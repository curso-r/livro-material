<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.2 O pacote dplyr | Ciência de Dados em R</title>
  <meta name="description" content="Livro com os tutoriais e material dos cursos sobre ciência de dados da Curso-R." />
  <meta name="generator" content="bookdown 0.22 and GitBook 2.6.7" />

  <meta property="og:title" content="7.2 O pacote dplyr | Ciência de Dados em R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="/assets/img/logo.png" />
  <meta property="og:description" content="Livro com os tutoriais e material dos cursos sobre ciência de dados da Curso-R." />
  <meta name="github-repo" content="curso-r/livro-material" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.2 O pacote dplyr | Ciência de Dados em R" />
  
  <meta name="twitter:description" content="Livro com os tutoriais e material dos cursos sobre ciência de dados da Curso-R." />
  <meta name="twitter:image" content="/assets/img/logo.png" />

<meta name="author" content="Curso-R" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="7-1-tibbles.html"/>
<link rel="next" href="7-3-tidyr.html"/>
<script src="libs/header-attrs-2.12/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.18/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script async defer src="https://hypothes.is/embed.js"></script>
<link href='https://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>
<!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-87272102-2"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-87272102-2');
</script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html"><img src = "https://raw.githubusercontent.com/curso-r/site-v2/master/static/img/logo_cursor_full.png" width = 80%></a></li>

<li class="divider"></li>
<li><a href="index.html#sobre">Sobre<span></span></a></li>
<li class="chapter" data-level="1" data-path="1-instalacao.html"><a href="1-instalacao.html"><i class="fa fa-check"></i><b>1</b> Instalação<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html"><i class="fa fa-check"></i><b>1.1</b> Instalação do R<span></span></a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html#no-windows"><i class="fa fa-check"></i><b>1.1.1</b> No Windows<span></span></a></li>
<li class="chapter" data-level="1.1.2" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html#no-linux"><i class="fa fa-check"></i><b>1.1.2</b> No Linux<span></span></a></li>
<li class="chapter" data-level="1.1.3" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html#no-macos"><i class="fa fa-check"></i><b>1.1.3</b> No MacOS<span></span></a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-2-instalacao-do-rstudio.html"><a href="1-2-instalacao-do-rstudio.html"><i class="fa fa-check"></i><b>1.2</b> Instalação do RStudio<span></span></a></li>
<li class="chapter" data-level="1.3" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html"><i class="fa fa-check"></i><b>1.3</b> Instalação de softwares adicionais<span></span></a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#instalacao-latex"><i class="fa fa-check"></i><b>1.3.1</b> LaTeX<span></span></a></li>
<li class="chapter" data-level="1.3.2" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#office"><i class="fa fa-check"></i><b>1.3.2</b> Office<span></span></a></li>
<li class="chapter" data-level="1.3.3" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#pagedown-e-chrome"><i class="fa fa-check"></i><b>1.3.3</b> Pagedown e Chrome<span></span></a></li>
<li class="chapter" data-level="1.3.4" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#renderizando-html-widgets"><i class="fa fa-check"></i><b>1.3.4</b> Renderizando HTML widgets<span></span></a></li>
<li class="chapter" data-level="1.3.5" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#blogdown"><i class="fa fa-check"></i><b>1.3.5</b> Blogdown<span></span></a></li>
<li class="chapter" data-level="1.3.6" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#ferramentas-de-desenvolvimento"><i class="fa fa-check"></i><b>1.3.6</b> Ferramentas de desenvolvimento<span></span></a></li>
<li class="chapter" data-level="1.3.7" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#git"><i class="fa fa-check"></i><b>1.3.7</b> Git<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-rstudio.html"><a href="2-rstudio.html"><i class="fa fa-check"></i><b>2</b> RStudio<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-1-telas.html"><a href="2-1-telas.html"><i class="fa fa-check"></i><b>2.1</b> Telas<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="2-2-atalhos.html"><a href="2-2-atalhos.html"><i class="fa fa-check"></i><b>2.2</b> Atalhos<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="2-3-projetos.html"><a href="2-3-projetos.html"><i class="fa fa-check"></i><b>2.3</b> Projetos<span></span></a></li>
<li class="chapter" data-level="2.4" data-path="2-4-git-e-versionamento.html"><a href="2-4-git-e-versionamento.html"><i class="fa fa-check"></i><b>2.4</b> Git e versionamento<span></span></a></li>
<li class="chapter" data-level="2.5" data-path="2-5-cheatsheets.html"><a href="2-5-cheatsheets.html"><i class="fa fa-check"></i><b>2.5</b> Cheatsheets<span></span></a></li>
<li class="chapter" data-level="2.6" data-path="2-6-addins.html"><a href="2-6-addins.html"><i class="fa fa-check"></i><b>2.6</b> Addins<span></span></a></li>
<li class="chapter" data-level="2.7" data-path="2-7-snippets.html"><a href="2-7-snippets.html"><i class="fa fa-check"></i><b>2.7</b> Snippets<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-r-base.html"><a href="3-r-base.html"><i class="fa fa-check"></i><b>3</b> R Básico<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html"><i class="fa fa-check"></i><b>3.1</b> Pedindo Ajuda<span></span></a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html#documentação-do-r"><i class="fa fa-check"></i><b>3.1.1</b> Documentação do R<span></span></a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html#google"><i class="fa fa-check"></i><b>3.1.2</b> Google<span></span></a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html#stack-overflow"><i class="fa fa-check"></i><b>3.1.3</b> Stack Overflow<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-2-r-como-calculadora.html"><a href="3-2-r-como-calculadora.html"><i class="fa fa-check"></i><b>3.2</b> R como calculadora<span></span></a>
<ul>
<li><a href="3-2-r-como-calculadora.html#exercícios">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-3-objetosFuncoes.html"><a href="3-3-objetosFuncoes.html"><i class="fa fa-check"></i><b>3.3</b> Objetos e funções<span></span></a>
<ul>
<li><a href="3-3-objetosFuncoes.html#exercícios-1">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-4-data-frames.html"><a href="3-4-data-frames.html"><i class="fa fa-check"></i><b>3.4</b> Data frames<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="3-5-classes.html"><a href="3-5-classes.html"><i class="fa fa-check"></i><b>3.5</b> Classes<span></span></a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="3-5-classes.html"><a href="3-5-classes.html#exercícios-2"><i class="fa fa-check"></i><b>3.5.1</b> Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="3-6-vetores.html"><a href="3-6-vetores.html"><i class="fa fa-check"></i><b>3.6</b> Vetores<span></span></a>
<ul>
<li><a href="3-6-vetores.html#exercícios-3">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="3-7-testes-lógicos.html"><a href="3-7-testes-lógicos.html"><i class="fa fa-check"></i><b>3.7</b> Testes lógicos<span></span></a>
<ul>
<li><a href="3-7-testes-lógicos.html#exercícios-4">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="3-8-valoresEspeciais.html"><a href="3-8-valoresEspeciais.html"><i class="fa fa-check"></i><b>3.8</b> Valores especiais<span></span></a>
<ul>
<li><a href="3-8-valoresEspeciais.html#exercícios-5">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="3-9-listas.html"><a href="3-9-listas.html"><i class="fa fa-check"></i><b>3.9</b> Listas<span></span></a></li>
<li class="chapter" data-level="3.10" data-path="3-10-mais-sobre-data-frames.html"><a href="3-10-mais-sobre-data-frames.html"><i class="fa fa-check"></i><b>3.10</b> Mais sobre data frames<span></span></a>
<ul>
<li><a href="3-10-mais-sobre-data-frames.html#exercícios-6">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="3-11-maisFuncoes.html"><a href="3-11-maisFuncoes.html"><i class="fa fa-check"></i><b>3.11</b> Mais sobre funções<span></span></a>
<ul>
<li><a href="3-11-maisFuncoes.html#exercícios-7">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.12" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html"><i class="fa fa-check"></i><b>3.12</b> Controle de Fluxo<span></span></a>
<ul>
<li class="chapter" data-level="3.12.1" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html#condicionamento-if-e-else"><i class="fa fa-check"></i><b>3.12.1</b> Condicionamento: if e else<span></span></a></li>
<li class="chapter" data-level="3.12.2" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html#iteradores-for-e-while"><i class="fa fa-check"></i><b>3.12.2</b> Iteradores: for e while<span></span></a></li>
<li><a href="3-12-controle-de-fluxo.html#exercícios-8">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html"><i class="fa fa-check"></i><b>3.13</b> Outros tópicos<span></span></a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html#matrizes"><i class="fa fa-check"></i><b>3.13.1</b> Matrizes<span></span></a></li>
<li class="chapter" data-level="3.13.2" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html#fatores"><i class="fa fa-check"></i><b>3.13.2</b> Fatores<span></span></a></li>
<li class="chapter" data-level="3.13.3" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html#gráficos-r-base"><i class="fa fa-check"></i><b>3.13.3</b> Gráficos (R base)<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-pacotes.html"><a href="4-pacotes.html"><i class="fa fa-check"></i><b>4</b> Pacotes<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html"><i class="fa fa-check"></i><b>4.1</b> Instalação de pacotes<span></span></a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html#via-cran"><i class="fa fa-check"></i><b>4.1.1</b> Via CRAN<span></span></a></li>
<li class="chapter" data-level="4.1.2" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html#via-github"><i class="fa fa-check"></i><b>4.1.2</b> Via Github<span></span></a></li>
<li class="chapter" data-level="4.1.3" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html#via-arquivo-.zip-ou-.tar.gz"><i class="fa fa-check"></i><b>4.1.3</b> Via arquivo .zip ou .tar.gz<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-2-tidyverse.html"><a href="4-2-tidyverse.html"><i class="fa fa-check"></i><b>4.2</b> Tidyverse<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-importacao.html"><a href="5-importacao.html"><i class="fa fa-check"></i><b>5</b> Importação<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-1-caminhos.html"><a href="5-1-caminhos.html"><i class="fa fa-check"></i><b>5.1</b> Caminhos<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="5-2-readr.html"><a href="5-2-readr.html"><i class="fa fa-check"></i><b>5.2</b> O pacote readr<span></span></a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5-2-readr.html"><a href="5-2-readr.html#lendo-arquivos-de-texto"><i class="fa fa-check"></i><b>5.2.1</b> Lendo arquivos de texto<span></span></a></li>
<li class="chapter" data-level="5.2.2" data-path="5-2-readr.html"><a href="5-2-readr.html#locale"><i class="fa fa-check"></i><b>5.2.2</b> Locale<span></span></a></li>
<li class="chapter" data-level="5.2.3" data-path="5-2-readr.html"><a href="5-2-readr.html#parseando-valores"><i class="fa fa-check"></i><b>5.2.3</b> Parseando valores<span></span></a></li>
<li class="chapter" data-level="5.2.4" data-path="5-2-readr.html"><a href="5-2-readr.html#escrevendo-arquivos-de-texto"><i class="fa fa-check"></i><b>5.2.4</b> Escrevendo arquivos de texto<span></span></a></li>
<li class="chapter" data-level="5.2.5" data-path="5-2-readr.html"><a href="5-2-readr.html#arquivos-.rds"><i class="fa fa-check"></i><b>5.2.5</b> Arquivos .rds<span></span></a></li>
<li><a href="5-2-readr.html#exercícios-9">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-3-readxl.html"><a href="5-3-readxl.html"><i class="fa fa-check"></i><b>5.3</b> Os pacotes readxl e writexl<span></span></a></li>
<li class="chapter" data-level="5.4" data-path="5-4-haven.html"><a href="5-4-haven.html"><i class="fa fa-check"></i><b>5.4</b> haven<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-pipe.html"><a href="6-pipe.html"><i class="fa fa-check"></i><b>6</b> Pipe<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-1-o-operador-pipe.html"><a href="6-1-o-operador-pipe.html"><i class="fa fa-check"></i><b>6.1</b> O operador pipe<span></span></a>
<ul>
<li><a href="6-1-o-operador-pipe.html#exercícios-10">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-2-outros-operadores.html"><a href="6-2-outros-operadores.html"><i class="fa fa-check"></i><b>6.2</b> Outros operadores<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-manipulacao.html"><a href="7-manipulacao.html"><i class="fa fa-check"></i><b>7</b> Manipulação<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="7-1-tibbles.html"><a href="7-1-tibbles.html"><i class="fa fa-check"></i><b>7.1</b> Tibbles<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html"><i class="fa fa-check"></i><b>7.2</b> O pacote dplyr<span></span></a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#selecionando-colunas"><i class="fa fa-check"></i><b>7.2.1</b> Selecionando colunas<span></span></a></li>
<li class="chapter" data-level="7.2.2" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#ordenando-a-base"><i class="fa fa-check"></i><b>7.2.2</b> Ordenando a base<span></span></a></li>
<li class="chapter" data-level="7.2.3" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#o-pipe-em-ação"><i class="fa fa-check"></i><b>7.2.3</b> O pipe em ação<span></span></a></li>
<li class="chapter" data-level="7.2.4" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#filtrando-linhas"><i class="fa fa-check"></i><b>7.2.4</b> Filtrando linhas<span></span></a></li>
<li class="chapter" data-level="7.2.5" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#modificando-e-criando-novas-colunas"><i class="fa fa-check"></i><b>7.2.5</b> Modificando e criando novas colunas<span></span></a></li>
<li class="chapter" data-level="7.2.6" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#sumarizando-a-base"><i class="fa fa-check"></i><b>7.2.6</b> Sumarizando a base<span></span></a></li>
<li class="chapter" data-level="7.2.7" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#juntando-duas-bases"><i class="fa fa-check"></i><b>7.2.7</b> Juntando duas bases<span></span></a></li>
<li class="chapter" data-level="7.2.8" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#dplyr-1.0"><i class="fa fa-check"></i><b>7.2.8</b> dplyr 1.0<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html"><i class="fa fa-check"></i><b>7.3</b> O pacote tidyr<span></span></a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#separate-e-unite"><i class="fa fa-check"></i><b>7.3.1</b> <code>separate()</code> e <code>unite()</code><span></span></a></li>
<li class="chapter" data-level="7.3.2" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#pivotagem"><i class="fa fa-check"></i><b>7.3.2</b> Pivotagem<span></span></a></li>
<li class="chapter" data-level="7.3.3" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#list-columns"><i class="fa fa-check"></i><b>7.3.3</b> <em>List columns</em><span></span></a></li>
<li class="chapter" data-level="7.3.4" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#exercícios-18"><i class="fa fa-check"></i><b>7.3.4</b> Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html"><i class="fa fa-check"></i><b>7.4</b> O pacote stringr<span></span></a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#introdução"><i class="fa fa-check"></i><b>7.4.1</b> Introdução<span></span></a></li>
<li class="chapter" data-level="7.4.2" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#funções-básicas"><i class="fa fa-check"></i><b>7.4.2</b> Funções básicas<span></span></a></li>
<li class="chapter" data-level="7.4.3" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#expressões-regulares"><i class="fa fa-check"></i><b>7.4.3</b> Expressões Regulares<span></span></a></li>
<li class="chapter" data-level="7.4.4" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#funções-que-utilizam-regex"><i class="fa fa-check"></i><b>7.4.4</b> Funções que utilizam regex<span></span></a></li>
<li class="chapter" data-level="7.4.5" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#exercícios-19"><i class="fa fa-check"></i><b>7.4.5</b> Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="7-5-o-pacote-lubridate.html"><a href="7-5-o-pacote-lubridate.html"><i class="fa fa-check"></i><b>7.5</b> O pacote lubridate<span></span></a>
<ul>
<li class="chapter" data-level="7.5.1" data-path="7-5-o-pacote-lubridate.html"><a href="7-5-o-pacote-lubridate.html#a-classe-date"><i class="fa fa-check"></i><b>7.5.1</b> A classe <code>date</code><span></span></a></li>
<li class="chapter" data-level="7.5.2" data-path="7-5-o-pacote-lubridate.html"><a href="7-5-o-pacote-lubridate.html#funções-úteis"><i class="fa fa-check"></i><b>7.5.2</b> Funções úteis<span></span></a></li>
<li class="chapter" data-level="7.5.3" data-path="7-5-o-pacote-lubridate.html"><a href="7-5-o-pacote-lubridate.html#fusos-horários"><i class="fa fa-check"></i><b>7.5.3</b> Fusos horários<span></span></a></li>
<li class="chapter" data-level="7.5.4" data-path="7-5-o-pacote-lubridate.html"><a href="7-5-o-pacote-lubridate.html#operações-com-datas"><i class="fa fa-check"></i><b>7.5.4</b> Operações com datas<span></span></a></li>
<li class="chapter" data-level="7.5.5" data-path="7-5-o-pacote-lubridate.html"><a href="7-5-o-pacote-lubridate.html#exercícios-20"><i class="fa fa-check"></i><b>7.5.5</b> Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7.6" data-path="7-6-forcats.html"><a href="7-6-forcats.html"><i class="fa fa-check"></i><b>7.6</b> O pacote forcats<span></span></a>
<ul>
<li class="chapter" data-level="7.6.1" data-path="7-6-forcats.html"><a href="7-6-forcats.html#o-que-são-fatores"><i class="fa fa-check"></i><b>7.6.1</b> O que são fatores?<span></span></a></li>
<li class="chapter" data-level="7.6.2" data-path="7-6-forcats.html"><a href="7-6-forcats.html#modificando-níveis-de-um-fator"><i class="fa fa-check"></i><b>7.6.2</b> Modificando níveis de um fator<span></span></a></li>
<li class="chapter" data-level="7.6.3" data-path="7-6-forcats.html"><a href="7-6-forcats.html#mudando-a-ordem-dos-níveis-de-um-fator"><i class="fa fa-check"></i><b>7.6.3</b> Mudando a ordem dos níveis de um fator<span></span></a></li>
<li class="chapter" data-level="7.6.4" data-path="7-6-forcats.html"><a href="7-6-forcats.html#colapsando-níveis-de-um-fator"><i class="fa fa-check"></i><b>7.6.4</b> Colapsando níveis de um fator<span></span></a></li>
<li class="chapter" data-level="7.6.5" data-path="7-6-forcats.html"><a href="7-6-forcats.html#outras-funções-úteis"><i class="fa fa-check"></i><b>7.6.5</b> Outras funções úteis<span></span></a></li>
<li class="chapter" data-level="7.6.6" data-path="7-6-forcats.html"><a href="7-6-forcats.html#exercícios-21"><i class="fa fa-check"></i><b>7.6.6</b> Exercícios<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-graficos.html"><a href="8-graficos.html"><i class="fa fa-check"></i><b>8</b> Visualização<span></span></a>
<ul>
<li class="chapter" data-level="8.1" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html"><i class="fa fa-check"></i><b>8.1</b> O pacote ggplot2<span></span></a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#gráficos-de-pontos-dispersão"><i class="fa fa-check"></i><b>8.1.1</b> Gráficos de pontos (dispersão)<span></span></a></li>
<li class="chapter" data-level="8.1.2" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#gráficos-de-linhas"><i class="fa fa-check"></i><b>8.1.2</b> Gráficos de linhas<span></span></a></li>
<li class="chapter" data-level="8.1.3" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#gráficos-de-barras"><i class="fa fa-check"></i><b>8.1.3</b> Gráficos de barras<span></span></a></li>
<li class="chapter" data-level="8.1.4" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#histogramas-e-boxplots"><i class="fa fa-check"></i><b>8.1.4</b> Histogramas e boxplots<span></span></a></li>
<li class="chapter" data-level="8.1.5" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#títulos-e-labels"><i class="fa fa-check"></i><b>8.1.5</b> Títulos e <em>labels</em><span></span></a></li>
<li class="chapter" data-level="8.1.6" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#escalas"><i class="fa fa-check"></i><b>8.1.6</b> Escalas<span></span></a></li>
<li class="chapter" data-level="8.1.7" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#temas"><i class="fa fa-check"></i><b>8.1.7</b> Temas<span></span></a></li>
<li class="chapter" data-level="8.1.8" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#juntando-gráficos"><i class="fa fa-check"></i><b>8.1.8</b> Juntando gráficos<span></span></a></li>
<li class="chapter" data-level="8.1.9" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#exercícios-22"><i class="fa fa-check"></i><b>8.1.9</b> Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-2-extensões-do-pacote-ggplot2.html"><a href="8-2-extensões-do-pacote-ggplot2.html"><i class="fa fa-check"></i><b>8.2</b> Extensões do pacote ggplot2<span></span></a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8-2-extensões-do-pacote-ggplot2.html"><a href="8-2-extensões-do-pacote-ggplot2.html#gghighlight"><i class="fa fa-check"></i><b>8.2.1</b> gghighlight<span></span></a></li>
<li class="chapter" data-level="8.2.2" data-path="8-2-extensões-do-pacote-ggplot2.html"><a href="8-2-extensões-do-pacote-ggplot2.html#ggridges"><i class="fa fa-check"></i><b>8.2.2</b> ggridges<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-relatorios.html"><a href="9-relatorios.html"><i class="fa fa-check"></i><b>9</b> Relatórios<span></span></a>
<ul>
<li class="chapter" data-level="9.1" data-path="9-1-markdown.html"><a href="9-1-markdown.html"><i class="fa fa-check"></i><b>9.1</b> Markdown<span></span></a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="9-1-markdown.html"><a href="9-1-markdown.html#ênfase"><i class="fa fa-check"></i><b>9.1.1</b> Ênfase<span></span></a></li>
<li class="chapter" data-level="9.1.2" data-path="9-1-markdown.html"><a href="9-1-markdown.html#títulos"><i class="fa fa-check"></i><b>9.1.2</b> Títulos<span></span></a></li>
<li class="chapter" data-level="9.1.3" data-path="9-1-markdown.html"><a href="9-1-markdown.html#listas-1"><i class="fa fa-check"></i><b>9.1.3</b> Listas<span></span></a></li>
<li class="chapter" data-level="9.1.4" data-path="9-1-markdown.html"><a href="9-1-markdown.html#equações"><i class="fa fa-check"></i><b>9.1.4</b> Equações<span></span></a></li>
<li class="chapter" data-level="9.1.5" data-path="9-1-markdown.html"><a href="9-1-markdown.html#código"><i class="fa fa-check"></i><b>9.1.5</b> Código<span></span></a></li>
<li class="chapter" data-level="9.1.6" data-path="9-1-markdown.html"><a href="9-1-markdown.html#links"><i class="fa fa-check"></i><b>9.1.6</b> Links<span></span></a></li>
<li class="chapter" data-level="9.1.7" data-path="9-1-markdown.html"><a href="9-1-markdown.html#imagens"><i class="fa fa-check"></i><b>9.1.7</b> Imagens<span></span></a></li>
<li class="chapter" data-level="9.1.8" data-path="9-1-markdown.html"><a href="9-1-markdown.html#tabelas"><i class="fa fa-check"></i><b>9.1.8</b> Tabelas<span></span></a></li>
<li class="chapter" data-level="9.1.9" data-path="9-1-markdown.html"><a href="9-1-markdown.html#recapitulando"><i class="fa fa-check"></i><b>9.1.9</b> Recapitulando<span></span></a></li>
<li><a href="9-1-markdown.html#exercicios-md">Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html"><i class="fa fa-check"></i><b>9.2</b> R Markdown<span></span></a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#criando-um-arquivo-.rmd"><i class="fa fa-check"></i><b>9.2.1</b> Criando um arquivo <code>.Rmd</code><span></span></a></li>
<li class="chapter" data-level="9.2.2" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#estrutura-do-arquivo-r-markdown"><i class="fa fa-check"></i><b>9.2.2</b> Estrutura do arquivo R Markdown<span></span></a></li>
<li class="chapter" data-level="9.2.3" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#adicionando-conteúdo"><i class="fa fa-check"></i><b>9.2.3</b> Adicionando conteúdo<span></span></a></li>
<li class="chapter" data-level="9.2.4" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#dicas-para-o-rstudio"><i class="fa fa-check"></i><b>9.2.4</b> Dicas para o RStudio<span></span></a></li>
<li><a href="9-2-r-markdown.html#exercicios-rmd">Exercícios<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-funcionais.html"><a href="10-funcionais.html"><i class="fa fa-check"></i><b>10</b> Programação funcional (purrr)<span></span></a>
<ul>
<li class="chapter" data-level="10.1" data-path="10-1-iterações-básicas.html"><a href="10-1-iterações-básicas.html"><i class="fa fa-check"></i><b>10.1</b> Iterações básicas<span></span></a></li>
<li class="chapter" data-level="10.2" data-path="10-2-iterações-intermediárias.html"><a href="10-2-iterações-intermediárias.html"><i class="fa fa-check"></i><b>10.2</b> Iterações intermediárias<span></span></a></li>
<li class="chapter" data-level="10.3" data-path="10-3-iterações-avançadas.html"><a href="10-3-iterações-avançadas.html"><i class="fa fa-check"></i><b>10.3</b> Iterações avançadas<span></span></a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="10-3-iterações-avançadas.html"><a href="10-3-iterações-avançadas.html#iterações-com-condicionais"><i class="fa fa-check"></i><b>10.3.1</b> Iterações com condicionais<span></span></a></li>
<li class="chapter" data-level="10.3.2" data-path="10-3-iterações-avançadas.html"><a href="10-3-iterações-avançadas.html#iterações-com-tabelas-e-funções"><i class="fa fa-check"></i><b>10.3.2</b> Iterações com tabelas e funções<span></span></a></li>
<li class="chapter" data-level="10.3.3" data-path="10-3-iterações-avançadas.html"><a href="10-3-iterações-avançadas.html#redução-e-acúmulo"><i class="fa fa-check"></i><b>10.3.3</b> Redução e acúmulo<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.4" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html"><i class="fa fa-check"></i><b>10.4</b> Miscelânea<span></span></a>
<ul>
<li class="chapter" data-level="10.4.1" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html#manter-e-descartar"><i class="fa fa-check"></i><b>10.4.1</b> Manter e descartar<span></span></a></li>
<li class="chapter" data-level="10.4.2" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html#a-família-is"><i class="fa fa-check"></i><b>10.4.2</b> A família <code>is</code><span></span></a></li>
<li class="chapter" data-level="10.4.3" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html#andar-e-modificar"><i class="fa fa-check"></i><b>10.4.3</b> Andar e modificar<span></span></a></li>
<li class="chapter" data-level="10.4.4" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html#transposição-e-indexação-profunda"><i class="fa fa-check"></i><b>10.4.4</b> Transposição e indexação profunda<span></span></a></li>
<li class="chapter" data-level="10.4.5" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html#aplicação-parcial"><i class="fa fa-check"></i><b>10.4.5</b> Aplicação parcial<span></span></a></li>
<li class="chapter" data-level="10.4.6" data-path="10-4-miscelânea-1.html"><a href="10-4-miscelânea-1.html#execução-segura"><i class="fa fa-check"></i><b>10.4.6</b> Execução segura<span></span></a></li>
</ul></li>
<li class="chapter" data-level="10.5" data-path="10-5-exercícios-23.html"><a href="10-5-exercícios-23.html"><i class="fa fa-check"></i><b>10.5</b> Exercícios<span></span></a></li>
</ul></li>
<li class="chapter" data-level="11" data-path="11-ravancado.html"><a href="11-ravancado.html"><i class="fa fa-check"></i><b>11</b> R avançado<span></span></a>
<ul>
<li class="chapter" data-level="11.1" data-path="11-1-nse.html"><a href="11-1-nse.html"><i class="fa fa-check"></i><b>11.1</b> NSE<span></span></a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="11-1-nse.html"><a href="11-1-nse.html#o-que-é"><i class="fa fa-check"></i><b>11.1.1</b> O que é?<span></span></a></li>
<li class="chapter" data-level="11.1.2" data-path="11-1-nse.html"><a href="11-1-nse.html#tidy-evaluation"><i class="fa fa-check"></i><b>11.1.2</b> Tidy evaluation<span></span></a></li>
<li class="chapter" data-level="11.1.3" data-path="11-1-nse.html"><a href="11-1-nse.html#curly-curly"><i class="fa fa-check"></i><b>11.1.3</b> Curly-curly<span></span></a></li>
<li class="chapter" data-level="11.1.4" data-path="11-1-nse.html"><a href="11-1-nse.html#strings-como-argumentos"><i class="fa fa-check"></i><b>11.1.4</b> Strings como argumentos<span></span></a></li>
<li class="chapter" data-level="11.1.5" data-path="11-1-nse.html"><a href="11-1-nse.html#exercícios-24"><i class="fa fa-check"></i><b>11.1.5</b> Exercícios<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-misc.html"><a href="12-misc.html"><i class="fa fa-check"></i><b>12</b> Miscelânea<span></span></a>
<ul>
<li class="chapter" data-level="12.1" data-path="12-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="12-1-arrumando-banco-de-dados-o-pacote-janitor.html"><i class="fa fa-check"></i><b>12.1</b> Arrumando banco de dados: o pacote janitor<span></span></a>
<ul>
<li class="chapter" data-level="12.1.1" data-path="12-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="12-1-arrumando-banco-de-dados-o-pacote-janitor.html#arrumando-o-nome-das-variáveis"><i class="fa fa-check"></i><b>12.1.1</b> Arrumando o nome das variáveis<span></span></a></li>
<li class="chapter" data-level="12.1.2" data-path="12-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="12-1-arrumando-banco-de-dados-o-pacote-janitor.html#removendo-linhas-e-colunas-vazias"><i class="fa fa-check"></i><b>12.1.2</b> Removendo linhas e colunas vazias<span></span></a></li>
<li class="chapter" data-level="12.1.3" data-path="12-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="12-1-arrumando-banco-de-dados-o-pacote-janitor.html#identificando-linhas-duplicadas"><i class="fa fa-check"></i><b>12.1.3</b> Identificando linhas duplicadas<span></span></a></li>
<li class="chapter" data-level="12.1.4" data-path="12-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="12-1-arrumando-banco-de-dados-o-pacote-janitor.html#outras-funções"><i class="fa fa-check"></i><b>12.1.4</b> Outras funções<span></span></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="13" data-path="13-respostas.html"><a href="13-respostas.html"><i class="fa fa-check"></i><b>13</b> Respostas<span></span></a>
<ul>
<li class="chapter" data-level="13.1" data-path="13-1-r-básico.html"><a href="13-1-r-básico.html"><i class="fa fa-check"></i><b>13.1</b> R básico<span></span></a>
<ul>
<li><a href="13-1-r-básico.html#r-como-calculadora-1">R como calculadora<span></span></a></li>
<li><a href="13-1-r-básico.html#objetos-e-funções">Objetos e funções<span></span></a></li>
<li><a href="13-1-r-básico.html#classes-1">Classes<span></span></a></li>
<li><a href="13-1-r-básico.html#vetores-1">Vetores<span></span></a></li>
<li><a href="13-1-r-básico.html#testes-lógicos-1">Testes lógicos<span></span></a></li>
<li><a href="13-1-r-básico.html#valores-especiais">Valores especiais<span></span></a></li>
<li><a href="13-1-r-básico.html#data-frames-1">Data frames<span></span></a></li>
<li><a href="13-1-r-básico.html#mais-sobre-funções">Mais sobre funções<span></span></a></li>
<li><a href="13-1-r-básico.html#controle-de-fluxo-1">Controle de fluxo<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="13-2-importação.html"><a href="13-2-importação.html"><i class="fa fa-check"></i><b>13.2</b> Importação<span></span></a>
<ul>
<li><a href="13-2-importação.html#o-pacote-readr">O pacote readr<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.3" data-path="13-3-pipe-1.html"><a href="13-3-pipe-1.html"><i class="fa fa-check"></i><b>13.3</b> Pipe<span></span></a></li>
<li class="chapter" data-level="13.4" data-path="13-4-o-pacote-dplyr.html"><a href="13-4-o-pacote-dplyr.html"><i class="fa fa-check"></i><b>13.4</b> O pacote dplyr<span></span></a>
<ul>
<li><a href="13-4-o-pacote-dplyr.html#selecionando-colunas-1">Selecionando colunas<span></span></a></li>
<li><a href="13-4-o-pacote-dplyr.html#ordenando-a-base-1">Ordenando a base<span></span></a></li>
<li><a href="13-4-o-pacote-dplyr.html#filtrando-linhas-1">Filtrando linhas<span></span></a></li>
<li><a href="13-4-o-pacote-dplyr.html#modificando-e-criando-novas-colunas-1">Modificando e criando novas colunas<span></span></a></li>
<li><a href="13-4-o-pacote-dplyr.html#sumarizando-a-base-1">Sumarizando a base<span></span></a></li>
<li><a href="13-4-o-pacote-dplyr.html#juntando-duas-bases-1">Juntando duas bases<span></span></a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="13-5-o-pacote-stringr-1.html"><a href="13-5-o-pacote-stringr-1.html"><i class="fa fa-check"></i><b>13.5</b> O pacote stringr<span></span></a></li>
<li class="chapter" data-level="13.6" data-path="13-6-o-pacote-lubridate-1.html"><a href="13-6-o-pacote-lubridate-1.html"><i class="fa fa-check"></i><b>13.6</b> O pacote lubridate<span></span></a></li>
<li class="chapter" data-level="13.7" data-path="13-7-o-pacote-forcats.html"><a href="13-7-o-pacote-forcats.html"><i class="fa fa-check"></i><b>13.7</b> O pacote forcats<span></span></a></li>
<li class="chapter" data-level="13.8" data-path="13-8-o-pacote-ggplot2-1.html"><a href="13-8-o-pacote-ggplot2-1.html"><i class="fa fa-check"></i><b>13.8</b> O pacote ggplot2<span></span></a></li>
<li class="chapter" data-level="13.9" data-path="13-9-programação-funcional-purrr.html"><a href="13-9-programação-funcional-purrr.html"><i class="fa fa-check"></i><b>13.9</b> Programação funcional (purrr)<span></span></a></li>
<li class="chapter" data-level="13.10" data-path="13-10-nse-1.html"><a href="13-10-nse-1.html"><i class="fa fa-check"></i><b>13.10</b> NSE<span></span></a></li>
</ul></li>
<li><a href="referências.html#referências">Referências<span></span></a>
<ul>
<li><a href="referências.html#allison-horst">Allison Horst<span></span></a></li>
<li><a href="referências.html#programação-em-r">Programação em R<span></span></a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado com bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ciência de Dados em R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level2 hasAnchor" number="7.2">
<h2><span class="header-section-number">7.2</span> O pacote dplyr<a href="7-2-dplyr.html#dplyr" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>O <code>dplyr</code> é o pacote mais útil para realizar transformação de dados, aliando simplicidade e eficiência de uma forma elegante. Os scripts em R que fazem uso inteligente dos verbos <code>dplyr</code> e as facilidades do operador <em>pipe</em> tendem a ficar mais legíveis e organizados, sem perder velocidade de execução.</p>
<p>As principais funções do <code>dplyr</code> são:</p>
<ul>
<li><code>select()</code> - seleciona colunas</li>
<li><code>arrange()</code> - ordena a base</li>
<li><code>filter()</code> - filtra linhas</li>
<li><code>mutate()</code> - cria/modifica colunas</li>
<li><code>group_by()</code> - agrupa a base</li>
<li><code>summarise()</code> - sumariza a base</li>
</ul>
<p>Todas essas funções seguem as mesmas características:</p>
<ul>
<li>O <em>input</em> é sempre uma <code>tibble</code> e o <em>output</em> é sempre uma <code>tibble</code>.</li>
<li>Colocamos a <code>tibble</code> no primeiro argumento e o que queremos fazer nos outros argumentos.</li>
<li>A utilização é facilitada com o emprego do operador <code>%&gt;%</code>.</li>
</ul>
<p>As principais vantagens de se usar o <code>dplyr</code> em detrimento das funções do R base são:</p>
<ul>
<li>Manipular dados se torna uma tarefa muito mais simples.</li>
<li>O código fica mais intuitivo de ser escrito e mais simples de ser lido.</li>
<li>O pacote <code>dplyr</code> utiliza <code>C</code> e <code>C++</code> por trás da maioria das funções, o que geralmente torna o código mais rápido.</li>
<li>É possível trabalhar com diferentes fontes de dados, como bases relacionais (SQL) e <code>data.table</code>.</li>
</ul>
<p>Se você ainda não tiver o <code>dplyr</code> instalado, rode o código abaixo.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="7-2-dplyr.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb236-2"><a href="7-2-dplyr.html#cb236-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Neste capítulo, vamos trabalhar com uma base de filmes do IMDB. Essa base pode ser baixada <a href="https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds">clicando aqui</a>.</p>
<p>Assim, utilizaremos o objeto <code>imdb</code> para acessar os dados.</p>
<div class="sourceCode" id="cb237"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb237-1"><a href="7-2-dplyr.html#cb237-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">&quot;imdb.rds&quot;</span>)</span>
<span id="cb237-2"><a href="7-2-dplyr.html#cb237-2" aria-hidden="true" tabindex="-1"></a>imdb</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Agora, vamos avaliar com mais detalhes as principais funções do pacote <code>dplyr</code>.</p>
<div id="selecionando-colunas" class="section level3 hasAnchor" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Selecionando colunas<a href="7-2-dplyr.html#selecionando-colunas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para selecionar colunas, utilizamos a função <code>select()</code>.</p>
<p>O primeiro argumento da função é a base de dados e os demais argumentos são os nomes das colunas que você gostaria de selecionar. Repare que você não precisa colocar o nome da coluna entre aspas.</p>
<div class="sourceCode" id="cb239"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb239-1"><a href="7-2-dplyr.html#cb239-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, titulo)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 1
##    titulo                                     
##    &lt;chr&gt;                                      
##  1 Avatar                                     
##  2 Pirates of the Caribbean: At World&#39;s End   
##  3 The Dark Knight Rises                      
##  4 John Carter                                
##  5 Spider-Man 3                               
##  6 Tangled                                    
##  7 Avengers: Age of Ultron                    
##  8 Batman v Superman: Dawn of Justice         
##  9 Superman Returns                           
## 10 Pirates of the Caribbean: Dead Man&#39;s Chest 
## # … with 3,797 more rows</code></pre>
<p>Você também pode selecionar várias colunas.</p>
<div class="sourceCode" id="cb241"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb241-1"><a href="7-2-dplyr.html#cb241-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, titulo, ano, orcamento)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 3
##    titulo                                        ano orcamento
##    &lt;chr&gt;                                       &lt;int&gt;     &lt;int&gt;
##  1 Avatar                                       2009 237000000
##  2 Pirates of the Caribbean: At World&#39;s End     2007 300000000
##  3 The Dark Knight Rises                        2012 250000000
##  4 John Carter                                  2012 263700000
##  5 Spider-Man 3                                 2007 258000000
##  6 Tangled                                      2010 260000000
##  7 Avengers: Age of Ultron                      2015 250000000
##  8 Batman v Superman: Dawn of Justice           2016 250000000
##  9 Superman Returns                             2006 209000000
## 10 Pirates of the Caribbean: Dead Man&#39;s Chest   2006 225000000
## # … with 3,797 more rows</code></pre>
<p>O operador <code>:</code> é muito útil para selecionar colunas consecutivas.</p>
<div class="sourceCode" id="cb243"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb243-1"><a href="7-2-dplyr.html#cb243-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, titulo<span class="sc">:</span>cor)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 5
##    titulo                                     ano diretor          duracao cor  
##    &lt;chr&gt;                                    &lt;int&gt; &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;
##  1 Avatar                                    2009 James Cameron        178 Color
##  2 Pirates of the Caribbean: At World&#39;s En…  2007 Gore Verbinski       169 Color
##  3 The Dark Knight Rises                     2012 Christopher Nol…     164 Color
##  4 John Carter                               2012 Andrew Stanton       132 Color
##  5 Spider-Man 3                              2007 Sam Raimi            156 Color
##  6 Tangled                                   2010 Nathan Greno         100 Color
##  7 Avengers: Age of Ultron                   2015 Joss Whedon          141 Color
##  8 Batman v Superman: Dawn of Justice        2016 Zack Snyder          183 Color
##  9 Superman Returns                          2006 Bryan Singer         169 Color
## 10 Pirates of the Caribbean: Dead Man&#39;s Ch…  2006 Gore Verbinski       151 Color
## # … with 3,797 more rows</code></pre>
<p>O <code>dplyr</code> possui um conjunto de funções auxiliares muito úteis para seleção de colunas. As principais são:</p>
<ul>
<li><code>starts_with()</code>: para colunas que começam com um texto padrão</li>
<li><code>ends_with()</code>: para colunas que terminam com um texto padrão</li>
<li><code>contains()</code>: para colunas que contêm um texto padrão</li>
</ul>
<p>Selecionamos a seguir todas as colunas que começam com o texto “ator”.</p>
<div class="sourceCode" id="cb245"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb245-1"><a href="7-2-dplyr.html#cb245-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, <span class="fu">starts_with</span>(<span class="st">&quot;ator&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 3
##    ator_1          ator_2            ator_3              
##    &lt;chr&gt;           &lt;chr&gt;             &lt;chr&gt;               
##  1 CCH Pounder     Joel David Moore  Wes Studi           
##  2 Johnny Depp     Orlando Bloom     Jack Davenport      
##  3 Tom Hardy       Christian Bale    Joseph Gordon-Levitt
##  4 Daryl Sabara    Samantha Morton   Polly Walker        
##  5 J.K. Simmons    James Franco      Kirsten Dunst       
##  6 Brad Garrett    Donna Murphy      M.C. Gainey         
##  7 Chris Hemsworth Robert Downey Jr. Scarlett Johansson  
##  8 Henry Cavill    Lauren Cohan      Alan D. Purwin      
##  9 Kevin Spacey    Marlon Brando     Frank Langella      
## 10 Johnny Depp     Orlando Bloom     Jack Davenport      
## # … with 3,797 more rows</code></pre>
<p>Para retirar colunas da base, base acrescentar um <code>-</code> antes da seleção.</p>
<div class="sourceCode" id="cb247"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb247-1"><a href="7-2-dplyr.html#cb247-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, <span class="sc">-</span>ano, <span class="sc">-</span> diretor)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 13
##    titulo  duracao cor   generos pais  classificacao orcamento receita nota_imdb
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1 Avatar      178 Color Action… USA   A partir de … 237000000  7.61e8       7.9
##  2 Pirate…     169 Color Action… USA   A partir de … 300000000  3.09e8       7.1
##  3 The Da…     164 Color Action… USA   A partir de … 250000000  4.48e8       8.5
##  4 John C…     132 Color Action… USA   A partir de … 263700000  7.31e7       6.6
##  5 Spider…     156 Color Action… USA   A partir de … 258000000  3.37e8       6.2
##  6 Tangle…     100 Color Advent… USA   Livre         260000000  2.01e8       7.8
##  7 Avenge…     141 Color Action… USA   A partir de … 250000000  4.59e8       7.5
##  8 Batman…     183 Color Action… USA   A partir de … 250000000  3.30e8       6.9
##  9 Superm…     169 Color Action… USA   A partir de … 209000000  2.00e8       6.1
## 10 Pirate…     151 Color Action… USA   A partir de … 225000000  4.23e8       7.3
## # … with 3,797 more rows, and 4 more variables: likes_facebook &lt;int&gt;,
## #   ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb249"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb249-1"><a href="7-2-dplyr.html#cb249-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, <span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;ator&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 12
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 3 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;</code></pre>
<div id="exercícios-11" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-11" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Teste aplicar a função <code>glimpse()</code> do pacote <code>{dplyr}</code> à base <code>imdb</code>. O que ela faz?</p>
<p><strong>2.</strong> Crie uma tabela com apenas as colunas <code>titulo</code>, <code>diretor</code>, e <code>orcamento.</code> Salve em um objeto chamado <code>imdb_simples</code>.</p>
<p><strong>3.</strong> Selecione apenas as colunas <code>ator_1</code>, <code>ator_2</code> e <code>ator_3</code> usando a função auxiliar <code>contains()</code>.</p>
<p><strong>4.</strong> Usando a função <code>select()</code> (e suas funções auxiliares), escreva códigos que retornem a base IMDB sem as colunas <code>ator_1</code>, <code>ator_2</code> e <code>ator_3.</code> Escreva todas as soluções diferentes que você conseguir pensar.</p>
</div>
</div>
<div id="ordenando-a-base" class="section level3 hasAnchor" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Ordenando a base<a href="7-2-dplyr.html#ordenando-a-base" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para ordenar linhas, utilizamos a função <code>arrange()</code>. O primeiro argumento é a base de dados. Os demais argumentos são as colunas pelas quais queremos ordenar as linhas. No exemplo a seguir, ordenamos as linhas da base por ordem crescente de orçamento.</p>
<div class="sourceCode" id="cb251"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb251-1"><a href="7-2-dplyr.html#cb251-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(imdb, orcamento)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Tarnati…  2003 Jonatha…      88 Color Biograph… USA   Outros              218
##  2 My Date…  2004 Jon Gunn      90 Color Document… USA   Livre              1100
##  3 A Plagu…  2013 Benjami…      76 Color Drama|Ho… USA   Outros             1400
##  4 The Mon…  2005 Anthony…      84 Color Crime|Dr… USA   A partir de …      3250
##  5 Primer    2004 Shane C…      77 Color Drama|Sc… USA   A partir de …      7000
##  6 El Mari…  1992 Robert …      81 Color Action|C… USA   A partir de …      7000
##  7 Newlywe…  2011 Edward …      95 Color Comedy|D… USA   Outros             9000
##  8 Pink Fl…  1972 John Wa…     108 Color Comedy|C… USA   A partir de …     10000
##  9 The Tou…  2007 Jane Cl…       7 Color Romance|… USA   Outros            13000
## 10 Paranor…  2007 Oren Pe…      84 Color Horror    USA   A partir de …     15000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Também podemos ordenar de forma decrescente usando a função <code>desc()</code>.</p>
<div class="sourceCode" id="cb253"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb253-1"><a href="7-2-dplyr.html#cb253-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(imdb, <span class="fu">desc</span>(orcamento))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  2 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  3 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  4 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Pirates…  2011 Rob Mar…     136 Color Action|A… USA   A partir de … 250000000
## 10 Captain…  2016 Anthony…     147 Color Action|A… USA   A partir de … 250000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>E claro, ordenar segundo duas ou mais colunas.</p>
<div class="sourceCode" id="cb255"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb255-1"><a href="7-2-dplyr.html#cb255-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(imdb, <span class="fu">desc</span>(ano), <span class="fu">desc</span>(orcamento))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Batman v…  2016 Zack Sn…     183 Color Action|… USA   A partir de … 250000000
##  2 Captain …  2016 Anthony…     147 Color Action|… USA   A partir de … 250000000
##  3 Star Tre…  2016 Justin …     122 Color Action|… USA   A partir de … 185000000
##  4 The Lege…  2016 David Y…     110 Color Action|… USA   A partir de … 180000000
##  5 The Lege…  2016 David Y…     110 Color Action|… USA   A partir de … 180000000
##  6 X-Men: A…  2016 Bryan S…     144 Color Action|… USA   A partir de … 178000000
##  7 Suicide …  2016 David A…     123 Color Action|… USA   A partir de … 175000000
##  8 Alice Th…  2016 James B…     113 Color Adventu… USA   Livre         170000000
##  9 Independ…  2016 Roland …     120 Color Action|… USA   A partir de … 165000000
## 10 Warcraft   2016 Duncan …     123 Color Action|… USA   A partir de … 160000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div id="exercícios-12" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-12" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Ordene os filmes em ordem crescente de <code>ano</code> e decrescente de <code>receita</code> e salve em um objeto chamado <code>filmes_ordenados</code>.</p>
<p><strong>2.</strong> Selecione apenas as colunas <code>titulo</code> e <code>orcamento</code> e então ordene de forma decrescente pelo <code>orcamento.</code></p>
</div>
</div>
<div id="o-pipe-em-ação" class="section level3 hasAnchor" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> O pipe em ação<a href="7-2-dplyr.html#o-pipe-em-ação" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Na grande maioria dos casos, vamos aplicar mais de uma função de manipulação em uma base para obtermos a tabela que desejamos. Poderíamos, por exemplo, querer uma tabela apenas com o título e ano dos filmes, ordenada de forma crescente de lançamento. Para fazer isso, poderíamos aninhar as funções</p>
<div class="sourceCode" id="cb257"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb257-1"><a href="7-2-dplyr.html#cb257-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">select</span>(imdb, titulo, ano), ano)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 2
##    titulo                                              ano
##    &lt;chr&gt;                                             &lt;int&gt;
##  1 Intolerance: Love&#39;s Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell&#39;s Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # … with 3,797 more rows</code></pre>
<p>ou criar um objeto intermediário</p>
<div class="sourceCode" id="cb259"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb259-1"><a href="7-2-dplyr.html#cb259-1" aria-hidden="true" tabindex="-1"></a>tab_titulo_ano <span class="ot">&lt;-</span> <span class="fu">select</span>(imdb, titulo, ano)</span>
<span id="cb259-2"><a href="7-2-dplyr.html#cb259-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb259-3"><a href="7-2-dplyr.html#cb259-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(tab_titulo_ano, ano)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 2
##    titulo                                              ano
##    &lt;chr&gt;                                             &lt;int&gt;
##  1 Intolerance: Love&#39;s Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell&#39;s Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # … with 3,797 more rows</code></pre>
<p>Os dois códigos funcionam e levam ao mesmo resultado, mas não são muito bons.</p>
<p>A primeira alternativa é ruim de escrever (já que precisamos escrever primeiro a função que roda por último) e de ler (pois é difícil identificar qual argumento pertence a qual função).</p>
<p>A segunda alternativa também é ruim, pois exige a criação de objetos auxiliares. Se quiséssimos aplicar 10 operações na base, precisaríamos criar 9 objetos intermediários.</p>
<p>A solução para aplicar diversas operações de manipulação em uma base de dados é aplicar o operador pipe: <code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb261"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb261-1"><a href="7-2-dplyr.html#cb261-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb261-2"><a href="7-2-dplyr.html#cb261-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, ano) <span class="sc">%&gt;%</span> </span>
<span id="cb261-3"><a href="7-2-dplyr.html#cb261-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ano)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 2
##    titulo                                              ano
##    &lt;chr&gt;                                             &lt;int&gt;
##  1 Intolerance: Love&#39;s Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell&#39;s Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # … with 3,797 more rows</code></pre>
<p>O que está sendo feito no código com pipe? Da primeira para a segunda linha, estamos aplicando a função <code>select()</code> à base imdb. Da segunda para a terceira, estamos aplicando a função <code>arrange()</code> à base resultante da função <code>select()</code>.</p>
<p>O resultado desse código é idêntico às tentativas sem pipe, com a vantagem de termos escrito o código na ordem em que as funções são aplicadas, de termos um código muito mais legível e de não precisarmos utilizar objetos intermediários.</p>
</div>
<div id="filtrando-linhas" class="section level3 hasAnchor" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Filtrando linhas<a href="7-2-dplyr.html#filtrando-linhas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para filtrar valores de uma coluna da base, utilizamos a função <code>filter()</code>.</p>
<div class="sourceCode" id="cb263"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb263-1"><a href="7-2-dplyr.html#cb263-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nota_imdb <span class="sc">&gt;</span> <span class="dv">9</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 15
##   titulo      ano diretor   duracao cor   generos  pais  classificacao orcamento
##   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
## 1 The Shaw…  1994 Frank Da…     142 Color Crime|D… USA   A partir de …  25000000
## 2 The Godf…  1972 Francis …     175 Color Crime|D… USA   A partir de …   6000000
## 3 Kickboxe…  2016 John Sto…      90 &lt;NA&gt;  Action   USA   Outros         17000000
## # … with 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Podemos selecionar apenas as colunas título e nota para visualizarmos as notas:</p>
<div class="sourceCode" id="cb265"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb265-1"><a href="7-2-dplyr.html#cb265-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb265-2"><a href="7-2-dplyr.html#cb265-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nota_imdb <span class="sc">&gt;</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb265-3"><a href="7-2-dplyr.html#cb265-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, nota_imdb)</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   titulo                    nota_imdb
##   &lt;chr&gt;                         &lt;dbl&gt;
## 1 The Shawshank Redemption        9.3
## 2 The Godfather                   9.2
## 3 Kickboxer: Vengeance            9.1</code></pre>
<p>Podemos estender o filtro para duas ou mais colunas. Para isso, separamos cada operação por uma vírgula.</p>
<div class="sourceCode" id="cb267"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb267-1"><a href="7-2-dplyr.html#cb267-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ano <span class="sc">&gt;</span> <span class="dv">2010</span>, nota_imdb <span class="sc">&gt;</span> <span class="fl">8.5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 × 15
##   titulo      ano diretor   duracao cor   generos  pais  classificacao orcamento
##   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
## 1 Interste…  2014 Christop…     169 Color Adventu… USA   A partir de … 165000000
## 2 Running …  2015 Mike May…      88 Color Family   USA   Outros          5000000
## 3 A Beginn…  2016 Mitchell…      87 Color Comedy|… USA   Outros               NA
## 4 Kickboxe…  2016 John Sto…      90 &lt;NA&gt;  Action   USA   Outros         17000000
## 5 Butterfl…  2014 Cary Bell      78 Color Documen… USA   Outros           180000
## # … with 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Também podemos fazer operações com as colunas da base dentro da função filter. O código abaixo devolve uma tabela apenas com os filmes que lucraram.</p>
<div class="sourceCode" id="cb269"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb269-1"><a href="7-2-dplyr.html#cb269-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(receita <span class="sc">-</span> orcamento <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,761 × 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar     2009 James C…     178 Color Action|… USA   A partir de … 237000000
##  2 Pirates …  2007 Gore Ve…     169 Color Action|… USA   A partir de … 300000000
##  3 The Dark…  2012 Christo…     164 Color Action|… USA   A partir de … 250000000
##  4 Spider-M…  2007 Sam Rai…     156 Color Action|… USA   A partir de … 258000000
##  5 Avengers…  2015 Joss Wh…     141 Color Action|… USA   A partir de … 250000000
##  6 Batman v…  2016 Zack Sn…     183 Color Action|… USA   A partir de … 250000000
##  7 Pirates …  2006 Gore Ve…     151 Color Action|… USA   A partir de … 225000000
##  8 Man of S…  2013 Zack Sn…     143 Color Action|… USA   A partir de … 225000000
##  9 The Aven…  2012 Joss Wh…     173 Color Action|… USA   A partir de … 220000000
## 10 The Amaz…  2012 Marc We…     153 Color Action|… USA   A partir de … 230000000
## # … with 1,751 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Naturalmente, podemos filtrar colunas categóricas. O exemplo abaixo retorna uma tabela apenas com os filmes com a Angelina Jolie Pitt ou o Brad Pitt no papel principal.</p>
<div class="sourceCode" id="cb271"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb271-1"><a href="7-2-dplyr.html#cb271-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span></span>
<span id="cb271-2"><a href="7-2-dplyr.html#cb271-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ator_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Angelina Jolie Pitt&#39;</span>, <span class="st">&quot;Brad Pitt&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 29 × 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Malefic…  2014 Robert …      97 Color Action|A… USA   Livre         180000000
##  2 The Cur…  2008 David F…     166 Color Drama|Fa… USA   A partir de … 150000000
##  3 Kung Fu…  2011 Jennife…      90 Color Action|A… USA   Livre         150000000
##  4 Troy      2004 Wolfgan…     196 Color Adventure USA   A partir de … 175000000
##  5 Kung Fu…  2008 Mark Os…      92 Color Action|A… USA   Livre         130000000
##  6 Salt      2010 Phillip…     101 Color Action|C… USA   A partir de … 110000000
##  7 Ocean&#39;s…  2004 Steven …     125 Color Crime|Th… USA   A partir de … 110000000
##  8 Mr. &amp; M…  2005 Doug Li…     126 Color Action|C… USA   A partir de … 120000000
##  9 Lara Cr…  2001 Simon W…     100 Color Action|A… USA   A partir de … 115000000
## 10 Ocean&#39;s…  2001 Steven …     116 Color Crime|Th… USA   A partir de …  85000000
## # … with 19 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Para filtrar textos sem correspondência exata, podemos utilizar a função auxiliar <code>str_detect()</code> do pacote <code>{stringr}</code>. Ela serve para verificar se cada string de um vetor contém um determinado padrão de texto.</p>
<div class="sourceCode" id="cb273"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb273-1"><a href="7-2-dplyr.html#cb273-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb273-2"><a href="7-2-dplyr.html#cb273-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb273-3"><a href="7-2-dplyr.html#cb273-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(</span>
<span id="cb273-4"><a href="7-2-dplyr.html#cb273-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;aa&quot;</span>,<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;bc&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="cn">NA</span>), </span>
<span id="cb273-5"><a href="7-2-dplyr.html#cb273-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb273-6"><a href="7-2-dplyr.html#cb273-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE    NA</code></pre>
<p>Podemos utilizá-la para filtrar apenas os filmes que contêm o gênero ação.</p>
<div class="sourceCode" id="cb275"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb275-1"><a href="7-2-dplyr.html#cb275-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A coluna gêneros apresenta todos os gêneros dos filmes concatenados</span></span>
<span id="cb275-2"><a href="7-2-dplyr.html#cb275-2" aria-hidden="true" tabindex="-1"></a>imdb<span class="sc">$</span>generos[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Action|Adventure|Fantasy|Sci-Fi&quot;                          
## [2] &quot;Action|Adventure|Fantasy&quot;                                 
## [3] &quot;Action|Thriller&quot;                                          
## [4] &quot;Action|Adventure|Sci-Fi&quot;                                  
## [5] &quot;Action|Adventure|Romance&quot;                                 
## [6] &quot;Adventure|Animation|Comedy|Family|Fantasy|Musical|Romance&quot;</code></pre>
<div class="sourceCode" id="cb277"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb277-1"><a href="7-2-dplyr.html#cb277-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos detectar se o gênero Action aparece na string</span></span>
<span id="cb277-2"><a href="7-2-dplyr.html#cb277-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(</span>
<span id="cb277-3"><a href="7-2-dplyr.html#cb277-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> imdb<span class="sc">$</span>generos[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb277-4"><a href="7-2-dplyr.html#cb277-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">&quot;Action&quot;</span></span>
<span id="cb277-5"><a href="7-2-dplyr.html#cb277-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb279"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb279-1"><a href="7-2-dplyr.html#cb279-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicamos essa lógica dentro da função filter, para a coluna completa</span></span>
<span id="cb279-2"><a href="7-2-dplyr.html#cb279-2" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(generos, <span class="st">&quot;Action&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 861 × 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar     2009 James C…     178 Color Action|… USA   A partir de … 237000000
##  2 Pirates …  2007 Gore Ve…     169 Color Action|… USA   A partir de … 300000000
##  3 The Dark…  2012 Christo…     164 Color Action|… USA   A partir de … 250000000
##  4 John Car…  2012 Andrew …     132 Color Action|… USA   A partir de … 263700000
##  5 Spider-M…  2007 Sam Rai…     156 Color Action|… USA   A partir de … 258000000
##  6 Avengers…  2015 Joss Wh…     141 Color Action|… USA   A partir de … 250000000
##  7 Batman v…  2016 Zack Sn…     183 Color Action|… USA   A partir de … 250000000
##  8 Superman…  2006 Bryan S…     169 Color Action|… USA   A partir de … 209000000
##  9 Pirates …  2006 Gore Ve…     151 Color Action|… USA   A partir de … 225000000
## 10 The Lone…  2013 Gore Ve…     150 Color Action|… USA   A partir de … 215000000
## # … with 851 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div id="exercícios-13" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-13" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Crie um objeto chamado <code>filmes_pb</code> apenas com filmes preto e branco.</p>
<p><strong>2.</strong> Crie um objeto chamado <code>curtos_legais</code> com filmes de 90 minutos ou menos de duração e nota no imdb maior do que 8.5.</p>
<p><strong>3.</strong> Retorne tabelas (<code>tibbles</code>) apenas com:</p>
<ul>
<li><p><strong>a.</strong> filmes coloridos anteriores a 1950;</p></li>
<li><p><strong>b.</strong> filmes do “Woody Allen” ou do “Wes Anderson”;</p></li>
<li><p><strong>c.</strong> filmes do “Steven Spielberg” ordenados de forma decrescente por ano, mostrando apenas as colunas <code>titulo</code> e <code>ano</code>;</p></li>
<li><p><strong>d.</strong> filmes que tenham “Action” <strong>ou</strong> “Comedy” entre os seus gêneros;</p></li>
<li><p><strong>e.</strong> filmes que tenham “Action” <strong>e</strong> “Comedy” entre os seus gêneros e tenha <code>nota_imdb</code> maior que 8;</p></li>
<li><p><strong>f.</strong> filmes que não possuem informação tanto de receita quanto de orçamento (isto é, possuem <code>NA</code> em ambas as colunas).</p></li>
</ul>
</div>
</div>
<div id="modificando-e-criando-novas-colunas" class="section level3 hasAnchor" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Modificando e criando novas colunas<a href="7-2-dplyr.html#modificando-e-criando-novas-colunas" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Para modificar uma coluna existente ou criar uma nova coluna, utilizamos a função <code>mutate()</code>. O código abaixo divide os valores da coluna duração por 60, mudando a unidade de medida dessa variável de minutos para horas.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb281-1"><a href="7-2-dplyr.html#cb281-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">duracao =</span> duracao<span class="sc">/</span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…    2.97 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…    2.82 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…    2.73 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …    2.2  Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…    2.6  Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …    1.67 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…    2.35 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…    3.05 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…    2.82 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…    2.52 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Também poderíamos ter criado essa variável em uma nova coluna. Repare que a nova coluna <code>duracao_horas</code> é colocada no final da tabela.</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb283-1"><a href="7-2-dplyr.html#cb283-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">duracao_horas =</span> duracao<span class="sc">/</span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 7 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;,
## #   duracao_horas &lt;dbl&gt;</code></pre>
<p>Podemos fazer qualquer operação com uma ou mais colunas. A única regra é que o resultado da operação retorne um vetor com comprimento igual ao número de linhas da base (ou com comprimento 1 para distribuir um mesmo valor em todas as linhas). Você também pode criar/modificar quantas colunas quiser dentro de um mesmo <code>mutate</code>.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb285-1"><a href="7-2-dplyr.html#cb285-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb285-2"><a href="7-2-dplyr.html#cb285-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento, <span class="at">pais =</span> <span class="st">&quot;Estados Unidos&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb285-3"><a href="7-2-dplyr.html#cb285-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, lucro, pais)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 3
##    titulo                                           lucro pais          
##    &lt;chr&gt;                                            &lt;int&gt; &lt;chr&gt;         
##  1 Avatar                                       523505847 Estados Unidos
##  2 Pirates of the Caribbean: At World&#39;s End       9404152 Estados Unidos
##  3 The Dark Knight Rises                        198130642 Estados Unidos
##  4 John Carter                                 -190641321 Estados Unidos
##  5 Spider-Man 3                                  78530303 Estados Unidos
##  6 Tangled                                      -59192738 Estados Unidos
##  7 Avengers: Age of Ultron                      208991599 Estados Unidos
##  8 Batman v Superman: Dawn of Justice            80249062 Estados Unidos
##  9 Superman Returns                              -8930592 Estados Unidos
## 10 Pirates of the Caribbean: Dead Man&#39;s Chest   198032628 Estados Unidos
## # … with 3,797 more rows</code></pre>
<div id="exercícios-14" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-14" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Crie uma coluna chamada <code>prejuizo</code> (<code>orcamento - receita</code>) e salve a nova tabela em um objeto chamado <code>imdb_prejuizo</code>. Em seguida, filtre apenas os filmes que deram prejuízo e ordene a tabela por ordem crescente de prejuízo.</p>
<p><strong>2.</strong> Fazendo apenas uma chamada da função mutate(), crie as seguintes colunas novas na base <code>imdb</code>:</p>
<ul>
<li><p><strong>a.</strong> <code>lucro = receita - orcamento</code></p></li>
<li><p><strong>b.</strong> <code>lucro_medio</code></p></li>
<li><p><strong>c.</strong> <code>lucro_relativo = (lucro - lucro_medio)/lucro_medio</code></p></li>
<li><p><strong>d.</strong> <code>houve_lucro = ifelse(lucro &gt; 0, "sim", "não")</code></p></li>
</ul>
<p><strong>3.</strong> Crie uma nova coluna que classifique o filme em <code>"recente"</code> (posterior a 2000) e <code>"antigo"</code> (de 2000 para trás).</p>
</div>
</div>
<div id="sumarizando-a-base" class="section level3 hasAnchor" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Sumarizando a base<a href="7-2-dplyr.html#sumarizando-a-base" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Sumarização é a técnica de se resumir um conjunto de dados utilizando alguma métrica de interesse. A média, a mediana, a variância, a frequência, a proporção, por exemplo, são tipos de sumarização que trazem diferentes informações sobre uma variável.</p>
<p>Para sumarizar uma coluna da base, utilizamos a função <code>summarize()</code>. O código abaixo resume a coluna orçamento pela sua média.</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb287-1"><a href="7-2-dplyr.html#cb287-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">media_orcamento =</span> <span class="fu">mean</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 1
##   media_orcamento
##             &lt;dbl&gt;
## 1       35755986.</code></pre>
<p>Repare que a saída da função continua sendo uma tibble.</p>
<p>Podemos calcular diversas sumarizações diferentes em um mesmo <code>summarize</code>. Cada sumarização será uma coluna da nova base.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb289-1"><a href="7-2-dplyr.html#cb289-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb289-2"><a href="7-2-dplyr.html#cb289-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_orcamento =</span> <span class="fu">mean</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb289-3"><a href="7-2-dplyr.html#cb289-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mediana_orcamento =</span> <span class="fu">median</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb289-4"><a href="7-2-dplyr.html#cb289-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variancia_orcamento =</span> <span class="fu">var</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb289-5"><a href="7-2-dplyr.html#cb289-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   media_orcamento mediana_orcamento variancia_orcamento
##             &lt;dbl&gt;             &lt;int&gt;               &lt;dbl&gt;
## 1       35755986.          20000000             1.82e15</code></pre>
<p>E também sumarizar diversas colunas.</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb291-1"><a href="7-2-dplyr.html#cb291-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb291-2"><a href="7-2-dplyr.html#cb291-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_orcamento =</span> <span class="fu">mean</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb291-3"><a href="7-2-dplyr.html#cb291-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_receita =</span> <span class="fu">mean</span>(receita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb291-4"><a href="7-2-dplyr.html#cb291-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_lucro =</span> <span class="fu">mean</span>(receita <span class="sc">-</span> orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb291-5"><a href="7-2-dplyr.html#cb291-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 3
##   media_orcamento media_receita media_lucro
##             &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1       35755986.     55214607.   17258230.</code></pre>
<p>Muitas vezes queremos sumarizar uma coluna agrupada pelas categorias de uma segunda coluna. Para isso, além do <code>summarize</code>, utilizamos também a função <code>group_by()</code>.</p>
<p>O código a seguir calcula a receita média dos filmes para cada categoria da coluna “cor”.</p>
<div class="sourceCode" id="cb293"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb293-1"><a href="7-2-dplyr.html#cb293-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb293-2"><a href="7-2-dplyr.html#cb293-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cor) <span class="sc">%&gt;%</span> </span>
<span id="cb293-3"><a href="7-2-dplyr.html#cb293-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">receita_media =</span> <span class="fu">mean</span>(receita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 × 2
##   cor             receita_media
##   &lt;chr&gt;                   &lt;dbl&gt;
## 1 Black and White     36938737.
## 2 Color               55765813.
## 3 &lt;NA&gt;                80014842</code></pre>
<p>A única alteração que a função <code>group_by()</code> faz na base é a marcação de que a base está agrupada.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb295-1"><a href="7-2-dplyr.html#cb295-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cor)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 15
## # Groups:   cor [3]
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div id="exercícios-15" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-15" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Calcule a duração média e mediana dos filmes da base.</p>
<p><strong>2.</strong> Calcule o lucro médio dos filmes com duração menor que 60 minutos.</p>
<p><strong>3.</strong> Apresente na mesma tabela o lucro médio dos filmes com duracao menor que 60 minutos e o lucro médio dos filmes com duracao maior ou igual a 60 minutos.</p>
<p><strong>4.</strong> Retorne tabelas (<code>tibbles</code>) apenas com:</p>
<ul>
<li><p><strong>a.</strong> a nota IMDB média dos filmes por tipo de classificacao;</p></li>
<li><p><strong>b.</strong> a receita média e mediana dos filmes por ano;</p></li>
<li><p><strong>c.</strong> apenas o nome dos diretores com mais de 10 filmes.</p></li>
</ul>
</div>
</div>
<div id="juntando-duas-bases" class="section level3 hasAnchor" number="7.2.7">
<h3><span class="header-section-number">7.2.7</span> Juntando duas bases<a href="7-2-dplyr.html#juntando-duas-bases" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Podemos juntar duas tabelas a partir de uma (coluna) chave utilizando a função <code>left_join()</code>. Como exempo, vamos inicialmente calcular o lucro médio dos filmes de cada diretor e salvar no objeto <code>tab_lucro_diretor</code>.</p>
<div class="sourceCode" id="cb297"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb297-1"><a href="7-2-dplyr.html#cb297-1" aria-hidden="true" tabindex="-1"></a>tab_lucro_diretor <span class="ot">&lt;-</span> imdb <span class="sc">%&gt;%</span></span>
<span id="cb297-2"><a href="7-2-dplyr.html#cb297-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(diretor) <span class="sc">%&gt;%</span> </span>
<span id="cb297-3"><a href="7-2-dplyr.html#cb297-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lucro_medio =</span> <span class="fu">mean</span>(receita <span class="sc">-</span> orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb297-4"><a href="7-2-dplyr.html#cb297-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb297-5"><a href="7-2-dplyr.html#cb297-5" aria-hidden="true" tabindex="-1"></a>tab_lucro_diretor</span></code></pre></div>
<pre><code>## # A tibble: 1,813 × 2
##    diretor          lucro_medio
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 A. Raven Cruz            NaN
##  2 Aaron Hann               NaN
##  3 Aaron Schneider      1676553
##  4 Aaron Seltzer       28546578
##  5 Abel Ferrara       -11272676
##  6 Adam Carolla        -1394057
##  7 Adam Goldberg       -1647420
##  8 Adam Green               NaN
##  9 Adam Jay Epstein         NaN
## 10 Adam Marcus         13435068
## # … with 1,803 more rows</code></pre>
<p>E se quisermos colocar essa informação na base original? Basta usar a função <code>left_join()</code> utilizando a coluna <code>diretor</code> como chave. Observe que a coluna <code>lucro_medio</code> aparece agora no fim da tabela.</p>
<div class="sourceCode" id="cb299"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb299-1"><a href="7-2-dplyr.html#cb299-1" aria-hidden="true" tabindex="-1"></a>imdb_com_lucro_medio <span class="ot">&lt;-</span> <span class="fu">left_join</span>(imdb, tab_lucro_diretor, <span class="at">by =</span> <span class="st">&quot;diretor&quot;</span>)</span>
<span id="cb299-2"><a href="7-2-dplyr.html#cb299-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb299-3"><a href="7-2-dplyr.html#cb299-3" aria-hidden="true" tabindex="-1"></a>imdb_com_lucro_medio</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 7 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;,
## #   lucro_medio &lt;dbl&gt;</code></pre>
<p>Na tabela <code>imdb_com_lucro_medio</code>, como na tabela <code>imdb</code>, cada linha continua a representar um filme diferente, mas agora temos também a informação do lucro médio do diretor de cada filme.</p>
<p>A primeira linha, por exemplo, traz as informações do filme Avatar. O valor do <code>lucro_medio</code> nessa linha representa o lucro médio de todos os filmes do James Cameron, que é o diretor de Avatar. Com essa informação, podemos calcular o quanto o lucro do Avatar se afasta do lucro médio do James Cameron.</p>
<div class="sourceCode" id="cb301"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb301-1"><a href="7-2-dplyr.html#cb301-1" aria-hidden="true" tabindex="-1"></a>imdb_com_lucro_medio <span class="sc">%&gt;%</span> </span>
<span id="cb301-2"><a href="7-2-dplyr.html#cb301-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb301-3"><a href="7-2-dplyr.html#cb301-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lucro =</span> receita <span class="sc">-</span> orcamento,</span>
<span id="cb301-4"><a href="7-2-dplyr.html#cb301-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lucro_relativo =</span> (lucro <span class="sc">-</span> lucro_medio)<span class="sc">/</span>lucro_medio,</span>
<span id="cb301-5"><a href="7-2-dplyr.html#cb301-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lucro_relativo =</span> scales<span class="sc">::</span><span class="fu">percent</span>(lucro_relativo)</span>
<span id="cb301-6"><a href="7-2-dplyr.html#cb301-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb301-7"><a href="7-2-dplyr.html#cb301-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, diretor, lucro, lucro_medio, lucro_relativo)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 × 5
##    titulo                      diretor          lucro lucro_medio lucro_relativo
##    &lt;chr&gt;                       &lt;chr&gt;            &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;         
##  1 Avatar                      James Cameron   5.24e8  194620985  168.98736%    
##  2 Pirates of the Caribbean: … Gore Verbins…   9.40e6   36942999. -74.54416%    
##  3 The Dark Knight Rises       Christopher …   1.98e8  101028447  96.11372%     
##  4 John Carter                 Andrew Stant…  -1.91e8   46668146  -508.50417%   
##  5 Spider-Man 3                Sam Raimi       7.85e7   63300090. 24.06033%     
##  6 Tangled                     Nathan Greno   -5.92e7  -59192738  0.00000%      
##  7 Avengers: Age of Ultron     Joss Whedon     2.09e8  250221657  -16.47741%    
##  8 Batman v Superman: Dawn of… Zack Snyder     8.02e7   33149106. 142.08514%    
##  9 Superman Returns            Bryan Singer   -8.93e6   -2887024. 209.33560%    
## 10 Pirates of the Caribbean: … Gore Verbins…   1.98e8   36942999. 436.04913%    
## # … with 3,797 more rows</code></pre>
<p>Observamos então que o Avatar obteve um lucro aproximadamente 169% maior que a média dos filmes do James Cameron.</p>
<p>Além da função <code>left_join()</code>, também são muito utilizadas as funções <code>right_join()</code> e <code>full_join()</code>.</p>
<ul>
<li><p><code>right_join()</code>: retorna todas as linhas da base <code>y</code> e todas as colunas das bases <code>x</code> e <code>y</code>. Linhas de <code>y</code> sem correspondentes em <code>x</code> receberão <code>NA</code> na nova base.</p></li>
<li><p><code>full_join()</code>: retorna todas as linhas e colunas de <code>x</code>e <code>y</code>. Valores sem correspondência entre as bases receberão <code>NA</code> na nova base.</p></li>
</ul>
<p>A figura a seguir esquematiza as operações dessas funções:</p>
<p><img src="assets/img/manipulacao/joins.png" width="355" style="display: block; margin: auto;" /></p>
<div id="exercícios-16" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-16" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>1.</strong> Utilize a base <code>imdb</code> para resolver os itens a seguir.</p>
<p><strong>a.</strong> Salve em um novo objeto uma tabela com a
nota média dos filmes de cada diretor. Essa tabela
deve conter duas colunas (<code>diretor</code> e <code>nota_imdb_media</code>)
e cada linha deve ser um diretor diferente.</p>
<p><strong>b.</strong> Use o <code>left_join()</code> para trazer a coluna
<code>nota_imdb_media</code> da tabela do item anterior
para a tabela <code>imdb</code> original.</p>
</div>
</div>
<div id="dplyr-1.0" class="section level3 hasAnchor" number="7.2.8">
<h3><span class="header-section-number">7.2.8</span> dplyr 1.0<a href="7-2-dplyr.html#dplyr-1.0" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>A versão 1.0 do pacote <code>dplyr</code> foi oficialmente lançada em junho de 2020 e contou com diversas novidades. Vamos falar das principais mudanças:</p>
<ul>
<li><p>A nova função <code>across()</code>, que facilita aplicar uma mesma operação em várias colunas.</p></li>
<li><p>A repaginada função <code>rowwise()</code>, para fazer operações por linha.</p></li>
<li><p>Novas funcionalidades das funções <code>select()</code> e <code>rename()</code> e a nova função <code>relocate()</code>.</p></li>
</ul>
<p>Para trabalhar essas funções, vamos utilizar a base <code>casas</code> do pacote <code>dados</code>. Para instalar esse pacote, rode os códigos abaixo:</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb303-1"><a href="7-2-dplyr.html#cb303-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;remotes&quot;</span>)</span>
<span id="cb303-2"><a href="7-2-dplyr.html#cb303-2" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;cienciadedatos/dados&quot;</span>)</span></code></pre></div>
<p>Para trazer os dados para o nosso <em>environment</em>, podemos rodar:</p>
<div class="sourceCode" id="cb304"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb304-1"><a href="7-2-dplyr.html#cb304-1" aria-hidden="true" tabindex="-1"></a>casas <span class="ot">&lt;-</span> dados<span class="sc">::</span>casas</span></code></pre></div>
<p>A base <code>casas</code> possui dados de venda de casas na cidade de Ames, nos Estados Unidos. São 2930 linhas e 77 colunas, sendo que cada linha corresponde a uma casa vendida e cada coluna a uma característica da casa ou da venda. Essa versão é uma tradução da base original, que pode ser encontrada no pacote <code>AmesHousing</code>:</p>
<div class="sourceCode" id="cb305"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb305-1"><a href="7-2-dplyr.html#cb305-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;AmesHousing&quot;</span>)</span>
<span id="cb305-2"><a href="7-2-dplyr.html#cb305-2" aria-hidden="true" tabindex="-1"></a><span class="fu">data</span>(ames_raw, <span class="at">package =</span> <span class="st">&quot;AmesHousing&quot;</span>)</span></code></pre></div>
<div id="a-função-across" class="section level4 unnumbered hasAnchor">
<h4>A função <code>across()</code><a href="7-2-dplyr.html#a-função-across" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A função <code>across()</code> substitui a família de verbos <code>_all()</code>, <code>_if</code> e <code>_at()</code>. A ideia é facilitar a aplicação de uma operação a diversas colunas da base. Para sumarizar a base para mais de uma variável, antigamente poderíamos fazer:</p>
<div class="sourceCode" id="cb306"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb306-1"><a href="7-2-dplyr.html#cb306-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb306-2"><a href="7-2-dplyr.html#cb306-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(geral_qualidade) <span class="sc">%&gt;%</span></span>
<span id="cb306-3"><a href="7-2-dplyr.html#cb306-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb306-4"><a href="7-2-dplyr.html#cb306-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lote_area_media =</span> <span class="fu">mean</span>(lote_area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb306-5"><a href="7-2-dplyr.html#cb306-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">venda_valor_medio =</span> <span class="fu">mean</span>(venda_valor, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb306-6"><a href="7-2-dplyr.html#cb306-6" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    geral_qualidade lote_area_media venda_valor_medio
##    &lt;chr&gt;                     &lt;dbl&gt;             &lt;dbl&gt;
##  1 abaixo da média           8464.           106485.
##  2 acima da média            9788.           162130.
##  3 boa                      10309.           205026.
##  4 excelente                12777.           368337.
##  5 média                     9996.           134753.
##  6 muito boa                10618.           270914.
##  7 Muito excelente          18071.           450217.
##  8 muito ruim               15214.            48725 
##  9 regular                   9439.            83186.
## 10 ruim                      9326.            52325.</code></pre>
<p>Ou então utilizar a função <code>summarise_at()</code>:</p>
<div class="sourceCode" id="cb308"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb308-1"><a href="7-2-dplyr.html#cb308-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb308-2"><a href="7-2-dplyr.html#cb308-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(geral_qualidade) <span class="sc">%&gt;%</span></span>
<span id="cb308-3"><a href="7-2-dplyr.html#cb308-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_at</span>(</span>
<span id="cb308-4"><a href="7-2-dplyr.html#cb308-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.vars =</span> <span class="fu">vars</span>(lote_area, venda_valor),</span>
<span id="cb308-5"><a href="7-2-dplyr.html#cb308-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">list</span>(mean),</span>
<span id="cb308-6"><a href="7-2-dplyr.html#cb308-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb308-7"><a href="7-2-dplyr.html#cb308-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    geral_qualidade lote_area venda_valor
##    &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
##  1 abaixo da média     8464.     106485.
##  2 acima da média      9788.     162130.
##  3 boa                10309.     205026.
##  4 excelente          12777.     368337.
##  5 média               9996.     134753.
##  6 muito boa          10618.     270914.
##  7 Muito excelente    18071.     450217.
##  8 muito ruim         15214.      48725 
##  9 regular             9439.      83186.
## 10 ruim                9326.      52325.</code></pre>
<p>Com a nova função <code>across()</code>, fazemos:</p>
<div class="sourceCode" id="cb310"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb310-1"><a href="7-2-dplyr.html#cb310-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb310-2"><a href="7-2-dplyr.html#cb310-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(geral_qualidade) <span class="sc">%&gt;%</span></span>
<span id="cb310-3"><a href="7-2-dplyr.html#cb310-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(</span>
<span id="cb310-4"><a href="7-2-dplyr.html#cb310-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">.cols =</span> <span class="fu">c</span>(lote_area, venda_valor),</span>
<span id="cb310-5"><a href="7-2-dplyr.html#cb310-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">.fns =</span> mean, </span>
<span id="cb310-6"><a href="7-2-dplyr.html#cb310-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">na.rm =</span> <span class="cn">TRUE</span></span>
<span id="cb310-7"><a href="7-2-dplyr.html#cb310-7" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<pre><code>## # A tibble: 10 × 3
##    geral_qualidade lote_area venda_valor
##    &lt;chr&gt;               &lt;dbl&gt;       &lt;dbl&gt;
##  1 abaixo da média     8464.     106485.
##  2 acima da média      9788.     162130.
##  3 boa                10309.     205026.
##  4 excelente          12777.     368337.
##  5 média               9996.     134753.
##  6 muito boa          10618.     270914.
##  7 Muito excelente    18071.     450217.
##  8 muito ruim         15214.      48725 
##  9 regular             9439.      83186.
## 10 ruim                9326.      52325.</code></pre>
<p>A sintaxe é parecida com a função <code>summarise_at()</code>, mas agora não precisamos mais usar a função <code>vars()</code> e nem usar <code>list(nome_da_funcao)</code>para definir a função aplicada nas colunas.</p>
<p>Usando <code>across()</code>, podemos facilmente aplicar uma função em todas as colunas da nossa base. Abaixo, calculamos o número de valores distintos para todas as variáveis da base <code>casas</code>. O padrão do parâmetro <code>.cols</code> é <code>everything()</code>, que representa “todas as colunas”.</p>
<div class="sourceCode" id="cb312"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb312-1"><a href="7-2-dplyr.html#cb312-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span> </span>
<span id="cb312-2"><a href="7-2-dplyr.html#cb312-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="at">.fns =</span> n_distinct))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 82
##   ordem   pid moradia_classe moradia_zoneamento lote_fachada lote_area rua_tipo
##   &lt;int&gt; &lt;int&gt;          &lt;int&gt;              &lt;int&gt;        &lt;int&gt;     &lt;int&gt;    &lt;int&gt;
## 1  2930  2930             16                  7          129      1960        2
## # … with 75 more variables: beco_tipo &lt;int&gt;, lote_formato &lt;int&gt;,
## #   terreno_contorno &lt;int&gt;, utilidades &lt;int&gt;, lote_config &lt;int&gt;,
## #   terreno_declive &lt;int&gt;, vizinhanca &lt;int&gt;, condicao_1 &lt;int&gt;,
## #   condicao_2 &lt;int&gt;, moradia_tipo &lt;int&gt;, moradia_estilo &lt;int&gt;,
## #   geral_qualidade &lt;int&gt;, geral_condicao &lt;int&gt;, construcao_ano &lt;int&gt;,
## #   remodelacao_ano &lt;int&gt;, telhado_estilo &lt;int&gt;, telhado_material &lt;int&gt;,
## #   exterior_cobertura_1 &lt;int&gt;, exterior_cobertura_2 &lt;int&gt;,
## #   alvenaria_tipo &lt;int&gt;, alvenaria_area &lt;int&gt;, exterior_qualidade &lt;int&gt;,
## #   exterior_condicao &lt;int&gt;, fundacao_tipo &lt;int&gt;, porao_qualidade &lt;int&gt;,
## #   porao_condicao &lt;int&gt;, porao_exposicao &lt;int&gt;, porao_acabamento_1 &lt;int&gt;,
## #   porao_area_com_acabamento_1 &lt;int&gt;, porao_acabamento_2 &lt;int&gt;,
## #   porao_area_com_acabamento_2 &lt;int&gt;, porao_area_sem_acabamento &lt;int&gt;,
## #   porao_area_total &lt;int&gt;, porao_num_banheiros &lt;int&gt;,
## #   porao_num_banheiros_lavabos &lt;int&gt;, aquecimento_tipo &lt;int&gt;,
## #   aquecimento_qualidade_condicao &lt;int&gt;, ar_condicionado_central &lt;int&gt;,
## #   sistema_eletrico_tipo &lt;int&gt;, primeiro_andar_area &lt;int&gt;,
## #   segundo_andar_area &lt;int&gt;, acabamento_baixa_qualidade_area &lt;int&gt;,
## #   acima_solo_area &lt;int&gt;, acima_solo_num_banheiros &lt;int&gt;,
## #   acima_solo_num_lavabos &lt;int&gt;, acima_solo_num_quartos &lt;int&gt;,
## #   acima_solo_num_cozinhas &lt;int&gt;, cozinha_qualidade &lt;int&gt;,
## #   acima_solo_num_comodos &lt;int&gt;, funcional &lt;int&gt;, total_num_lareiras &lt;int&gt;,
## #   lareira_qualidade &lt;int&gt;, garagem_tipo &lt;int&gt;, garagem_ano_construcao &lt;int&gt;,
## #   garagem_acabamento &lt;int&gt;, garagem_capacidade_carros &lt;int&gt;,
## #   garagem_area &lt;int&gt;, garagem_qualidade &lt;int&gt;, garagem_condicao &lt;int&gt;,
## #   entrada_veiculo_pavimentada &lt;int&gt;, deck_madeira_area &lt;int&gt;,
## #   varanda_aberta_area &lt;int&gt;, varanda_fechada_area &lt;int&gt;,
## #   varanda_3ssn_area &lt;int&gt;, varanda_com_tela_area &lt;int&gt;, piscina_area &lt;int&gt;,
## #   piscina_qualidade &lt;int&gt;, cerca_qualidade &lt;int&gt;,
## #   funcionalidades_diversas &lt;int&gt;, funcionalidades_valor &lt;int&gt;,
## #   venda_mes &lt;int&gt;, venda_ano &lt;int&gt;, venda_tipo &lt;int&gt;, venda_condicao &lt;int&gt;,
## #   venda_valor &lt;int&gt;</code></pre>
<p>Para fazer essa mesma operação, antes utilizaríamos a função <code>summarise_all()</code>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb314-1"><a href="7-2-dplyr.html#cb314-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span> </span>
<span id="cb314-2"><a href="7-2-dplyr.html#cb314-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_all</span>(<span class="at">.funs =</span> <span class="sc">~</span><span class="fu">n_distinct</span>(.x))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 82
##   ordem   pid moradia_classe moradia_zoneamento lote_fachada lote_area rua_tipo
##   &lt;int&gt; &lt;int&gt;          &lt;int&gt;              &lt;int&gt;        &lt;int&gt;     &lt;int&gt;    &lt;int&gt;
## 1  2930  2930             16                  7          129      1960        2
## # … with 75 more variables: beco_tipo &lt;int&gt;, lote_formato &lt;int&gt;,
## #   terreno_contorno &lt;int&gt;, utilidades &lt;int&gt;, lote_config &lt;int&gt;,
## #   terreno_declive &lt;int&gt;, vizinhanca &lt;int&gt;, condicao_1 &lt;int&gt;,
## #   condicao_2 &lt;int&gt;, moradia_tipo &lt;int&gt;, moradia_estilo &lt;int&gt;,
## #   geral_qualidade &lt;int&gt;, geral_condicao &lt;int&gt;, construcao_ano &lt;int&gt;,
## #   remodelacao_ano &lt;int&gt;, telhado_estilo &lt;int&gt;, telhado_material &lt;int&gt;,
## #   exterior_cobertura_1 &lt;int&gt;, exterior_cobertura_2 &lt;int&gt;,
## #   alvenaria_tipo &lt;int&gt;, alvenaria_area &lt;int&gt;, exterior_qualidade &lt;int&gt;,
## #   exterior_condicao &lt;int&gt;, fundacao_tipo &lt;int&gt;, porao_qualidade &lt;int&gt;,
## #   porao_condicao &lt;int&gt;, porao_exposicao &lt;int&gt;, porao_acabamento_1 &lt;int&gt;,
## #   porao_area_com_acabamento_1 &lt;int&gt;, porao_acabamento_2 &lt;int&gt;,
## #   porao_area_com_acabamento_2 &lt;int&gt;, porao_area_sem_acabamento &lt;int&gt;,
## #   porao_area_total &lt;int&gt;, porao_num_banheiros &lt;int&gt;,
## #   porao_num_banheiros_lavabos &lt;int&gt;, aquecimento_tipo &lt;int&gt;,
## #   aquecimento_qualidade_condicao &lt;int&gt;, ar_condicionado_central &lt;int&gt;,
## #   sistema_eletrico_tipo &lt;int&gt;, primeiro_andar_area &lt;int&gt;,
## #   segundo_andar_area &lt;int&gt;, acabamento_baixa_qualidade_area &lt;int&gt;,
## #   acima_solo_area &lt;int&gt;, acima_solo_num_banheiros &lt;int&gt;,
## #   acima_solo_num_lavabos &lt;int&gt;, acima_solo_num_quartos &lt;int&gt;,
## #   acima_solo_num_cozinhas &lt;int&gt;, cozinha_qualidade &lt;int&gt;,
## #   acima_solo_num_comodos &lt;int&gt;, funcional &lt;int&gt;, total_num_lareiras &lt;int&gt;,
## #   lareira_qualidade &lt;int&gt;, garagem_tipo &lt;int&gt;, garagem_ano_construcao &lt;int&gt;,
## #   garagem_acabamento &lt;int&gt;, garagem_capacidade_carros &lt;int&gt;,
## #   garagem_area &lt;int&gt;, garagem_qualidade &lt;int&gt;, garagem_condicao &lt;int&gt;,
## #   entrada_veiculo_pavimentada &lt;int&gt;, deck_madeira_area &lt;int&gt;,
## #   varanda_aberta_area &lt;int&gt;, varanda_fechada_area &lt;int&gt;,
## #   varanda_3ssn_area &lt;int&gt;, varanda_com_tela_area &lt;int&gt;, piscina_area &lt;int&gt;,
## #   piscina_qualidade &lt;int&gt;, cerca_qualidade &lt;int&gt;,
## #   funcionalidades_diversas &lt;int&gt;, funcionalidades_valor &lt;int&gt;,
## #   venda_mes &lt;int&gt;, venda_ano &lt;int&gt;, venda_tipo &lt;int&gt;, venda_condicao &lt;int&gt;,
## #   venda_valor &lt;int&gt;</code></pre>
<p>Se quisermos selecionar as colunas a serem modificadas a partir de um teste lógico, utilizamos o ajudante <code>where()</code>.</p>
<p>No exemplo abaixo, calculamos o número de valores distintos das colunas de categóricas.</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb316-1"><a href="7-2-dplyr.html#cb316-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb316-2"><a href="7-2-dplyr.html#cb316-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.character), n_distinct))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 47
##     pid moradia_classe moradia_zoneamento rua_tipo beco_tipo lote_formato
##   &lt;int&gt;          &lt;int&gt;              &lt;int&gt;    &lt;int&gt;     &lt;int&gt;        &lt;int&gt;
## 1  2930             16                  7        2         3            4
## # … with 41 more variables: terreno_contorno &lt;int&gt;, utilidades &lt;int&gt;,
## #   lote_config &lt;int&gt;, terreno_declive &lt;int&gt;, vizinhanca &lt;int&gt;,
## #   condicao_1 &lt;int&gt;, condicao_2 &lt;int&gt;, moradia_tipo &lt;int&gt;,
## #   moradia_estilo &lt;int&gt;, geral_qualidade &lt;int&gt;, geral_condicao &lt;int&gt;,
## #   telhado_estilo &lt;int&gt;, telhado_material &lt;int&gt;, exterior_cobertura_1 &lt;int&gt;,
## #   exterior_cobertura_2 &lt;int&gt;, alvenaria_tipo &lt;int&gt;, exterior_qualidade &lt;int&gt;,
## #   exterior_condicao &lt;int&gt;, fundacao_tipo &lt;int&gt;, porao_qualidade &lt;int&gt;,
## #   porao_condicao &lt;int&gt;, porao_exposicao &lt;int&gt;, porao_acabamento_1 &lt;int&gt;,
## #   porao_acabamento_2 &lt;int&gt;, aquecimento_tipo &lt;int&gt;,
## #   aquecimento_qualidade_condicao &lt;int&gt;, ar_condicionado_central &lt;int&gt;,
## #   sistema_eletrico_tipo &lt;int&gt;, cozinha_qualidade &lt;int&gt;, funcional &lt;int&gt;,
## #   lareira_qualidade &lt;int&gt;, garagem_tipo &lt;int&gt;, garagem_acabamento &lt;int&gt;,
## #   garagem_qualidade &lt;int&gt;, garagem_condicao &lt;int&gt;,
## #   entrada_veiculo_pavimentada &lt;int&gt;, piscina_qualidade &lt;int&gt;,
## #   cerca_qualidade &lt;int&gt;, funcionalidades_diversas &lt;int&gt;, venda_tipo &lt;int&gt;,
## #   venda_condicao &lt;int&gt;</code></pre>
<p>Todas as colunas da base resultante eram colunas com classe <code>character</code> na base <code>casas</code>.</p>
<p>Anteriormente, utilizávamos a função <code>summarise_if()</code>.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb318-1"><a href="7-2-dplyr.html#cb318-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb318-2"><a href="7-2-dplyr.html#cb318-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise_if</span>(is.character, n_distinct)</span></code></pre></div>
<pre><code>## # A tibble: 1 × 47
##     pid moradia_classe moradia_zoneamento rua_tipo beco_tipo lote_formato
##   &lt;int&gt;          &lt;int&gt;              &lt;int&gt;    &lt;int&gt;     &lt;int&gt;        &lt;int&gt;
## 1  2930             16                  7        2         3            4
## # … with 41 more variables: terreno_contorno &lt;int&gt;, utilidades &lt;int&gt;,
## #   lote_config &lt;int&gt;, terreno_declive &lt;int&gt;, vizinhanca &lt;int&gt;,
## #   condicao_1 &lt;int&gt;, condicao_2 &lt;int&gt;, moradia_tipo &lt;int&gt;,
## #   moradia_estilo &lt;int&gt;, geral_qualidade &lt;int&gt;, geral_condicao &lt;int&gt;,
## #   telhado_estilo &lt;int&gt;, telhado_material &lt;int&gt;, exterior_cobertura_1 &lt;int&gt;,
## #   exterior_cobertura_2 &lt;int&gt;, alvenaria_tipo &lt;int&gt;, exterior_qualidade &lt;int&gt;,
## #   exterior_condicao &lt;int&gt;, fundacao_tipo &lt;int&gt;, porao_qualidade &lt;int&gt;,
## #   porao_condicao &lt;int&gt;, porao_exposicao &lt;int&gt;, porao_acabamento_1 &lt;int&gt;,
## #   porao_acabamento_2 &lt;int&gt;, aquecimento_tipo &lt;int&gt;,
## #   aquecimento_qualidade_condicao &lt;int&gt;, ar_condicionado_central &lt;int&gt;,
## #   sistema_eletrico_tipo &lt;int&gt;, cozinha_qualidade &lt;int&gt;, funcional &lt;int&gt;,
## #   lareira_qualidade &lt;int&gt;, garagem_tipo &lt;int&gt;, garagem_acabamento &lt;int&gt;,
## #   garagem_qualidade &lt;int&gt;, garagem_condicao &lt;int&gt;,
## #   entrada_veiculo_pavimentada &lt;int&gt;, piscina_qualidade &lt;int&gt;,
## #   cerca_qualidade &lt;int&gt;, funcionalidades_diversas &lt;int&gt;, venda_tipo &lt;int&gt;,
## #   venda_condicao &lt;int&gt;</code></pre>
<p>Com o <code>across()</code>, podemos combinar os efeitos de um <code>summarise_if()</code> e um <code>summarise_at()</code> em um único <code>summarise()</code>. A seguir, calculamos as áreas médias, garantindo que pegamos apenas variáveis numéricas.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb320-1"><a href="7-2-dplyr.html#cb320-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb320-2"><a href="7-2-dplyr.html#cb320-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="fu">across</span>(<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="fu">contains</span>(<span class="st">&quot;_area&quot;</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 × 17
##   lote_area alvenaria_area porao_area_com_ac… porao_area_com_a… porao_area_sem_…
##       &lt;dbl&gt;          &lt;dbl&gt;              &lt;dbl&gt;             &lt;dbl&gt;            &lt;dbl&gt;
## 1    10148.           102.               443.              49.7             559.
## # … with 12 more variables: porao_area_total &lt;dbl&gt;, primeiro_andar_area &lt;dbl&gt;,
## #   segundo_andar_area &lt;dbl&gt;, acabamento_baixa_qualidade_area &lt;dbl&gt;,
## #   acima_solo_area &lt;dbl&gt;, garagem_area &lt;dbl&gt;, deck_madeira_area &lt;dbl&gt;,
## #   varanda_aberta_area &lt;dbl&gt;, varanda_fechada_area &lt;dbl&gt;,
## #   varanda_3ssn_area &lt;dbl&gt;, varanda_com_tela_area &lt;dbl&gt;, piscina_area &lt;dbl&gt;</code></pre>
<p>Além disso, com a função <code>across()</code>, podemos fazer sumarizações complexas que não seria possível utilizando apenas as funções <code>summarise()</code>, <code>summarise_if()</code> e <code>summarise_at()</code>. No exemplo a seguir, calculamos a média das áreas, o número de <code>NAs</code> de variáveis categóricas e o número de casas para cada tipo de fundação. Tudo em um mesmo <code>summarise()</code>!</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb322-1"><a href="7-2-dplyr.html#cb322-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb322-2"><a href="7-2-dplyr.html#cb322-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(fundacao_tipo) <span class="sc">%&gt;%</span></span>
<span id="cb322-3"><a href="7-2-dplyr.html#cb322-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb322-4"><a href="7-2-dplyr.html#cb322-4" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.numeric) <span class="sc">&amp;</span> <span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>), mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb322-5"><a href="7-2-dplyr.html#cb322-5" aria-hidden="true" tabindex="-1"></a>    <span class="fu">across</span>(<span class="fu">where</span>(is.character), <span class="sc">~</span><span class="fu">sum</span>(<span class="fu">is.na</span>(.x))),</span>
<span id="cb322-6"><a href="7-2-dplyr.html#cb322-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">n_obs =</span> <span class="fu">n</span>(),</span>
<span id="cb322-7"><a href="7-2-dplyr.html#cb322-7" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb322-8"><a href="7-2-dplyr.html#cb322-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, n_obs)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 5
##   fundacao_tipo       lote_area alvenaria_area porao_area_com_acabamento_1 n_obs
##   &lt;chr&gt;                   &lt;dbl&gt;          &lt;dbl&gt;                       &lt;dbl&gt; &lt;int&gt;
## 1 bloco de concreto      10616.           85.0                       468.   1244
## 2 concreto derrramado    10054.          144.                        506.   1310
## 3 laje                   10250.           35.2                         0      49
## 4 madeira                 9838.           16                         812.      5
## 5 pedra                   8659.            0                          43.9    11
## 6 tijolo e telha          8712.           10.2                       151.    311</code></pre>
<p>Embora a nova sintaxe, usando <code>across()</code>, não seja muito diferente do que fazíamos antes, realizar sumarizações complexas não é a única vantagem desse novo <em>framework</em>.</p>
<p>O <code>across()</code> pode ser utilizado em todos os verbos do <code>{dplyr}</code> (com exceção do <code>select()</code> e <code>rename()</code>, já que ele não trás vantagens com relação ao que já podia ser feito) e isso unifica o modo de fazermos essas operações no <code>dplyr</code>. Em vez de termos uma família de funções para cada verbo, temos agora apenas o próprio verbo e a função <code>across()</code>.</p>
<p>Vamos ver um exemplo para o <code>mutate()</code> e para o <code>filter()</code>.</p>
<p>O código abaixo transforma todas as variáveis que possuem “area” no nome, passando os valores de pés quadrados para metros quadrados.</p>
<div class="sourceCode" id="cb324"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb324-1"><a href="7-2-dplyr.html#cb324-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb324-2"><a href="7-2-dplyr.html#cb324-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="fu">across</span>(</span>
<span id="cb324-3"><a href="7-2-dplyr.html#cb324-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">contains</span>(<span class="st">&quot;area&quot;</span>),</span>
<span id="cb324-4"><a href="7-2-dplyr.html#cb324-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~</span> .x <span class="sc">/</span> <span class="fl">10.764</span></span>
<span id="cb324-5"><a href="7-2-dplyr.html#cb324-5" aria-hidden="true" tabindex="-1"></a>  ))</span></code></pre></div>
<p>Já o código a seguir filtra apenas as casas que possuem varanda aberta, cerca e lareira (o <code>NA</code> nessa base significa que a casa não possui tal característica).</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb325-1"><a href="7-2-dplyr.html#cb325-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb325-2"><a href="7-2-dplyr.html#cb325-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(<span class="fu">across</span>(</span>
<span id="cb325-3"><a href="7-2-dplyr.html#cb325-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">c</span>(varanda_aberta_area, cerca_qualidade, lareira_qualidade),</span>
<span id="cb325-4"><a href="7-2-dplyr.html#cb325-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~!</span><span class="fu">is.na</span>(.x)</span>
<span id="cb325-5"><a href="7-2-dplyr.html#cb325-5" aria-hidden="true" tabindex="-1"></a>  )) </span></code></pre></div>
<p>Não precisamos do <code>across()</code> na hora de selecionar colunas. A função <code>select()</code> já usa naturalmente o mecanismo de seleção de colunas que o <code>across()</code> proporciona.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb326-1"><a href="7-2-dplyr.html#cb326-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb326-2"><a href="7-2-dplyr.html#cb326-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="fu">where</span>(is.numeric))</span></code></pre></div>
<pre><code>## # A tibble: 2,930 × 35
##    ordem lote_fachada lote_area construcao_ano remodelacao_ano alvenaria_area
##    &lt;int&gt;        &lt;int&gt;     &lt;int&gt;          &lt;int&gt;           &lt;int&gt;          &lt;int&gt;
##  1     1          141     31770           1960            1960            112
##  2     2           80     11622           1961            1961              0
##  3     3           81     14267           1958            1958            108
##  4     4           93     11160           1968            1968              0
##  5     5           74     13830           1997            1998              0
##  6     6           78      9978           1998            1998             20
##  7     7           41      4920           2001            2001              0
##  8     8           43      5005           1992            1992              0
##  9     9           39      5389           1995            1996              0
## 10    10           60      7500           1999            1999              0
## # … with 2,920 more rows, and 29 more variables:
## #   porao_area_com_acabamento_1 &lt;int&gt;, porao_area_com_acabamento_2 &lt;int&gt;,
## #   porao_area_sem_acabamento &lt;int&gt;, porao_area_total &lt;int&gt;,
## #   porao_num_banheiros &lt;int&gt;, porao_num_banheiros_lavabos &lt;int&gt;,
## #   primeiro_andar_area &lt;int&gt;, segundo_andar_area &lt;int&gt;,
## #   acabamento_baixa_qualidade_area &lt;int&gt;, acima_solo_area &lt;int&gt;,
## #   acima_solo_num_banheiros &lt;int&gt;, acima_solo_num_lavabos &lt;int&gt;,
## #   acima_solo_num_quartos &lt;int&gt;, acima_solo_num_cozinhas &lt;int&gt;,
## #   acima_solo_num_comodos &lt;int&gt;, total_num_lareiras &lt;int&gt;,
## #   garagem_ano_construcao &lt;int&gt;, garagem_capacidade_carros &lt;int&gt;,
## #   garagem_area &lt;int&gt;, deck_madeira_area &lt;int&gt;, varanda_aberta_area &lt;int&gt;,
## #   varanda_fechada_area &lt;int&gt;, varanda_3ssn_area &lt;int&gt;,
## #   varanda_com_tela_area &lt;int&gt;, piscina_area &lt;int&gt;,
## #   funcionalidades_valor &lt;int&gt;, venda_mes &lt;int&gt;, venda_ano &lt;int&gt;,
## #   venda_valor &lt;int&gt;</code></pre>
<p>O mesmo vale para o <code>rename()</code>. Se quisermos renomer várias colunas, a partir de uma função, utilizamos o <code>rename_with()</code>.</p>
<div class="sourceCode" id="cb328"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb328-1"><a href="7-2-dplyr.html#cb328-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb328-2"><a href="7-2-dplyr.html#cb328-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rename_with</span>(toupper, <span class="fu">contains</span>(<span class="st">&quot;venda&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 2,930 × 82
##    ordem pid    moradia_classe  moradia_zoneame… lote_fachada lote_area rua_tipo
##    &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;           &lt;chr&gt;                   &lt;int&gt;     &lt;int&gt; &lt;chr&gt;   
##  1     1 05263… 020             Residencial bai…          141     31770 pavimen…
##  2     2 05263… 020             Residencial alt…           80     11622 pavimen…
##  3     3 05263… 020             Residencial bai…           81     14267 pavimen…
##  4     4 05263… 020             Residencial bai…           93     11160 pavimen…
##  5     5 05271… 060             Residencial bai…           74     13830 pavimen…
##  6     6 05271… 060             Residencial bai…           78      9978 pavimen…
##  7     7 05271… desenvolviment… Residencial bai…           41      4920 pavimen…
##  8     8 05271… desenvolviment… Residencial bai…           43      5005 pavimen…
##  9     9 05271… desenvolviment… Residencial bai…           39      5389 pavimen…
## 10    10 05271… 060             Residencial bai…           60      7500 pavimen…
## # … with 2,920 more rows, and 75 more variables: beco_tipo &lt;chr&gt;,
## #   lote_formato &lt;chr&gt;, terreno_contorno &lt;chr&gt;, utilidades &lt;chr&gt;,
## #   lote_config &lt;chr&gt;, terreno_declive &lt;chr&gt;, vizinhanca &lt;chr&gt;,
## #   condicao_1 &lt;chr&gt;, condicao_2 &lt;chr&gt;, moradia_tipo &lt;chr&gt;,
## #   moradia_estilo &lt;chr&gt;, geral_qualidade &lt;chr&gt;, geral_condicao &lt;chr&gt;,
## #   construcao_ano &lt;int&gt;, remodelacao_ano &lt;int&gt;, telhado_estilo &lt;chr&gt;,
## #   telhado_material &lt;chr&gt;, exterior_cobertura_1 &lt;chr&gt;,
## #   exterior_cobertura_2 &lt;chr&gt;, alvenaria_tipo &lt;chr&gt;, alvenaria_area &lt;int&gt;,
## #   exterior_qualidade &lt;chr&gt;, exterior_condicao &lt;chr&gt;, fundacao_tipo &lt;chr&gt;,
## #   porao_qualidade &lt;chr&gt;, porao_condicao &lt;chr&gt;, porao_exposicao &lt;chr&gt;,
## #   porao_acabamento_1 &lt;chr&gt;, porao_area_com_acabamento_1 &lt;int&gt;,
## #   porao_acabamento_2 &lt;chr&gt;, porao_area_com_acabamento_2 &lt;int&gt;,
## #   porao_area_sem_acabamento &lt;int&gt;, porao_area_total &lt;int&gt;,
## #   porao_num_banheiros &lt;int&gt;, porao_num_banheiros_lavabos &lt;int&gt;,
## #   aquecimento_tipo &lt;chr&gt;, aquecimento_qualidade_condicao &lt;chr&gt;,
## #   ar_condicionado_central &lt;chr&gt;, sistema_eletrico_tipo &lt;chr&gt;,
## #   primeiro_andar_area &lt;int&gt;, segundo_andar_area &lt;int&gt;,
## #   acabamento_baixa_qualidade_area &lt;int&gt;, acima_solo_area &lt;int&gt;,
## #   acima_solo_num_banheiros &lt;int&gt;, acima_solo_num_lavabos &lt;int&gt;,
## #   acima_solo_num_quartos &lt;int&gt;, acima_solo_num_cozinhas &lt;int&gt;,
## #   cozinha_qualidade &lt;chr&gt;, acima_solo_num_comodos &lt;int&gt;, funcional &lt;chr&gt;,
## #   total_num_lareiras &lt;int&gt;, lareira_qualidade &lt;chr&gt;, garagem_tipo &lt;chr&gt;,
## #   garagem_ano_construcao &lt;int&gt;, garagem_acabamento &lt;chr&gt;,
## #   garagem_capacidade_carros &lt;int&gt;, garagem_area &lt;int&gt;,
## #   garagem_qualidade &lt;chr&gt;, garagem_condicao &lt;chr&gt;,
## #   entrada_veiculo_pavimentada &lt;chr&gt;, deck_madeira_area &lt;int&gt;,
## #   varanda_aberta_area &lt;int&gt;, varanda_fechada_area &lt;int&gt;,
## #   varanda_3ssn_area &lt;int&gt;, varanda_com_tela_area &lt;int&gt;, piscina_area &lt;int&gt;,
## #   piscina_qualidade &lt;chr&gt;, cerca_qualidade &lt;chr&gt;,
## #   funcionalidades_diversas &lt;chr&gt;, funcionalidades_valor &lt;int&gt;,
## #   VENDA_MES &lt;int&gt;, VENDA_ANO &lt;int&gt;, VENDA_TIPO &lt;chr&gt;, VENDA_CONDICAO &lt;chr&gt;,
## #   VENDA_VALOR &lt;int&gt;</code></pre>
</div>
<div id="a-função-relocate" class="section level4 unnumbered hasAnchor">
<h4>A função <code>relocate()</code><a href="7-2-dplyr.html#a-função-relocate" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>O <code>{dplyr}</code> possui agora uma função própria para reorganizar colunas: <code>relocate()</code>. Por padrão, ela coloca uma ou mais colunas no começo da base.</p>
<div class="sourceCode" id="cb330"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb330-1"><a href="7-2-dplyr.html#cb330-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb330-2"><a href="7-2-dplyr.html#cb330-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(venda_valor, venda_tipo)</span></code></pre></div>
<pre><code>## # A tibble: 2,930 × 82
##    venda_valor venda_tipo ordem pid    moradia_classe          moradia_zoneamen…
##          &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt;  &lt;chr&gt;                   &lt;chr&gt;            
##  1      215000 &quot;WD &quot;          1 05263… 020                     Residencial baix…
##  2      105000 &quot;WD &quot;          2 05263… 020                     Residencial alta…
##  3      172000 &quot;WD &quot;          3 05263… 020                     Residencial baix…
##  4      244000 &quot;WD &quot;          4 05263… 020                     Residencial baix…
##  5      189900 &quot;WD &quot;          5 05271… 060                     Residencial baix…
##  6      195500 &quot;WD &quot;          6 05271… 060                     Residencial baix…
##  7      213500 &quot;WD &quot;          7 05271… desenvolvimento de uni… Residencial baix…
##  8      191500 &quot;WD &quot;          8 05271… desenvolvimento de uni… Residencial baix…
##  9      236500 &quot;WD &quot;          9 05271… desenvolvimento de uni… Residencial baix…
## 10      189000 &quot;WD &quot;         10 05271… 060                     Residencial baix…
## # … with 2,920 more rows, and 76 more variables: lote_fachada &lt;int&gt;,
## #   lote_area &lt;int&gt;, rua_tipo &lt;chr&gt;, beco_tipo &lt;chr&gt;, lote_formato &lt;chr&gt;,
## #   terreno_contorno &lt;chr&gt;, utilidades &lt;chr&gt;, lote_config &lt;chr&gt;,
## #   terreno_declive &lt;chr&gt;, vizinhanca &lt;chr&gt;, condicao_1 &lt;chr&gt;,
## #   condicao_2 &lt;chr&gt;, moradia_tipo &lt;chr&gt;, moradia_estilo &lt;chr&gt;,
## #   geral_qualidade &lt;chr&gt;, geral_condicao &lt;chr&gt;, construcao_ano &lt;int&gt;,
## #   remodelacao_ano &lt;int&gt;, telhado_estilo &lt;chr&gt;, telhado_material &lt;chr&gt;,
## #   exterior_cobertura_1 &lt;chr&gt;, exterior_cobertura_2 &lt;chr&gt;,
## #   alvenaria_tipo &lt;chr&gt;, alvenaria_area &lt;int&gt;, exterior_qualidade &lt;chr&gt;,
## #   exterior_condicao &lt;chr&gt;, fundacao_tipo &lt;chr&gt;, porao_qualidade &lt;chr&gt;,
## #   porao_condicao &lt;chr&gt;, porao_exposicao &lt;chr&gt;, porao_acabamento_1 &lt;chr&gt;,
## #   porao_area_com_acabamento_1 &lt;int&gt;, porao_acabamento_2 &lt;chr&gt;,
## #   porao_area_com_acabamento_2 &lt;int&gt;, porao_area_sem_acabamento &lt;int&gt;,
## #   porao_area_total &lt;int&gt;, porao_num_banheiros &lt;int&gt;,
## #   porao_num_banheiros_lavabos &lt;int&gt;, aquecimento_tipo &lt;chr&gt;,
## #   aquecimento_qualidade_condicao &lt;chr&gt;, ar_condicionado_central &lt;chr&gt;,
## #   sistema_eletrico_tipo &lt;chr&gt;, primeiro_andar_area &lt;int&gt;,
## #   segundo_andar_area &lt;int&gt;, acabamento_baixa_qualidade_area &lt;int&gt;,
## #   acima_solo_area &lt;int&gt;, acima_solo_num_banheiros &lt;int&gt;,
## #   acima_solo_num_lavabos &lt;int&gt;, acima_solo_num_quartos &lt;int&gt;,
## #   acima_solo_num_cozinhas &lt;int&gt;, cozinha_qualidade &lt;chr&gt;,
## #   acima_solo_num_comodos &lt;int&gt;, funcional &lt;chr&gt;, total_num_lareiras &lt;int&gt;,
## #   lareira_qualidade &lt;chr&gt;, garagem_tipo &lt;chr&gt;, garagem_ano_construcao &lt;int&gt;,
## #   garagem_acabamento &lt;chr&gt;, garagem_capacidade_carros &lt;int&gt;,
## #   garagem_area &lt;int&gt;, garagem_qualidade &lt;chr&gt;, garagem_condicao &lt;chr&gt;,
## #   entrada_veiculo_pavimentada &lt;chr&gt;, deck_madeira_area &lt;int&gt;,
## #   varanda_aberta_area &lt;int&gt;, varanda_fechada_area &lt;int&gt;,
## #   varanda_3ssn_area &lt;int&gt;, varanda_com_tela_area &lt;int&gt;, piscina_area &lt;int&gt;,
## #   piscina_qualidade &lt;chr&gt;, cerca_qualidade &lt;chr&gt;,
## #   funcionalidades_diversas &lt;chr&gt;, funcionalidades_valor &lt;int&gt;,
## #   venda_mes &lt;int&gt;, venda_ano &lt;int&gt;, venda_condicao &lt;chr&gt;</code></pre>
<p>Podemos usar os argumentos <code>.after</code> e <code>.before</code> para fazer mudanças mais complexas.</p>
<p>O código baixo coloca a coluna <code>venda_ano</code> depois da coluna <code>construcao_ano</code>.</p>
<div class="sourceCode" id="cb332"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb332-1"><a href="7-2-dplyr.html#cb332-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb332-2"><a href="7-2-dplyr.html#cb332-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(venda_ano, <span class="at">.after =</span> construcao_ano)</span></code></pre></div>
<p>O código baixo coloca a coluna <code>venda_ano</code> antes da coluna <code>construcao_ano</code>.</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb333-1"><a href="7-2-dplyr.html#cb333-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb333-2"><a href="7-2-dplyr.html#cb333-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">relocate</span>(venda_ano, <span class="at">.before =</span> construcao_ano)</span></code></pre></div>
</div>
<div id="a-função-rowwise" class="section level4 unnumbered hasAnchor">
<h4>A função <code>rowwise()</code><a href="7-2-dplyr.html#a-função-rowwise" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Por fim, vamos discutir operações feitas por linha. Tome como exemplo a tabela abaixo. Ela apresenta as notas de alunos em quatro provas.</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb334-1"><a href="7-2-dplyr.html#cb334-1" aria-hidden="true" tabindex="-1"></a>tab_notas <span class="ot">&lt;-</span> <span class="fu">tibble</span>(</span>
<span id="cb334-2"><a href="7-2-dplyr.html#cb334-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">student_id =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb334-3"><a href="7-2-dplyr.html#cb334-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">prova1 =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb334-4"><a href="7-2-dplyr.html#cb334-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">prova2 =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb334-5"><a href="7-2-dplyr.html#cb334-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">prova3 =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>),</span>
<span id="cb334-6"><a href="7-2-dplyr.html#cb334-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">prova4 =</span> <span class="fu">sample</span>(<span class="dv">0</span><span class="sc">:</span><span class="dv">10</span>, <span class="dv">5</span>)</span>
<span id="cb334-7"><a href="7-2-dplyr.html#cb334-7" aria-hidden="true" tabindex="-1"></a>)</span>
<span id="cb334-8"><a href="7-2-dplyr.html#cb334-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb334-9"><a href="7-2-dplyr.html#cb334-9" aria-hidden="true" tabindex="-1"></a>tab_notas</span></code></pre></div>
<pre><code>## # A tibble: 5 × 5
##   student_id prova1 prova2 prova3 prova4
##        &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;
## 1          1     10      8      4      7
## 2          2      0      0      3      0
## 3          3      2      9     10      8
## 4          4      3      7      5      2
## 5          5      4      1      1      3</code></pre>
<p>Se quisermos gerar uma coluna com a nota média de cada aluno nas quatro provas, não poderíamos usar o <code>mutate()</code> diretamente.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb336-1"><a href="7-2-dplyr.html#cb336-1" aria-hidden="true" tabindex="-1"></a>tab_notas <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">c</span>(prova1, prova2, prova3, prova4)))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
##   student_id prova1 prova2 prova3 prova4 media
##        &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1          1     10      8      4      7  4.35
## 2          2      0      0      3      0  4.35
## 3          3      2      9     10      8  4.35
## 4          4      3      7      5      2  4.35
## 5          5      4      1      1      3  4.35</code></pre>
<p>Neste caso, todas as colunas estão sendo empilhadas e gerando uma única média, passada a todas as linhas da coluna <code>media</code>.</p>
<p>Para fazermos a conta para cada aluno, podemos agrupar por aluno. Agora sim a média é calculada apenas nas notas de cada estudante.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb338-1"><a href="7-2-dplyr.html#cb338-1" aria-hidden="true" tabindex="-1"></a>tab_notas <span class="sc">%&gt;%</span></span>
<span id="cb338-2"><a href="7-2-dplyr.html#cb338-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(student_id) <span class="sc">%&gt;%</span></span>
<span id="cb338-3"><a href="7-2-dplyr.html#cb338-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">c</span>(prova1, prova2, prova3, prova4)))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Groups:   student_id [5]
##   student_id prova1 prova2 prova3 prova4 media
##        &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1          1     10      8      4      7  7.25
## 2          2      0      0      3      0  0.75
## 3          3      2      9     10      8  7.25
## 4          4      3      7      5      2  4.25
## 5          5      4      1      1      3  2.25</code></pre>
<p>Também podemos nos aproveitar da sintaxe do <code>across()</code> neste caso. Para isso, precisamos substutir a função <code>c()</code> pela função <code>c_across()</code>.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb340-1"><a href="7-2-dplyr.html#cb340-1" aria-hidden="true" tabindex="-1"></a>tab_notas <span class="sc">%&gt;%</span></span>
<span id="cb340-2"><a href="7-2-dplyr.html#cb340-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(student_id) <span class="sc">%&gt;%</span></span>
<span id="cb340-3"><a href="7-2-dplyr.html#cb340-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;prova&quot;</span>))))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Groups:   student_id [5]
##   student_id prova1 prova2 prova3 prova4 media
##        &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1          1     10      8      4      7  7.25
## 2          2      0      0      3      0  0.75
## 3          3      2      9     10      8  7.25
## 4          4      3      7      5      2  4.25
## 5          5      4      1      1      3  2.25</code></pre>
<p>Equivalentemente ao <code>group_by()</code>, neste caso, podemos usar a função <code>rowwise()</code>.</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb342-1"><a href="7-2-dplyr.html#cb342-1" aria-hidden="true" tabindex="-1"></a>tab_notas <span class="sc">%&gt;%</span></span>
<span id="cb342-2"><a href="7-2-dplyr.html#cb342-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>(student_id) <span class="sc">%&gt;%</span></span>
<span id="cb342-3"><a href="7-2-dplyr.html#cb342-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;prova&quot;</span>))))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Rowwise:  student_id
##   student_id prova1 prova2 prova3 prova4 media
##        &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1          1     10      8      4      7  7.25
## 2          2      0      0      3      0  0.75
## 3          3      2      9     10      8  7.25
## 4          4      3      7      5      2  4.25
## 5          5      4      1      1      3  2.25</code></pre>
<p>Ela é muito útil quando queremos fazer operação por linhas, mas não temos uma coluna de identificação. Por padrão, se não indicarmos nenhuma coluna, cada linha será um “grupo”.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb344-1"><a href="7-2-dplyr.html#cb344-1" aria-hidden="true" tabindex="-1"></a>tab_notas <span class="sc">%&gt;%</span></span>
<span id="cb344-2"><a href="7-2-dplyr.html#cb344-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">rowwise</span>() <span class="sc">%&gt;%</span></span>
<span id="cb344-3"><a href="7-2-dplyr.html#cb344-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">media =</span> <span class="fu">mean</span>(<span class="fu">c_across</span>(<span class="fu">starts_with</span>(<span class="st">&quot;prova&quot;</span>))))</span></code></pre></div>
<pre><code>## # A tibble: 5 × 6
## # Rowwise: 
##   student_id prova1 prova2 prova3 prova4 media
##        &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt;  &lt;int&gt; &lt;dbl&gt;
## 1          1     10      8      4      7  7.25
## 2          2      0      0      3      0  0.75
## 3          3      2      9     10      8  7.25
## 4          4      3      7      5      2  4.25
## 5          5      4      1      1      3  2.25</code></pre>
<p>Veja que <code>student_id</code> não é passada para a função <code>rowwise()</code>. Não precisaríamos dessa coluna na base para reproduzir a geração da columa <code>media</code> neste caso.</p>
</div>
<div id="exercícios-17" class="section level4 unnumbered hasAnchor">
<h4>Exercícios<a href="7-2-dplyr.html#exercícios-17" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A base <code>casas</code> abaixo pode ser encontrada a partir do código abaixo:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb346-1"><a href="7-2-dplyr.html#cb346-1" aria-hidden="true" tabindex="-1"></a>remotes<span class="sc">::</span><span class="fu">install_github</span>(<span class="st">&quot;cienciadedatos/dados&quot;</span>)</span>
<span id="cb346-2"><a href="7-2-dplyr.html#cb346-2" aria-hidden="true" tabindex="-1"></a>dados<span class="sc">::</span>casas</span></code></pre></div>
<p><strong>1.</strong> Reescreva os códigos abaixo utilizando as funções <code>across()</code> e <code>where()</code>.</p>
<p><strong>a.</strong></p>
<div class="sourceCode" id="cb347"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb347-1"><a href="7-2-dplyr.html#cb347-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb347-2"><a href="7-2-dplyr.html#cb347-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(geral_qualidade) <span class="sc">%&gt;%</span></span>
<span id="cb347-3"><a href="7-2-dplyr.html#cb347-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(</span>
<span id="cb347-4"><a href="7-2-dplyr.html#cb347-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">acima_solo_area_media =</span> <span class="fu">mean</span>(acima_solo_area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb347-5"><a href="7-2-dplyr.html#cb347-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">garagem_area_media =</span> <span class="fu">mean</span>(garagem_area, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb347-6"><a href="7-2-dplyr.html#cb347-6" aria-hidden="true" tabindex="-1"></a>    <span class="at">valor_venda_medio =</span> <span class="fu">mean</span>(venda_valor, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb347-7"><a href="7-2-dplyr.html#cb347-7" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>b.</strong></p>
<div class="sourceCode" id="cb348"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb348-1"><a href="7-2-dplyr.html#cb348-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb348-2"><a href="7-2-dplyr.html#cb348-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter_at</span>(</span>
<span id="cb348-3"><a href="7-2-dplyr.html#cb348-3" aria-hidden="true" tabindex="-1"></a>    <span class="fu">vars</span>(porao_qualidade, varanda_fechada_area, cerca_qualidade),</span>
<span id="cb348-4"><a href="7-2-dplyr.html#cb348-4" aria-hidden="true" tabindex="-1"></a>    <span class="sc">~!</span><span class="fu">is.na</span>(.x)</span>
<span id="cb348-5"><a href="7-2-dplyr.html#cb348-5" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p><strong>c.</strong></p>
<div class="sourceCode" id="cb349"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb349-1"><a href="7-2-dplyr.html#cb349-1" aria-hidden="true" tabindex="-1"></a>casas <span class="sc">%&gt;%</span></span>
<span id="cb349-2"><a href="7-2-dplyr.html#cb349-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate_if</span>(is.character, <span class="sc">~</span>tidyr<span class="sc">::</span><span class="fu">replace_na</span>(.x, <span class="at">replace =</span> <span class="st">&quot;Não possui&quot;</span>))</span></code></pre></div>
<p><strong>2.</strong> Utilizando a base <code>casas</code>, resolva os itens a seguir.</p>
<ul>
<li><p><strong>a.</strong> Usando o <code>case_when()</code> crie um código para categorizar a variável venda_valor da seguinte maneira:</p>
<ul>
<li><strong>barata</strong>: $0 a $129.500<br />
</li>
<li><strong>preço mediano</strong>: $129.500 a $180.796</li>
<li><strong>cara</strong>: $ 180.796 a $213.500</li>
<li><strong>muito cara</strong>: maior que $213.500</li>
</ul></li>
</ul>
<div style="height: 10px;">

</div>
<ul>
<li><strong>b.</strong> Utilize o código feito na letra (a) para agrupar a base <code>casas</code> pela variável venda_valor categorizada e calcular todas as áreas médias para cada uma dessas categorias.</li>
</ul>
<p><strong>3.</strong> Escreva um código que receba a base <code>casas</code> e retorne uma tabela com apenas</p>
<ul>
<li><p><strong>a.</strong> as colunas referentes à garagem da casa.</p></li>
<li><p><strong>b.</strong> as colunas referentes a variáveis de qualidade.</p></li>
<li><p><strong>c.</strong> colunas numéricas que representam áreas da casa e do terreno.</p></li>
<li><p><strong>d.</strong> colunas numéricas.</p></li>
<li><p><strong>e.</strong> colunas referentes à piscina, porão e o valor de venda.</p></li>
</ul>
<p><strong>4.</strong> Usando a função <code>rename_with()</code>, troque todos os <code>"_"</code> dos nomes das colunas por um espaço <code>" "</code>.</p>
<p><strong>5.</strong> Escreva um código para colocar todas as colunas relativas a venda no começo da base <code>casas</code>.</p>
<p><strong>6.</strong> 5. Escreva um código para colocar todas as colunas numéricas da base <code>casas</code> no começo da tabela e todas as colunas categóricas no final.</p>

</div>
</div>
</div>
<hr/>
<footer>
<a href="https://curso-r.com" target="_blank"><img src="https://raw.githubusercontent.com/curso-r/site-v2/master/static/img/logo_cursor_full.png" width="15%", alt="Curso-R"/></a>
</footer>
            </section>

          </div>
        </div>
      </div>
<a href="7-1-tibbles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="7-3-tidyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["livro-curso-r.pdf", "livro-curso-r.epub", "livro-curso-r.mobi"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
