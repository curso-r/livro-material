<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>7.2 O pacote dplyr | Ciência de Dados em R</title>
  <meta name="description" content="Livro com os tutoriais e material dos cursos sobre ciência de dados da Curso-R." />
  <meta name="generator" content="bookdown 0.21 and GitBook 2.6.7" />

  <meta property="og:title" content="7.2 O pacote dplyr | Ciência de Dados em R" />
  <meta property="og:type" content="book" />
  
  <meta property="og:image" content="assets/img/logo.png" />
  <meta property="og:description" content="Livro com os tutoriais e material dos cursos sobre ciência de dados da Curso-R." />
  <meta name="github-repo" content="curso-r/livro-material" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="7.2 O pacote dplyr | Ciência de Dados em R" />
  
  <meta name="twitter:description" content="Livro com os tutoriais e material dos cursos sobre ciência de dados da Curso-R." />
  <meta name="twitter:image" content="assets/img/logo.png" />

<meta name="author" content="Curso-R" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  <link rel="shortcut icon" href="assets/img/favicon.ico" type="image/x-icon" />
<link rel="prev" href="7-1-tibbles.html"/>
<link rel="next" href="7-3-tidyr.html"/>
<script src="libs/header-attrs-2.7/header-attrs.js"></script>
<script src="libs/jquery-3.5.1/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.3/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.17/datatables.js"></script>
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.20/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.20/js/jquery.dataTables.min.js"></script>
<link href="libs/crosstalk-1.1.1/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.1.1/js/crosstalk.min.js"></script>
<script async defer src="https://hypothes.is/embed.js"></script>
<link href='https://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>
<link href='https://fonts.googleapis.com/css?family=Arvo' rel='stylesheet' type='text/css'>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="assets/style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./index.html"><img src = "https://raw.githubusercontent.com/curso-r/site-v2/master/static/img/logo_cursor_full.png" width = 80%></a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Sobre</a></li>
<li class="chapter" data-level="1" data-path="1-instalacao.html"><a href="1-instalacao.html"><i class="fa fa-check"></i><b>1</b> Instalação</a>
<ul>
<li class="chapter" data-level="1.1" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html"><i class="fa fa-check"></i><b>1.1</b> Instalação do R</a>
<ul>
<li class="chapter" data-level="1.1.1" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html#no-windows"><i class="fa fa-check"></i><b>1.1.1</b> No Windows</a></li>
<li class="chapter" data-level="1.1.2" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html#no-linux"><i class="fa fa-check"></i><b>1.1.2</b> No Linux</a></li>
<li class="chapter" data-level="1.1.3" data-path="1-1-instalacao-do-r.html"><a href="1-1-instalacao-do-r.html#no-mac"><i class="fa fa-check"></i><b>1.1.3</b> No Mac</a></li>
</ul></li>
<li class="chapter" data-level="1.2" data-path="1-2-instalacao-do-rstudio.html"><a href="1-2-instalacao-do-rstudio.html"><i class="fa fa-check"></i><b>1.2</b> Instalação do RStudio</a></li>
<li class="chapter" data-level="1.3" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html"><i class="fa fa-check"></i><b>1.3</b> Instalação de softwares adicionais</a>
<ul>
<li class="chapter" data-level="1.3.1" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#latex"><i class="fa fa-check"></i><b>1.3.1</b> LaTeX</a></li>
<li class="chapter" data-level="1.3.2" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#office"><i class="fa fa-check"></i><b>1.3.2</b> Office</a></li>
<li class="chapter" data-level="1.3.3" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#pagedown-e-chrome"><i class="fa fa-check"></i><b>1.3.3</b> Pagedown e Chrome</a></li>
<li class="chapter" data-level="1.3.4" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#renderizando-html-widgets"><i class="fa fa-check"></i><b>1.3.4</b> Renderizando HTML widgets</a></li>
<li class="chapter" data-level="1.3.5" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#blogdown"><i class="fa fa-check"></i><b>1.3.5</b> Blogdown</a></li>
<li class="chapter" data-level="1.3.6" data-path="1-3-instalacao-adicionais.html"><a href="1-3-instalacao-adicionais.html#rtools"><i class="fa fa-check"></i><b>1.3.6</b> Rtools</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="2" data-path="2-rstudio.html"><a href="2-rstudio.html"><i class="fa fa-check"></i><b>2</b> RStudio</a>
<ul>
<li class="chapter" data-level="2.1" data-path="2-1-telas.html"><a href="2-1-telas.html"><i class="fa fa-check"></i><b>2.1</b> Telas</a></li>
<li class="chapter" data-level="2.2" data-path="2-2-atalhos.html"><a href="2-2-atalhos.html"><i class="fa fa-check"></i><b>2.2</b> Atalhos</a></li>
<li class="chapter" data-level="2.3" data-path="2-3-projetos.html"><a href="2-3-projetos.html"><i class="fa fa-check"></i><b>2.3</b> Projetos</a></li>
<li class="chapter" data-level="2.4" data-path="2-4-git-e-versionamento.html"><a href="2-4-git-e-versionamento.html"><i class="fa fa-check"></i><b>2.4</b> Git e versionamento</a></li>
<li class="chapter" data-level="2.5" data-path="2-5-cheatsheets.html"><a href="2-5-cheatsheets.html"><i class="fa fa-check"></i><b>2.5</b> Cheatsheets</a></li>
<li class="chapter" data-level="2.6" data-path="2-6-addins.html"><a href="2-6-addins.html"><i class="fa fa-check"></i><b>2.6</b> Addins</a></li>
<li class="chapter" data-level="2.7" data-path="2-7-snippets.html"><a href="2-7-snippets.html"><i class="fa fa-check"></i><b>2.7</b> Snippets</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="3-r-base.html"><a href="3-r-base.html"><i class="fa fa-check"></i><b>3</b> R Básico</a>
<ul>
<li class="chapter" data-level="3.1" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html"><i class="fa fa-check"></i><b>3.1</b> Pedindo Ajuda</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html#documentação-do-r"><i class="fa fa-check"></i><b>3.1.1</b> Documentação do R</a></li>
<li class="chapter" data-level="3.1.2" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html#google"><i class="fa fa-check"></i><b>3.1.2</b> Google</a></li>
<li class="chapter" data-level="3.1.3" data-path="3-1-pedindo-ajuda.html"><a href="3-1-pedindo-ajuda.html#stack-overflow"><i class="fa fa-check"></i><b>3.1.3</b> Stack Overflow</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="3-2-r-como-calculadora.html"><a href="3-2-r-como-calculadora.html"><i class="fa fa-check"></i><b>3.2</b> R como calculadora</a>
<ul>
<li class="chapter" data-level="" data-path="3-2-r-como-calculadora.html"><a href="3-2-r-como-calculadora.html#exercícios"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="3-3-objetosFuncoes.html"><a href="3-3-objetosFuncoes.html"><i class="fa fa-check"></i><b>3.3</b> Objetos e funções</a>
<ul>
<li class="chapter" data-level="" data-path="3-3-objetosFuncoes.html"><a href="3-3-objetosFuncoes.html#exercícios-1"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="3-4-data-frames.html"><a href="3-4-data-frames.html"><i class="fa fa-check"></i><b>3.4</b> Data frames</a></li>
<li class="chapter" data-level="3.5" data-path="3-5-classes.html"><a href="3-5-classes.html"><i class="fa fa-check"></i><b>3.5</b> Classes</a>
<ul>
<li class="chapter" data-level="3.5.1" data-path="3-5-classes.html"><a href="3-5-classes.html#exercícios-2"><i class="fa fa-check"></i><b>3.5.1</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.6" data-path="3-6-vetores.html"><a href="3-6-vetores.html"><i class="fa fa-check"></i><b>3.6</b> Vetores</a>
<ul>
<li class="chapter" data-level="" data-path="3-6-vetores.html"><a href="3-6-vetores.html#exercícios-3"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.7" data-path="3-7-testes-lógicos.html"><a href="3-7-testes-lógicos.html"><i class="fa fa-check"></i><b>3.7</b> Testes lógicos</a>
<ul>
<li class="chapter" data-level="" data-path="3-7-testes-lógicos.html"><a href="3-7-testes-lógicos.html#exercícios-4"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.8" data-path="3-8-valoresEspeciais.html"><a href="3-8-valoresEspeciais.html"><i class="fa fa-check"></i><b>3.8</b> Valores especiais</a>
<ul>
<li class="chapter" data-level="" data-path="3-8-valoresEspeciais.html"><a href="3-8-valoresEspeciais.html#exercícios-5"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.9" data-path="3-9-listas.html"><a href="3-9-listas.html"><i class="fa fa-check"></i><b>3.9</b> Listas</a></li>
<li class="chapter" data-level="3.10" data-path="3-10-mais-sobre-data-frames.html"><a href="3-10-mais-sobre-data-frames.html"><i class="fa fa-check"></i><b>3.10</b> Mais sobre data frames</a>
<ul>
<li class="chapter" data-level="" data-path="3-10-mais-sobre-data-frames.html"><a href="3-10-mais-sobre-data-frames.html#exercícios-6"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.11" data-path="3-11-maisFuncoes.html"><a href="3-11-maisFuncoes.html"><i class="fa fa-check"></i><b>3.11</b> Mais sobre funções</a>
<ul>
<li class="chapter" data-level="" data-path="3-11-maisFuncoes.html"><a href="3-11-maisFuncoes.html#exercícios-7"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.12" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html"><i class="fa fa-check"></i><b>3.12</b> Controle de Fluxo</a>
<ul>
<li class="chapter" data-level="3.12.1" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html#condicionamento-if-e-else"><i class="fa fa-check"></i><b>3.12.1</b> Condicionamento: if e else</a></li>
<li class="chapter" data-level="3.12.2" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html#iteradores-for-e-while"><i class="fa fa-check"></i><b>3.12.2</b> Iteradores: for e while</a></li>
<li class="chapter" data-level="" data-path="3-12-controle-de-fluxo.html"><a href="3-12-controle-de-fluxo.html#exercícios-8"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="3.13" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html"><i class="fa fa-check"></i><b>3.13</b> Outros tópicos</a>
<ul>
<li class="chapter" data-level="3.13.1" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html#matrizes"><i class="fa fa-check"></i><b>3.13.1</b> Matrizes</a></li>
<li class="chapter" data-level="3.13.2" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html#fatores"><i class="fa fa-check"></i><b>3.13.2</b> Fatores</a></li>
<li class="chapter" data-level="3.13.3" data-path="3-13-outros-tópicos.html"><a href="3-13-outros-tópicos.html#gráficos-r-base"><i class="fa fa-check"></i><b>3.13.3</b> Gráficos (R base)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="4-pacotes.html"><a href="4-pacotes.html"><i class="fa fa-check"></i><b>4</b> Pacotes</a>
<ul>
<li class="chapter" data-level="4.1" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html"><i class="fa fa-check"></i><b>4.1</b> Instalação de pacotes</a>
<ul>
<li class="chapter" data-level="4.1.1" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html#via-cran"><i class="fa fa-check"></i><b>4.1.1</b> Via CRAN</a></li>
<li class="chapter" data-level="4.1.2" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html#via-github"><i class="fa fa-check"></i><b>4.1.2</b> Via Github</a></li>
<li class="chapter" data-level="4.1.3" data-path="4-1-instalação-de-pacotes.html"><a href="4-1-instalação-de-pacotes.html#via-arquivo-.zip-ou-.tar.gz"><i class="fa fa-check"></i><b>4.1.3</b> Via arquivo .zip ou .tar.gz</a></li>
</ul></li>
<li class="chapter" data-level="4.2" data-path="4-2-tidyverse.html"><a href="4-2-tidyverse.html"><i class="fa fa-check"></i><b>4.2</b> Tidyverse</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="5-importacao.html"><a href="5-importacao.html"><i class="fa fa-check"></i><b>5</b> Importação</a>
<ul>
<li class="chapter" data-level="5.1" data-path="5-1-caminhos.html"><a href="5-1-caminhos.html"><i class="fa fa-check"></i><b>5.1</b> Caminhos</a></li>
<li class="chapter" data-level="5.2" data-path="5-2-readr.html"><a href="5-2-readr.html"><i class="fa fa-check"></i><b>5.2</b> O pacote readr</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="5-2-readr.html"><a href="5-2-readr.html#lendo-arquivos-de-texto"><i class="fa fa-check"></i><b>5.2.1</b> Lendo arquivos de texto</a></li>
<li class="chapter" data-level="5.2.2" data-path="5-2-readr.html"><a href="5-2-readr.html#locale"><i class="fa fa-check"></i><b>5.2.2</b> Locale</a></li>
<li class="chapter" data-level="5.2.3" data-path="5-2-readr.html"><a href="5-2-readr.html#parseando-valores"><i class="fa fa-check"></i><b>5.2.3</b> Parseando valores</a></li>
<li class="chapter" data-level="5.2.4" data-path="5-2-readr.html"><a href="5-2-readr.html#escrevendo-arquivos-de-texto"><i class="fa fa-check"></i><b>5.2.4</b> Escrevendo arquivos de texto</a></li>
<li class="chapter" data-level="5.2.5" data-path="5-2-readr.html"><a href="5-2-readr.html#arquivos-.rds"><i class="fa fa-check"></i><b>5.2.5</b> Arquivos .rds</a></li>
<li class="chapter" data-level="" data-path="5-2-readr.html"><a href="5-2-readr.html#exercícios-9"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="5-3-readxl.html"><a href="5-3-readxl.html"><i class="fa fa-check"></i><b>5.3</b> Os pacotes readxl e writexl</a></li>
<li class="chapter" data-level="5.4" data-path="5-4-haven.html"><a href="5-4-haven.html"><i class="fa fa-check"></i><b>5.4</b> haven</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="6-pipe.html"><a href="6-pipe.html"><i class="fa fa-check"></i><b>6</b> Pipe</a>
<ul>
<li class="chapter" data-level="6.1" data-path="6-1-o-operador-pipe.html"><a href="6-1-o-operador-pipe.html"><i class="fa fa-check"></i><b>6.1</b> O operador pipe</a>
<ul>
<li class="chapter" data-level="" data-path="6-1-o-operador-pipe.html"><a href="6-1-o-operador-pipe.html#exercícios-10"><i class="fa fa-check"></i>Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="6-2-outros-operadores.html"><a href="6-2-outros-operadores.html"><i class="fa fa-check"></i><b>6.2</b> Outros operadores</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="7-manipulacao.html"><a href="7-manipulacao.html"><i class="fa fa-check"></i><b>7</b> Manipulação</a>
<ul>
<li class="chapter" data-level="7.1" data-path="7-1-tibbles.html"><a href="7-1-tibbles.html"><i class="fa fa-check"></i><b>7.1</b> Tibbles</a></li>
<li class="chapter" data-level="7.2" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html"><i class="fa fa-check"></i><b>7.2</b> O pacote dplyr</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#selecionando-colunas"><i class="fa fa-check"></i><b>7.2.1</b> Selecionando colunas</a></li>
<li class="chapter" data-level="7.2.2" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#ordenando-a-base"><i class="fa fa-check"></i><b>7.2.2</b> Ordenando a base</a></li>
<li class="chapter" data-level="7.2.3" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#o-pipe-em-ação"><i class="fa fa-check"></i><b>7.2.3</b> O pipe em ação</a></li>
<li class="chapter" data-level="7.2.4" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#filtrando-linhas"><i class="fa fa-check"></i><b>7.2.4</b> Filtrando linhas</a></li>
<li class="chapter" data-level="7.2.5" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#modificando-e-criando-novas-colunas"><i class="fa fa-check"></i><b>7.2.5</b> Modificando e criando novas colunas</a></li>
<li class="chapter" data-level="7.2.6" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#summarisando-a-base"><i class="fa fa-check"></i><b>7.2.6</b> Summarisando a base</a></li>
<li class="chapter" data-level="7.2.7" data-path="7-2-dplyr.html"><a href="7-2-dplyr.html#juntando-duas-bases"><i class="fa fa-check"></i><b>7.2.7</b> Juntando duas bases</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html"><i class="fa fa-check"></i><b>7.3</b> O pacote tidyr</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#gather"><i class="fa fa-check"></i><b>7.3.1</b> <code>gather()</code></a></li>
<li class="chapter" data-level="7.3.2" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#spread"><i class="fa fa-check"></i><b>7.3.2</b> <code>spread()</code></a></li>
<li class="chapter" data-level="7.3.3" data-path="7-3-tidyr.html"><a href="7-3-tidyr.html#outras-funções-do-tidyr"><i class="fa fa-check"></i><b>7.3.3</b> Outras funções do <code>tidyr</code></a></li>
</ul></li>
<li class="chapter" data-level="7.4" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html"><i class="fa fa-check"></i><b>7.4</b> O pacote stringr</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#introdução"><i class="fa fa-check"></i><b>7.4.1</b> Introdução</a></li>
<li class="chapter" data-level="7.4.2" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#funções-básicas"><i class="fa fa-check"></i><b>7.4.2</b> Funções básicas</a></li>
<li class="chapter" data-level="7.4.3" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#expressões-regulares"><i class="fa fa-check"></i><b>7.4.3</b> Expressões Regulares</a></li>
<li class="chapter" data-level="7.4.4" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#funções-que-utilizam-regex"><i class="fa fa-check"></i><b>7.4.4</b> Funções que utilizam regex</a></li>
<li class="chapter" data-level="7.4.5" data-path="7-4-o-pacote-stringr.html"><a href="7-4-o-pacote-stringr.html#exercícios-17"><i class="fa fa-check"></i><b>7.4.5</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="7.5" data-path="7-5-forcats.html"><a href="7-5-forcats.html"><i class="fa fa-check"></i><b>7.5</b> O pacote forcats</a></li>
<li class="chapter" data-level="7.6" data-path="7-6-o-pacote-lubridate.html"><a href="7-6-o-pacote-lubridate.html"><i class="fa fa-check"></i><b>7.6</b> O pacote lubridate</a></li>
</ul></li>
<li class="chapter" data-level="8" data-path="8-graficos.html"><a href="8-graficos.html"><i class="fa fa-check"></i><b>8</b> Visualização</a>
<ul>
<li class="chapter" data-level="8.1" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html"><i class="fa fa-check"></i><b>8.1</b> O pacote ggplot2</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#gráficos-de-pontos-dispersão"><i class="fa fa-check"></i><b>8.1.1</b> Gráficos de pontos (dispersão)</a></li>
<li class="chapter" data-level="8.1.2" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#gráficos-de-linhas"><i class="fa fa-check"></i><b>8.1.2</b> Gráficos de linhas</a></li>
<li class="chapter" data-level="8.1.3" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#gráficos-de-barras"><i class="fa fa-check"></i><b>8.1.3</b> Gráficos de barras</a></li>
<li class="chapter" data-level="8.1.4" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#histogramas-e-boxplots"><i class="fa fa-check"></i><b>8.1.4</b> Histogramas e boxplots</a></li>
<li class="chapter" data-level="8.1.5" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#títulos-e-labels"><i class="fa fa-check"></i><b>8.1.5</b> Títulos e <em>labels</em></a></li>
<li class="chapter" data-level="8.1.6" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#escalas"><i class="fa fa-check"></i><b>8.1.6</b> Escalas</a></li>
<li class="chapter" data-level="8.1.7" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#temas"><i class="fa fa-check"></i><b>8.1.7</b> Temas</a></li>
<li class="chapter" data-level="8.1.8" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#juntando-gráficos"><i class="fa fa-check"></i><b>8.1.8</b> Juntando gráficos</a></li>
<li class="chapter" data-level="8.1.9" data-path="8-1-o-pacote-ggplot2.html"><a href="8-1-o-pacote-ggplot2.html#exercícios-18"><i class="fa fa-check"></i><b>8.1.9</b> Exercícios</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="8-2-extensões-do-pacote-ggplot2.html"><a href="8-2-extensões-do-pacote-ggplot2.html"><i class="fa fa-check"></i><b>8.2</b> Extensões do pacote ggplot2</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="8-2-extensões-do-pacote-ggplot2.html"><a href="8-2-extensões-do-pacote-ggplot2.html#gghighlight"><i class="fa fa-check"></i><b>8.2.1</b> gghighlight</a></li>
<li class="chapter" data-level="8.2.2" data-path="8-2-extensões-do-pacote-ggplot2.html"><a href="8-2-extensões-do-pacote-ggplot2.html#ggridges"><i class="fa fa-check"></i><b>8.2.2</b> ggridges</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="9" data-path="9-relatorios.html"><a href="9-relatorios.html"><i class="fa fa-check"></i><b>9</b> Relatórios</a>
<ul>
<li class="chapter" data-level="9.1" data-path="9-1-markdown.html"><a href="9-1-markdown.html"><i class="fa fa-check"></i><b>9.1</b> Markdown</a>
<ul>
<li class="chapter" data-level="9.1.1" data-path="9-1-markdown.html"><a href="9-1-markdown.html#ênfase"><i class="fa fa-check"></i><b>9.1.1</b> Ênfase</a></li>
<li class="chapter" data-level="9.1.2" data-path="9-1-markdown.html"><a href="9-1-markdown.html#títulos"><i class="fa fa-check"></i><b>9.1.2</b> Títulos</a></li>
<li class="chapter" data-level="9.1.3" data-path="9-1-markdown.html"><a href="9-1-markdown.html#listas-1"><i class="fa fa-check"></i><b>9.1.3</b> Listas</a></li>
<li class="chapter" data-level="9.1.4" data-path="9-1-markdown.html"><a href="9-1-markdown.html#equações"><i class="fa fa-check"></i><b>9.1.4</b> Equações</a></li>
<li class="chapter" data-level="9.1.5" data-path="9-1-markdown.html"><a href="9-1-markdown.html#código"><i class="fa fa-check"></i><b>9.1.5</b> Código</a></li>
<li class="chapter" data-level="9.1.6" data-path="9-1-markdown.html"><a href="9-1-markdown.html#links"><i class="fa fa-check"></i><b>9.1.6</b> Links</a></li>
<li class="chapter" data-level="9.1.7" data-path="9-1-markdown.html"><a href="9-1-markdown.html#imagens"><i class="fa fa-check"></i><b>9.1.7</b> Imagens</a></li>
<li class="chapter" data-level="9.1.8" data-path="9-1-markdown.html"><a href="9-1-markdown.html#tabelas"><i class="fa fa-check"></i><b>9.1.8</b> Tabelas</a></li>
<li class="chapter" data-level="9.1.9" data-path="9-1-markdown.html"><a href="9-1-markdown.html#recapitulando"><i class="fa fa-check"></i><b>9.1.9</b> Recapitulando</a></li>
</ul></li>
<li class="chapter" data-level="9.2" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html"><i class="fa fa-check"></i><b>9.2</b> R Markdown</a>
<ul>
<li class="chapter" data-level="9.2.1" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#códigos-em-r"><i class="fa fa-check"></i><b>9.2.1</b> Códigos em R</a></li>
<li class="chapter" data-level="9.2.2" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#imagens-1"><i class="fa fa-check"></i><b>9.2.2</b> Imagens</a></li>
<li class="chapter" data-level="9.2.3" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#tabelas-1"><i class="fa fa-check"></i><b>9.2.3</b> Tabelas</a></li>
<li class="chapter" data-level="9.2.4" data-path="9-2-r-markdown.html"><a href="9-2-r-markdown.html#dicas-para-o-rstudio"><i class="fa fa-check"></i><b>9.2.4</b> Dicas para o RStudio</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="10-funcionais.html"><a href="10-funcionais.html"><i class="fa fa-check"></i><b>10</b> Funcionais</a></li>
<li class="chapter" data-level="11" data-path="11-misc.html"><a href="11-misc.html"><i class="fa fa-check"></i><b>11</b> Miscelânea</a>
<ul>
<li class="chapter" data-level="11.1" data-path="11-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="11-1-arrumando-banco-de-dados-o-pacote-janitor.html"><i class="fa fa-check"></i><b>11.1</b> Arrumando banco de dados: o pacote janitor</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="11-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="11-1-arrumando-banco-de-dados-o-pacote-janitor.html#arrumando-o-nome-das-variáveis"><i class="fa fa-check"></i><b>11.1.1</b> Arrumando o nome das variáveis</a></li>
<li class="chapter" data-level="11.1.2" data-path="11-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="11-1-arrumando-banco-de-dados-o-pacote-janitor.html#removendo-linhas-e-colunas-vazias"><i class="fa fa-check"></i><b>11.1.2</b> Removendo linhas e colunas vazias</a></li>
<li class="chapter" data-level="11.1.3" data-path="11-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="11-1-arrumando-banco-de-dados-o-pacote-janitor.html#identificando-linhas-duplicadas"><i class="fa fa-check"></i><b>11.1.3</b> Identificando linhas duplicadas</a></li>
<li class="chapter" data-level="11.1.4" data-path="11-1-arrumando-banco-de-dados-o-pacote-janitor.html"><a href="11-1-arrumando-banco-de-dados-o-pacote-janitor.html#outras-funções"><i class="fa fa-check"></i><b>11.1.4</b> Outras funções</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="12-respostas.html"><a href="12-respostas.html"><i class="fa fa-check"></i><b>12</b> Respostas</a>
<ul>
<li class="chapter" data-level="12.1" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html"><i class="fa fa-check"></i><b>12.1</b> R básico</a>
<ul>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#r-como-calculadora-1"><i class="fa fa-check"></i>R como calculadora</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#objetos-e-funções"><i class="fa fa-check"></i>Objetos e funções</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#classes-1"><i class="fa fa-check"></i>Classes</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#vetores-1"><i class="fa fa-check"></i>Vetores</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#testes-lógicos-1"><i class="fa fa-check"></i>Testes lógicos</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#valores-especiais"><i class="fa fa-check"></i>Valores especiais</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#data-frames-1"><i class="fa fa-check"></i>Data frames</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#mais-sobre-funções"><i class="fa fa-check"></i>Mais sobre funções</a></li>
<li class="chapter" data-level="" data-path="12-1-r-básico.html"><a href="12-1-r-básico.html#controle-de-fluxo-1"><i class="fa fa-check"></i>Controle de fluxo</a></li>
</ul></li>
<li class="chapter" data-level="12.2" data-path="12-2-importação.html"><a href="12-2-importação.html"><i class="fa fa-check"></i><b>12.2</b> Importação</a>
<ul>
<li class="chapter" data-level="" data-path="12-2-importação.html"><a href="12-2-importação.html#o-pacote-readr"><i class="fa fa-check"></i>O pacote readr</a></li>
</ul></li>
<li class="chapter" data-level="12.3" data-path="12-3-pipe-1.html"><a href="12-3-pipe-1.html"><i class="fa fa-check"></i><b>12.3</b> Pipe</a></li>
<li class="chapter" data-level="12.4" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html"><i class="fa fa-check"></i><b>12.4</b> O pacote dplyr</a>
<ul>
<li class="chapter" data-level="" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html#selecionando-colunas-1"><i class="fa fa-check"></i>Selecionando colunas</a></li>
<li class="chapter" data-level="" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html#ordenando-a-base-1"><i class="fa fa-check"></i>Ordenando a base</a></li>
<li class="chapter" data-level="" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html#filtrando-linhas-1"><i class="fa fa-check"></i>Filtrando linhas</a></li>
<li class="chapter" data-level="" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html#modificando-e-criando-novas-colunas-1"><i class="fa fa-check"></i>Modificando e criando novas colunas</a></li>
<li class="chapter" data-level="" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html#summarisando-a-base-1"><i class="fa fa-check"></i>Summarisando a base</a></li>
<li class="chapter" data-level="" data-path="12-4-o-pacote-dplyr.html"><a href="12-4-o-pacote-dplyr.html#juntando-duas-bases-1"><i class="fa fa-check"></i>Juntando duas bases</a></li>
</ul></li>
<li class="chapter" data-level="12.5" data-path="12-5-o-pacote-ggplot2-1.html"><a href="12-5-o-pacote-ggplot2-1.html"><i class="fa fa-check"></i><b>12.5</b> O pacote ggplot2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html"><i class="fa fa-check"></i>Referências</a>
<ul>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html#allison-horst"><i class="fa fa-check"></i>Allison Horst</a></li>
<li class="chapter" data-level="" data-path="referências.html"><a href="referências.html#programação-em-r"><i class="fa fa-check"></i>Programação em R</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Publicado com bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ciência de Dados em R</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="dplyr" class="section level2" number="7.2">
<h2><span class="header-section-number">7.2</span> O pacote dplyr</h2>
<p>O <code>dplyr</code> é o pacote mais útil para realizar transformação de dados, aliando simplicidade e eficiência de uma forma elegante. Os scripts em R que fazem uso inteligente dos verbos <code>dplyr</code> e as facilidades do operador <em>pipe</em> tendem a ficar mais legíveis e organizados sem perder velocidade de execução.</p>
<p>As principais funções do <code>dplyr</code> são:</p>
<ul>
<li><code>select()</code> - seleciona colunas</li>
<li><code>arrange()</code> - ordena a base</li>
<li><code>filter()</code> - filtra linhas</li>
<li><code>mutate()</code> - cria/modifica colunas</li>
<li><code>group_by()</code> - agrupa a base</li>
<li><code>summarise()</code> - sumariza a base</li>
</ul>
<p>Todas essas funções seguem as mesmas características:</p>
<ul>
<li>O <em>input</em> é sempre uma <code>tibble</code> e o <em>output</em> é sempre um <code>tibble</code>.</li>
<li>Colocamos a <code>tibble</code> no primeiro argumento e o que queremos fazer nos outros argumentos.</li>
<li>A utilização é facilitada com o emprego do operador <code>%&gt;%</code>.</li>
</ul>
<p>As principais vantagens de se usar o <code>dplyr</code> em detrimento das funções do R base são:</p>
<ul>
<li>Manipular dados se torna uma tarefa muito mais simples.</li>
<li>O código fica mais intuitivo de ser escrito e mais simples de ser lido.</li>
<li>O pacote <code>dplyr</code> utiliza <code>C</code> e <code>C++</code> por trás da maioria das funções, o que geralmente torna o código mais rápido.</li>
<li>É possível trabalhar com diferentes fontes de dados, como bases relacionais (SQL) e <code>data.table</code>.</li>
</ul>
<p>Se você ainda não tiver o <code>dplyr</code> instalado, rode o código abaixo.</p>
<div class="sourceCode" id="cb233"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb233-1"><a href="7-2-dplyr.html#cb233-1" aria-hidden="true" tabindex="-1"></a><span class="fu">install.packages</span>(<span class="st">&quot;dplyr&quot;</span>)</span>
<span id="cb233-2"><a href="7-2-dplyr.html#cb233-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span></code></pre></div>
<p>Neste capítulo, vamos trabalhar com uma base de filmes do IMDB. Essa base pode ser baixada <a href="https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds">clicando aqui</a>.</p>
<p>Assim, utilizaremos o objeto <code>imdb</code> para acessar os dados.</p>
<div class="sourceCode" id="cb234"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb234-1"><a href="7-2-dplyr.html#cb234-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="ot">&lt;-</span> readr<span class="sc">::</span><span class="fu">read_rds</span>(<span class="st">&quot;imdb.rds&quot;</span>)</span>
<span id="cb234-2"><a href="7-2-dplyr.html#cb234-2" aria-hidden="true" tabindex="-1"></a>imdb</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Agora, vamos avaliar com mais detalhes as principais funções do pacote <code>dplyr</code>.</p>
<div id="selecionando-colunas" class="section level3" number="7.2.1">
<h3><span class="header-section-number">7.2.1</span> Selecionando colunas</h3>
<p>Para selecionar colunas, utilizamos a função <code>select()</code>.</p>
<p>O primeiro argumento da função é a base de dados e os demais argumentos são os nomes das colunas que você gostaria de selecionar. Repare que você não precisa colocar o nome da coluna entre aspas.</p>
<div class="sourceCode" id="cb236"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb236-1"><a href="7-2-dplyr.html#cb236-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, titulo)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 1
##    titulo                                     
##    &lt;chr&gt;                                      
##  1 Avatar                                     
##  2 Pirates of the Caribbean: At World&#39;s End   
##  3 The Dark Knight Rises                      
##  4 John Carter                                
##  5 Spider-Man 3                               
##  6 Tangled                                    
##  7 Avengers: Age of Ultron                    
##  8 Batman v Superman: Dawn of Justice         
##  9 Superman Returns                           
## 10 Pirates of the Caribbean: Dead Man&#39;s Chest 
## # … with 3,797 more rows</code></pre>
<p>Você também pode selecionar várias colunas.</p>
<div class="sourceCode" id="cb238"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb238-1"><a href="7-2-dplyr.html#cb238-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, titulo, ano, orcamento)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 3
##    titulo                                        ano orcamento
##    &lt;chr&gt;                                       &lt;int&gt;     &lt;int&gt;
##  1 Avatar                                       2009 237000000
##  2 Pirates of the Caribbean: At World&#39;s End     2007 300000000
##  3 The Dark Knight Rises                        2012 250000000
##  4 John Carter                                  2012 263700000
##  5 Spider-Man 3                                 2007 258000000
##  6 Tangled                                      2010 260000000
##  7 Avengers: Age of Ultron                      2015 250000000
##  8 Batman v Superman: Dawn of Justice           2016 250000000
##  9 Superman Returns                             2006 209000000
## 10 Pirates of the Caribbean: Dead Man&#39;s Chest   2006 225000000
## # … with 3,797 more rows</code></pre>
<p>O operador <code>:</code> é muito útil para selecionar colunas consecutivas.</p>
<div class="sourceCode" id="cb240"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb240-1"><a href="7-2-dplyr.html#cb240-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, titulo<span class="sc">:</span>cor)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 5
##    titulo                                     ano diretor          duracao cor  
##    &lt;chr&gt;                                    &lt;int&gt; &lt;chr&gt;              &lt;int&gt; &lt;chr&gt;
##  1 Avatar                                    2009 James Cameron        178 Color
##  2 Pirates of the Caribbean: At World&#39;s En…  2007 Gore Verbinski       169 Color
##  3 The Dark Knight Rises                     2012 Christopher Nol…     164 Color
##  4 John Carter                               2012 Andrew Stanton       132 Color
##  5 Spider-Man 3                              2007 Sam Raimi            156 Color
##  6 Tangled                                   2010 Nathan Greno         100 Color
##  7 Avengers: Age of Ultron                   2015 Joss Whedon          141 Color
##  8 Batman v Superman: Dawn of Justice        2016 Zack Snyder          183 Color
##  9 Superman Returns                          2006 Bryan Singer         169 Color
## 10 Pirates of the Caribbean: Dead Man&#39;s Ch…  2006 Gore Verbinski       151 Color
## # … with 3,797 more rows</code></pre>
<p>O <code>dplyr</code> possui o conjunto de funções auxiliares muito úteis para seleção de colunas. As principais são:</p>
<ul>
<li><code>starts_with()</code>: para colunas que começam com um texto padrão</li>
<li><code>ends_with()</code>: para colunas que terminam com um texto padrão</li>
<li><code>contains()</code>: para colunas que contêm um texto padrão</li>
</ul>
<p>Selecionamos a seguir todas as colunas que começam com o texto “ator”.</p>
<div class="sourceCode" id="cb242"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb242-1"><a href="7-2-dplyr.html#cb242-1" aria-hidden="true" tabindex="-1"></a><span class="fu">select</span>(imdb, <span class="fu">starts_with</span>(<span class="st">&quot;ator&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 3
##    ator_1          ator_2            ator_3              
##    &lt;chr&gt;           &lt;chr&gt;             &lt;chr&gt;               
##  1 CCH Pounder     Joel David Moore  Wes Studi           
##  2 Johnny Depp     Orlando Bloom     Jack Davenport      
##  3 Tom Hardy       Christian Bale    Joseph Gordon-Levitt
##  4 Daryl Sabara    Samantha Morton   Polly Walker        
##  5 J.K. Simmons    James Franco      Kirsten Dunst       
##  6 Brad Garrett    Donna Murphy      M.C. Gainey         
##  7 Chris Hemsworth Robert Downey Jr. Scarlett Johansson  
##  8 Henry Cavill    Lauren Cohan      Alan D. Purwin      
##  9 Kevin Spacey    Marlon Brando     Frank Langella      
## 10 Johnny Depp     Orlando Bloom     Jack Davenport      
## # … with 3,797 more rows</code></pre>
<p>Para retirar colunas da base, base acrescentar um <code>-</code> antes da seleção.</p>
<div class="sourceCode" id="cb244"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb244-1"><a href="7-2-dplyr.html#cb244-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span></span>
<span id="cb244-2"><a href="7-2-dplyr.html#cb244-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>ano, <span class="sc">-</span> diretor)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 13
##    titulo  duracao cor   generos pais  classificacao orcamento receita nota_imdb
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt; &lt;chr&gt;   &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;   &lt;int&gt;     &lt;dbl&gt;
##  1 Avatar      178 Color Action… USA   A partir de … 237000000  7.61e8       7.9
##  2 Pirate…     169 Color Action… USA   A partir de … 300000000  3.09e8       7.1
##  3 The Da…     164 Color Action… USA   A partir de … 250000000  4.48e8       8.5
##  4 John C…     132 Color Action… USA   A partir de … 263700000  7.31e7       6.6
##  5 Spider…     156 Color Action… USA   A partir de … 258000000  3.37e8       6.2
##  6 Tangle…     100 Color Advent… USA   Livre         260000000  2.01e8       7.8
##  7 Avenge…     141 Color Action… USA   A partir de … 250000000  4.59e8       7.5
##  8 Batman…     183 Color Action… USA   A partir de … 250000000  3.30e8       6.9
##  9 Superm…     169 Color Action… USA   A partir de … 209000000  2.00e8       6.1
## 10 Pirate…     151 Color Action… USA   A partir de … 225000000  4.23e8       7.3
## # … with 3,797 more rows, and 4 more variables: likes_facebook &lt;int&gt;,
## #   ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div class="sourceCode" id="cb246"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb246-1"><a href="7-2-dplyr.html#cb246-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span></span>
<span id="cb246-2"><a href="7-2-dplyr.html#cb246-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span><span class="fu">starts_with</span>(<span class="st">&quot;ator&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 12
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 3 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;</code></pre>
<div id="exercícios-11" class="section level4 unnumbered">
<h4>Exercícios</h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Teste aplicar a função <code>glimpse()</code> do pacote <code>{dplyr}</code> à base <code>imdb</code>. O que ela faz?</p>
<p><strong>2.</strong> Crie uma tabela com apenas as colunas <code>titulo</code>, <code>diretor</code>, e <code>orcamento.</code> Salve em um objeto chamado <code>imdb_simples</code>.</p>
<p><strong>3.</strong> Selecione apenas as colunas <code>ator_1</code>, <code>ator_2</code> e <code>ator_3</code> usando o ajudante <code>contains()</code>.</p>
<p><strong>4.</strong> Usando a função <code>select()</code> (e seus ajudantes), escreva códigos que retornem a base IMDB sem as colunas <code>ator_1</code>, <code>ator_2</code> e <code>ator_3.</code> Escreva todas as soluções diferentes que você conseguir pensar.</p>
</div>
</div>
<div id="ordenando-a-base" class="section level3" number="7.2.2">
<h3><span class="header-section-number">7.2.2</span> Ordenando a base</h3>
<p>Para ordenar linhas, utilizamos a função <code>arrange()</code>. O primeiro argumento é a base de dados. Os demais argumentos são as colunas pelas quais queremos ordenar as linhas. No exemplo a seguir, ordenamos as linhas da base por ordem crescente de orçamento.</p>
<div class="sourceCode" id="cb248"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb248-1"><a href="7-2-dplyr.html#cb248-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(imdb, orcamento)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Tarnati…  2003 Jonatha…      88 Color Biograph… USA   Outros              218
##  2 My Date…  2004 Jon Gunn      90 Color Document… USA   Livre              1100
##  3 A Plagu…  2013 Benjami…      76 Color Drama|Ho… USA   Outros             1400
##  4 The Mon…  2005 Anthony…      84 Color Crime|Dr… USA   A partir de …      3250
##  5 Primer    2004 Shane C…      77 Color Drama|Sc… USA   A partir de …      7000
##  6 El Mari…  1992 Robert …      81 Color Action|C… USA   A partir de …      7000
##  7 Newlywe…  2011 Edward …      95 Color Comedy|D… USA   Outros             9000
##  8 Pink Fl…  1972 John Wa…     108 Color Comedy|C… USA   A partir de …     10000
##  9 The Tou…  2007 Jane Cl…       7 Color Romance|… USA   Outros            13000
## 10 Paranor…  2007 Oren Pe…      84 Color Horror    USA   A partir de …     15000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Também podemos ordenar de forma decrescente usando a função <code>desc()</code>.</p>
<div class="sourceCode" id="cb250"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb250-1"><a href="7-2-dplyr.html#cb250-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(imdb, <span class="fu">desc</span>(orcamento))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  2 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  3 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  4 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Pirates…  2011 Rob Mar…     136 Color Action|A… USA   A partir de … 250000000
## 10 Captain…  2016 Anthony…     147 Color Action|A… USA   A partir de … 250000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>E claro, ordenar segundo duas ou mais colunas.</p>
<div class="sourceCode" id="cb252"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb252-1"><a href="7-2-dplyr.html#cb252-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(imdb, <span class="fu">desc</span>(ano), <span class="fu">desc</span>(orcamento))</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Batman v…  2016 Zack Sn…     183 Color Action|… USA   A partir de … 250000000
##  2 Captain …  2016 Anthony…     147 Color Action|… USA   A partir de … 250000000
##  3 Star Tre…  2016 Justin …     122 Color Action|… USA   A partir de … 185000000
##  4 The Lege…  2016 David Y…     110 Color Action|… USA   A partir de … 180000000
##  5 The Lege…  2016 David Y…     110 Color Action|… USA   A partir de … 180000000
##  6 X-Men: A…  2016 Bryan S…     144 Color Action|… USA   A partir de … 178000000
##  7 Suicide …  2016 David A…     123 Color Action|… USA   A partir de … 175000000
##  8 Alice Th…  2016 James B…     113 Color Adventu… USA   Livre         170000000
##  9 Independ…  2016 Roland …     120 Color Action|… USA   A partir de … 165000000
## 10 Warcraft   2016 Duncan …     123 Color Action|… USA   A partir de … 160000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div id="exercícios-12" class="section level4 unnumbered">
<h4>Exercícios</h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Ordene os filmes em ordem crescente de <code>ano</code> e decrescente de <code>receita</code> e salve em um objeto chamado <code>filmes_ordenados</code>.</p>
<p><strong>2.</strong> Selecione apenas as colunas <code>titulo</code> e <code>orcamento</code> e então ordene de forma decrescente pelo <code>orcamento.</code></p>
</div>
</div>
<div id="o-pipe-em-ação" class="section level3" number="7.2.3">
<h3><span class="header-section-number">7.2.3</span> O pipe em ação</h3>
<p>Na grande maioria dos casos, vamos aplicar mais de uma função de manipulação em uma base para obtermos a tabela que desejamos. Poderíamos, por exemplo, querer uma tabela apenas com o título e ano dos filmes, ordenada de forma crescente de lançamento. Para fazer isso, poderíamos aninhar as funções</p>
<div class="sourceCode" id="cb254"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb254-1"><a href="7-2-dplyr.html#cb254-1" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(<span class="fu">select</span>(imdb, titulo, ano), ano)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 2
##    titulo                                              ano
##    &lt;chr&gt;                                             &lt;int&gt;
##  1 Intolerance: Love&#39;s Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell&#39;s Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # … with 3,797 more rows</code></pre>
<p>ou criar um objeto intermediário</p>
<div class="sourceCode" id="cb256"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb256-1"><a href="7-2-dplyr.html#cb256-1" aria-hidden="true" tabindex="-1"></a>tab_titulo_ano <span class="ot">&lt;-</span> <span class="fu">select</span>(imdb, titulo, ano)</span>
<span id="cb256-2"><a href="7-2-dplyr.html#cb256-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb256-3"><a href="7-2-dplyr.html#cb256-3" aria-hidden="true" tabindex="-1"></a><span class="fu">arrange</span>(tab_titulo_ano, ano)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 2
##    titulo                                              ano
##    &lt;chr&gt;                                             &lt;int&gt;
##  1 Intolerance: Love&#39;s Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell&#39;s Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # … with 3,797 more rows</code></pre>
<p>Os dois códigos funcionam e levam ao mesmo resultado, mas não são muito boas.</p>
<p>A primeira alternativa é ruim de escrever, já que precisamos escrever primeiro a função que roda por último, e de ler, pois é difícil identificar qual argumento pertence a qual função.</p>
<p>A segunda alternativa é ruim pois exige a criação de objetos auxiliares. Se quiséssimos aplicar 10 operações na base, precisaríamos criar 9 objetos intermediários.</p>
<p>A solução para aplicar diversas operações de manipulação em uma base de dados é aplicar o operador pipe: <code>%&gt;%</code>.</p>
<div class="sourceCode" id="cb258"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb258-1"><a href="7-2-dplyr.html#cb258-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb258-2"><a href="7-2-dplyr.html#cb258-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, ano) <span class="sc">%&gt;%</span> </span>
<span id="cb258-3"><a href="7-2-dplyr.html#cb258-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(ano)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 2
##    titulo                                              ano
##    &lt;chr&gt;                                             &lt;int&gt;
##  1 Intolerance: Love&#39;s Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell&#39;s Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # … with 3,797 more rows</code></pre>
<p>O que está sendo feito no código com pipe? Da primeira para a segunda linha, estamos aplicando a função <code>select()</code> à base imdb. Da segunda para a terceira, estamos aplicando a função <code>arrange()</code> à base resultante da função <code>select()</code>.</p>
<p>O resultado desse código é identico às tentativas sem pipe, com a vantagem de termos escrito o código na ordem em que as funções são aplicadas, de termos um código muito mais legível e de não precisarmos utilizar objetos intermediários.</p>
</div>
<div id="filtrando-linhas" class="section level3" number="7.2.4">
<h3><span class="header-section-number">7.2.4</span> Filtrando linhas</h3>
<p>Para filtrar valores de uma coluna da base, utilizamos a função <code>filter()</code>.</p>
<div class="sourceCode" id="cb260"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb260-1"><a href="7-2-dplyr.html#cb260-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(nota_imdb <span class="sc">&gt;</span> <span class="dv">9</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 15
##   titulo      ano diretor   duracao cor   generos  pais  classificacao orcamento
##   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
## 1 The Shaw…  1994 Frank Da…     142 Color Crime|D… USA   A partir de …  25000000
## 2 The Godf…  1972 Francis …     175 Color Crime|D… USA   A partir de …   6000000
## 3 Kickboxe…  2016 John Sto…      90 &lt;NA&gt;  Action   USA   Outros         17000000
## # … with 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Podemos selecionar apenas as colunas título e nota para visualizarmos as notas:</p>
<div class="sourceCode" id="cb262"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb262-1"><a href="7-2-dplyr.html#cb262-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb262-2"><a href="7-2-dplyr.html#cb262-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(nota_imdb <span class="sc">&gt;</span> <span class="dv">9</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb262-3"><a href="7-2-dplyr.html#cb262-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, nota_imdb)</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   titulo                    nota_imdb
##   &lt;chr&gt;                         &lt;dbl&gt;
## 1 The Shawshank Redemption        9.3
## 2 The Godfather                   9.2
## 3 Kickboxer: Vengeance            9.1</code></pre>
<p>Podemos estender o filtro para duas ou mais colunas. Para isso, separamos cada operação por uma vírgula.</p>
<div class="sourceCode" id="cb264"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb264-1"><a href="7-2-dplyr.html#cb264-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ano <span class="sc">&gt;</span> <span class="dv">2010</span>, nota_imdb <span class="sc">&gt;</span> <span class="fl">8.5</span>)</span></code></pre></div>
<pre><code>## # A tibble: 5 x 15
##   titulo      ano diretor   duracao cor   generos  pais  classificacao orcamento
##   &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;       &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
## 1 Interste…  2014 Christop…     169 Color Adventu… USA   A partir de … 165000000
## 2 Running …  2015 Mike May…      88 Color Family   USA   Outros          5000000
## 3 A Beginn…  2016 Mitchell…      87 Color Comedy|… USA   Outros               NA
## 4 Kickboxe…  2016 John Sto…      90 &lt;NA&gt;  Action   USA   Outros         17000000
## 5 Butterfl…  2014 Cary Bell      78 Color Documen… USA   Outros           180000
## # … with 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Também podemos fazer operações com as colunas da base dentro da função filter. O código abaixo devolve uma tabela apenas com os filmes que lucraram.</p>
<div class="sourceCode" id="cb266"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb266-1"><a href="7-2-dplyr.html#cb266-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(receita <span class="sc">-</span> orcamento <span class="sc">&gt;</span> <span class="dv">0</span>)</span></code></pre></div>
<pre><code>## # A tibble: 1,761 x 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar     2009 James C…     178 Color Action|… USA   A partir de … 237000000
##  2 Pirates …  2007 Gore Ve…     169 Color Action|… USA   A partir de … 300000000
##  3 The Dark…  2012 Christo…     164 Color Action|… USA   A partir de … 250000000
##  4 Spider-M…  2007 Sam Rai…     156 Color Action|… USA   A partir de … 258000000
##  5 Avengers…  2015 Joss Wh…     141 Color Action|… USA   A partir de … 250000000
##  6 Batman v…  2016 Zack Sn…     183 Color Action|… USA   A partir de … 250000000
##  7 Pirates …  2006 Gore Ve…     151 Color Action|… USA   A partir de … 225000000
##  8 Man of S…  2013 Zack Sn…     143 Color Action|… USA   A partir de … 225000000
##  9 The Aven…  2012 Joss Wh…     173 Color Action|… USA   A partir de … 220000000
## 10 The Amaz…  2012 Marc We…     153 Color Action|… USA   A partir de … 230000000
## # … with 1,751 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Naturalmente, podemos filtrar colunas categóricas. O exemplo abaixo retorna uma tabela apenas com os filmes com a Angelina Jolie Pitt ou o Brad Pitt no papel principal.</p>
<div class="sourceCode" id="cb268"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb268-1"><a href="7-2-dplyr.html#cb268-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span></span>
<span id="cb268-2"><a href="7-2-dplyr.html#cb268-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ator_1 <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&#39;Angelina Jolie Pitt&#39;</span>, <span class="st">&quot;Brad Pitt&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 29 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Malefic…  2014 Robert …      97 Color Action|A… USA   Livre         180000000
##  2 The Cur…  2008 David F…     166 Color Drama|Fa… USA   A partir de … 150000000
##  3 Kung Fu…  2011 Jennife…      90 Color Action|A… USA   Livre         150000000
##  4 Troy      2004 Wolfgan…     196 Color Adventure USA   A partir de … 175000000
##  5 Kung Fu…  2008 Mark Os…      92 Color Action|A… USA   Livre         130000000
##  6 Salt      2010 Phillip…     101 Color Action|C… USA   A partir de … 110000000
##  7 Ocean&#39;s…  2004 Steven …     125 Color Crime|Th… USA   A partir de … 110000000
##  8 Mr. &amp; M…  2005 Doug Li…     126 Color Action|C… USA   A partir de … 120000000
##  9 Lara Cr…  2001 Simon W…     100 Color Action|A… USA   A partir de … 115000000
## 10 Ocean&#39;s…  2001 Steven …     116 Color Crime|Th… USA   A partir de …  85000000
## # … with 19 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Para filtrar textos sem correspondência exata, podemos utilizar a função auxiliar <code>str_detect()</code> do pacote <code>{stringr}</code>. Ela serve para verificar se cada string de um vetor contém um determinado padrão de texto.</p>
<div class="sourceCode" id="cb270"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb270-1"><a href="7-2-dplyr.html#cb270-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span>
<span id="cb270-2"><a href="7-2-dplyr.html#cb270-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb270-3"><a href="7-2-dplyr.html#cb270-3" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(</span>
<span id="cb270-4"><a href="7-2-dplyr.html#cb270-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> <span class="fu">c</span>(<span class="st">&quot;a&quot;</span>, <span class="st">&quot;aa&quot;</span>,<span class="st">&quot;abc&quot;</span>, <span class="st">&quot;bc&quot;</span>, <span class="st">&quot;A&quot;</span>, <span class="cn">NA</span>), </span>
<span id="cb270-5"><a href="7-2-dplyr.html#cb270-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">&quot;a&quot;</span></span>
<span id="cb270-6"><a href="7-2-dplyr.html#cb270-6" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE FALSE FALSE    NA</code></pre>
<p>Podemos utilizá-la para filtrar apenas os filmes que contêm o gênero ação.</p>
<div class="sourceCode" id="cb272"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb272-1"><a href="7-2-dplyr.html#cb272-1" aria-hidden="true" tabindex="-1"></a><span class="co"># A coluna gêneros apresenta todos os gêneros dos filmes concatenados</span></span>
<span id="cb272-2"><a href="7-2-dplyr.html#cb272-2" aria-hidden="true" tabindex="-1"></a>imdb<span class="sc">$</span>generos[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>]</span></code></pre></div>
<pre><code>## [1] &quot;Action|Adventure|Fantasy|Sci-Fi&quot;                          
## [2] &quot;Action|Adventure|Fantasy&quot;                                 
## [3] &quot;Action|Thriller&quot;                                          
## [4] &quot;Action|Adventure|Sci-Fi&quot;                                  
## [5] &quot;Action|Adventure|Romance&quot;                                 
## [6] &quot;Adventure|Animation|Comedy|Family|Fantasy|Musical|Romance&quot;</code></pre>
<div class="sourceCode" id="cb274"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb274-1"><a href="7-2-dplyr.html#cb274-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Podemos detectar se o gênero Action aparece na string</span></span>
<span id="cb274-2"><a href="7-2-dplyr.html#cb274-2" aria-hidden="true" tabindex="-1"></a><span class="fu">str_detect</span>(</span>
<span id="cb274-3"><a href="7-2-dplyr.html#cb274-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">string =</span> imdb<span class="sc">$</span>generos[<span class="dv">1</span><span class="sc">:</span><span class="dv">6</span>],</span>
<span id="cb274-4"><a href="7-2-dplyr.html#cb274-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">pattern =</span> <span class="st">&quot;Action&quot;</span></span>
<span id="cb274-5"><a href="7-2-dplyr.html#cb274-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE</code></pre>
<div class="sourceCode" id="cb276"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb276-1"><a href="7-2-dplyr.html#cb276-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Aplicamos essa lógica dentro da função filter, para a coluna completa</span></span>
<span id="cb276-2"><a href="7-2-dplyr.html#cb276-2" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">filter</span>(<span class="fu">str_detect</span>(generos, <span class="st">&quot;Action&quot;</span>))</span></code></pre></div>
<pre><code>## # A tibble: 861 x 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    &lt;chr&gt;     &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;    &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar     2009 James C…     178 Color Action|… USA   A partir de … 237000000
##  2 Pirates …  2007 Gore Ve…     169 Color Action|… USA   A partir de … 300000000
##  3 The Dark…  2012 Christo…     164 Color Action|… USA   A partir de … 250000000
##  4 John Car…  2012 Andrew …     132 Color Action|… USA   A partir de … 263700000
##  5 Spider-M…  2007 Sam Rai…     156 Color Action|… USA   A partir de … 258000000
##  6 Avengers…  2015 Joss Wh…     141 Color Action|… USA   A partir de … 250000000
##  7 Batman v…  2016 Zack Sn…     183 Color Action|… USA   A partir de … 250000000
##  8 Superman…  2006 Bryan S…     169 Color Action|… USA   A partir de … 209000000
##  9 Pirates …  2006 Gore Ve…     151 Color Action|… USA   A partir de … 225000000
## 10 The Lone…  2013 Gore Ve…     150 Color Action|… USA   A partir de … 215000000
## # … with 851 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div id="exercícios-13" class="section level4 unnumbered">
<h4>Exercícios</h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Crie um objeto chamado <code>filmes_pb</code> apenas com filmes preto e branco.</p>
<p><strong>2.</strong> Crie um objeto chamado <code>curtos_legais</code> com filmes de 90 minutos ou menos de duração e nota no imdb maior do que 8.5.</p>
<p><strong>3.</strong> Retorne tabelas (<code>tibbles</code>) apenas com:</p>
<ul>
<li><p><strong>a.</strong> filmes coloridos anteriores a 1950;</p></li>
<li><p><strong>b.</strong> filmes do “Woody Allen” ou do “Wes Anderson”;</p></li>
<li><p><strong>c.</strong> filmes do “Steven Spielberg” ordenados de forma decrescente por ano, mostrando apenas as colunas <code>titulo</code> e <code>ano</code>;</p></li>
<li><p><strong>d.</strong> filmes que tenham “Action” <strong>ou</strong> “Comedy” entre os seus gêneros;</p></li>
<li><p><strong>e.</strong> filmes que tenham “Action” <strong>e</strong> “Comedy” entre os seus gêneros e tenha <code>nota_imdb</code> maior que 8;</p></li>
<li><p><strong>f.</strong> filmes que não possuem informação tanto de receita quanto de orçamento (isto é, possuem <code>NA</code> em ambas as colunas).</p></li>
</ul>
</div>
</div>
<div id="modificando-e-criando-novas-colunas" class="section level3" number="7.2.5">
<h3><span class="header-section-number">7.2.5</span> Modificando e criando novas colunas</h3>
<p>Para modificar uma coluna existente ou criar uma nova coluna, utilizamos a função <code>mutate()</code>. O código abaixo divide os valores da coluna duração por 60, mudando a unidade de medida dessa variável de minutos para horas.</p>
<div class="sourceCode" id="cb278"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb278-1"><a href="7-2-dplyr.html#cb278-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">duracao =</span> duracao<span class="sc">/</span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…    2.97 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…    2.82 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…    2.73 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …    2.2  Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…    2.6  Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …    1.67 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…    2.35 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…    3.05 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…    2.82 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…    2.52 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<p>Também poderíamos ter criado essa variável em uma nova coluna. Repare que a nova coluna <code>duracao_horas</code> é colocada no final da tabela.</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb280-1"><a href="7-2-dplyr.html#cb280-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">duracao_horas =</span> duracao<span class="sc">/</span><span class="dv">60</span>)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 7 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;,
## #   duracao_horas &lt;dbl&gt;</code></pre>
<p>Podemos fazer qualquer operação com uma ou mais colunas. A única regra é que o resultado da operação retorne um vetor com comprimento igual ao número de linhas da base (ou com comprimento 1 para distribuir um mesmo valor em todas as linhas). Você também pode criar/modificar quantas colunas quiser dentro de um mesmo <code>mutate</code>.</p>
<div class="sourceCode" id="cb282"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb282-1"><a href="7-2-dplyr.html#cb282-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb282-2"><a href="7-2-dplyr.html#cb282-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lucro =</span> receita <span class="sc">-</span> orcamento, <span class="at">pais =</span> <span class="st">&quot;Estados Unidos&quot;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb282-3"><a href="7-2-dplyr.html#cb282-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, lucro, pais)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 3
##    titulo                                           lucro pais          
##    &lt;chr&gt;                                            &lt;int&gt; &lt;chr&gt;         
##  1 Avatar                                       523505847 Estados Unidos
##  2 Pirates of the Caribbean: At World&#39;s End       9404152 Estados Unidos
##  3 The Dark Knight Rises                        198130642 Estados Unidos
##  4 John Carter                                 -190641321 Estados Unidos
##  5 Spider-Man 3                                  78530303 Estados Unidos
##  6 Tangled                                      -59192738 Estados Unidos
##  7 Avengers: Age of Ultron                      208991599 Estados Unidos
##  8 Batman v Superman: Dawn of Justice            80249062 Estados Unidos
##  9 Superman Returns                              -8930592 Estados Unidos
## 10 Pirates of the Caribbean: Dead Man&#39;s Chest   198032628 Estados Unidos
## # … with 3,797 more rows</code></pre>
<div id="exercícios-14" class="section level4 unnumbered">
<h4>Exercícios</h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Crie uma coluna chamada <code>prejuizo</code> (<code>orcamento - receita</code>) e salve a nova tabela em um objeto chamado <code>imdb_prejuizo</code>. Em seguida, filtre apenas os filmes que deram prejuízo e ordene a tabela por ordem crescente de prejuízo.</p>
<p><strong>2.</strong> Fazendo apenas uma chamada da função mutate(), crie as seguintes colunas novas na base <code>imdb</code>:</p>
<ul>
<li><p><strong>a.</strong> <code>lucro = receita - orcamento</code></p></li>
<li><p><strong>b.</strong> <code>lucro_medio</code></p></li>
<li><p><strong>c.</strong> <code>lucro_relativo = (lucro - lucro_medio)/lucro_medio</code></p></li>
<li><p><strong>d.</strong> <code>houve_lucro = ifelse(lucro &gt; 0, "sim", "não")</code></p></li>
</ul>
<p><strong>3.</strong> Crie uma nova coluna que classifique o filme em <code>"recente"</code> (posterior a 2000) e <code>"antigo"</code> (de 2000 para trás).</p>
</div>
</div>
<div id="summarisando-a-base" class="section level3" number="7.2.6">
<h3><span class="header-section-number">7.2.6</span> Summarisando a base</h3>
<p>Sumarização é a técnica de se resumir um conjunto de dados utilizando alguma métrica de interesse. A média, a mediana, a variância, a frequência, a proporção, por exemplo, são tipos de sumarização que trazem diferentes informações sobre uma variável.</p>
<p>Para sumarizar uma coluna da base, utilizamos a função <code>summarize()</code>. O código abaixo resume a coluna orçamento pela sua média.</p>
<div class="sourceCode" id="cb284"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb284-1"><a href="7-2-dplyr.html#cb284-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(<span class="at">media_orcamento =</span> <span class="fu">mean</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 1 x 1
##   media_orcamento
##             &lt;dbl&gt;
## 1       35755986.</code></pre>
<p>Repare que a saída da função continua sendo uma tibble.</p>
<p>Podemos calcular diversas sumarizações diferentes em um mesmo <code>summarize</code>. Cada sumarização será uma coluna da nova base.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb286-1"><a href="7-2-dplyr.html#cb286-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">summarise</span>(</span>
<span id="cb286-2"><a href="7-2-dplyr.html#cb286-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_orcamento =</span> <span class="fu">mean</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-3"><a href="7-2-dplyr.html#cb286-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">mediana_orcamento =</span> <span class="fu">median</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb286-4"><a href="7-2-dplyr.html#cb286-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">variancia_orcamento =</span> <span class="fu">var</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb286-5"><a href="7-2-dplyr.html#cb286-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   media_orcamento mediana_orcamento variancia_orcamento
##             &lt;dbl&gt;             &lt;int&gt;               &lt;dbl&gt;
## 1       35755986.          20000000   1822337181441743.</code></pre>
<p>E também sumarizar diversas colunas.</p>
<div class="sourceCode" id="cb288"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb288-1"><a href="7-2-dplyr.html#cb288-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">summarize</span>(</span>
<span id="cb288-2"><a href="7-2-dplyr.html#cb288-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_orcamento =</span> <span class="fu">mean</span>(orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb288-3"><a href="7-2-dplyr.html#cb288-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_receita =</span> <span class="fu">mean</span>(receita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>),</span>
<span id="cb288-4"><a href="7-2-dplyr.html#cb288-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">media_lucro =</span> <span class="fu">mean</span>(receita <span class="sc">-</span> orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb288-5"><a href="7-2-dplyr.html#cb288-5" aria-hidden="true" tabindex="-1"></a>)</span></code></pre></div>
<pre><code>## # A tibble: 1 x 3
##   media_orcamento media_receita media_lucro
##             &lt;dbl&gt;         &lt;dbl&gt;       &lt;dbl&gt;
## 1       35755986.     55214607.   17258230.</code></pre>
<p>Muitas vezes queremos sumarizar uma coluna agrupada pelas categorias de uma segunda coluna. Para isso, além do <code>summarize</code>, utilizamos também a função <code>group_by()</code>.</p>
<p>O código a seguir calcula a receita média dos filmes para cada categoria da coluna “cor”.</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb290-1"><a href="7-2-dplyr.html#cb290-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> </span>
<span id="cb290-2"><a href="7-2-dplyr.html#cb290-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(cor) <span class="sc">%&gt;%</span> </span>
<span id="cb290-3"><a href="7-2-dplyr.html#cb290-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">receita_media =</span> <span class="fu">mean</span>(receita, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<pre><code>## # A tibble: 3 x 2
##   cor             receita_media
##   &lt;chr&gt;                   &lt;dbl&gt;
## 1 Black and White     36938737.
## 2 Color               55765813.
## 3 &lt;NA&gt;                80014842</code></pre>
<p>A única alteração que a função <code>group_by()</code> faz na base é a marcação de que a base está agrupada.</p>
<div class="sourceCode" id="cb292"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb292-1"><a href="7-2-dplyr.html#cb292-1" aria-hidden="true" tabindex="-1"></a>imdb <span class="sc">%&gt;%</span> <span class="fu">group_by</span>(cor)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 15
## # Groups:   cor [3]
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 6 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;</code></pre>
<div id="exercícios-15" class="section level4 unnumbered">
<h4>Exercícios</h4>
<p>Utilize a base <code>imdb</code> nos exercícios a seguir.</p>
<p><strong>1.</strong> Calcule a duração média e mediana dos filmes da base.</p>
<p><strong>2.</strong> Calcule o lucro médio dos filmes com duração menor que 60 minutos.</p>
<p><strong>3.</strong> Apresente na mesma tabela o lucro médio dos filmes com duracao menor que 60 minutos e o lucro médio dos filmes com duracao maior ou igual a 60 minutos.</p>
<p><strong>4.</strong> Retorne tabelas (<code>tibbles</code>) apenas com:</p>
<ul>
<li><p><strong>a.</strong> a nota IMDB média dos filmes por tipo de classificacao;</p></li>
<li><p><strong>b.</strong> a receita média e mediana dos filmes por ano;</p></li>
<li><p><strong>c.</strong> apenas o nome dos diretores com mais de 10 filmes.</p></li>
</ul>
</div>
</div>
<div id="juntando-duas-bases" class="section level3" number="7.2.7">
<h3><span class="header-section-number">7.2.7</span> Juntando duas bases</h3>
<p>Podemos juntar duas tabelas a partir de uma (coluna) chave utilizando a função <code>left_join()</code>. Como exempo, vamos inicialmente calcular o lucro médio dos filmes de cada diretor e salvar no objeto <code>tab_lucro_diretor</code>.</p>
<div class="sourceCode" id="cb294"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb294-1"><a href="7-2-dplyr.html#cb294-1" aria-hidden="true" tabindex="-1"></a>tab_lucro_diretor <span class="ot">&lt;-</span> imdb <span class="sc">%&gt;%</span></span>
<span id="cb294-2"><a href="7-2-dplyr.html#cb294-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(diretor) <span class="sc">%&gt;%</span> </span>
<span id="cb294-3"><a href="7-2-dplyr.html#cb294-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarise</span>(<span class="at">lucro_medio =</span> <span class="fu">mean</span>(receita <span class="sc">-</span> orcamento, <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb294-4"><a href="7-2-dplyr.html#cb294-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb294-5"><a href="7-2-dplyr.html#cb294-5" aria-hidden="true" tabindex="-1"></a>tab_lucro_diretor</span></code></pre></div>
<pre><code>## # A tibble: 1,813 x 2
##    diretor          lucro_medio
##    &lt;chr&gt;                  &lt;dbl&gt;
##  1 A. Raven Cruz            NaN
##  2 Aaron Hann               NaN
##  3 Aaron Schneider      1676553
##  4 Aaron Seltzer       28546578
##  5 Abel Ferrara       -11272676
##  6 Adam Carolla        -1394057
##  7 Adam Goldberg       -1647420
##  8 Adam Green               NaN
##  9 Adam Jay Epstein         NaN
## 10 Adam Marcus         13435068
## # … with 1,803 more rows</code></pre>
<p>E se quisermos colocar essa informação na base original? Basta usar a função <code>left_join()</code> utilizando a coluna <code>diretor</code> como chave. Observe que a coluna <code>lucro_medio</code> aparece agora no fim da tabela.</p>
<div class="sourceCode" id="cb296"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb296-1"><a href="7-2-dplyr.html#cb296-1" aria-hidden="true" tabindex="-1"></a>imdb_com_lucro_medio <span class="ot">&lt;-</span> <span class="fu">left_join</span>(imdb, tab_lucro_diretor, <span class="at">by =</span> <span class="st">&quot;diretor&quot;</span>)</span>
<span id="cb296-2"><a href="7-2-dplyr.html#cb296-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb296-3"><a href="7-2-dplyr.html#cb296-3" aria-hidden="true" tabindex="-1"></a>imdb_com_lucro_medio</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    &lt;chr&gt;    &lt;int&gt; &lt;chr&gt;      &lt;int&gt; &lt;chr&gt; &lt;chr&gt;     &lt;chr&gt; &lt;chr&gt;             &lt;int&gt;
##  1 Avatar    2009 James C…     178 Color Action|A… USA   A partir de … 237000000
##  2 Pirates…  2007 Gore Ve…     169 Color Action|A… USA   A partir de … 300000000
##  3 The Dar…  2012 Christo…     164 Color Action|T… USA   A partir de … 250000000
##  4 John Ca…  2012 Andrew …     132 Color Action|A… USA   A partir de … 263700000
##  5 Spider-…  2007 Sam Rai…     156 Color Action|A… USA   A partir de … 258000000
##  6 Tangled   2010 Nathan …     100 Color Adventur… USA   Livre         260000000
##  7 Avenger…  2015 Joss Wh…     141 Color Action|A… USA   A partir de … 250000000
##  8 Batman …  2016 Zack Sn…     183 Color Action|A… USA   A partir de … 250000000
##  9 Superma…  2006 Bryan S…     169 Color Action|A… USA   A partir de … 209000000
## 10 Pirates…  2006 Gore Ve…     151 Color Action|A… USA   A partir de … 225000000
## # … with 3,797 more rows, and 7 more variables: receita &lt;int&gt;, nota_imdb &lt;dbl&gt;,
## #   likes_facebook &lt;int&gt;, ator_1 &lt;chr&gt;, ator_2 &lt;chr&gt;, ator_3 &lt;chr&gt;,
## #   lucro_medio &lt;dbl&gt;</code></pre>
<p>Na tabela <code>imdb_com_lucro_medio</code>, como na tabela <code>imdb</code>, cada linha continua a representar um filme diferente, mas agora temos também a informação do lucro médio do diretor de cada filme.</p>
<p>A primeira linha, por exemplo, traz as informações do filme Avatar. O valor do <code>lucro_medio</code> nessa linha representa o lucro médio de todos os filmes do James Cameron, que é o diretor de Avatar. Com essa informação, podemos calcular o quanto o lucro do Avatar se afasta do lucro médio do James Cameron.</p>
<div class="sourceCode" id="cb298"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb298-1"><a href="7-2-dplyr.html#cb298-1" aria-hidden="true" tabindex="-1"></a>imdb_com_lucro_medio <span class="sc">%&gt;%</span> </span>
<span id="cb298-2"><a href="7-2-dplyr.html#cb298-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb298-3"><a href="7-2-dplyr.html#cb298-3" aria-hidden="true" tabindex="-1"></a>    <span class="at">lucro =</span> receita <span class="sc">-</span> orcamento,</span>
<span id="cb298-4"><a href="7-2-dplyr.html#cb298-4" aria-hidden="true" tabindex="-1"></a>    <span class="at">lucro_relativo =</span> (lucro <span class="sc">-</span> lucro_medio)<span class="sc">/</span>lucro_medio,</span>
<span id="cb298-5"><a href="7-2-dplyr.html#cb298-5" aria-hidden="true" tabindex="-1"></a>    <span class="at">lucro_relativo =</span> scales<span class="sc">::</span><span class="fu">percent</span>(lucro_relativo)</span>
<span id="cb298-6"><a href="7-2-dplyr.html#cb298-6" aria-hidden="true" tabindex="-1"></a>  ) <span class="sc">%&gt;%</span> </span>
<span id="cb298-7"><a href="7-2-dplyr.html#cb298-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(titulo, diretor, lucro, lucro_medio, lucro_relativo)</span></code></pre></div>
<pre><code>## # A tibble: 3,807 x 5
##    titulo                      diretor          lucro lucro_medio lucro_relativo
##    &lt;chr&gt;                       &lt;chr&gt;            &lt;int&gt;       &lt;dbl&gt; &lt;chr&gt;         
##  1 Avatar                      James Cameron   5.24e8  194620985  168.98736%    
##  2 Pirates of the Caribbean: … Gore Verbins…   9.40e6   36942999. -74.54416%    
##  3 The Dark Knight Rises       Christopher …   1.98e8  101028447  96.11372%     
##  4 John Carter                 Andrew Stant…  -1.91e8   46668146  -508.50417%   
##  5 Spider-Man 3                Sam Raimi       7.85e7   63300090. 24.06033%     
##  6 Tangled                     Nathan Greno   -5.92e7  -59192738  0.00000%      
##  7 Avengers: Age of Ultron     Joss Whedon     2.09e8  250221657  -16.47741%    
##  8 Batman v Superman: Dawn of… Zack Snyder     8.02e7   33149106. 142.08514%    
##  9 Superman Returns            Bryan Singer   -8.93e6   -2887024. 209.33560%    
## 10 Pirates of the Caribbean: … Gore Verbins…   1.98e8   36942999. 436.04913%    
## # … with 3,797 more rows</code></pre>
<p>Observamos então que o Avatar obteve um lucro aproximadamente 169% maior que a média dos filmes do James Cameron.</p>
<p>Além da função <code>left_join()</code>, também são muito utilizadas as funções <code>right_join()</code> e <code>full_join()</code>.</p>
<ul>
<li><p><code>right_join()</code>: retorna todas as linhas da base <code>y</code> e todas as colunas das bases <code>x</code> e <code>y</code>. Linhas de <code>y</code> sem correspondentes em <code>x</code> receberão <code>NA</code> na nova base.</p></li>
<li><p><code>full_join()</code>: retorna todas as linhas e colunas de <code>x</code>e <code>y</code>. Valores sem correspondência entre as bases receberão <code>NA</code> na nova base.</p></li>
</ul>
<p>A figura a seguir esquematiza as operações dessas funções:</p>
<p><img src="assets/img/manipulacao/joins.png" width="355" style="display: block; margin: auto;" /></p>
<div id="exercícios-16" class="section level4 unnumbered">
<h4>Exercícios</h4>
<p><strong>1.</strong> Utilize a base <code>imdb</code> para resolver os itens a seguir.</p>
<p><strong>a.</strong> Salve em um novo objeto uma tabela com a
nota média dos filmes de cada diretor. Essa tabela
deve conter duas colunas (<code>diretor</code> e <code>nota_imdb_media</code>)
e cada linha deve ser um diretor diferente.</p>
<p><strong>b.</strong> Use o <code>left_join()</code> para trazer a coluna
<code>nota_imdb_media</code> da tabela do item anterior
para a tabela <code>imdb</code> original.</p>

</div>
</div>
</div>
<hr/>
<footer>
<a href="https://curso-r.com" target="_blank"><img src="https://raw.githubusercontent.com/curso-r/site-v2/master/static/img/logo_cursor_full.png" width="15%", alt="Curso-R"/></a>
</footer>
            </section>

          </div>
        </div>
      </div>
<a href="7-1-tibbles.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="7-3-tidyr.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "serif",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["livro-curso-r.pdf"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
