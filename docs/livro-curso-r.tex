% Options for packages loaded elsewhere
\PassOptionsToPackage{unicode}{hyperref}
\PassOptionsToPackage{hyphens}{url}
%
\documentclass[
]{book}
\usepackage{amsmath,amssymb}
\usepackage{lmodern}
\usepackage{ifxetex,ifluatex}
\ifnum 0\ifxetex 1\fi\ifluatex 1\fi=0 % if pdftex
  \usepackage[T1]{fontenc}
  \usepackage[utf8]{inputenc}
  \usepackage{textcomp} % provide euro and other symbols
\else % if luatex or xetex
  \usepackage{unicode-math}
  \defaultfontfeatures{Scale=MatchLowercase}
  \defaultfontfeatures[\rmfamily]{Ligatures=TeX,Scale=1}
\fi
% Use upquote if available, for straight quotes in verbatim environments
\IfFileExists{upquote.sty}{\usepackage{upquote}}{}
\IfFileExists{microtype.sty}{% use microtype if available
  \usepackage[]{microtype}
  \UseMicrotypeSet[protrusion]{basicmath} % disable protrusion for tt fonts
}{}
\makeatletter
\@ifundefined{KOMAClassName}{% if non-KOMA class
  \IfFileExists{parskip.sty}{%
    \usepackage{parskip}
  }{% else
    \setlength{\parindent}{0pt}
    \setlength{\parskip}{6pt plus 2pt minus 1pt}}
}{% if KOMA class
  \KOMAoptions{parskip=half}}
\makeatother
\usepackage{xcolor}
\IfFileExists{xurl.sty}{\usepackage{xurl}}{} % add URL line breaks if available
\IfFileExists{bookmark.sty}{\usepackage{bookmark}}{\usepackage{hyperref}}
\hypersetup{
  pdftitle={Ciência de Dados em R},
  pdfauthor={Curso-R},
  hidelinks,
  pdfcreator={LaTeX via pandoc}}
\urlstyle{same} % disable monospaced font for URLs
\usepackage{color}
\usepackage{fancyvrb}
\newcommand{\VerbBar}{|}
\newcommand{\VERB}{\Verb[commandchars=\\\{\}]}
\DefineVerbatimEnvironment{Highlighting}{Verbatim}{commandchars=\\\{\}}
% Add ',fontsize=\small' for more characters per line
\usepackage{framed}
\definecolor{shadecolor}{RGB}{248,248,248}
\newenvironment{Shaded}{\begin{snugshade}}{\end{snugshade}}
\newcommand{\AlertTok}[1]{\textcolor[rgb]{0.94,0.16,0.16}{#1}}
\newcommand{\AnnotationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\AttributeTok}[1]{\textcolor[rgb]{0.77,0.63,0.00}{#1}}
\newcommand{\BaseNTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\BuiltInTok}[1]{#1}
\newcommand{\CharTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\CommentTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\CommentVarTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ConstantTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ControlFlowTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\DataTypeTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{#1}}
\newcommand{\DecValTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\DocumentationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\ErrorTok}[1]{\textcolor[rgb]{0.64,0.00,0.00}{\textbf{#1}}}
\newcommand{\ExtensionTok}[1]{#1}
\newcommand{\FloatTok}[1]{\textcolor[rgb]{0.00,0.00,0.81}{#1}}
\newcommand{\FunctionTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\ImportTok}[1]{#1}
\newcommand{\InformationTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\newcommand{\KeywordTok}[1]{\textcolor[rgb]{0.13,0.29,0.53}{\textbf{#1}}}
\newcommand{\NormalTok}[1]{#1}
\newcommand{\OperatorTok}[1]{\textcolor[rgb]{0.81,0.36,0.00}{\textbf{#1}}}
\newcommand{\OtherTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{#1}}
\newcommand{\PreprocessorTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textit{#1}}}
\newcommand{\RegionMarkerTok}[1]{#1}
\newcommand{\SpecialCharTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\SpecialStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\StringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\VariableTok}[1]{\textcolor[rgb]{0.00,0.00,0.00}{#1}}
\newcommand{\VerbatimStringTok}[1]{\textcolor[rgb]{0.31,0.60,0.02}{#1}}
\newcommand{\WarningTok}[1]{\textcolor[rgb]{0.56,0.35,0.01}{\textbf{\textit{#1}}}}
\usepackage{longtable,booktabs,array}
\usepackage{calc} % for calculating minipage widths
% Correct order of tables after \paragraph or \subparagraph
\usepackage{etoolbox}
\makeatletter
\patchcmd\longtable{\par}{\if@noskipsec\mbox{}\fi\par}{}{}
\makeatother
% Allow footnotes in longtable head/foot
\IfFileExists{footnotehyper.sty}{\usepackage{footnotehyper}}{\usepackage{footnote}}
\makesavenoteenv{longtable}
\usepackage{graphicx}
\makeatletter
\def\maxwidth{\ifdim\Gin@nat@width>\linewidth\linewidth\else\Gin@nat@width\fi}
\def\maxheight{\ifdim\Gin@nat@height>\textheight\textheight\else\Gin@nat@height\fi}
\makeatother
% Scale images if necessary, so that they will not overflow the page
% margins by default, and it is still possible to overwrite the defaults
% using explicit options in \includegraphics[width, height, ...]{}
\setkeys{Gin}{width=\maxwidth,height=\maxheight,keepaspectratio}
% Set default figure placement to htbp
\makeatletter
\def\fps@figure{htbp}
\makeatother
\usepackage[normalem]{ulem}
% Avoid problems with \sout in headers with hyperref
\pdfstringdefDisableCommands{\renewcommand{\sout}{}}
\setlength{\emergencystretch}{3em} % prevent overfull lines
\providecommand{\tightlist}{%
  \setlength{\itemsep}{0pt}\setlength{\parskip}{0pt}}
\setcounter{secnumdepth}{5}
\usepackage{booktabs}
\ifluatex
  \usepackage{selnolig}  % disable illegal ligatures
\fi
\usepackage[]{natbib}
\bibliographystyle{plainnat}

\title{Ciência de Dados em R}
\author{Curso-R}
\date{Última atualização: 14/07/2021}

\begin{document}
\maketitle

{
\setcounter{tocdepth}{1}
\tableofcontents
}
\hypertarget{sobre}{%
\chapter*{Sobre}\label{sobre}}
\addcontentsline{toc}{chapter}{Sobre}

Este livro está em \textbf{construção} e em \textbf{revisão aberta}. Fique à vontade para corrigir qualquer tipo de erro que encontrar no nosso material.

Todo o conteúdo deste livro é gratuito e aberto.

Autoria:

\begin{itemize}
\tightlist
\item
  \href{https://twitter.com/athos_damiani}{Athos Damiani}
\item
  \href{https://twitter.com/BeaMilz}{Beatriz Milz}
\item
  \href{https://twitter.com/clente_}{Caio Lente}
\item
  \href{https://twitter.com/dfalbel}{Daniel Falbel}
\item
  \href{https://twitter.com/Azeloc}{Fernando Correa}
\item
  \href{https://twitter.com/jtrecenti}{Julio Trecenti}
\item
  \href{http://linkedin.com/in/nicole-luduvice-9a6379197}{Nicole Luduvice}
\item
  \href{https://wamorim.com}{William Amorim}
\end{itemize}

\hypertarget{a-curso-r}{%
\subsubsection*{A Curso-R}\label{a-curso-r}}
\addcontentsline{toc}{subsubsection}{A Curso-R}

A Curso-R é o braço de Educação da R6 Consultoria, uma empresa de treinamentos e consultoria em Ciência de Dados e linguagem de programação R. Surgimos em 2015, com cursos de introdução ao R no Programa de Cursos de Verão do Instituto de Matemática e Estatística da Universidade de São Paulo (IME-USP).

\begin{itemize}
\item
  Conheça os nossos cursos: \url{https://www.curso-r.com/cursos/}
\item
  Conheça o nosso blog: \url{https://www.curso-r.com/blog/}
\item
  Conheça o restante do nosso material: \url{https://www.curso-r.com/material/}
\item
  Saiba mais sobre a Curso-R: \url{https://www.curso-r.com/sobre/}
\end{itemize}

\hypertarget{o-r-e-o-rstudio}{%
\subsubsection*{O R e o RStudio}\label{o-r-e-o-rstudio}}
\addcontentsline{toc}{subsubsection}{O R e o RStudio}

O R é uma linguagem de programação \emph{open source} para análise de dados que fornece uma grande variedade de ferramentas estatísticas e gráficas.

O RStudio é o ambiente de desenvolvimento mais utilizado para programação em R. Ele possui diversas ferramentas que facilitam a utilização do R para se fazer análise de dados.

\hypertarget{este-livro}{%
\subsubsection*{Este livro}\label{este-livro}}
\addcontentsline{toc}{subsubsection}{Este livro}

Este livro tem como objetivo guiar o leitor por todas as etapas de uma análise de dados, utilizando o R como ferramenta. Nele, você encontrará ferramentas para importar, arrumar, manipular, visualizar e modelar bases de dados. E também ferramentas para comunicar e automatizar resultados.

\textbackslash begin\{figure\}

\{\centering \includegraphics[width=26.67in]{assets/img/environmental-data-science-r4ds-general}

\}

\textbackslash caption\{Arte por Allison Horst (\citet{allison_horst}). Veja nas Referências onde encontrá-la.\}\label{fig:allison-env}
\textbackslash end\{figure\}

\hypertarget{comunidade}{%
\subsubsection*{Comunidade}\label{comunidade}}
\addcontentsline{toc}{subsubsection}{Comunidade}

Seja bem-vinda(o) ao \#rstats.

Compartilhe seu desenvolvimento! Poste seus avaços nas redes sociais, compartilhe suas dúvidas em fóruns, procure e participe dos grupos e comunidades de programadores.

\begin{itemize}
\item
  Comunidade R-Ladies: \href{https://benubah.github.io/r-community-explorer/rladies.html}{Global} e \href{https://github.com/R-Ladies-Sao-Paulo/RLadies-Brasil\#readme}{Brasil}
\item
  Fórum de dúvidas da Curso-R: \url{https://discourse.curso-r.com/}
\item
  Grupo de divulgação da Curso-R no Telegram: \url{https://t.me/r6cursor}
\item
  Grupo R Brasil no Telegram: \url{https://t.me/rbrasiloficial}
\end{itemize}

\textbackslash begin\{figure\}

\{\centering \includegraphics[width=27.9in]{assets/img/welcome_to_rstats_twitter}

\}

\textbackslash caption\{Arte por Allison Horst (\citet{allison_horst}). Veja nas Referências onde encontrá-la.\}\label{fig:allison-twitter}
\textbackslash end\{figure\}

\hypertarget{agradecimentos}{%
\subsubsection*{Agradecimentos}\label{agradecimentos}}
\addcontentsline{toc}{subsubsection}{Agradecimentos}

\begin{itemize}
\item
  \href{https://www.linkedin.com/in/hsvab}{Haydee Svab} - Revisão do conteúdo inicial sobre \protect\hyperlink{markdown}{Markdown}.
\item
  Sugestões feitas durante transmissões na Twitch: \href{https://www.twitch.tv/AugustoCL_/about}{AugustoCL\_} e \href{https://www.twitch.tv/pouchewar/about}{pouchewar} .
\end{itemize}

\hypertarget{instalacao}{%
\chapter{Instalação}\label{instalacao}}

Nesta seção, abordaremos como instalar o R e o RStudio no Linux e no Windows. Também discutiremos sobre a instalação de pacotes no R.

\hypertarget{instalacao-do-r}{%
\section{Instalação do R}\label{instalacao-do-r}}

A instalação padrão do R é feita a partir do CRAN, uma rede de servidores espalhada pelo mundo que armazena versões idênticas e atualizadas de códigos e documentações para o R.

\begin{quote}
Sempre que for instalar algo do CRAN, utilize o servidor (\emph{mirror}) mais próximo de você.
\end{quote}

\hypertarget{no-windows}{%
\subsection{No Windows}\label{no-windows}}

Para instalar o R no Windows, siga os seguintes passos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Acesse o CRAN: \url{https://www.r-project.org/}
\item
  No menu à esquerda, encontre a opção \textbf{Download} e clique em \textbf{CRAN}.
\item
  Escolha a opção de servidor (\emph{mirror}) mais próxima de você.
\item
  Clique na opção \textbf{base}.
\item
  Na nova página, clique em **Download R x.x.x for Windows*, sendo x.x.x o número da versão que será baixada. Se você teve algum problema com o download, tente escolher outro servidor no passo 3.
\item
  Feito o download, clique duas vezes no arquivo baixado e siga as instruções para instalação.
\end{enumerate}

\begin{quote}
Na etapa de escolher a pasta de destino da instalação, se você escolher um local que não esteja dentro da sua pasta de usuário, você precisará de acesso de administrador. Se escolher uma pasta dentro da sua paste de usuário, não precisará.
\end{quote}

\hypertarget{no-linux}{%
\subsection{No Linux}\label{no-linux}}

Como a instalação no Linux depende da distribuição utilizada e, em geral, pessoas que utilizam Linux são mais experientes, vamos informar apenas as coordenadas até as instruções/arquivos. Se você tiver alguma dificuldade durante o processo, por favor envie a sua dúvida para a nossa \href{https://discourse.curso-r.com/}{comunidade}. Faremos o possível para ajudar.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Acesse o CRAN: \url{https://cran.r-project.org/}
\item
  No menu à esquerda, encontre a opção \textbf{Download} e clique em \textbf{CRAN}.
\item
  Escolha a opção de servidor (\emph{mirror}) mais próxima de você.
\item
  Clique em \emph{Download R for Linux}.
\item
  Clique no link referente à distribuição que você utiliza.
\item
  Siga as instruções contidas na página para instalar o R. Se você teve algum problema com o download, tente escolher outro servidor no passo 3.
\end{enumerate}

\hypertarget{no-macos}{%
\subsection{No MacOS}\label{no-macos}}

Para instalar o R no MacOS, siga os seguintes passos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Acesse o CRAN: \url{https://www.r-project.org/}
\item
  No menu à esquerda, encontre a opção \textbf{Download} e clique em \textbf{CRAN}.
\item
  Escolha a opção de servidor (\emph{mirror}) mais próxima de você.
\item
  Na nova página, clique em **Download R for (Mac) OS X*.
\item
  Clique na versão do R que você quer baixar (geralmente queremos baixar a mais recente). O objetivo aqui é baixar um arquivo do tipo ``R-x.x.x.pkg'', sendo x.x.x o número da versão que vamos instalar. Se você teve algum problema com o download, tente escolher outro servidor no passo 3.
\item
  Feito o download, clique duas vezes no arquivo baixado e siga as instruções para instalação.
\end{enumerate}

\hypertarget{instalacao-do-rstudio}{%
\section{Instalação do RStudio}\label{instalacao-do-rstudio}}

Agora vamos instalar a versão \emph{open source} do RStudio, a IDE que utilizaremos para escrever e executar códigos em R.

Para instalar o RStudio no Windows, siga os seguintes passos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Acesse a página de downloads da RStudio: \url{https://rstudio.com/products/rstudio/download/\#download}
\end{enumerate}

\begin{itemize}
\item
  Se você tiver acesso administrador, baixe a versão referente ao seu sistema operacional que está na lista de \emph{All Installers}.
\item
  Se você não tiver acesso de administrador, baixe a versão referente ao seu sistema operacional que está na lista de \emph{Zip/Tarballs}.
\end{itemize}

\hypertarget{instalando-se-vocuxea-for-administrador}{%
\subsubsection*{Instalando se você for administrador}\label{instalando-se-vocuxea-for-administrador}}
\addcontentsline{toc}{subsubsection}{Instalando se você for administrador}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\tightlist
\item
  Clique duas vezes no arquivo que você baixou da página do RStudio e siga as instruções de instalação.
\end{enumerate}

\hypertarget{instalauxe7uxe3o-se-vocuxea-nuxe3o-for-administrador}{%
\subsubsection*{Instalação se você não for administrador}\label{instalauxe7uxe3o-se-vocuxea-nuxe3o-for-administrador}}
\addcontentsline{toc}{subsubsection}{Instalação se você não for administrador}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{1}
\item
  Descompacte o arquivo baixado no passo anterior. Geralmente isso pode ser feito clicando no arquivo compactado com o botão direito do mouse e clicando na opção \emph{descompactar} ou \emph{extrair}.
\item
  Após a descompactação ter sido finalizada, você terá uma pasta chamada: \texttt{RStudio-x.x.x}, em que x.x.x é o número da versão baixada. Abra essa pasta e entre na subpasta com nome \texttt{bin}.
\item
  Procure pelo arquivo chamado \texttt{rstudio} e clique duas vezes. Isso abrirá o RStudio. Recomendamos fixar o programa na barra de tarefas para não precisar repetir essa etapa sempre que for abrir o programa.
\end{enumerate}

\textbf{Observação}: se você excluir a pasta que extraímos, o RStudio irá parar de funcionar.

\hypertarget{instalacao-adicionais}{%
\section{Instalação de softwares adicionais}\label{instalacao-adicionais}}

Os softwares descritos anteriormente são suficientes para realizar as tarefas básicas em R. Porém, principalmente quando tratamos de \protect\hyperlink{relatorios}{relatórios com R}, alguns softwares adicionais podem ser necessários em casos específicos! A seguir citamos alguns destes softwares, em quais casos eles são necessários e/ou úteis, e instruções sobre como instalá-los.

\hypertarget{instalacao-latex}{%
\subsection{LaTeX}\label{instalacao-latex}}

O LaTeX é um software para renderização de documentos PDF e também uma linguagem de programação. É bastante usada na academia para produção de artigos científicos.

No R, o LaTeX aparece quando queremos gerar relatórios e apresentações em PDF, a partir de um documento RMarkdown. Na prática, o RMarkdown é transformado para LaTeX através do software \href{https://pandoc.org}{\emph{Pandoc}}\footnote{O Pandoc já vem dentro do próprio RStudio, então não é necessário instalar este \emph{software}.}, que por sua vez é processado para gerar o PDF. Portanto, para gerar um relatório em PDF através do RMarkdown, precisamos ter alguma ferramenta de LaTeX instalada.

A recomendação das pessoas que desenvolvem o RMarkdown é a utilização do \href{https://yihui.org/tinytex/}{\texttt{tinytex}}, uma distribuição leve do LaTeX.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{\textquotesingle{}tinytex\textquotesingle{}}\NormalTok{)}
\NormalTok{tinytex}\SpecialCharTok{::}\FunctionTok{install\_tinytex}\NormalTok{()  }\CommentTok{\# instalar o TinyTeX}
\end{Highlighting}
\end{Shaded}

Caso você encontre algum problema para instalar o TinyTex, também é possível instalar outros editores de LaTex. A seguir estão apresentadas algumas opções!

\hypertarget{no-windows-1}{%
\subsubsection{No Windows}\label{no-windows-1}}

Uma distribuição de LaTeX que apresenta versão para Windows é o MiKTeX.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Para instalá-lo, primeiramente faça o download do arquivo \texttt{.exe} \href{https://MiKTeX.org/download\#win}{através deste link}, escolhendo a versão de instalação para Windows.
\item
  Abra o arquivo baixado. Uma janela irá abrir, e a primeira etapa de instalação é a ``Copying Conditions''. Nesta etapa você deve selecionar a opção \textbf{``I accept the MiKTeX copying conditions''} e clicar em \textbf{``Avançar''}.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex1} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{2}
\tightlist
\item
  A próxima etapa da instalação, chamada de ``Installation Scope'', você deve escolher em qual usuário o software deve ser instalado. Selecione a primeira opção (\textbf{``Install MiKTeX only for me.\textbf{") para que o MiKTeX seja instalado apenas no seu usuário atual no computador. Essa é a opção recomendada. Então clique em }''Avançar"}.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex2} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{3}
\tightlist
\item
  Na etapa ``Installation Directory'', escolha o diretório em que o MiKTeX será instalado. Caso tenha dúvidas sobre isso, não altere nada e utilize o caminho padrão de instalação. Então clique em \textbf{``Avançar''}.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex3} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{4}
\tightlist
\item
  Na etapa ``Settings'', utilize as configurações padrão e clique em \textbf{``Avançar''}.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex4} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{5}
\tightlist
\item
  Na etapa ``Review'', é apresentado as configurações escolhidas anteriormente. Clique em \textbf{Start} para que a instalação seja começada.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex5} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{6}
\tightlist
\item
  O processo de instalação será realizado, e pode demorar alguns minutos. Duas barras verdes aparecerão para demonstrar a porcentagem da instalação já realizada. Quando essa etapa terminar, as barras ficarão cinza e o você deverá clicar no botão \textbf{Start}.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex6} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  Na etapa ``Update Check'', apresentará a opção de buscar por atualizações. Mantenha o botão \textbf{``Check for updates now''} selecionado, e clique no botão \textbf{Start}.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex7} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{8}
\tightlist
\item
  A próxima janela mostrará uma mensagem dizendo que a instalação foi completa. Clique no botão \textbf{Close} para fechar essa janela.
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex8} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{9}
\tightlist
\item
  Abra o MiKTeX console através do menu Iniciar do Windows. No menu lateral, escolha a opção ``Updates''. Clique em \textbf{``Check for updates''}, e o MiKTeX buscará informações sobre as possíveis atualizações necessárias. Então clique em \textbf{``Update now''}, para que as atualizações sejam baixadas e instaladas. Essa etapa também pode demorar um pouco!
\end{enumerate}

\begin{center}\includegraphics[width=0.8\linewidth]{img/instalacao/miktex_windows/win_miktex9} \end{center}

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\setcounter{enumi}{10}
\tightlist
\item
  Após instalar as atualizações, o MiKTeX avisará que ele precisa ser fechado. Abra-o novamente. Após este processo, o MiKTex estará pronto para uso.
\end{enumerate}

\hypertarget{no-linux-1}{%
\subsubsection{No Linux}\label{no-linux-1}}

No linux, a forma mais direta de garantir que temos o LaTeX na máquina com todas as dependências é instalando o \texttt{texlive-full}. No Ubuntu, basta rodar

\begin{verbatim}
sudo apt install texlive-full
\end{verbatim}

\begin{quote}
\textbf{Importante}: o texlive-full é uma fora ``bruta'' de instalar tudo do LaTeX, e pode ocupar mais do que 5GB do seu disco! Então tome cuidado e procure alternativas, como as descritas \href{https://linuxconfig.org/how-to-install-latex-on-ubuntu-18-04-bionic-beaver-linux}{neste site}.
\end{quote}

\hypertarget{no-macos-1}{%
\subsubsection{No MacOS}\label{no-macos-1}}

Uma distribuição de LaTeX que apresenta versão para MacOS é o MikTex. Para instalá-lo, primeiramente faça o download do arquivo \texttt{.dmg} \href{https://miktex.org/download\#mac}{através deste link}. \href{https://miktex.org/howto/install-miktex-mac}{Este tutorial} apresenta todos os passos de instalação no MacOS, porém abaixo também vamos descrever os passos:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Faça o download do arquivo \texttt{.dmg} \href{https://miktex.org/download\#mac}{através deste link}, escolhendo a versão de instalação para MacOS.
\item
  Abra o arquivo baixado. Uma janela irá abrir, e você deve arrastar o ícone ``MiKTeX Console'' para a pasta ``Applications'' (como mostrado na animação abaixo, sendo necessário arrastar apenas uma vez).
\item
  No Launchpad (menu de arquivos instalados), procure o ícone do ``MiKTeX Console'' e abra-o. Você também pode usar a pesquisa do MacOS (utilizando o atalho Command + Barra de espaço), pesquisando por MiKTeX para abrir o software.
\item
  Ao abrir pela primeira vez, o MiKTeX solicitará que você selecione uma opção para que a instalação seja completada. Selecione \textbf{``Finish private setup''}, e isso fará com que o MiKTeX esteja disponível apenas no seu usuário do computador. Após selecionar essa opcão, ele terminará a configuração, e aparecerá uma mensagem dizendo que o MiKTex será reiniciado. Espere até que ele reinicie. Ao final, aparecerá uma mensagem dizendo que é necessário fazer atualizações no MiKTeX.
\item
  No menu lateral, escolha a opção ``Updates''. Clique em \textbf{``Check for updates''}, e o MiKTex buscará informações sobre as possíveis atualizações necessárias. Então clique em \textbf{``Update now''}, para que as atualizações sejam baixadas e instaladas.
\item
  Após instalar e atualizar, o MiKTeX está pronto para uso!
\end{enumerate}

\hypertarget{office}{%
\subsection{Office}\label{office}}

No R, os arquivos do pacote office também são gerados a partir do Pandoc. Por isso, não é necessário instalar nenhum software adicional para gerar os documentos.

No entanto, para abrir documentos do Office, como \texttt{.pptx} e \texttt{.docx}, é necessário ter o Office ou alguma alternativa aberta instalados.

Além disso, por conta das particularidades desses tipos de documentos, muitas vezes é necessário instalar pacotes adicionais, que não vêm com o \texttt{\{rmarkdown\}}. Abaixo, segue uma lista de pacotes usualmente utilizados nesse contexto:

\begin{itemize}
\tightlist
\item
  \texttt{\{officedown\}}.
\item
  \texttt{\{officer\}}, que é uma dependência do \texttt{\{officedown\}}.
\item
  \texttt{\{flextable\}}, para geração de tabelas.
\item
  \texttt{\{svglite\}}, para renderizar gráficos em SVG.
\end{itemize}

\begin{quote}
Uma dica adicional: É possível gerar gráficos \emph{editáveis} nos documentos Office! Dessa forma, você pode gerar o relatório bruto e depois editar manualmente. Para isso, siga o tutorial deste \href{https://www.youtube.com/watch?v=Yprmq8AUf8g}{vídeo do YouTube}. Referência: \href{http://www.sthda.com/english/wiki/saving-high-resolution-ggplots-how-to-preserve-semi-transparency}{link}.
\end{quote}

\hypertarget{no-windows-2}{%
\subsubsection{No Windows}\label{no-windows-2}}

O LibreOffice pode ser instalado através \href{https://pt-br.libreoffice.org/baixe-ja/libreoffice-novo/}{deste link}, escolhendo o sistema operacional ``Windows'' e clicando em ``Baixar'' e executando o arquivo baixado.

\hypertarget{no-linux-2}{%
\subsubsection{No Linux}\label{no-linux-2}}

No linux, a forma mais fácil de abrir documentos provenientes do Office é utilizando o LibreOffice:

\begin{verbatim}
sudo apt install libreoffice
\end{verbatim}

\begin{quote}
O LibreOffice possui algumas limitações quando comparado ao software da Microsoft. Por exemplo, as tabelas que saem bonitas no Office podem ficar desformatadas no LibreOffice.
\end{quote}

\begin{quote}
o LibreOffice 7.1 não está ainda no aptitude. Se quiser instalar essa versão, é possível baixar o arquivo \texttt{.deb} no \href{https://www.libreoffice.org}{site da ferramenta}.
\end{quote}

\hypertarget{no-macos-2}{%
\subsubsection{No MacOS}\label{no-macos-2}}

O sistema operaciona MacOS disponibiliza o \href{https://www.apple.com/br/iwork/}{iWork}, que é composto pelas ferramentas Numbers, Pages e Keynote. Esses programas possibilitam abrir arquivos provenientes do Office.

Outra opção é a utilização do LibreOffice.

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Primeiro, faça o download do arquivo \texttt{.dmg} de instalação, através \href{https://pt-br.libreoffice.org/baixe-ja/libreoffice-novo/}{deste link}, escolhendo o sistema operacional ``MacOS'' e clicando em ``Baixar''.
\item
  Após baixar o arquivo, abra-o. Uma janela irá abrir (como na imagem a seguir). Você deve arrastar o ícone ``LibreOffice'' para a pasta ``Applications'' (como mostrado na animação abaixo, sendo necessário arrastar apenas uma vez).
\item
  O LibreOffice será instalado e você poderá utilizá-lo abrindo através do Launchpad (menu de arquivos instalados), ou também utilizando a pesquisa do Mac (utilizando o atalho Command + Barra de espaço), pesquisando por LibreOffice para abrir o software.
\end{enumerate}

\hypertarget{pagedown-e-chrome}{%
\subsection{Pagedown e Chrome}\label{pagedown-e-chrome}}

O \texttt{\{pagedown\}} é uma alternativa recente para produzir arquivos em HTML utilizando o \href{https://www.pagedjs.org/}{\texttt{paged.js}}, uma biblioteca em JavaScript que torna um arquivo HTML muito parecido com um PDF. Com a ajuda do Chrome, é possível, inclusive, exportar o arquivo para PDF.

O \texttt{\{pagedown\}}, portanto, apresenta o melhor de dois mundos: a praticidade da extensão HTML e a portabilidade de arquivos PDF. Dessa forma, é possível gerar documentos PDF com formatos agradáveis sem depender do LaTeX.

No entanto, para gerar documentos PDF, é preciso utilizar um navegador. O navegador recomendado pelo \texttt{\{pagedown\}} é o \href{https://www.google.com/intl/pt-BR/chrome/}{Chrome}, tanto que o pacote já vem com a função \texttt{pagedown::chrome\_print()}, que pode ser utilizada para transformar um arquivo HTML ou RMarkdown em PDF.

\begin{quote}
Se você já tiver o Chrome instalado na sua máquina, provavelmente tudo funcionará sem problemas. Se não tiver e não quiser instalar, é possível instalar somente o \href{https://developers.google.com/web/updates/2017/04/headless-chrome}{headless Chrome}.
\end{quote}

\begin{quote}
No linux, uma alternativa é instalar o projeto Chromium, que é quase que totalmente open source.
\end{quote}

\hypertarget{renderizando-html-widgets}{%
\subsection{Renderizando HTML widgets}\label{renderizando-html-widgets}}

Os HTML widgets são formas de ligar bibliotecas do JavaScript com pacotes do R. Isso permite gerar relatórios dinâmicos em HTML diretamente do R. O pacote \texttt{\{htmlwidgets\}} possui um conjunto de melhores práticas para criação dessas soluções.

No entanto, é comum utilizar HTML widgets em relatórios estáticos. Para isso, o R precisa de uma estratégia para tirar fotos estáticas dos widgets. Isso é realizado através do pacote \texttt{\{webshot\}}.

Você pode instalar o \texttt{\{webshot\}} executando o código abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"webshot"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Para que o \texttt{\{webshot\}} funcione, no entanto, também é necessário ter o PhantomJS instalado na máquina. O PhantomJS é basicamente um navegador que roda totalmente no plano de fundo, possibilitando a captura de tela.

Para instalar o PhantomJS, execute o código abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{webshot}\SpecialCharTok{::}\FunctionTok{install\_phantomjs}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{blogdown}{%
\subsection{Blogdown}\label{blogdown}}

Para criar blogs utilizando o pacote \texttt{\{blogdown\}}, também é necessário instalar o Hugo, programa que renderiza sites estáticos.

Felizmente, essa tarefa é bem tranquila pois o \texttt{\{blogdown\}} já vem com um helper para isso. Basta executar o código abaixo e reiniciar a sua sessão do R para que o Hugo seja instalado:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{blogdown}\SpecialCharTok{::}\FunctionTok{install\_hugo}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\hypertarget{ferramentas-de-desenvolvimento}{%
\subsection{Ferramentas de desenvolvimento}\label{ferramentas-de-desenvolvimento}}

Em algumas situações (como por exemplo, no desenvolvimento de pacotes), é solicitado a instalação de ferramentas de desenvolvimento. Essas ferramentas dependem do sistema operacional utilizado.

No caso do desenvolvimento de pacotes, você pode verificar se já possui as ferramentas de desenvolvimento instaladas usando a seguinte função: \texttt{devtools::has\_devel()}. Caso a mensagem retornada seja \emph{``Your system is ready to build packages!''}, significa que você já tem as ferramentas necessárias instaladas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{has\_devel}\NormalTok{()}
\CommentTok{\#\textgreater{} Your system is ready to build packages!}
\end{Highlighting}
\end{Shaded}

\hypertarget{no-windows---rtools}{%
\subsubsection{No Windows - Rtools}\label{no-windows---rtools}}

O software Rtools é apenas necessário para computadores que utilizem o sistema operacional Windows. Para instalá-lo, clique \href{https://cran.r-project.org/bin/windows/Rtools/}{neste link} e faça o download do arquivo instalador referente à sua versão do Windows (32 ou 64 bits). Abra o arquivo baixado para realizar a instalação.

\hypertarget{no-linux---r-base-dev}{%
\subsubsection{No Linux - r-base-dev}\label{no-linux---r-base-dev}}

No Linux, caso seja necessário, você também pode instalar o pacote \texttt{r-base-dev}. Por exemplo, no Ubuntu você pode instalá-lo executando o seguinte código no terminal:

\begin{verbatim}
sudo apt install r-base-dev
\end{verbatim}

\hypertarget{no-macos---xcode-command-line-tools}{%
\subsubsection{No MacOS - Xcode command line tools}\label{no-macos---xcode-command-line-tools}}

O Xcode command line tools é uma ferramenta de desenvolvimento oficial da Apple. Para instalar essa ferramenta, primeiramente é preciso acessar o Terminal. Você pode encontrar o Terminal procurando na lista de programas instalados (\emph{Launchpad}), ou então na opção de busca (usando o atalho: \textbf{command + barra de espaço}) e escrevendo Terminal.

No terminal, escreva o seguinte código e aperte Enter, o que iniciará a instalação:

\begin{verbatim}
xcode-select --install
\end{verbatim}

Siga as instruções apresentadas para instalar.

Caso a seguinte mensagem apareça, significa que você já tem a ferramenta instalada: \texttt{error:\ command\ line\ tools\ are\ already\ installed,\ use\ "Software\ Update"\ to\ install\ updates}.

Caso queira confirmar que a instalação foi bem sucedida, execute no terminal o código a seguir. Caso a mensagem de retorno seja um caminho (por exemplo: \texttt{/Library/Developer/CommandLineTools}), significa que a instalação foi bem sucedida, e esse é o caminho onde a ferramenta foi instalada.

\begin{verbatim}
xcode-select -p
\end{verbatim}

\hypertarget{git}{%
\subsection{Git}\label{git}}

O Git é um programa para linha de comando que possibilita realizar o controle de versões dos arquivos em um diretório (ou seja, em uma pasta). Para instalar esse sistema de controle de versões distribuído, acesse a \href{http://git-scm.com/download/}{página sobre Download do Git}, escolha o seu sistema operacional, siga as instruções apresentadas para instalação.

\hypertarget{rstudio}{%
\chapter{RStudio}\label{rstudio}}

O RStudio é sem dúvidas o mais completo ambiente de desenvolvimento para programação em R. Descubra aqui as funcionalidades do RStudio que nos permitem escrever códigos e analisar resultados de forma muito mais eficiente.

\hypertarget{telas}{%
\section{Telas}\label{telas}}

Ao abrir o RStudio, você verá 4 quadrantes. Observe a figura abaixo.

\begin{center}\includegraphics[width=56.24in]{assets/img/rstudio/rstudio-editor} \end{center}

Esses quadrantes representam o \textbf{editor}, o \textbf{console}, o \textbf{environment} e o \textbf{output}. Eles vêm nesta ordem, mas você pode organizá-los da forma que preferir acessando a seção \emph{Pane Layout} da opção \texttt{Global\ options...} no menu \texttt{Tools}.

O editor e o console são os dois principais painéis do RStudio. Passaremos a maior parte do tempo neles.

\begin{itemize}
\tightlist
\item
  \textbf{Editor/Scripts}: é onde escrevemos nossos códigos. Repare que o RStudio colore algumas palavras e símbolos para facilitar a leitura do código.
\item
  \textbf{Console}: é onde rodamos o código e recebemos as saídas. O R vive aqui!
\end{itemize}

Os demais painéis são auxiliares. O objetivo deles é facilitar pequenas tarefas que fazem parte tanto da programação quanto da análise de dados, como olhar a documentação de funções, analisar os objetos criados em uma sessão do R, procurar e organizar os arquivos que compõem a nossa análise, armazenar e analisar os gráficos criados e muito mais.

\begin{itemize}
\tightlist
\item
  \textbf{Environment}: painel com todos os objetos criados na sessão.
\item
  \textbf{History}: painel com um histórico dos comandos rodados.
\item
  \textbf{Files}: mostra os arquivos no diretório de trabalho. É possível navegar entre diretórios.
\item
  \textbf{Plots}: painel onde os gráficos serão apresentados.
\item
  \textbf{Packages}: apresenta todos os pacotes instalados e carregados.
\item
  \textbf{Help}: janela onde a documentação das funções serão apresentadas.
\item
  \textbf{Viewer}: painel onde relatórios e dashboards serão apresentados.
\end{itemize}

\hypertarget{atalhos}{%
\section{Atalhos}\label{atalhos}}

Conhecer os atalhos do teclado ajuda bastante quando estamos programando no RStudio. Veja os principais:

\begin{itemize}
\tightlist
\item
  \textbf{CTRL+ENTER}: avalia a linha selecionada no script. O atalho mais utilizado.
\item
  \textbf{ALT+-}: cria no script um sinal de atribuição (\textless-). Você o usará o tempo todo.
\item
  \textbf{CTRL+SHIFT+M}: (\%\textgreater\%) operador \emph{pipe}. Guarde esse atalho, você o usará bastante.
\item
  \textbf{CTRL+1}: altera cursor para o script.
\item
  \textbf{CTRL+2}: altera cursor para o console.
\item
  \textbf{CTRL+ALT+I}: cria um chunk no R Markdown.
\item
  \textbf{CTRL+SHIFT+K}: compila um arquivo no R Markdown.
\item
  \textbf{ALT+SHIFT+K}: janela com todos os atalhos disponíveis.
\end{itemize}

No MacBook, os atalhos geralmente são os mesmos, substituindo o \textbf{CTRL} por \textbf{command} e o \textbf{ALT} por \textbf{option}.

\hypertarget{projetos}{%
\section{Projetos}\label{projetos}}

Uma funcionalidade muito importante do RStudio é a possibilidade de criar \textbf{projetos}.

Um projeto nada mais é do que uma pasta no seu computador. Nessa pasta, estarão todos os arquivos que você usurá ou criará na sua análise.

A principal razão de utilizarmos projetos é \textbf{organização}. Com eles, fica muito mais fácil importar bases de dados para dentro do R, criar análises reprodutíveis e compartilhar o nosso trabalho.

\begin{quote}
Você que está começando agora no R, já se habitue a criar um novo projeto para cada nova análise que for fazer.
\end{quote}

Para criar um projeto, clique em \texttt{New\ Project...} no Menu \texttt{File}. Na caixa de diálogo que aparecerá, clique em \texttt{New\ Directory} para criar o projeto em uma nova pasta ou \texttt{Existing\ Directory} para criar em uma pasta existente.

Se você tiver o \texttt{Git} instalado, você também pode usar projetos para conectar com repositórios do Github e outras plataformas de desenvolvimento. Para isso, basta clicar em \texttt{Version\ Control}.

\begin{center}\includegraphics[width=7.4in]{assets/img/rstudio/projetos} \end{center}

Criando um projeto, o RStudio criará na pasta escolhida um arquivo \texttt{nome-do-projeto.Rproj}. Você pode usar esse arquivo para iniciar o RStudio já com o respectivo projeto aberto.

Quando um projeto estiver aberto no RStudio, o seu nome aparecerá no canto superior direito da tela. Na aba \textbf{Files}, aparecerão todos os arquivos contidos no projeto.

\begin{center}\includegraphics[width=40in]{assets/img/rstudio/exemplo-projeto-aberto} \end{center}

Você pode criar livremente novas pastas dentro da pasta do projeto. Por padrão, o R sempre começará a procurar arquivos na pasta raiz do projeto (é a pasta que contem o \texttt{nome-do-projeto.Rproj}).

Uma maneira fácil de navegar entre projetos é utilizar o menu disponibilizado quando clicamos no nome do projeto. Veja a figura a seguir.

\begin{center}\includegraphics[width=40in]{assets/img/rstudio/exemplo-lista-projetos} \end{center}

Nesse menu, além de podermos criar novos projetos ou abrir projetos já existentes, também temos um acesso rápido a projetos abertos recentemente. Basta clicar em qualquer um deles para trocar de projeto, isto é, deixar de trabalhar em uma análise e começar a trabalhar em outra.

A seguir, apresentamos algumas estruturas de organização de projetos no RStudio.

\textbf{Estrutura 1}. Por extensão de arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{nome\_do\_projeto/}
  \ExtensionTok{{-}}\NormalTok{ .Rprofile   }\CommentTok{\# códigos para rodar assim que abrir o projeto}
  \ExtensionTok{{-}}\NormalTok{ R/          }\CommentTok{\# Código R, organizado com a{-}carrega.R, b{-}prepara bd.R, c{-}vis.R, d{-}modela, ...}
  \ExtensionTok{{-}}\NormalTok{ RData/      }\CommentTok{\# Dados em formato .RData}
  \ExtensionTok{{-}}\NormalTok{ csv/        }\CommentTok{\# Dados em .csv}
  \ExtensionTok{{-}}\NormalTok{ png/        }\CommentTok{\# gráficos em PNG}
  \ExtensionTok{{-}}\NormalTok{ nome\_do\_projeto.Rproj}
\end{Highlighting}
\end{Shaded}

\textbf{Estrutura 2}. Típico projeto de análise estatística.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{project/}
  \ExtensionTok{{-}}\NormalTok{ README.Rmd   }\CommentTok{\# Descrição do pacote}
  \ExtensionTok{{-}}\NormalTok{ set{-}up.R     }\CommentTok{\# Pacotes etc}
  \ExtensionTok{{-}}\NormalTok{ R/           }\CommentTok{\# Código R, organizado com 0{-}load.R, 1{-}tidy.R, 2{-}vis.R, ...}
  \ExtensionTok{{-}}\NormalTok{ data/        }\CommentTok{\# Dados (estruturados ou não)}
  \ExtensionTok{{-}}\NormalTok{ figures/     }\CommentTok{\# gráficos (pode ficar dentro de output/)}
  \ExtensionTok{{-}}\NormalTok{ output/      }\CommentTok{\# Relatórios em .Rmd, .tex etc}
  \ExtensionTok{{-}}\NormalTok{ project.Rproj}
\end{Highlighting}
\end{Shaded}

\textbf{Estrutura 3}. Pacote do R.

\begin{Shaded}
\begin{Highlighting}[]
\ExtensionTok{project/}
  \ExtensionTok{{-}}\NormalTok{ README.md    }\CommentTok{\# Descrição do pacote}
  \ExtensionTok{{-}}\NormalTok{ DESCRIPTION  }\CommentTok{\# Metadados estruturados do pacote e dependências}
  \ExtensionTok{{-}}\NormalTok{ NAMESPACE    }\CommentTok{\# importações e exportações do pacote}
  \ExtensionTok{{-}}\NormalTok{ vignettes/   }\CommentTok{\# Relatórios em .Rmd}
  \ExtensionTok{{-}}\NormalTok{ R/           }\CommentTok{\# Funções do R}
  \ExtensionTok{{-}}\NormalTok{ data/        }\CommentTok{\# Dados estruturados (tidy data)}
  \ExtensionTok{{-}}\NormalTok{ data{-}raw/    }\CommentTok{\# Dados não estruturados e arqs 0{-}load.R, 1{-}tidy.R, 2{-}vis.R, ...}
  \ExtensionTok{{-}}\NormalTok{ project.Rproj}
\end{Highlighting}
\end{Shaded}

\hypertarget{git-e-versionamento}{%
\section{Git e versionamento}\label{git-e-versionamento}}

O RStudio possui funcionalidades para quem trabalha com o programa \emph{Git} para versionar arquivos.

\begin{center}\includegraphics[width=0.7\linewidth]{assets/img/rstudio/git-menu} \end{center}

Além disso, quando você inicia o Git na pasta raiz de um projeto, o RStudio criará uma nova abinha chamada \emph{Git}, onde você pode confirir os arquivos modificados que estão à espera de um \emph{commit}.

\begin{center}\includegraphics[width=0.6\linewidth]{assets/img/rstudio/git-aba} \end{center}

Para saber mais sobre Git e versionamento de arquivos, leia esse excelente capítulo do \href{https://curso-r.github.io/zen-do-r/git-github.html}{Zen do R}.

\hypertarget{cheatsheets}{%
\section{Cheatsheets}\label{cheatsheets}}

O RStudio tem à disposição algumas \emph{folhas de cola}, as \textbf{cheatsheets}. Elas trazem um resumão de como utilizar diversos pacotes e até o próprio RStudio.

Para acessá-las, basta clicar no menu \texttt{Help} e então em \texttt{Cheatsheets}.

Outra forma de acessá-las é através do site da \href{https://rstudio.com/resources/cheatsheets/}{RStudio}, onde existem muitas opções de \textbf{cheatsheets}, incluindo algumas \href{https://rstudio.com/resources/cheatsheets/\#translations}{traduzidas} para o Português.

\begin{center}\includegraphics[width=700pt,height=600pt]{assets/img/rstudio/cheatsheet-rstudio} \end{center}

\hypertarget{addins}{%
\section{Addins}\label{addins}}

Addins são cápsulas de código R que podem ser executados interativamente a partir do menu \texttt{Addins}.

\begin{center}\includegraphics[width=0.7\linewidth]{assets/img/rstudio/botao_addins} \end{center}

Eles servem para fazer diversos tipos de tarefas, como identar seu código, ajudar nas tarefas de copiar e colar, insirir códigos no seu script e muito mais.

Os addins são criados pelos pacotes que instalamos, então cada pacote vai nos disponibizar addins que facilitam algum tipo de tarefa.

Veja \href{https://rstudio.github.io/rstudioaddins/demo/demo-reformat.gif}{aqui} um exemplo de um addin que formata um código e \href{https://rstudio.github.io/rstudioaddins/demo/demo-subset.gif}{aqui} um addin que filtra uma base.

O pacote \texttt{\{CursoR\}} da Curso-R, por exemplo, tem um addin que auxilia quem faz nossos cursos a atualizar o material de cada aula.

\begin{center}\includegraphics[width=0.4\linewidth]{assets/img/rstudio/addins} \end{center}

\hypertarget{snippets}{%
\section{Snippets}\label{snippets}}

Snippets são atalhos que podemos criar para gerar pedaços rotineiros de código.

O RStudio já vem com vários snippets criados. Você pode visualizar os snippts existentes ou criar novos acessando \texttt{Tools\ \textgreater{}\ Global\ Options...\ \textgreater{}\ Code\ \textgreater{}\ Editting\ \textgreater{}\ Snippets\ \textgreater{}\ Edit\ snippets}.

No arquivo de texto aberto, basta seguir o padrão dos snippets já existentes para criar novos. Você também pode editar os snippets padrão do RStudio.

\begin{center}\includegraphics[width=0.7\linewidth]{assets/img/rstudio/snippets} \end{center}

Cada snippet terá um \emph{nome}, que deverá ser utilizado no script para ativar o código guardado por trás.

\begin{center}\includegraphics[width=0.6\linewidth]{assets/img/rstudio/snippet_for} \end{center}

Basta escrever o nome, apertar a teclar \texttt{TAB} e \emph{voilà}.

\begin{center}\includegraphics[width=0.4\linewidth]{assets/img/rstudio/snippet_for_resultado} \end{center}

\hypertarget{r-base}{%
\chapter{R Básico}\label{r-base}}

Introduziremos aqui os principais conceitos de programação em R. Indicamos a leitura deste capítulo a quem nunca teve contato com uma linguagem de programação ou a quem gostaria de entender um pouco melhor a estrutura de objetos, funções e classes do R.

Os tópicos discutidos aqui são especialmente importantes para entendermos o que é um \emph{data frame}, a nossa base de dados dentro do R, e quais operações estão sendo realizadas por trás das cortinas quando estivermos filtrando suas linhas ou modificando suas colunas. Também são importantes para começarmos a criar as nossas próprias funções, o que deixa nossos códigos muito mais organizados, eficientes e \emph{compartilháveis}.

\hypertarget{pedindo-ajuda}{%
\section{Pedindo Ajuda}\label{pedindo-ajuda}}

A linguagem \texttt{R} é bem intuitiva. É possível fazer bastante coisa à base da tentativa e erro. Além disso, grande parte do conhecimento é escalável, isto é, aprender a utilizar uma função é meio caminho andado para aprender todas as outras funções que operam de forma semelhante\footnote{Essa ideia é um dos princípios por trás do \texttt{tidyverse}.}.

No entanto, a intuição não infalível, e recorrentemente vamos precisar de ajuda para rodar alguma função ou descobrir como fazer alguma tarefa no R. Felizmente, a comunidade R é bem ativa e existem vários lugares para buscar respostas. Nesta seção, vamos apresentar as principais maneiras algumas dessas maneiras.

\textbackslash begin\{figure\}

\{\centering \includegraphics[width=11.49in]{assets/img/r-base/code_hero_rstats}

\}

\textbackslash caption\{Arte por Allison Horst (\citet{allison_horst}). Veja nas Referências onde encontrá-la.\}\label{fig:r-base-1}
\textbackslash end\{figure\}

No R, há quatro principais entidades para se pedir ajuda:

\begin{itemize}
\tightlist
\item
  Help/documentação do R
\item
  Google
\item
  Stack Overflow
\item
  Coleguinha
\end{itemize}

A busca por ajuda é feita preferencialmente, mas não necessariamente, na ordem acima.

\hypertarget{documentauxe7uxe3o-do-r}{%
\subsection{Documentação do R}\label{documentauxe7uxe3o-do-r}}

A documentação do R serve para você aprender a usar uma determinada função. Se você não sabe o que é uma função, não se preocupe. Discutiremos esse tópico nas Seções \ref{objetosFuncoes} e \ref{maisFuncoes}.

Você pode acessar a documentação de uma função\footnote{Bases de dados presentes em pacotes também têm documentação, e geralmente é possível encontrar o significado de cada variável nela. Por exemplo, \texttt{help(mtcars)}.} das seguintes maneiras:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{?mean}
\FunctionTok{help}\NormalTok{(mean)}
\end{Highlighting}
\end{Shaded}

Algumas dicas:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Leia a seção \emph{Usage} para ter noção de como usar a função.
\item
  Os parâmetros da função estão descritos em \emph{Arguments}.
\item
  Os exemplos no final são particularmente úteis.
\item
  Caso essa função não atenda às suas necessidades, a seção \emph{See Also} sugere funções relacionadas.
\end{enumerate}

Alguns pacotes possuem tutorias de uso mais completos. Esses textos são chamados de \texttt{vignettes} e podem ser acessados com a função \texttt{vignette(package\ =\ \textquotesingle{}nomeDoPacote\textquotesingle{})}. Por exemplo, \texttt{vignette(package\ =\ \textquotesingle{}dplyr\textquotesingle{})}.

\hypertarget{google}{%
\subsection{Google}\label{google}}

Há uma comunidade gigantesca de usuários de R gerando diariamente uma infinidade de conteúdos e discussões. Não raramente, você irá encontrar discussões sobre o seu problema simplesmente o descrevendo no Google. Pesquisas em inglês aumentam consideravelmente a chance de encontrar uma resposta.

Quando você recebe um erro na tentativa de rodar algum código no R e não sabe o que está errado, uma boa estratégia é pesquisar a mensagem de erro no Google. Essa deve ser sua primeira tentativa para resolver o problema. Repare na imagem abaixo o `r' adicionado na busca. Isso ajuda bastante a encontrar uma solução.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{log}\NormalTok{(}\StringTok{"5"}\NormalTok{)}
\DocumentationTok{\#\# Error in log("5"): non{-}numeric argument to mathematical function}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=795pt,height=267pt]{assets/img/r-base/ajuda_google} \end{center}

\hypertarget{stack-overflow}{%
\subsection{Stack Overflow}\label{stack-overflow}}

O \href{http://stackoverflow.com/}{Stack Overflow} e o \href{http://pt.stackoverflow.com/}{Stack Overflow em Português} são sites de Pergunta e Resposta amplamente utilizados por todas as linguagens de programação, e o R é uma delas. Nos EUA, chegam até a usar a reputação dos usuários dentro da plataforma como diferencial no currículo!

Provavelmente o Google lhe indicará uma página deles quando você estiver procurando ajuda. E quando todas as fontes possíveis de ajuda falharem, o Stack Overflow lhe dará o espaço para \textbf{criar sua própria pergunta}.

\textbf{Um ponto importante}: como fazer uma \emph{boa pergunta} no Stack Overflow?

No site, existe um tutorial com uma lista de boas práticas, \href{http://pt.stackoverflow.com/help/how-to-ask}{que se encontra aqui}. Resumindo, as principais dicas são

\begin{itemize}
\tightlist
\item
  ser conciso;
\item
  ser específico;
\item
  ter mente aberta; e
\item
  ser gentil.
\end{itemize}

Porém, no caso do R, há outro requisito que vai aumentar muito sua chance de ter uma boa resposta: \textbf{exemplinho minimal e reprodutível}.

\begin{itemize}
\item
  Ser \textbf{minimal}: usar bancos de dados menores e utilizar pedaços de códigos apenas suficientes para apresentar o seu problema. Não precisa de banco de dados de um milhão de linhas e nem colocar o seu código inteiro para descrever a sua dúvida.
\item
  Ser \textbf{reprodutível}: o seu código deve rodar fora da sua máquina. Se você não fornecer uma versão do seu problema que rode (ou que imite seu erro), as pessoas vão logo desistir de te ajudar. Por isso, nunca coloque bancos de dados que só você tem acesso. Use bancos de dados que já vem no R ou disponibilize um exemplo (possivelmente anonimizado) em \texttt{.csv} na web para baixar. E se precisar utilizar funções de algum pacote, especifique os pacotes que você usou.
\end{itemize}

\hypertarget{r-como-calculadora}{%
\section{R como calculadora}\label{r-como-calculadora}}

O papel do \textbf{Console} no R é executar os nossos comandos. Ele avalia o código que passamos para ele e devolve a saída correspondente --- se tudo der certo --- ou uma mensagem de erro --- se o seu código tiver algum problema.

Vamos começar com o exemplo mais simples possível:

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{+} \DecValTok{1}
\DocumentationTok{\#\# [1] 2}
\end{Highlighting}
\end{Shaded}

Nesse caso, o nosso comando foi o código \texttt{1\ +\ 1} e a saída foi o valor \texttt{2}.

\begin{quote}
\textbf{Quando compilamos?} Quem vem de linguagens como o C ou Java espera que seja necessário compilar o código em texto para o código das máquinas (geralmente um código binário). No R, isso não é necessário. O R é uma linguagem de programação dinâmica que interpreta o seu código enquanto você o executa.
\end{quote}

Tente agora jogar no console a expressão: \texttt{2\ *\ 2\ -\ (4\ +\ 4)\ /\ 2}.

Pronto! Você já é capaz de pedir ao R para fazer qualquer uma das quatro operações aritméticas básicas. A seguir, apresentamos uma lista resumindo como fazer as principais operações no R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# adição}
\DecValTok{1} \SpecialCharTok{+} \DecValTok{1}
\DocumentationTok{\#\# [1] 2}

\CommentTok{\# subtração}
\DecValTok{4} \SpecialCharTok{{-}} \DecValTok{2}
\DocumentationTok{\#\# [1] 2}

\CommentTok{\# multiplicação}
\DecValTok{2} \SpecialCharTok{*} \DecValTok{3}
\DocumentationTok{\#\# [1] 6}

\CommentTok{\# divisão}
\DecValTok{5} \SpecialCharTok{/} \DecValTok{3}
\DocumentationTok{\#\# [1] 1.666667}

\CommentTok{\# potência}
\DecValTok{4} \SpecialCharTok{\^{}} \DecValTok{2}
\DocumentationTok{\#\# [1] 16}

\CommentTok{\# resto da divisão de 5 por 3}
\DecValTok{5} \SpecialCharTok{\%\%} \DecValTok{3}
\DocumentationTok{\#\# [1] 2}

\CommentTok{\# parte inteira da divisão de 5 por 3}
\DecValTok{5} \SpecialCharTok{\%/\%} \DecValTok{3}  
\DocumentationTok{\#\# [1] 1}
\end{Highlighting}
\end{Shaded}

Repare que as operações e suas precedências são mantidas como na matemática, ou seja, divisão e multiplicação são calculadas antes da adição e subtração. E os parênteses nunca são demais!

Uma outra forma de executar uma expressão é escrever o código em um \textbf{script}, deixar o cursor em cima da linha e usar o atalho \texttt{Ctrl\ +\ Enter}. Assim, o comando é enviado para o \textbf{Console}, onde é diretamente executado. Essa operação é chamada de \textbf{avaliar}, \textbf{executar} ou \textbf{rodar} o código.

Se você digitar um comando incompleto, como \texttt{5\ +}, e apertar \texttt{Enter}, o R mostrará um \texttt{+}, o que não tem nada a ver com a adição da matemática. Isso significa que o R está esperando que você enviar \textbf{mais} algum código para completar o seu comando. Termine o seu comando ou aperte \texttt{Esc} para recomeçar.

\begin{verbatim}
> 5 -
+ 
+ 5
[1] 0
\end{verbatim}

Se você digitar um comando que o R não reconhece, ele retornará uma mensagem de erro.

NÃO ENTRE EM PÂNICO!

Ele só está avisando que não conseguiu interpretar o comando. Você pode digitar outro comando normalmente em seguida.

\begin{verbatim}
> 5 % 2
Error: unexpected input in "5 % 2"
> 5 ^ 2
[1] 25
\end{verbatim}

\hypertarget{exercuxedcios}{%
\subsection*{Exercícios}\label{exercuxedcios}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Qual a diferença entre o R e o RStudio?

\textbf{2.} Podemos usar o RStudio sem o R? E o R sem o RStudio?

\textbf{3.} Precisamos compilar nossos códigos de R?

\textbf{4.} Calcule o número de ouro no R. Dica: o número de ouro é dado pela expressão \(\frac{1 + \sqrt{5}}{2}\).

\textbf{5.} Por que é preferível escrevermos sempre o nosso código no \emph{script} e não no \emph{Console}?

\hypertarget{objetosFuncoes}{%
\section{Objetos e funções}\label{objetosFuncoes}}

O R te permite salvar valores dentro de um \textbf{objeto}. Um objeto é simplesmente um nome que guarda um valor. Para criar um objeto, utilizamos o operador \texttt{\textless{}-}.

No exemplo abaixo, salvamos o valor \texttt{1} em \texttt{a}. Sempre que avaliarmos o objeto \texttt{a}, o R vai devolver o valor 1.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Salvando \textasciigrave{}1\textasciigrave{} em \textasciigrave{}a\textasciigrave{}}
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{1}

\CommentTok{\# Avaliando o objeto \textasciigrave{}a\textasciigrave{}}
\NormalTok{a}
\DocumentationTok{\#\# [1] 1}
\end{Highlighting}
\end{Shaded}

Existem algumas regras para dar nomes aos objetos. A mais importante é: o nome deve começar com uma letra\footnote{Ou com um ponto.}. O nome pode conter números, mas não pode começar com números. Você pode usar pontos \texttt{.} e underlines \texttt{\_} para separar palavras.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Permitido}

\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{x1 }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{3}
\NormalTok{meu\_objeto }\OtherTok{\textless{}{-}} \DecValTok{4}
\NormalTok{meu.objeto }\OtherTok{\textless{}{-}} \DecValTok{5}

\CommentTok{\# Não permitido}

\NormalTok{1x }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{\_objeto }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{meu}\SpecialCharTok{{-}}\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{3}
\end{Highlighting}
\end{Shaded}

\textbf{Atenção!}

O R \textbf{diferencia letras maiúsculas e minúsculas}, isto é, \texttt{b} é considerado um objeto diferente de \texttt{B}. Rode o exemplo abaixo e observe que dois objetos diferentes são criados no \textbf{Environment}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{B }\OtherTok{\textless{}{-}} \DecValTok{3}

\NormalTok{b}
\DocumentationTok{\#\# [1] 2}
\NormalTok{B}
\DocumentationTok{\#\# [1] 3}
\end{Highlighting}
\end{Shaded}

O objeto mais importante para o cientista de dados é, claro, a base de dados. No R, uma base de dados é representa por objetos chamados de \emph{data frames}. Na próxima seção, vamos entender o que são esses objetos.

Enquanto objetos são \emph{nomes} que guardam \emph{valores}, funções no R são \emph{nomes} que guardam um \textbf{código de R}. A ideia é muito simples: sempre que você rodar uma função, o código que ela guarda será executado e um resultado nos será devolvido.

A sintaxe para usar uma função é a seguinte:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nome\_da\_funcao}\NormalTok{(arg1, arg2, argn)}
\end{Highlighting}
\end{Shaded}

Entre parênteses, após o nome da função, temos o que chamamos de \emph{argumentos}. Uma função pode ter qualquer número de argumentos e eles são sempre separados por vírgula.

Basicamente, uma função recebe seus argumentos, executa uma ação sobre ou a partir deles e devolve um resultado. Por exemplo

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] 3}
\end{Highlighting}
\end{Shaded}

A função \texttt{sum()} recebeu os argumentos \texttt{1} e \texttt{2}, somou os dois valores e devolveu o resultado dessa operação: o valor \texttt{3}.

Falaremos mais sobre funções na Seção \ref{maisFuncoes}.

\hypertarget{exercuxedcios-1}{%
\subsection*{Exercícios}\label{exercuxedcios-1}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Qual a diferença entre os códigos abaixo?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Código 1}
\DecValTok{33} \SpecialCharTok{/} \DecValTok{11}

\CommentTok{\# Código 2}
\NormalTok{divisao }\OtherTok{\textless{}{-}} \DecValTok{33} \SpecialCharTok{/} \DecValTok{11}
\end{Highlighting}
\end{Shaded}

\textbf{2.} Multiplique a sua idade por meses e salve o resultado em um objeto chamado \texttt{idade\_em\_meses}. Em seguida, multiplique esse objeto por 30 e salve o resultado em um objeto chamado \texttt{idade\_em\_dias}.

\textbf{3.} Por que o nome \texttt{meu-objeto} não pode ser utilizado para criar um objeto? O que significa a mensagem de erro resultante?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{meu}\SpecialCharTok{{-}}\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{1}
\DocumentationTok{\#\# Error in meu {-} objeto \textless{}{-} 1: object \textquotesingle{}meu\textquotesingle{} not found}
\end{Highlighting}
\end{Shaded}

\hypertarget{data-frames}{%
\section{Data frames}\label{data-frames}}

Os \emph{data frames} são de extrema importância no R, pois são os objetos que guardam os nossos dados. Eles são equivalentes a uma tabela do SQL ou uma planilha do Excel.

A principal característica de um \emph{data frame} é possuir linhas e colunas\footnote{Você pode construir um \emph{data frame} vazio, com 0 linha e 0 coluna. No entanto, a \emph{estrutura} de linhas e colunas estará presente.}. Veja o exemplo abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}
\DocumentationTok{\#\#                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb}
\DocumentationTok{\#\# Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4}
\DocumentationTok{\#\# Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4}
\DocumentationTok{\#\# Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1}
\DocumentationTok{\#\# Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1}
\DocumentationTok{\#\# Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2}
\DocumentationTok{\#\# Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1}
\DocumentationTok{\#\# Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4}
\DocumentationTok{\#\# Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2}
\DocumentationTok{\#\# Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2}
\DocumentationTok{\#\# Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4}
\DocumentationTok{\#\# Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4}
\DocumentationTok{\#\# Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3}
\DocumentationTok{\#\# Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3}
\DocumentationTok{\#\# Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3}
\DocumentationTok{\#\# Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4}
\DocumentationTok{\#\# Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4}
\DocumentationTok{\#\# Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4}
\DocumentationTok{\#\# Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1}
\DocumentationTok{\#\# Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2}
\DocumentationTok{\#\# Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1}
\DocumentationTok{\#\# Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1}
\DocumentationTok{\#\# Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2}
\DocumentationTok{\#\# AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2}
\DocumentationTok{\#\# Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4}
\DocumentationTok{\#\# Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2}
\DocumentationTok{\#\# Fiat X1{-}9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1}
\DocumentationTok{\#\# Porsche 914{-}2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2}
\DocumentationTok{\#\# Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2}
\DocumentationTok{\#\# Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4}
\DocumentationTok{\#\# Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6}
\DocumentationTok{\#\# Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8}
\DocumentationTok{\#\# Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2}
\end{Highlighting}
\end{Shaded}

O \texttt{mtcars} é um \emph{data frame} nativo do R que contém informações sobre diversos modelos de carros. Ele possui 32 linhas e 11 colunas\footnote{A primeira ``coluna'' representa apenas o \emph{nome} das linhas (modelo do carro), não é uma coluna da base. Repare que ela não possui um nome, como as outras. Essa estrutura de nome de linha é própria de \emph{data frames} no R. Se exportássemos essa base para o Excel, por exemplo, essa coluna não apareceria.}. Se você quiser saber mais sobre o \texttt{mtcars}, veja a documentação dele rodando \texttt{?mtcars} no \textbf{Console}.

Nos próximos capítulos, os \emph{data frames} serão o nosso principal objeto de estudo. Aprenderemos a selecionar, criar e modificar colunas, filtrar e ordenar linhas, juntar dois \emph{data frames} e, a partir deles, construiremos gráficos e ajustaremos modelos.

Mas, da mesma forma que é muito mais fácil aprendermos a fritar um ovo após entendermos o que é o fogo, uma frigideira e um ovo, vamos estudar nas próximas seções quais são as estruturas que formam os \emph{data frames} e como manipulá-las.

\hypertarget{classes}{%
\section{Classes}\label{classes}}

A classe de um objeto é muito importante dentro do R. É a partir dela que as funções e operadores conseguem saber exatamente o que fazer com um objeto.

Por exemplo, podemos somar dois números, mas não conseguimos somar duas letras (texto):

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1} \SpecialCharTok{+} \DecValTok{1}
\DocumentationTok{\#\# [1] 2}


\StringTok{"a"} \SpecialCharTok{+} \StringTok{"b"}
\DocumentationTok{\#\# Error in "a" + "b": non{-}numeric argument to binary operator}
\end{Highlighting}
\end{Shaded}

O operador \texttt{+} verifica que \texttt{"a"} e \texttt{"b"} não são números (ou que a classe deles não é numérica) e devolve uma mensagem de erro informando isso.

Observe que para criar texto no R, colocamos os caracteres entre aspas. As aspas servem para diferenciar \emph{nomes} (objetos, funções, pacotes) de \emph{textos} (letras e palavras). Os textos são muito comuns em variáveis categóricas e são popularmente chamados de \emph{strings} no contexto de programação.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \DecValTok{10}

\CommentTok{\# O objeto \textasciigrave{}a\textasciigrave{}, sem aspas}
\NormalTok{a}
\DocumentationTok{\#\# [1] 10}

\CommentTok{\# A letra (texto) \textasciigrave{}a\textasciigrave{}, com aspas}
\StringTok{"a"}
\DocumentationTok{\#\# [1] "a"}
\end{Highlighting}
\end{Shaded}

Para saber a classe de um objeto, basta rodarmos \texttt{class(nome-do-objeto)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}
\FunctionTok{class}\NormalTok{(x)}
\DocumentationTok{\#\# [1] "numeric"}

\NormalTok{y }\OtherTok{\textless{}{-}} \StringTok{"a"}
\FunctionTok{class}\NormalTok{(y)}
\DocumentationTok{\#\# [1] "character"}

\FunctionTok{class}\NormalTok{(mtcars)}
\DocumentationTok{\#\# [1] "data.frame"}
\end{Highlighting}
\end{Shaded}

As classes mais básicas dentro do R são:

\begin{itemize}
\tightlist
\item
  \emph{numeric}
\item
  \emph{character}
\item
  \emph{logical}
\end{itemize}

\begin{quote}
Geralmente serão utilizados como sinônimos:

\begin{itemize}
\tightlist
\item
  texto, string, \emph{character}, caracteres
\item
  número, valor real, \emph{numeric}, \emph{double}
\item
  lógico, \emph{logical}, booleano, valor TRUE/FALSE
\end{itemize}
\end{quote}

Veja alguns exemplos:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# numeric}
\DecValTok{1}
\FloatTok{0.10}
\FloatTok{0.95}
\NormalTok{pi}

\CommentTok{\# characters}
\StringTok{"a"}
\StringTok{"1"}
\StringTok{"positivo"}

\CommentTok{\# logical}
\ConstantTok{TRUE}
\ConstantTok{FALSE}
\end{Highlighting}
\end{Shaded}

Um objeto de qualquer uma dessas classes é chamado de \textbf{objeto atômico}.

Esse nome se deve ao fato de essas classes não se misturarem, isto é, para um objeto ter a classe \texttt{numeric}, por exemplo, todos os seus valores precisam ser numéricos.

Mas como atribuir mais de um valor a um mesmo objeto? Para isso, precisamos criar \textbf{vetores}.

\hypertarget{exercuxedcios-2}{%
\subsection{Exercícios}\label{exercuxedcios-2}}

\textbf{1.} Guarde em um objeto chamado \texttt{nome} uma \emph{string} contendo o seu nome completo.

\textbf{2.} Guarde em um objeto chamado \texttt{cidade} o nome da cidade onde você mora. Em seguida, guarde em um objeto chamado \texttt{estado} o nome do estado onde você mora. Usando esses objetos, resolva os itens abaixo:

\begin{itemize}
\item
  \textbf{a.} Utilize a função \texttt{nchar()} para contar o número de caracteres em cada cada string.
\item
  \textbf{b.} Interprete o resultado do seguinte código:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, estado)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{c.} Interprete o resultado do seguinte código:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, estado, }\AttributeTok{sep =} \StringTok{" {-} "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{d.} Desafio. Como você reproduziria o mesmo resultado do item (b) sem utilizar o argumento \texttt{sep}?
\item
  \textbf{e.} Qual a diferença entre as funções \texttt{paste()} e \texttt{paste0()}?
\end{itemize}

\hypertarget{vetores}{%
\section{Vetores}\label{vetores}}

Vetores são estruturas muito importantes dentro R. Em especial, pensando em análise de dados, precisamos estudá-los pois cada coluna de um \emph{data frame} será representada como um vetor.

Vetores no R são apenas \textbf{conjuntos indexados de valores}. Para criá-los, basta colocar os valores separados por vírgulas dentro de um \texttt{c()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{3}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{)}
\NormalTok{vetor2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)}

\NormalTok{vetor1}
\DocumentationTok{\#\# [1]   1   5   3 {-}10}
\NormalTok{vetor2}
\DocumentationTok{\#\# [1] "a" "b" "c"}
\end{Highlighting}
\end{Shaded}

Os objetos \texttt{vetor1} e \texttt{vetor2} são vetores.

Uma maneira fácil de criar um vetor com uma sequência de números é utilizar o operador \texttt{:}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vetor de 1 a 10}
\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}
\DocumentationTok{\#\#  [1]  1  2  3  4  5  6  7  8  9 10}

\CommentTok{\# Vetor de 10 a 1}
\DecValTok{10}\SpecialCharTok{:}\DecValTok{1}
\DocumentationTok{\#\#  [1] 10  9  8  7  6  5  4  3  2  1}

\CommentTok{\# Vetor de {-}3 a 3}
\SpecialCharTok{{-}}\DecValTok{3}\SpecialCharTok{:}\DecValTok{3}
\DocumentationTok{\#\# [1] {-}3 {-}2 {-}1  0  1  2  3}
\end{Highlighting}
\end{Shaded}

Quando dizemos que vetores são conjuntos \emph{indexados}, isso quer dizer que cada valor dentro de um vetor tem uma \textbf{posição}. Essa posição é dada pela ordem em que os elementos foram colocados no momento em que o vetor foi criado. Isso nos permite acessar individualmente cada valor de um vetor.

Para isso, colocamos o índice do valor que queremos acessar dentro de colchetes \texttt{{[}{]}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{)}

\NormalTok{vetor[}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\# [1] "a"}
\NormalTok{vetor[}\DecValTok{2}\NormalTok{]}
\DocumentationTok{\#\# [1] "b"}
\NormalTok{vetor[}\DecValTok{3}\NormalTok{]}
\DocumentationTok{\#\# [1] "c"}
\NormalTok{vetor[}\DecValTok{4}\NormalTok{]}
\DocumentationTok{\#\# [1] "d"}
\end{Highlighting}
\end{Shaded}

Você também pode colocar um conjunto de índices dentro dos colchetes, para pegar os valores contidos nessas posições:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor[}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)]}
\DocumentationTok{\#\# [1] "b" "c"}
\NormalTok{vetor[}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{)]}
\DocumentationTok{\#\# [1] "a" "b" "d"}
\end{Highlighting}
\end{Shaded}

Essa operação é conhecida como \emph{subsetting}, pois estamos pegando subconjuntos de valores de um vetor.

Se você tentar acessar uma posição do vetor que não existe, ele retornará \texttt{NA}, indicando que esse valor não existe. Discutiremos o que são \texttt{NA}'s na Seção \ref{valoresEspeciais}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor[}\DecValTok{5}\NormalTok{]}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Um vetor só pode guardar um tipo de objeto e ele terá sempre a mesma classe dos objetos que guarda. Para saber a classe de um vetor, rodamos \texttt{class(nome-do-vetor)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{3}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{)}
\NormalTok{vetor2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)}

\FunctionTok{class}\NormalTok{(vetor1)}
\DocumentationTok{\#\# [1] "numeric"}
\FunctionTok{class}\NormalTok{(vetor2)}
\DocumentationTok{\#\# [1] "character"}
\end{Highlighting}
\end{Shaded}

Se tentarmos misturar duas classes, o R vai apresentar o comportamento conhecido como \textbf{coerção}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\StringTok{"a"}\NormalTok{)}

\NormalTok{vetor}
\DocumentationTok{\#\# [1] "1" "2" "a"}
\FunctionTok{class}\NormalTok{(vetor)}
\DocumentationTok{\#\# [1] "character"}
\end{Highlighting}
\end{Shaded}

Veja que todos os elementos do vetor se transformaram em texto. Agora temos um vetor com o texto \texttt{"1"}, o texto \texttt{"2"} e o texto \texttt{"a"}. Como um vetor só pode ter uma classe de objeto dentro dele, classes mais fracas serão sempre reprimidas pelas classes mais fortes. Como regra de bolso: caracteres serão sempre a classe mais forte. Então, sempre que você misturar números e texto em um vetor, os números virarão texto.

Falaremos bastante de coerção nas próximas seções e capítulos, trazendo exemplos de quando ela ajuda e de quando ela atrapalha.

De forma bastante intuitiva, você pode fazer operações com vetores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{20}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{)}
\NormalTok{vetor }\SpecialCharTok{+} \DecValTok{1}
\DocumentationTok{\#\# [1]  1  6 21 {-}2}
\end{Highlighting}
\end{Shaded}

Ao rodarmos \texttt{vetor1\ +\ 1}, o R subtrai \texttt{1} de cada um dos elementos do vetor. O mesmo acontece com qualquer outra operação aritmética.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\SpecialCharTok{{-}} \DecValTok{1}
\NormalTok{vetor }\SpecialCharTok{/} \DecValTok{2}
\NormalTok{vetor }\SpecialCharTok{*} \DecValTok{10}
\end{Highlighting}
\end{Shaded}

Você também pode fazer operações que envolvem mais de um vetor:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{vetor2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{)}

\NormalTok{vetor1  }\SpecialCharTok{+}\NormalTok{ vetor2}
\DocumentationTok{\#\# [1] 11 22 33}
\end{Highlighting}
\end{Shaded}

Neste caso, o R irá alinhar os dois vetores e somar elemento a elemento. Esse tipo de comportamento é chamado de \textbf{vetorização}. Isso pode ficar um pouco confuso quando os dois vetores não possuem o mesmo tamanho. Tente adivinhar qual será a saída do código a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\NormalTok{vetor2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{40}\NormalTok{)}

\NormalTok{vetor1 }\SpecialCharTok{+}\NormalTok{ vetor2}
\DocumentationTok{\#\# [1] 11 22 31 42}
\end{Highlighting}
\end{Shaded}

Embora estejamos somando dois vetores de tamanho diferentes, o R não devolve um erro (o que parecia ser a resposta mais intuitiva). O R alinhou os dois vetores e, como eles não possuíam o mesmo tamanho, o primeiro foi repetido para ficar do mesmo tamanho do segundo. É como se o primeiro vetor fosse na verdade \texttt{c(1,\ 2,\ 1,\ 2)}. Esse comportamento é chamado de \textbf{reciclagem}.

Embora contra-intuitiva, a reciclagem é muito útil no R graças a um caso particular muito importante. Quando somamos \texttt{vetor\ +\ 1} no nosso primeiro exemplo, o que o R está fazendo por trás é transformando o \texttt{1} em \texttt{c(1,\ 1,\ 1,\ 1)} e realizando a soma vetorizada \texttt{c(0,\ 5,\ 20,\ -3)\ +\ c(1,\ 1,\ 1,\ 1)}. Isso porque o número \texttt{1} nada mais é do que um vetor de tamanho 1, isto é, \texttt{1} é igual a \texttt{c(1)}.

Usaremos esse comportamento no R o tempo todo e é muito importante a reciclagem para termos certeza de que o R está fazendo exatamente aquilo que gostaríamos que ele fizesse.

Um outro caso interessante de reciclagem é quando o comprimento dos vetores não são múltiplos um do outro.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{vetor2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{40}\NormalTok{, }\DecValTok{50}\NormalTok{)}

\NormalTok{vetor1 }\SpecialCharTok{+}\NormalTok{ vetor2}
\DocumentationTok{\#\# Warning in vetor1 + vetor2: longer object length is not a multiple of shorter}
\DocumentationTok{\#\# object length}
\DocumentationTok{\#\# [1] 11 22 33 41 52}
\end{Highlighting}
\end{Shaded}

Neste caso, duas coisas aconteceram:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  O R realizou a conta, repetindo cada valor do primeiro vetor até que os dois tenham o mesmo tamanho. No fundo, a operação realizada foi \texttt{c(1,\ 2,\ 3,\ 1,\ 2)\ +\ c(10,\ 20,\ 30,\ 40,\ 50)}.
\item
  Como essa operação é ainda menos intuitiva e raramente desejada, o R devolveu um aviso dizendo que o comprimento do primeiro vetor maior não é um múltiplo do comprimento do vetor menor.
\end{enumerate}

\hypertarget{exercuxedcios-3}{%
\subsection*{Exercícios}\label{exercuxedcios-3}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Guarde em um objeto a sequência de números de 0 a 5 e resolva os itens abaixos.

\begin{itemize}
\item
  \textbf{a.} Use subsetting para fazer o R devolver o primeiro número dessa sequência. Em seguida, faça o R devolver o último número da sequência.
\item
  \textbf{b.} Multiplique todos os valores do vetor por -1. Guarde o resultado em
  um novo objeto chamado \texttt{vetor\_negativo}.
\end{itemize}

\textbf{2.} Crie um vetor com o nome de tres \texttt{frutas}, guarde em um objeto chamado frutas e resolva os itens abaixo.

\begin{itemize}
\item
  \textbf{a.} Utilize a a função \texttt{length()} para verificar o tamanho do vetor.
\item
  \textbf{b.} Inspecione a saída de \texttt{paste("eu\ gosto\ de",\ frutas)} e responda se o tamanho do vetor mudou.
\end{itemize}

\textbf{3.} O que é reciclagem? Escreva um código em R que exemplifique esse comportamento.

\textbf{4.} O que é coerção? Escreva um código em R que exemplifique esse comportamento.

\textbf{5.} Por que a coerção pode ser um problema na hora de importarmos bases de dados para o R?

\textbf{6.} Use a função \texttt{sum()} para somar os valores de 1 a 100.

\textbf{7.} Considere o vetor booleano a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dolar\_subiu }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Este vetor tem informação de uma semana (7 dias, começando no domingo) indicando se o dólar subiu (TRUE) ou não subiu (FALSE) no respectivo dia. Interprete o resultado dos códigos abaixo:

\begin{itemize}
\item
  \textbf{a.} \texttt{length(dolar\_subiu)}
\item
  \textbf{b.} \texttt{dolar\_subiu{[}2{]}}
\item
  \textbf{c.} \texttt{sum(dolar\_subiu)}
\item
  \textbf{d.} \texttt{mean(dolar\_subiu)}
\end{itemize}

\hypertarget{testes-luxf3gicos}{%
\section{Testes lógicos}\label{testes-luxf3gicos}}

Poder fazer qualquer tipo de operação lógica é um dos motivos pelos quais programar nos deixar mais eficientes. Dê bastante atenção a elas, pois usaremos comparações lógicas o tempo todo!

Uma operação lógica nada mais é do que um teste que retorna \textbf{verdadeiro} ou \textbf{falso}. No R (e em outras linguagens de programação), esses valores dois valores recebem uma classe especial: \texttt{logical}.

O verdadeiro no R vai ser representado pelo valor \texttt{TRUE} e o falso pelo valor \texttt{FALSE}. Esses nomes no R são \textbf{reservados}, isto é, você não pode chamar nenhum objeto de TRUE ou FALSE.

\begin{Shaded}
\begin{Highlighting}[]
\ConstantTok{TRUE} \OtherTok{\textless{}{-}} \DecValTok{1}
\DocumentationTok{\#\# Error in TRUE \textless{}{-} 1 : invalid (do\_set) left{-}hand side to assignment}
\end{Highlighting}
\end{Shaded}

Checando a classe desses valores, vemos que são lógicos\footnote{Também conhecidos como valores binários ou booleanos}. Eles são os únicos possíveis valores dessa classe.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# [1] "logical"}
\FunctionTok{class}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}
\DocumentationTok{\#\# [1] "logical"}
\end{Highlighting}
\end{Shaded}

Agora que conhecemos o \texttt{TRUE} e \texttt{FALSE}, podemos explorar os teste lógicos. Começando pelo mais simples: vamos testar se um valor é igual ao outro. Para isso, usamos o operador \texttt{==}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Testes com resultado verdadeiro}
\DecValTok{1} \SpecialCharTok{==} \DecValTok{1}
\DocumentationTok{\#\# [1] TRUE}
\StringTok{"a"} \SpecialCharTok{==} \StringTok{"a"}
\DocumentationTok{\#\# [1] TRUE}

\CommentTok{\# Testes com resultado falso}
\DecValTok{1} \SpecialCharTok{==} \DecValTok{2}
\DocumentationTok{\#\# [1] FALSE}
\StringTok{"a"} \SpecialCharTok{==} \StringTok{"b"}
\DocumentationTok{\#\# [1] FALSE}
\end{Highlighting}
\end{Shaded}

Também podemos testar se dois valores são diferentes. Para isso, usamos o operador \texttt{!=}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Testes com resultado falso}
\DecValTok{1} \SpecialCharTok{!=} \DecValTok{1}
\DocumentationTok{\#\# [1] FALSE}
\StringTok{"a"} \SpecialCharTok{!=} \StringTok{"a"}
\DocumentationTok{\#\# [1] FALSE}

\CommentTok{\# Testes com resultado verdadeiro}
\DecValTok{1} \SpecialCharTok{!=} \DecValTok{2}
\DocumentationTok{\#\# [1] TRUE}
\StringTok{"a"} \SpecialCharTok{!=} \StringTok{"b"}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Para comparar se um valor é maior que outro, temos à disposição 4 operadores:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Maior}
\DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{3}
\DocumentationTok{\#\# [1] FALSE}
\DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{2}
\DocumentationTok{\#\# [1] TRUE}

\CommentTok{\# Maior ou igual}
\DecValTok{3} \SpecialCharTok{\textgreater{}} \DecValTok{4}
\DocumentationTok{\#\# [1] FALSE}
\DecValTok{3} \SpecialCharTok{\textgreater{}=} \DecValTok{3}
\DocumentationTok{\#\# [1] TRUE}

\CommentTok{\# Menor }
\DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{3}
\DocumentationTok{\#\# [1] FALSE}
\DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{4}
\DocumentationTok{\#\# [1] TRUE}

\CommentTok{\# Menor ou igual}
\DecValTok{3} \SpecialCharTok{\textless{}} \DecValTok{2}
\DocumentationTok{\#\# [1] FALSE}
\DecValTok{3} \SpecialCharTok{\textless{}=} \DecValTok{3}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Um outro operador muito útil é o \texttt{\%in\%}. Com ele, podemos verificar se um valor está dentro de um conjunto de valores (vetor).

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3} \SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}
\StringTok{"a"} \SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)}
\DocumentationTok{\#\# [1] FALSE}
\end{Highlighting}
\end{Shaded}

Nós começamos essa seção dizendo que usaremos testes lógicos o tempo todo. O motivo para isso é que eles fazem parte de uma operação muito comum na manipulação de base de dados: os \textbf{filtros}.

No Excel, por exemplo, quando você filtra uma planilha, o que está sendo feito por trás é um teste lógico.

Falamos anteriormente que cada coluna das nossas bases de dados será representada dentro do R como um vetor. O comportamento que explica a importância dos testes lógicos na hora de filtrar uma base está ilustrado abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minha\_coluna }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{20}\NormalTok{)}

\NormalTok{minha\_coluna }\SpecialCharTok{\textgreater{}} \DecValTok{3}
\DocumentationTok{\#\# [1] FALSE FALSE FALSE  TRUE FALSE  TRUE  TRUE}

\NormalTok{minha\_coluna[minha\_coluna }\SpecialCharTok{\textgreater{}} \DecValTok{3}\NormalTok{]}
\DocumentationTok{\#\# [1] 10  5 20}
\end{Highlighting}
\end{Shaded}

Muitas coisas aconteceram aqui, vamos por partes.

Primeiro, na operação \texttt{minha\_coluna\ \textgreater{}\ 3} o R fez um excelente uso do comportamento de reciclagem. No fundo, o que ele fez foi transformar (reciclar) o valor \texttt{3} no vetor \texttt{c(3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3)} e testar se \texttt{c(1,\ 3,\ 0,\ 10,\ -1,\ 5,\ 20)\ \textgreater{}\ c(3,\ 3,\ 3,\ 3,\ 3,\ 3,\ 3)}.

Como os operadores lógicos também são vetorizados (fazem operações elemento a elemento), os testes realizados foram \texttt{1\ \textgreater{}\ 3}, \texttt{3\ \textgreater{}\ 3}, \texttt{0\ \textgreater{}\ 3}, \texttt{10\ \textgreater{}\ 3}, \texttt{-1\ \textgreater{}\ 3}, \texttt{5\ \textgreater{}\ 3} e, finalmente, \texttt{20\ \textgreater{}\ 3}. Cada um desses testes tem o seu próprio resultado. Por isso a saída de \texttt{minha\_coluna\ \textgreater{}\ 3} é um vetor de verdadeiros e falsos, respectivos a cada um desses 7 testes.

A segunda operação traz a grande novidade aqui: podemos usar os valores \texttt{TRUE} e \texttt{FALSE} para selecionar elementos de um vetor!

A regra é muito simples: \textbf{retornar} as posições que receberem \texttt{TRUE}, \textbf{não retornar} as posições que receberem \texttt{FALSE}. Portanto, a segunda operação é equivalente a:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minha\_coluna[}\FunctionTok{c}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)]}
\DocumentationTok{\#\# [1] 10  5 20}
\end{Highlighting}
\end{Shaded}

O vetor lógico filtra o vetor \texttt{minha\_coluna}, retornando apenas os valores maiores que 3, já que foi esse o teste lógico que fizemos.

Essa é a \emph{mágica} que acontece por trás de filtros no R. Na prática, não precisaremos usar colchetes, não lembraremos da reciclagem e nem veremos a cara dos \texttt{TRUE} e \texttt{FALSE}. Mas conhecer esse processo é muito importante, principalmente para encontrar problemas de código ou de base.

A seguir, apresentamos uma tabela com os principais operadores lógicos:

Para finalizar, listamos na tabela abaixo os principais operadores lógicos.

\begin{tabular}{l|l}
\hline
Operador & Descrição\\
\hline
x < y & x menor que y?\\
\hline
x <= y & x menor ou igual a y?\\
\hline
x > y & x maior que y?\\
\hline
x >= y & x maior ou igual a y?\\
\hline
x == y & x igual a y?\\
\hline
x != y & x diferente de y?\\
\hline
!x & Negativa de x\\
\hline
x | y & x ou y são verdadeiros?\\
\hline
x \& y & x e y são verdadeiros?\\
\hline
x \%in\% y & x percente a y?\\
\hline
xor(x, y) & x ou y são verdadeiros (apenas um deles)?\\
\hline
\end{tabular}

Por fim, veja algumas diferenças entre comparações lógicas no SQL e no R:

\begin{itemize}
\tightlist
\item
  \textbf{Igualdade}: no SQL é só um sinal de igual: \texttt{2\ =\ 1}. No R são dois: \texttt{2\ ==\ 1}.
\item
  \textbf{Diferença}: no SQL, usamos \texttt{\textless{}\textgreater{}}. No R usamos \texttt{!=}.
\item
  \textbf{Negação}: em vez de usar a palavra \texttt{NOT} igual ao SQL, usamos \texttt{!} no R. Por exemplo, \texttt{id\ not\ in\ (\textquotesingle{}1\textquotesingle{},\ \textquotesingle{}2\textquotesingle{},\ \textquotesingle{}3\textquotesingle{})} fica \texttt{!(id\ \%in\%\ c(1,\ 2,\ 3))}.
\end{itemize}

\hypertarget{exercuxedcios-4}{%
\subsection*{Exercícios}\label{exercuxedcios-4}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1} O código abaixo vai guardar no objeto \texttt{segredo} um número inteiro entre 0 e 10. Sem olhar qual número foi guardado no objeto, resolva os itens a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(}\FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{min =} \DecValTok{0}\NormalTok{, }\AttributeTok{max =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{a.} Teste se o segredo é maior ou igual a 0.
\item
  \textbf{b.} Teste se o segredo é menor ou igual a 10.
\item
  \textbf{c.} Teste se o segredo é maior que 5.
\item
  \textbf{d.} Teste se o segredo é par.
\item
  \textbf{e.} Teste se \texttt{segredo\ *\ 5} é maior que a sua idade.
\item
  \textbf{f.} Desafio. Escreva um teste para descobrir o valor do segredo.
\end{itemize}

\textbf{2.} Escreva um código em R que devolva apenas os valores maiores
ou iguais a 10 do vetor abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{23}\NormalTok{, }\DecValTok{42}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{3.} Use o vetor numeross abaixo para responder as questoes seguintes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numeros }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{4}\SpecialCharTok{:}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{a.} Escreva um código que devolva apenas valores positivos do vetor \texttt{numeros}.
\item
  \textbf{b.} Escreva um código que devolta apenas os valores pares do vetor \texttt{numeros}.
\item
  \textbf{c.} Filtre o vetor para que retorne apenas aqueles valores que, quando elevados a 2, são menores do que 4.
\end{itemize}

\hypertarget{valoresEspeciais}{%
\section{Valores especiais}\label{valoresEspeciais}}

Vimos anteriormente que se você tentar acessar uma posição que não existe dentro de um vetor, ele retorna um valor estranho.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\NormalTok{vetor[}\DecValTok{4}\NormalTok{]}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Esse valor, o \texttt{NA}, é tratado de forma especial no R. Ele representa a \emph{ausência de informação}, isto é, a informação existe, mas nós (e o R) não sabemos qual é.

O \texttt{NA} para o R nada mais é do que o valor faltante ou omisso da Estatística. O famoso \emph{missing}. Geralmente, quando temos uma base com valores faltando, como a idade para alguns indivíduos da nossa amostra, não significa que a idade deles não existe. Significa apenas que não temos essa informação.

Esse conceito é muito importante para entender o resultado da expressão abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{5} \SpecialCharTok{==} \ConstantTok{NA}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Em um primeiro momento, poderíamos esperar que o resultado fosse \texttt{TRUE}. Mas, sabendo o significado por trás do \texttt{NA} --- um valor desconhecido ---, a verdadeira pergunta que estamos fazendo é: 5 é igual a um valor que existe, mas que não sei qual é? É como se eu perguntasse se eu tenho 5 moedas na mão, mas lhe mostrasse a mão fechada. A resposta para isso é \emph{não sei} ou, dentro do R, \texttt{NA}.

Um outro exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idade\_ana }\OtherTok{\textless{}{-}} \DecValTok{30}
\NormalTok{idade\_beto }\OtherTok{\textless{}{-}} \ConstantTok{NA}
\NormalTok{idade\_carla }\OtherTok{\textless{}{-}} \ConstantTok{NA}

\NormalTok{idade\_ana }\SpecialCharTok{==}\NormalTok{ idade\_beto}
\DocumentationTok{\#\# [1] NA}

\NormalTok{idade\_beto }\SpecialCharTok{==}\NormalTok{ idade\_carla}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Eu posso saber a idade da Ana, mas se eu não souber a idade do Beto, não sei se os dois tem a mesma idade. Por isso, \texttt{NA}. Da mesma forma, se não sei nem a idade do Beto nem da Carla, também não tenho como saber se os dois têm a mesma idade. Outra vez \texttt{NA}.

Mas e quando queremos saber se um valor é NA ou não? Para fazer esse teste, temos que rodar \texttt{is.na(valor-ou-objeto)}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(}\ConstantTok{NA}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}

\FunctionTok{is.na}\NormalTok{(idade\_ana)}
\DocumentationTok{\#\# [1] FALSE}

\FunctionTok{is.na}\NormalTok{(idade\_beto)}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Repare que essa função também é vetorizada.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is.na}\NormalTok{(}\FunctionTok{c}\NormalTok{(idade\_ana, idade\_beto, idade\_carla))}
\DocumentationTok{\#\# [1] FALSE  TRUE  TRUE}
\end{Highlighting}
\end{Shaded}

Assim como o \texttt{NA}, existem outros valores especiais muito comuns no R.

O \texttt{NaN} (\emph{not a number}) representa indefinições matemáticas.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{0}\SpecialCharTok{/}\DecValTok{0}
\DocumentationTok{\#\# [1] NaN}

\FunctionTok{log}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{)}
\DocumentationTok{\#\# Warning in log({-}1): NaNs produced}
\DocumentationTok{\#\# [1] NaN}
\end{Highlighting}
\end{Shaded}

O \texttt{Inf} (infinito) representa um número muito grande (que o computador não consegue representar) ou um limite matemático.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O computador não consegue representar um número tão grande.}
\CommentTok{\# O número é então """arredondado""" para infinito.}
\DecValTok{10}\SpecialCharTok{\^{}}\DecValTok{310}
\DocumentationTok{\#\# [1] Inf}

\CommentTok{\# Limite matemático.}
\DecValTok{1} \SpecialCharTok{/} \DecValTok{0}
\DocumentationTok{\#\# [1] Inf}

\CommentTok{\# O "menos infinito" também existe.}
\SpecialCharTok{{-}}\DecValTok{1} \SpecialCharTok{/} \DecValTok{0}
\DocumentationTok{\#\# [1] {-}Inf}
\end{Highlighting}
\end{Shaded}

O \texttt{NULL} (nulo) representa a ausência de um objeto. Ele não tem significado prático para a análise dados. Está mais em sintonia com comportamentos de lógica de programação. Muitas vezes vamos definir um objeto como nulo para dizer ao R que não queremos dar um valor para ele. Muito utilizado em funções.

Da mesma forma que utilizados \texttt{is.na()} para testar se um objeto é \texttt{NA}, utilizamos \texttt{is.nan()}, \texttt{is.infinite()} ou \texttt{is.null()} para testar se um objeto é \texttt{NaN}, infinito ou nulo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nao\_sou\_um\_numero }\OtherTok{\textless{}{-}} \ConstantTok{NaN}
\NormalTok{objeto\_infinito }\OtherTok{\textless{}{-}} \ConstantTok{Inf}
\NormalTok{objeto\_nulo }\OtherTok{\textless{}{-}} \ConstantTok{NULL}

\FunctionTok{is.nan}\NormalTok{(nao\_sou\_um\_numero)}
\DocumentationTok{\#\# [1] TRUE}

\FunctionTok{is.infinite}\NormalTok{(objeto\_infinito)}
\DocumentationTok{\#\# [1] TRUE}

\FunctionTok{is.null}\NormalTok{(objeto\_nulo)}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

\hypertarget{exercuxedcios-5}{%
\subsection*{Exercícios}\label{exercuxedcios-5}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Quais as diferenças entre \texttt{NaN}, \texttt{NULL}, \texttt{NA} e \texttt{Inf}? Digite expressões que retornem cada um desses valores.

\textbf{2.} Escreva um código que conte o número de \texttt{NAs} do vetor \texttt{b}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{7}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{2}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{listas}{%
\section{Listas}\label{listas}}

Chegamos ao último tópico antes de voltarmos aos data frames: as listas.

Listas são objetos muito importantes dentro do R. Primeiro porque \textbf{todo data frame é uma lista}. Segundo porque elas são bem parecidas com vetores, mas com uma diferença essencial: você pode misturar diferentes classes de objetos dentro dela.

Para criar uma lista, rodamos \texttt{list(valor1,\ valor2,\ valor3)}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[2]]}
\DocumentationTok{\#\# [1] "a"}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[3]]}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

Veja que não houve coerção. Ainda temos um valor número, um texto e um valor lógico dentro da lista.

O \emph{subsetting} de listas é um pouco diferente do que o de vetores. Isso porque \textbf{cada elemento de uma lista também é uma lista}. Veja o que acontece se tentarmos usar \texttt{{[}{]}} para pegar um elemento de uma lista.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lista }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}

\NormalTok{lista[}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] 1}

\FunctionTok{class}\NormalTok{(lista[}\DecValTok{1}\NormalTok{])}
\DocumentationTok{\#\# [1] "list"}
\end{Highlighting}
\end{Shaded}

O R nos retorna uma lista com apenas aquele elemento. Se quisermos o elemento de fato dentro de cada posição, precisamos usar dois colchetes:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lista[[}\DecValTok{1}\NormalTok{]]}
\DocumentationTok{\#\# [1] 1}

\FunctionTok{class}\NormalTok{(lista[[}\DecValTok{1}\NormalTok{]])}
\DocumentationTok{\#\# [1] "numeric"}
\end{Highlighting}
\end{Shaded}

Cada elemento de uma lista ser uma lista é importante pois isso nos permite colocar vetores de tamanhos diferentes em cada posição. Isso faz das listas uma estrutura bem flexível para guardar dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lista }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{))}

\NormalTok{lista}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] 1 2 3}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[2]]}
\DocumentationTok{\#\# [1] "a"}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[3]]}
\DocumentationTok{\#\# [1]  TRUE  TRUE FALSE FALSE}

\NormalTok{lista[}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] 1 2 3}

\NormalTok{lista[}\DecValTok{2}\NormalTok{]}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] "a"}

\NormalTok{lista[}\DecValTok{3}\NormalTok{]}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1]  TRUE  TRUE FALSE FALSE}
\end{Highlighting}
\end{Shaded}

É muito comum darmos nomes para cada posição de uma lista.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_cliente }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{cliente =} \StringTok{"Ana Silva"}\NormalTok{, }\AttributeTok{idade =} \DecValTok{25}\NormalTok{, }\AttributeTok{estado\_civil =} \ConstantTok{NA}\NormalTok{)}

\NormalTok{dados\_cliente}
\DocumentationTok{\#\# $cliente}
\DocumentationTok{\#\# [1] "Ana Silva"}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $idade}
\DocumentationTok{\#\# [1] 25}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $estado\_civil}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Agora, dentro da lista, o valor \texttt{Ana\ Silva}, por exemplo, está sendo atribuído ao nome \texttt{cliente}. Esse nome só existirá dentro da lista.

Um detalhe importante: os iguais utilizados nas atribuições dos nomes dentro da lista \textbf{não podem} ser substituídos por \texttt{\textless{}-}.

Quando as posições de uma lista tem nome, podemos acessar seus valores diretamente utilizando o operador \texttt{\$}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_cliente}\SpecialCharTok{$}\NormalTok{cliente}
\DocumentationTok{\#\# [1] "Ana Silva"}

\NormalTok{dados\_cliente}\SpecialCharTok{$}\NormalTok{idade}
\DocumentationTok{\#\# [1] 25}

\NormalTok{dados\_cliente}\SpecialCharTok{$}\NormalTok{estado\_civil}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Repare que o R devolve o valor dentro de cada posição, e não uma lista.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_cliente[}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\# $cliente}
\DocumentationTok{\#\# [1] "Ana Silva"}

\NormalTok{dados\_cliente}\SpecialCharTok{$}\NormalTok{cliente}
\DocumentationTok{\#\# [1] "Ana Silva"}

\FunctionTok{class}\NormalTok{(dados\_cliente[}\DecValTok{1}\NormalTok{])}
\DocumentationTok{\#\# [1] "list"}

\FunctionTok{class}\NormalTok{(dados\_cliente}\SpecialCharTok{$}\NormalTok{cliente)}
\DocumentationTok{\#\# [1] "character"}
\end{Highlighting}
\end{Shaded}

Isto implica que, nesse exemplo, \texttt{dados\_cliente\$cliente} é equivalente a \texttt{dados\_cliente{[}{[}1{]}{]}}.

Conforme ficamos mais e mais proficientes na linguagem R, as listas passam a ficar cada vez mais frequentes. Voltaremos a falar delas diversas vezes nos próximos capítulos, em especial no Capítulo \ref{funcionais}.

\hypertarget{mais-sobre-data-frames}{%
\section{Mais sobre data frames}\label{mais-sobre-data-frames}}

Chegou a hora de usarmos tudo o que aprendemos na seção anterior para exploramos ao máximo o nosso objeto favorito: o \emph{data frame}.

Na seção anterior, nós dissemos que \emph{data frames} são listas. Isso é importante pois todas as propriedades de uma lista valem para um \emph{data frame}.

A melhor forma de entender essa equivalência é ver um \emph{data frame} representado como uma lista.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as.list}\NormalTok{(mtcars)}
\DocumentationTok{\#\# $mpg}
\DocumentationTok{\#\#  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4}
\DocumentationTok{\#\# [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7}
\DocumentationTok{\#\# [31] 15.0 21.4}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $cyl}
\DocumentationTok{\#\#  [1] 6 6 4 6 8 6 8 4 4 6 6 8 8 8 8 8 8 4 4 4 4 8 8 8 8 4 4 4 8 6 8 4}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $disp}
\DocumentationTok{\#\#  [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8}
\DocumentationTok{\#\# [13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0}
\DocumentationTok{\#\# [25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $hp}
\DocumentationTok{\#\#  [1] 110 110  93 110 175 105 245  62  95 123 123 180 180 180 205 215 230  66  52}
\DocumentationTok{\#\# [20]  65  97 150 150 245 175  66  91 113 264 175 335 109}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $drat}
\DocumentationTok{\#\#  [1] 3.90 3.90 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 3.92 3.07 3.07 3.07 2.93}
\DocumentationTok{\#\# [16] 3.00 3.23 4.08 4.93 4.22 3.70 2.76 3.15 3.73 3.08 4.08 4.43 3.77 4.22 3.62}
\DocumentationTok{\#\# [31] 3.54 4.11}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $wt}
\DocumentationTok{\#\#  [1] 2.620 2.875 2.320 3.215 3.440 3.460 3.570 3.190 3.150 3.440 3.440 4.070}
\DocumentationTok{\#\# [13] 3.730 3.780 5.250 5.424 5.345 2.200 1.615 1.835 2.465 3.520 3.435 3.840}
\DocumentationTok{\#\# [25] 3.845 1.935 2.140 1.513 3.170 2.770 3.570 2.780}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $qsec}
\DocumentationTok{\#\#  [1] 16.46 17.02 18.61 19.44 17.02 20.22 15.84 20.00 22.90 18.30 18.90 17.40}
\DocumentationTok{\#\# [13] 17.60 18.00 17.98 17.82 17.42 19.47 18.52 19.90 20.01 16.87 17.30 15.41}
\DocumentationTok{\#\# [25] 17.05 18.90 16.70 16.90 14.50 15.50 14.60 18.60}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $vs}
\DocumentationTok{\#\#  [1] 0 0 1 1 0 1 0 1 1 1 1 0 0 0 0 0 0 1 1 1 1 0 0 0 0 1 0 1 0 0 0 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $am}
\DocumentationTok{\#\#  [1] 1 1 1 0 0 0 0 0 0 0 0 0 0 0 0 0 0 1 1 1 0 0 0 0 0 1 1 1 1 1 1 1}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $gear}
\DocumentationTok{\#\#  [1] 4 4 4 3 3 3 3 4 4 4 4 3 3 3 3 3 3 4 4 4 3 3 3 3 3 4 5 5 5 5 5 4}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $carb}
\DocumentationTok{\#\#  [1] 4 4 1 1 2 1 4 2 2 4 4 3 3 3 4 4 4 1 2 1 1 2 2 4 2 1 2 2 4 6 8 2}
\end{Highlighting}
\end{Shaded}

O código acima nos permite ver o \emph{data frame} \texttt{mtcars} representado como uma lista. Veja que cada coluna da base se transforma em um elemento da lista. E o nome de cada coluna vira o nome de cada posição. Isso é interessante, pois podemos usar nos \emph{data frames} as mesmas operações que aprendemos para listas.

Por exemplo, podemos usar o operador \texttt{\$} para acessar cada elemento da lista, isto é, cada coluna do \emph{data frame}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}\SpecialCharTok{$}\NormalTok{mpg}
\DocumentationTok{\#\#  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4}
\DocumentationTok{\#\# [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7}
\DocumentationTok{\#\# [31] 15.0 21.4}
\end{Highlighting}
\end{Shaded}

E assim como cada elemento de uma lista também é uma lista, cada elemento (coluna) de um \emph{data frame} também é um *data frame.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\#                      mpg}
\DocumentationTok{\#\# Mazda RX4           21.0}
\DocumentationTok{\#\# Mazda RX4 Wag       21.0}
\DocumentationTok{\#\# Datsun 710          22.8}
\DocumentationTok{\#\# Hornet 4 Drive      21.4}
\DocumentationTok{\#\# Hornet Sportabout   18.7}
\DocumentationTok{\#\# Valiant             18.1}
\DocumentationTok{\#\# Duster 360          14.3}
\DocumentationTok{\#\# Merc 240D           24.4}
\DocumentationTok{\#\# Merc 230            22.8}
\DocumentationTok{\#\# Merc 280            19.2}
\DocumentationTok{\#\# Merc 280C           17.8}
\DocumentationTok{\#\# Merc 450SE          16.4}
\DocumentationTok{\#\# Merc 450SL          17.3}
\DocumentationTok{\#\# Merc 450SLC         15.2}
\DocumentationTok{\#\# Cadillac Fleetwood  10.4}
\DocumentationTok{\#\# Lincoln Continental 10.4}
\DocumentationTok{\#\# Chrysler Imperial   14.7}
\DocumentationTok{\#\# Fiat 128            32.4}
\DocumentationTok{\#\# Honda Civic         30.4}
\DocumentationTok{\#\# Toyota Corolla      33.9}
\DocumentationTok{\#\# Toyota Corona       21.5}
\DocumentationTok{\#\# Dodge Challenger    15.5}
\DocumentationTok{\#\# AMC Javelin         15.2}
\DocumentationTok{\#\# Camaro Z28          13.3}
\DocumentationTok{\#\# Pontiac Firebird    19.2}
\DocumentationTok{\#\# Fiat X1{-}9           27.3}
\DocumentationTok{\#\# Porsche 914{-}2       26.0}
\DocumentationTok{\#\# Lotus Europa        30.4}
\DocumentationTok{\#\# Ford Pantera L      15.8}
\DocumentationTok{\#\# Ferrari Dino        19.7}
\DocumentationTok{\#\# Maserati Bora       15.0}
\DocumentationTok{\#\# Volvo 142E          21.4}

\FunctionTok{class}\NormalTok{(mtcars[}\DecValTok{1}\NormalTok{])}
\DocumentationTok{\#\# [1] "data.frame"}
\end{Highlighting}
\end{Shaded}

Mas se \emph{data frames} são listas, por que existe a classe \emph{data frame}? Na verdade, \emph{data frames} são um tipo especial de listas, que têm as seguintes propriedades:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\item
  Todos os seus elementos (colunas) precisam ter o mesmo comprimento (número de linhas).
\item
  Todos os seus elementos (colunas) precisam ser nomeados.
\item
  \emph{Data frames} têm 2 dimensões.
\end{enumerate}

As propriedades (1) e (2) se devem ao formato das bases de dados. Elas são retangulares\footnote{Também existem bases não retangulares, como dados de imagens por exemplos, mas não trataremos dessas estruturas neste livro.} --- observamos as mesmas variáveis (colunas) para todas as unidades amostrais (linhas)\footnote{Mesmo quando uma variável não existe para uma unidade amostral, representamos esse valor como um \emph{missing}} ---, e precisam ter algum nome especificando as colunas.

Da mesma forma que podemos ver um \emph{data frame} como uma lista, também podemos fazer o inverso.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_cliente }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{cliente =} \FunctionTok{c}\NormalTok{(}\StringTok{"Ana Silva"}\NormalTok{, }\StringTok{"Beto Pereira"}\NormalTok{, }\StringTok{"Carla Souza"}\NormalTok{),}
  \AttributeTok{idade =} \FunctionTok{c}\NormalTok{(}\DecValTok{25}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{23}\NormalTok{),}
  \AttributeTok{estado\_civil =} \FunctionTok{c}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\StringTok{"Solteiro"}\NormalTok{, }\StringTok{"Casada"}\NormalTok{)}
\NormalTok{)}

\NormalTok{dados\_cliente }
\DocumentationTok{\#\# $cliente}
\DocumentationTok{\#\# [1] "Ana Silva"    "Beto Pereira" "Carla Souza" }
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $idade}
\DocumentationTok{\#\# [1] 25 30 23}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $estado\_civil}
\DocumentationTok{\#\# [1] NA         "Solteiro" "Casada"}

\FunctionTok{as.data.frame}\NormalTok{(dados\_cliente)}
\DocumentationTok{\#\#        cliente idade estado\_civil}
\DocumentationTok{\#\# 1    Ana Silva    25         \textless{}NA\textgreater{}}
\DocumentationTok{\#\# 2 Beto Pereira    30     Solteiro}
\DocumentationTok{\#\# 3  Carla Souza    23       Casada}
\end{Highlighting}
\end{Shaded}

Quando tivermos valores faltantes na nossa base (células vazias no Excel), eles serão representados por \texttt{NA} nos \emph{data frames}.

Observe que não conseguimos transformar uma lista em \emph{data frame} se os elementos da lista não tiverem o mesmo comprimento.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_cliente }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \AttributeTok{cliente =} \FunctionTok{c}\NormalTok{(}\StringTok{"Ana Silva"}\NormalTok{, }\StringTok{"Beto Pereira"}\NormalTok{, }\StringTok{"Carla Souza"}\NormalTok{),}
  \AttributeTok{idade =} \FunctionTok{c}\NormalTok{(}\DecValTok{25}\NormalTok{, }\DecValTok{30}\NormalTok{),}
  \AttributeTok{estado\_civil =} \FunctionTok{c}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\StringTok{"Solteiro"}\NormalTok{, }\StringTok{"Casada"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{as.data.frame}\NormalTok{(dados\_cliente)}
\DocumentationTok{\#\# Error in (function (..., row.names = NULL, check.rows = FALSE, check.names = TRUE, : arguments imply differing number of rows: 3, 2}
\end{Highlighting}
\end{Shaded}

Transformar uma lista não nomeada em \emph{data frame} é possível, mas o R cria nomes nada agradáveis para as colunas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_cliente }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}
  \FunctionTok{c}\NormalTok{(}\StringTok{"Ana Silva"}\NormalTok{, }\StringTok{"Beto Pereira"}\NormalTok{, }\StringTok{"Carla Souza"}\NormalTok{),}
  \FunctionTok{c}\NormalTok{(}\DecValTok{25}\NormalTok{, }\DecValTok{30}\NormalTok{, }\DecValTok{23}\NormalTok{),}
  \FunctionTok{c}\NormalTok{(}\ConstantTok{NA}\NormalTok{, }\StringTok{"Solteiro"}\NormalTok{, }\StringTok{"Casada"}\NormalTok{)}
\NormalTok{)}

\FunctionTok{as.data.frame}\NormalTok{(dados\_cliente)}
\DocumentationTok{\#\#   c..Ana.Silva....Beto.Pereira....Carla.Souza.. c.25..30..23.}
\DocumentationTok{\#\# 1                                     Ana Silva            25}
\DocumentationTok{\#\# 2                                  Beto Pereira            30}
\DocumentationTok{\#\# 3                                   Carla Souza            23}
\DocumentationTok{\#\#   c.NA...Solteiro....Casada..}
\DocumentationTok{\#\# 1                        \textless{}NA\textgreater{}}
\DocumentationTok{\#\# 2                    Solteiro}
\DocumentationTok{\#\# 3                      Casada}
\end{Highlighting}
\end{Shaded}

A propriedade (3) é atribuída aos \emph{data frames} para que possamos aproveitar melhor dessa estrutura retangular dentro do R. Na prática, essas duas dimensões representam nada mais que as linhas e as colunas da base. Essa é a maior diferença entre uma lista e um \emph{data frame}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{class}\NormalTok{(mtcars)}
\DocumentationTok{\#\# [1] "data.frame"}

\FunctionTok{dim}\NormalTok{(mtcars)}
\DocumentationTok{\#\# [1] 32 11}
\end{Highlighting}
\end{Shaded}

O resultado do código \texttt{dim(mtcars)} nos dá as seguintes informações:

\begin{itemize}
\item
  O \emph{data frame} mtcars tem duas dimensões (como todo \emph{data frame}).
\item
  A primeira dimensão tem comprimento 32 e a segunda dimensão tem comprimento 11. Em outras palavras: a base \texttt{mtcars} tem 32 linhas e 11 colunas.
\end{itemize}

Veja a seguir que listas não têm dimensão.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars\_como\_lista }\OtherTok{\textless{}{-}} \FunctionTok{as.list}\NormalTok{(mtcars)}

\FunctionTok{class}\NormalTok{(mtcars\_como\_lista)}
\DocumentationTok{\#\# [1] "list"}

\FunctionTok{dim}\NormalTok{(mtcars\_como\_lista)}
\DocumentationTok{\#\# NULL}
\end{Highlighting}
\end{Shaded}

Ter duas dimensões significa que devemos usar dois índices para acessar os valores de um \emph{data frame} (fazer \emph{subsetting}). Para isso, ainda usamos o colchete, mas agora com dois argumentos: \texttt{{[}linha,\ coluna{]}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[}\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{]}
\DocumentationTok{\#\# [1] 160}
\end{Highlighting}
\end{Shaded}

O código acima está nos devolvendo o valor presente na segunda linha da terceira coluna da base \texttt{mtcars}.

Também podemos pegar todos as linhas de uma coluna ou todas as colunas de uma linha deixando um dos argumentos vazio:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Todas as linhas da coluna 1}
\NormalTok{mtcars[,}\DecValTok{1}\NormalTok{]}
\DocumentationTok{\#\#  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4}
\DocumentationTok{\#\# [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7}
\DocumentationTok{\#\# [31] 15.0 21.4}

\CommentTok{\# Todas as colunas da linha 1}
\NormalTok{mtcars[}\DecValTok{1}\NormalTok{,]}
\DocumentationTok{\#\#           mpg cyl disp  hp drat   wt  qsec vs am gear carb}
\DocumentationTok{\#\# Mazda RX4  21   6  160 110  3.9 2.62 16.46  0  1    4    4}
\end{Highlighting}
\end{Shaded}

Por fim, lembrando que dento de cada coluna temos um vetor, podemos usar os testes lógicos para filtrar as linhas do nosso \emph{data frame} conforme alguma regra.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}\SpecialCharTok{$}\NormalTok{cyl }\SpecialCharTok{==} \DecValTok{4}
\DocumentationTok{\#\#  [1] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE  TRUE  TRUE FALSE FALSE FALSE}
\DocumentationTok{\#\# [13] FALSE FALSE FALSE FALSE FALSE  TRUE  TRUE  TRUE  TRUE FALSE FALSE FALSE}
\DocumentationTok{\#\# [25] FALSE  TRUE  TRUE  TRUE FALSE FALSE FALSE  TRUE}

\NormalTok{mtcars[mtcars}\SpecialCharTok{$}\NormalTok{cyl }\SpecialCharTok{==} \DecValTok{4}\NormalTok{, ]}
\DocumentationTok{\#\#                 mpg cyl  disp  hp drat    wt  qsec vs am gear carb}
\DocumentationTok{\#\# Datsun 710     22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1}
\DocumentationTok{\#\# Merc 240D      24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2}
\DocumentationTok{\#\# Merc 230       22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2}
\DocumentationTok{\#\# Fiat 128       32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1}
\DocumentationTok{\#\# Honda Civic    30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2}
\DocumentationTok{\#\# Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1}
\DocumentationTok{\#\# Toyota Corona  21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1}
\DocumentationTok{\#\# Fiat X1{-}9      27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1}
\DocumentationTok{\#\# Porsche 914{-}2  26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2}
\DocumentationTok{\#\# Lotus Europa   30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2}
\DocumentationTok{\#\# Volvo 142E     21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2}
\end{Highlighting}
\end{Shaded}

O código \texttt{mtcars\$cyl\ ==\ 4} nos diz em quais linhas estão os carros com 4 cilindros. Quando usamos o vetor de \texttt{TRUE} e \texttt{FALSE} resultante dentro do \emph{subsetting} das linhas em \texttt{mtcars{[}mtcars\$cyl\ ==\ 4,\ {]}}, o R nos devolve todos as colunas dos carros com 4 cilindros. A regra é simples: linha com \texttt{TRUE} é retornada, linha com \texttt{FALSE} não.

Encerramos aqui a nossa primeira conversa sobre \texttt{data\ frames} para falar de outra estrutura muito importante dentro do R: as funções.

\hypertarget{exercuxedcios-6}{%
\subsection*{Exercícios}\label{exercuxedcios-6}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Quais códigos abaixo retornam \textbf{um vetor} com a coluna \texttt{mpg} do data frame \texttt{mtcars}?

\begin{itemize}
\item
  \textbf{a.} \texttt{mtcars\$mpg}
\item
  \textbf{b.} \texttt{mtcars{[}\ ,\ 3{]}}
\item
  \textbf{c.} \texttt{mtcars("mpg")}
\item
  \textbf{d.} \texttt{mtcars{[}\ ,\ "mpg"{]}}
\item
  \textbf{e.} \texttt{mtcars.mpg}
\item
  \textbf{f.} \texttt{mtcars{[}\ ,\ 1{]}}
\item
  \textbf{g.} \texttt{mtcars{[}1,\ 1{]}}
\item
  \textbf{h.} \texttt{mpg\$mtcars}
\end{itemize}

\textbf{2.} Para que serve a função \texttt{str()}. Dê um exemplo do seu uso.

\textbf{3.} Para que serve a função \texttt{nanes()}. Dê um exemplo do seu uso.

\textbf{4.} Use o data frame \texttt{airquality} para responder às questões abaixo:

\begin{itemize}
\item
  \textbf{a.} Quantas colunas \texttt{airquality} tem?
\item
  \textbf{b.} Quantas linhas \texttt{airquality} tem?
\item
  \textbf{c.} O que a função \texttt{head()} retorna?
\item
  \textbf{d.} Quais são os nomes das colunas?
\item
  \textbf{e.} Qual é a classe da coluna \texttt{Ozone}?
\end{itemize}

\textbf{5.} Desafio. Calculando desvio-padrão no R. Use o data frame \texttt{airquality} para responder às questões abaixo:

\begin{itemize}
\item
  \textbf{a.} Tire a média da coluna Ozone e guarde em um objeto.
\item
  \textbf{b.} Guarde em um objeto o vetor correspondente à coluna Ozone subtraída da sua própria média (calculada em no item a).
\item
  \textbf{c.} Eleve o vetor calculado em (b) ao quadrado. Salve o resultado em um novo objeto.
\item
  \textbf{d.} Tire a média do vetor calculado em (c) e salve o resultado em um objeto chamado \texttt{variancia}. Em seguida, calcule a raiz quadrada desse valor e salve em um objeto chamado \texttt{desvio\_padrao}.
\item
  \textbf{e.} Compare o valor de \texttt{desvio\_padrao} com \texttt{sd(airquality\$Ozone)} e pesquise por que os valores não são iguais. Dica: veja a documentação da função \texttt{sd()}.
\end{itemize}

\textbf{6.} Use o \emph{data frame} \texttt{airquality} para responder às questões abaixo.

\begin{itemize}
\item
  \textbf{a.} Conte quantos \texttt{NAs} tem na coluna \texttt{Solar.R}.
\item
  \textbf{b.} Filtre a tabela \texttt{airquality}com apenas linhas em que \texttt{Solar.R} é \texttt{NA}.
\item
  \textbf{c.} Filtre a tabela \texttt{airquality} com apenas linhas em que \texttt{Solar.R} \textbf{não} é \texttt{NA}.
\item
  \textbf{d.} Filtre a tabela \texttt{airquality} com apenas linhas em que \texttt{Solar.R} \textbf{não} é \texttt{NA} e \texttt{Month} é igual a 5.
\end{itemize}

\hypertarget{maisFuncoes}{%
\section{Mais sobre funções}\label{maisFuncoes}}

Funções são tão comuns e intuitivas (provavelmente você já usou funções no Excel), que mesmo sem termos abordado o tema com detalhes, nós conseguimos utilizar várias funções nas seções anteriores:

\begin{itemize}
\tightlist
\item
  a função \texttt{c()} foi utilizada para criar vetores;
\item
  a função \texttt{class()} foi utilizada para descobrir a classe de um objeto;
\item
  a família de funções \texttt{is.na()}, \texttt{is.nan()}, \texttt{is.infinite()} e \texttt{is.null} foram utilizadas para testar se um valor é \texttt{NA}, \texttt{NaN}, infinito ou \texttt{NULL}, respectivamente.
\end{itemize}

Diferentemente dos objetos, as funções podem receber \textbf{argumentos}. Argumentos são os valores que colocamos dentro dos parênteses e que as funções precisam para funcionar (calcular algum resultado). Por exemplo, a função \texttt{c()} precisa saber quais são os valores que formarão o vetor que ela irá criar.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\DocumentationTok{\#\# [1] 1 3 5}
\end{Highlighting}
\end{Shaded}

Nesse caso, os valores \texttt{1}, \texttt{3} e \texttt{5} são os argumentos da função \texttt{c()}. \textbf{Os argumentos de uma função são sempre separados por vírgulas}.

Funções no R têm personalidade. Cada uma pode funcionar de um jeito diferente das demais, mesmo quando fazem tarefas parecidas. Por exemplo, vejamos a função \texttt{sum()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\# [1] 4}
\end{Highlighting}
\end{Shaded}

Como você deve ter percebido, essa função retorna a soma de seus argumentos. Também podemos passar um vetor como argumento, e ela retornará a soma dos elementos do vetor.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\DocumentationTok{\#\# [1] 4}
\end{Highlighting}
\end{Shaded}

Já a função \texttt{mean()}, que calcula a média de um conjunto de valores, exige que você passe valores na forma de um vetor:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Só vai considerar o primeiro número na média}
\FunctionTok{mean}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\# [1] 1}

\CommentTok{\# Considera todos os valores dentro do vetor na média}
\FunctionTok{mean}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{))}
\DocumentationTok{\#\# [1] 2}
\end{Highlighting}
\end{Shaded}

Como cada coluna de um \emph{data frame} é um vetor, podemos calcular a média de uma coluna fazendo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Podemos passar esse vetor para a função mean()}
\FunctionTok{mean}\NormalTok{(mtcars}\SpecialCharTok{$}\NormalTok{mpg)}
\DocumentationTok{\#\# [1] 20.09062}
\end{Highlighting}
\end{Shaded}

Também podemos usar argumentos para modificar o comportamento de uma função. O que acontece se algum elemento do vetor for \texttt{NA}?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\ConstantTok{NA}\NormalTok{))}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Como a função não sabe o valor do terceiro elemento do vetor, ela não sabe qual é a média desses 3 elementos e, então, devolve \texttt{NA}. Como é muito comum termos \texttt{NA} nas nossas bases de dados, é muito comum tentarmos calcular a média de uma coluna que tem \texttt{NA} e recebermos \texttt{NA} como resposta.

Na grande maioria dos casos, queremos saber a média de uma coluna apesar dos \texttt{NA}s. Isto é, queremos retirar os \texttt{NA}s e então calcular a média com os valores que conhecemos. Para isso, podemos utilizar o argumento \texttt{na.rm\ =\ TRUE} da função \texttt{mean()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\ConstantTok{NA}\NormalTok{), }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# [1] 2}
\end{Highlighting}
\end{Shaded}

Esse argumento diz à função para remover os \texttt{NA}s antes de calcular a média. Assim, a média calculada é: \texttt{(1\ +\ 3)/2}.

Claro que cada função tem os seus próprios argumentos e nem toda função terá o argumento \texttt{na.rm=}. Para saber quais são e como usar os argumentos de uma função, basta acessar a sua documentação:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{help}\NormalTok{(mean)}
\end{Highlighting}
\end{Shaded}

Os argumentos das funções também têm nomes, que podemos ou não usar na hora de usar uma função. Veja por exemplo a função \texttt{seq()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{from =} \DecValTok{4}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{, }\AttributeTok{by =} \DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1]  4  6  8 10}
\end{Highlighting}
\end{Shaded}

Entre outros argumentos, ela possui os argumentos \texttt{from=}, \texttt{to=} e \texttt{by=}. O que ela faz é criar uma sequência (vetor) de \texttt{by} em \texttt{by} que começa em \texttt{from} e termina em \texttt{to}. No exemplo, criamos uma função de 2 em 2 que começa em 4 e termina em 10.

Também poderíamos usar a mesma função sem colocar o nome dos argumentos:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1]  4  6  8 10}
\end{Highlighting}
\end{Shaded}

Para utilizar a função sem escrever o nome dos argumentos, você precisa colocar os valores na ordem em que os argumentos aparecem. E se você olhar a documentação da função \texttt{seq()}, fazendo \texttt{help(seq)}, verá que a ordem dos argumentos é justamente \texttt{from=}, \texttt{to=} e \texttt{by=}.

Escrevendo o nome dos argumentos, não há problema em alterar a ordem dos argumentos:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\AttributeTok{by =} \DecValTok{2}\NormalTok{, }\AttributeTok{to =} \DecValTok{10}\NormalTok{, }\AttributeTok{from =} \DecValTok{4}\NormalTok{)}
\DocumentationTok{\#\# [1]  4  6  8 10}
\end{Highlighting}
\end{Shaded}

Mas se especificar os argumentos, a ordem importa. Veja que o resultado será diferente.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{seq}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\DocumentationTok{\#\# [1]  2  6 10}
\end{Highlighting}
\end{Shaded}

A seguir, apresentamos algumas funções nativas do R úteis para trabalhar com \emph{data frames} :

\begin{itemize}
\tightlist
\item
  \texttt{head()} - Mostra as primeiras 6 linhas.
\item
  \texttt{tail()} - Mostra as últimas 6 linhas.
\item
  \texttt{dim()} - Número de linhas e de colunas.
\item
  \texttt{names()} - Os nomes das colunas (variáveis).
\item
  \texttt{str()} - Estrutura do \emph{data frame}. Mostra, entre outras coisas, as classes de cada coluna.
\item
  \texttt{cbind()} - Acopla duas tabelas lado a lado.
\item
  \texttt{rbind()} - Empilha duas tabelas.
\end{itemize}

Além de usar funções já prontas, você pode criar a sua própria função. A sintaxe é a seguinte:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nome\_da\_funcao }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(argumento\_1, argumento\_2) \{}
  
  \CommentTok{\# Código que a função irá executar}
  
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Repare que \texttt{function} é um nome reservado no R, isto é, você não pode criar um objeto com esse nome.

Um exemplo: vamos criar uma função que soma dois números.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minha\_soma }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  soma }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ y}
  
\NormalTok{  soma  }\CommentTok{\# resultado retornado}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Essa função tem os seguintes componentes:

\begin{itemize}
\tightlist
\item
  \texttt{minha\_soma}: nome da função
\item
  \texttt{x} e \texttt{y}: argumentos da função
\item
  \texttt{soma\ \textless{}-\ x\ +\ y}: operação que a função executa
\item
  \texttt{soma}: valor retornado pela função
\end{itemize}

Após rodarmos o código de criar a função, podemos utilizá-la como qualquer outra função do R.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{minha\_soma}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] 4}
\end{Highlighting}
\end{Shaded}

O objeto \texttt{soma} só existe \emph{dentro da função}, isto é, além de ele não ser colocado no seu \emph{environment}, ele só existirá na memória (RAM) enquanto o R estiver executando a função. Depois disso, ele será apagado. O mesmo vale para os argumentos \texttt{x} e \texttt{y}.

O valor retornado pela função representa o resultado que receberemos ao utilizá-la. Por padrão, \textbf{a função retornará sempre a última linha de código que existir dentro dela}. No nosso exemplo, a função retorna o valor contido no objeto \texttt{soma}, pois é isso que fazemos na última linha de código da função.

Repare que se atribuirmos o resultado a um objeto, ele não será mostrado no console:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resultado }\OtherTok{\textless{}{-}} \FunctionTok{minha\_soma}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{3}\NormalTok{)}

\CommentTok{\# Para ver o resultado, rodamos o objeto \textasciigrave{}resultado\textasciigrave{}}
\NormalTok{resultado}
\DocumentationTok{\#\# [1] 6}
\end{Highlighting}
\end{Shaded}

Agora, o que acontece se a última linha da função não devolver um objeto? Veja:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minha\_nova\_soma }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  soma }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ y}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

A função \texttt{minha\_nova\_soma()} apenas cria o objeto \texttt{soma}, sem retorná-lo como na função \texttt{minha\_soma()}. Se utilizarmos essa nova função, nenhum valor é devolvido no console:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{minha\_nova\_soma}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

No entanto, a última linha da função agora é a atribuição \texttt{soma\ \textless{}-\ x\ +\ y} e esse será o ``resultado retornado''. Assim, podemos visualizar o resultado da função fazendo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{resultado }\OtherTok{\textless{}{-}} \FunctionTok{minha\_nova\_soma}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{)}

\NormalTok{resultado}
\DocumentationTok{\#\# [1] 2}
\end{Highlighting}
\end{Shaded}

É como se, por trás das cortinas, o R estivesse fazendo \texttt{resultado\ \textless{}-\ soma\ \textless{}-\ x\ +\ y}, mas apenas o objeto \texttt{resultado} continua existindo, já que os objetos \texttt{soma}, \texttt{x}e \texttt{y} são descartados após a função ser executada.

Claro que, na prática, é sempre bom criarmos funções que retornem na tela os seus resultados, para evitar esse passo a mais se quisermos apenas ver o resultado no console. Assim, a função \texttt{minha\_soma()} costuma ser preferível com relação à função \texttt{minha\_nova\_soma()}.

\hypertarget{exercuxedcios-7}{%
\subsection*{Exercícios}\label{exercuxedcios-7}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Qual dos códigos abaixo devolverá um erro se for avaliado?

\begin{itemize}
\item
  \textbf{a.} \texttt{3\ *\ 5\ +\ 10}
\item
  \textbf{b.} \texttt{function\ \textless{}-\ 10}
\item
  \textbf{c.} \texttt{mean(1,\ 10)}
\item
  \textbf{d.} \texttt{(soma\ \textless{}-\ sum(1,\ 1))}
\end{itemize}

\textbf{2.} Crie uma função que receba um número e retorne o quadrado deste número.

\textbf{3.} Crie uma função que receba 2 números e devolva a raiz quadrada da soma desses números.

\textbf{4.} Crie uma função que receba dois valores (numéricos) e devolva o maior deles.

\textbf{5.} Use a função \texttt{runif()} para criar uma função que retorne um número aleatório inteiro entre 0 e 10 (0 e 10 inclusive). Caso você não conheça a função \texttt{runif()}, rode \texttt{help(runif)} para ler a sua documentação.

\textbf{6.} Rode \texttt{help(sample)} para descobrir o que a função \texttt{sample()} faz. Em seguida

\begin{itemize}
\item
  \textbf{a.} use-a para escrever uma função que devolva uma linha aleatória de um \emph{data frame};
\item
  \textbf{b.} generalize a função para retornar um número qualquer de linhas, escolhido pelo usuário.
\end{itemize}

\hypertarget{controle-de-fluxo}{%
\section{Controle de Fluxo}\label{controle-de-fluxo}}

Como toda boa linguagem de programação, o R possui estruturas de \texttt{if}, \texttt{else}, \texttt{for} e \texttt{while}. Esses \textbf{controles de fluxo} são muito importantes na hora de programar, pois nos permitem manipular de modo eficiente as ações do computador.

A seguir, explicaremos para que servem e como utilizar cada uma dessas estruturas.

\hypertarget{condicionamento-if-e-else}{%
\subsection{Condicionamento: if e else}\label{condicionamento-if-e-else}}

As estruturas \texttt{if} e \texttt{else} servem para executarmos um código apenas se uma condição (teste lógico) for satisfeita.

No código abaixo, a função \texttt{Sys.time()}, que retorna a data/hora no momento da execução, só será avlaiada se o objeto \texttt{x} for igual a 1.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Não vai executar a função Sys.time()}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{2}

\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{         }
  \FunctionTok{Sys.time}\NormalTok{()}
\NormalTok{\}}

\CommentTok{\# Vai executar a função Sys.time()}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}

\ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{         }
  \FunctionTok{Sys.time}\NormalTok{()}
\NormalTok{\}}
\DocumentationTok{\#\# [1] "2021{-}07{-}14 14:31:30 {-}03"}
\end{Highlighting}
\end{Shaded}

O R só vai executar o que está na expressão dentro das chaves \texttt{\{\}} se a expressão que estiver dentro dos parênteses \texttt{()} retornar \texttt{TRUE}. Veja outro exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vai fazer  a soma}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"}\NormalTok{) \{}
  \FunctionTok{sum}\NormalTok{(x)}
\NormalTok{\}}
\DocumentationTok{\#\# [1] 29}

\CommentTok{\# Não vai fazer a soma}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"}\NormalTok{) \{}
  \FunctionTok{sum}\NormalTok{(x)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

Nesse exemplo, a soma só é executada se a classe do objeto \texttt{x} for numérica, isto é, se \texttt{x} for um vetor de números. Essa verificação poderia ser colocada dentro de uma função para evitarmos que ela retorne um erro.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minha\_soma }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"} \SpecialCharTok{\&} \FunctionTok{class}\NormalTok{(y) }\SpecialCharTok{==} \StringTok{"numeric"}\NormalTok{) \{}
\NormalTok{     x }\SpecialCharTok{+}\NormalTok{ y}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\# Retorna a soma}
\FunctionTok{minha\_soma}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] 3}

\CommentTok{\# Não retorna nada}
\FunctionTok{minha\_soma}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Nesses casos, é muito comum o uso das funções \texttt{return()} e \texttt{stop()} para, respectivamente, retornar um resultado antecipadamente ou para a execução da função e devolver ao usuário uma mensagem de erro personalizada.

Um exemplo usando \texttt{return()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Devolvendo um resultado antecipadamente}
\NormalTok{minha\_soma\_NA }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"} \SpecialCharTok{\&} \FunctionTok{class}\NormalTok{(y) }\SpecialCharTok{==} \StringTok{"numeric"}\NormalTok{) \{}
\NormalTok{     soma }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{+}\NormalTok{ y}
     \FunctionTok{return}\NormalTok{(soma)}
\NormalTok{  \}}
  
  \ConstantTok{NA}
\NormalTok{\}}

\CommentTok{\# Retorna a soma}
\FunctionTok{minha\_soma\_NA}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] 3}

\CommentTok{\# Retorna NA}
\FunctionTok{minha\_soma\_NA}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{)}
\DocumentationTok{\#\# [1] NA}

\CommentTok{\# Retorna NA}
\FunctionTok{minha\_soma\_NA}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"b"}\NormalTok{)}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Na função \texttt{minha\_soma\_NA()}, a soma só é calculada e retornada se \texttt{x} e \texttt{y} forem numéricos. Caso pelo menos um dos dois não seja, o código dentro do \texttt{if} não é executado e o valor retornado é o \texttt{NA}.

Agora, usando \texttt{stop()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Agora, devolvendo um erro}
\NormalTok{minha\_soma\_erro }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
  \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{!=} \StringTok{"numeric"} \SpecialCharTok{|} \FunctionTok{class}\NormalTok{(y) }\SpecialCharTok{!=} \StringTok{"numeric"}\NormalTok{) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"A classe dos objetos x e y deve ser numérica."}\NormalTok{)}
\NormalTok{  \}}
  
\NormalTok{  x }\SpecialCharTok{+}\NormalTok{ y}
\NormalTok{\}}

\CommentTok{\# Retorna a soma}
\FunctionTok{minha\_soma\_erro}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] 3}

\CommentTok{\# Retorna erro}
\FunctionTok{minha\_soma\_erro}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{)}
\DocumentationTok{\#\# Error in minha\_soma\_erro("a", "b"): A classe dos objetos x e y deve ser numérica.}

\CommentTok{\# Retorna erro}
\FunctionTok{minha\_soma\_erro}\NormalTok{(}\DecValTok{1}\NormalTok{, }\StringTok{"b"}\NormalTok{)}
\DocumentationTok{\#\# Error in minha\_soma\_erro(1, "b"): A classe dos objetos x e y deve ser numérica.}
\end{Highlighting}
\end{Shaded}

Na função \texttt{minha\_soma\_erro()}, testamos no \texttt{if} se a classe de \texttt{x} \textbf{ou} a classe de \texttt{y} é diferente de \texttt{numeric}, isto é, se pelo menos um dos dois não é um número. Se esse teste retornar \texttt{TRUE}, a função para a sua execução e devolve para o usuário a seguinte mensagem de erro: ``A classe dos objetos x e y deve ser numérica.''. Se o teste retorna \texttt{FALSE}, a soma é realizada e seu resultado nos é retornado.

O \texttt{else} funciona como uma extensão do \texttt{if}, dando uma alternativa caso o teste executado seja falso.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vai fazer  a soma}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{15}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"}\NormalTok{) \{}
  \FunctionTok{sum}\NormalTok{(x)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \ConstantTok{NA}
\NormalTok{\}}
\DocumentationTok{\#\# [1] 29}

\CommentTok{\# Vai retornar NA}
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{10}\NormalTok{, }\StringTok{"15"}\NormalTok{)}

\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"}\NormalTok{) \{}
  \FunctionTok{sum}\NormalTok{(x)}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \ConstantTok{NA}
\NormalTok{\}}
\DocumentationTok{\#\# [1] NA}
\end{Highlighting}
\end{Shaded}

Também podemos usar o \texttt{else} para encadear vários \texttt{if}s. Teste o código abaixo com valores positivos e negativos para \texttt{x}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{0}

\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{) \{}
  
  \StringTok{"negativo"}
  
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
  
  \StringTok{"neutro"}
  
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) \{}
  
  \StringTok{"positivo"}
\NormalTok{\}}
\DocumentationTok{\#\# [1] "neutro"}
\end{Highlighting}
\end{Shaded}

Repare que o \texttt{if} no último \texttt{else} poderia ser omitido.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{0}

\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\textless{}} \DecValTok{0}\NormalTok{) \{}
  
  \StringTok{"negativo"}
  
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
  
  \StringTok{"neutro"}
  
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  
  \StringTok{"positivo"}
\NormalTok{\}}
\DocumentationTok{\#\# [1] "neutro"}
\end{Highlighting}
\end{Shaded}

\hypertarget{iteradores-for-e-while}{%
\subsection{Iteradores: for e while}\label{iteradores-for-e-while}}

O \texttt{for} pode ser utilizado para fazer os famosos \emph{loopings} de programação, isto é, repetir uma mesma tarefa para um conjunto de valores diferentes. Cada repetição é chamada de iteração e o objeto que muda de valor em cada \textbf{interação} é chamado de \textbf{iterador}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numero\_de\_colunas }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(mtcars)}

\ControlFlowTok{for}\NormalTok{ (coluna }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{numero\_de\_colunas) \{}
\NormalTok{  media }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(mtcars[,coluna])}
  
  \FunctionTok{print}\NormalTok{(media)}
\NormalTok{\}}
\DocumentationTok{\#\# [1] 20.09062}
\DocumentationTok{\#\# [1] 6.1875}
\DocumentationTok{\#\# [1] 230.7219}
\DocumentationTok{\#\# [1] 146.6875}
\DocumentationTok{\#\# [1] 3.596563}
\DocumentationTok{\#\# [1] 3.21725}
\DocumentationTok{\#\# [1] 17.84875}
\DocumentationTok{\#\# [1] 0.4375}
\DocumentationTok{\#\# [1] 0.40625}
\DocumentationTok{\#\# [1] 3.6875}
\DocumentationTok{\#\# [1] 2.8125}
\end{Highlighting}
\end{Shaded}

O código acima vai calcular a média de cada coluna do \emph{data frame} \texttt{mtcars}. Alguns pontos importantes:

\begin{itemize}
\item
  No exemplo, temos 11 iterações e o objeto \texttt{coluna} é o iterador.
\item
  Como \texttt{numero\_de\_colunas} é igual a 11, a expressão \texttt{1:numero\_de\_colunas} cria uma sequência de números de 1 a 11.
\item
  A expressão \texttt{coluna\ in\ 1:numero\_de\_colunas} indica que o valor de \texttt{coluna} será 1 na primeira iteração, 2 na segunda iteração, 3 na terceira e assim por diante.
\item
  O código dentro do \texttt{for} não é retornado para o usuário ao fim de cada iteração. Por isso, para ver os resultados no Console, usamos a função \texttt{print()}.
\end{itemize}

Também podemos salvar as médias em um vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numero\_de\_colunas }\OtherTok{\textless{}{-}} \FunctionTok{ncol}\NormalTok{(mtcars)}

\CommentTok{\# Antes, criamos um vetor vazio.}
\NormalTok{medias }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{()}

\ControlFlowTok{for}\NormalTok{ (coluna }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\NormalTok{numero\_de\_colunas) \{}
\NormalTok{  medias[coluna] }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(mtcars[,coluna])}
\NormalTok{\}}

\NormalTok{medias}
\DocumentationTok{\#\#  [1]  20.090625   6.187500 230.721875 146.687500   3.596563   3.217250}
\DocumentationTok{\#\#  [7]  17.848750   0.437500   0.406250   3.687500   2.812500}
\end{Highlighting}
\end{Shaded}

Assim como o \texttt{for}, o \texttt{while} também é um iterador.

O código a seguir irá imprimir na tela o valor de \texttt{i} enquanto este objeto for menor que 3. No momento em que a condição dentro das chaves \texttt{\{\}} não for mais respeitada, o processo será interrompido.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{i }\OtherTok{\textless{}{-}} \DecValTok{1}

\ControlFlowTok{while}\NormalTok{ (i }\SpecialCharTok{\textless{}} \DecValTok{3}\NormalTok{)\{}
  \FunctionTok{print}\NormalTok{(i)}
\NormalTok{  i }\OtherTok{\textless{}{-}}\NormalTok{  i }\SpecialCharTok{+} \DecValTok{1}
\NormalTok{\}}
\DocumentationTok{\#\# [1] 1}
\DocumentationTok{\#\# [1] 2}
\end{Highlighting}
\end{Shaded}

É importante que o valor de i seja atualizado em cada interação, caso contrário a função entrará em um loop infinito. Por isso fazemos \texttt{i\ \textless{}-\ i\ +\ 1} após o \texttt{print}.

\hypertarget{exercuxedcios-8}{%
\subsection*{Exercícios}\label{exercuxedcios-8}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Por que o código abaixo retorna erro? Arrume o código para retornar o valor \texttt{TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{4}
\ControlFlowTok{if}\NormalTok{(}\AttributeTok{x =} \DecValTok{4}\NormalTok{) \{}
  \ConstantTok{TRUE}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\textbf{2.} Usando \texttt{if} e \texttt{else}, escreva um código que retorne a string \texttt{"número"} caso o valor seja da classe \texttt{numeric} ou \texttt{integer}; a string \texttt{"palavra"} caso o valor seja da classe \texttt{character}; e \texttt{NA} caso contrário.

\textbf{3.} Usando apenas \texttt{for} e a função \texttt{length()}, construa uma função que calcule a média de um vetor número qualquer. Construa uma condição para a função retornar \texttt{NULL} caso o vetor não seja numérico.

\textbf{4.} Utilize o vetor \texttt{a} para resolver as questões a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{a.} Utilize o \texttt{for} para imprimir as médias acumuladas do vetor \texttt{a}, isto é, primeiro vamos imprimir 10, depois a média entre 10 e 3, depois a média entre 10, 3 e 5 e assim por diante.
\item
  \textbf{b.} Adapte o laço que você fez no item anterior para ignorar os valores negativos, isto é, em caso de valor negativo, o laço não deve calcular a média e não imprimir nada.
\end{itemize}

\hypertarget{outros-tuxf3picos}{%
\section{Outros tópicos}\label{outros-tuxf3picos}}

Nesta seção, apresentamos alguns tópicos extras. Alguns deles serão retomanos em capítulos posteriores.

\hypertarget{matrizes}{%
\subsection{Matrizes}\label{matrizes}}

As matrizes no R podem ser tratadas como vetores com duas dimensões. Por serem vetores, elas só podem conter elementos de uma mesma classe. Por possuírem duas dimensões, as operações de \emph{subsetting} devem ser realizadas utilizando a sintaxe \texttt{matriz{[}linha,\ coluna{]}}.

Para criar uma matriz, utilizamos a função \texttt{matrix()}. Precisamos definir quais elementos formarão a matriz e qual será o número de linhas e colunas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Uma matriz de 2 linhas e 3 colunas}
\NormalTok{m }\OtherTok{\textless{}{-}} \FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{)}

\NormalTok{m}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    4    7}
\DocumentationTok{\#\# [2,]    2    5    8}
\DocumentationTok{\#\# [3,]    3    6    9}

\FunctionTok{dim}\NormalTok{(m)}
\DocumentationTok{\#\# [1] 3 3}
\end{Highlighting}
\end{Shaded}

Repare que os números de 1 a 9 foram dispostos na matriz coluna por coluna (\emph{column-wise}), ou seja, preenchendo de cima para baixo e depois da esquerda para a direita. Esse comportamento pode ser alterado se utilizarmos o argumento \texttt{byrow=}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{matrix}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{9}\NormalTok{, }\AttributeTok{nrow =} \DecValTok{3}\NormalTok{, }\AttributeTok{ncol =} \DecValTok{3}\NormalTok{, }\AttributeTok{byrow =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    2    3}
\DocumentationTok{\#\# [2,]    4    5    6}
\DocumentationTok{\#\# [3,]    7    8    9}
\end{Highlighting}
\end{Shaded}

\emph{Subsetting} de matrizes é muito parecido com o de \emph{data frames}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Seleciona a terceira linha}
\NormalTok{m[}\DecValTok{3}\NormalTok{, ]}
\DocumentationTok{\#\# [1] 3 6 9}

\CommentTok{\# Seleciona a segunda coluna}
\NormalTok{m[ , }\DecValTok{2}\NormalTok{]   }
\DocumentationTok{\#\# [1] 4 5 6}

\CommentTok{\# Seleciona o primeiro elemento da segunda coluna}
\NormalTok{m[}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{]}
\DocumentationTok{\#\# [1] 4}
\end{Highlighting}
\end{Shaded}

A seguir, apresentamos algumas operações úteis para trabalhar com matrizes.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Matriz transposta}
\FunctionTok{t}\NormalTok{(m)     }
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    2    3}
\DocumentationTok{\#\# [2,]    4    5    6}
\DocumentationTok{\#\# [3,]    7    8    9}

\CommentTok{\# Matriz identidade 3 por 3}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{diag}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\NormalTok{n}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    0    0}
\DocumentationTok{\#\# [2,]    0    1    0}
\DocumentationTok{\#\# [3,]    0    0    1}

\CommentTok{\# Multiplicação por escalar}
\NormalTok{n }\SpecialCharTok{*} \DecValTok{2}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    2    0    0}
\DocumentationTok{\#\# [2,]    0    2    0}
\DocumentationTok{\#\# [3,]    0    0    2}

\CommentTok{\# Multiplicação matricial}
\NormalTok{m }\SpecialCharTok{\%*\%}\NormalTok{ n}
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]    1    4    7}
\DocumentationTok{\#\# [2,]    2    5    8}
\DocumentationTok{\#\# [3,]    3    6    9}

\CommentTok{\# Matriz inversa de m}
\NormalTok{n2 }\OtherTok{\textless{}{-}}\NormalTok{ n }\SpecialCharTok{*} \DecValTok{2}
\FunctionTok{solve}\NormalTok{(n2)  }
\DocumentationTok{\#\#      [,1] [,2] [,3]}
\DocumentationTok{\#\# [1,]  0.5  0.0  0.0}
\DocumentationTok{\#\# [2,]  0.0  0.5  0.0}
\DocumentationTok{\#\# [3,]  0.0  0.0  0.5}
\end{Highlighting}
\end{Shaded}

\hypertarget{fatores}{%
\subsection{Fatores}\label{fatores}}

Fatores são uma classe de objetos no R criada para representar as variáveis categóricas numericamente. Essa classe possui um atributo especial: os \texttt{levels}. \emph{Levels} são nada mais do que as categorias possíveis de uma variável categórica.

Como exemplo, imagine que o objeto \texttt{sexo} guarde uma coluna que indica o sexo de uma pessoa: \texttt{F} para feminino e \texttt{M} para masculino. Normalmente, essa coluna seria importada para o R como texto. Podemos transformá-la em fator utilizando a função \texttt{as.factor()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Variável sexo como texto}
\NormalTok{sexo }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"M"}\NormalTok{)}
\NormalTok{sexo}
\DocumentationTok{\#\# [1] "F" "M" "M" "M" "F" "F" "M"}

\CommentTok{\# Variável sexo, como fator}
\FunctionTok{as.factor}\NormalTok{(sexo)}
\DocumentationTok{\#\# [1] F M M M F F M}
\DocumentationTok{\#\# Levels: F M}
\end{Highlighting}
\end{Shaded}

Repare que a saída do objeto \texttt{sexo} quando o transformamos em fator tem uma informação a mais. Na última linha, visualizamos os \texttt{levels} desse fator, isto é, um conjunto das categorias possíveis do fator \texttt{sexo} (no caso, F e M).

Por padrão, \textbf{os levels são ordenados por ordem alfabética}. Veremos mais adiante que isso pode fazer diferença na construção de gráficos e na aplicação de modelos.

A diferença entre fatores e texto dentro do R é como eles são representados internamente. Enquanto objetos da classe \texttt{character} realmente são representados como texto, fatores são representados como números inteiros.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Em geral, não é possível transforma textos em números}
\FunctionTok{as.numeric}\NormalTok{(sexo)}
\DocumentationTok{\#\# Warning: NAs introduced by coercion}
\DocumentationTok{\#\# [1] NA NA NA NA NA NA NA}

\CommentTok{\# Mas podemos transforrma fatores em inteiros}
\NormalTok{fator }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(sexo)}
\FunctionTok{as.numeric}\NormalTok{(fator)}
\DocumentationTok{\#\# [1] 1 2 2 2 1 1 2}
\end{Highlighting}
\end{Shaded}

Internamente, cada level de um fator é representado como um inteiro. No exemplo anterior, o level \texttt{F} está sendo representado como \texttt{1} e o level \texttt{M} como \texttt{2}. Se um fator tiver 10 levels, teremos os inteiros de \texttt{1} a \texttt{10} representando esse fator.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# letters é um objeto nativo do R}
\NormalTok{letras }\OtherTok{\textless{}{-}}\NormalTok{ letters[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{]}

\NormalTok{fator }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(letras)}
\NormalTok{fator}
\DocumentationTok{\#\#  [1] a b c d e f g h i j}
\DocumentationTok{\#\# Levels: a b c d e f g h i j}

\FunctionTok{as.numeric}\NormalTok{(fator)}
\DocumentationTok{\#\#  [1]  1  2  3  4  5  6  7  8  9 10}
\end{Highlighting}
\end{Shaded}

O texto que vemos quando avaliamos um fator (\texttt{F} e \texttt{M} em vez de \texttt{1} e \texttt{2}, por exemplo) é apenas uma ``etiqueta'' que o R coloca em cima dos inteiros. As diferentes etiquetas de um fator são justamente os \texttt{levels}.

Como fatores são sempre representados interrnamente por inteiros sequencias começando do 1 (1, 2, 3, \ldots) e esses inteiros são sempre atribuídos conforme a ordem alfabética dos \texttt{levels}, um erro muito comum é tentar transformar levels numéricos em números:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Texto}
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"10"}\NormalTok{, }\StringTok{"55"}\NormalTok{, }\StringTok{"55"}\NormalTok{, }\StringTok{"12"}\NormalTok{, }\StringTok{"10"}\NormalTok{, }\StringTok{"{-}5"}\NormalTok{, }\StringTok{"{-}90"}\NormalTok{)}
\NormalTok{vetor}
\DocumentationTok{\#\# [1] "10"  "55"  "55"  "12"  "10"  "{-}5"  "{-}90"}

\CommentTok{\# Fator}
\NormalTok{fator }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(vetor)}
\NormalTok{fator}
\DocumentationTok{\#\# [1] 10  55  55  12  10  {-}5  {-}90}
\DocumentationTok{\#\# Levels: {-}5 {-}90 10 12 55}

\CommentTok{\# Número}
\FunctionTok{as.numeric}\NormalTok{(fator)}
\DocumentationTok{\#\# [1] 3 5 5 4 3 1 2}
\end{Highlighting}
\end{Shaded}

Quando transformamos o objeto \texttt{vetor} em um fator, o R não enxerga os ``números'' dentro dele. Para o R, é tudo texto. Então, como nos outros exemplos, cada ``número'' será representado por um inteiro, atribuído pela ordem alfabética.

Uma forma de evitar esse problema é transformar o fator em texto antes de transformá-lo em número.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Voltando para texto}
\NormalTok{texto }\OtherTok{\textless{}{-}} \FunctionTok{as.character}\NormalTok{(fator)}
\NormalTok{texto}
\DocumentationTok{\#\# [1] "10"  "55"  "55"  "12"  "10"  "{-}5"  "{-}90"}

\CommentTok{\# Agora sim os números originais}
\FunctionTok{as.numeric}\NormalTok{(texto)}
\DocumentationTok{\#\# [1]  10  55  55  12  10  {-}5 {-}90}
\end{Highlighting}
\end{Shaded}

\hypertarget{gruxe1ficos-r-base}{%
\subsection{Gráficos (R base)}\label{gruxe1ficos-r-base}}

O R já vem com funções básicas que fazem gráficos estatísticos de todas as naturezas.

\begin{itemize}
\tightlist
\item
  Vantagens: são rápidas e simples.
\item
  Desvantagens: os gráficos são simplórios e geralmente é difícil gerar gráficos mais elaborados.
\end{itemize}

Nesta seção, mostraremos como construir alguns tipos de gráficos usando as funções base do R, mas o nosso foco em visualização de dados está nas funções do pacote \texttt{ggplot2}, apresentadas no Capítulo \ref{graficos}.

\hypertarget{gruxe1fico-de-dispersuxe3o-e-linhas}{%
\subsubsection*{Gráfico de dispersão e linhas}\label{gruxe1fico-de-dispersuxe3o-e-linhas}}
\addcontentsline{toc}{subsubsection}{Gráfico de dispersão e linhas}

Para construir um gráfico de dispersão, utilizamos a função \texttt{plot()}. Seus principais parâmetros são:

\begin{itemize}
\tightlist
\item
  \texttt{x}, \texttt{y}: vetores para representarem os eixos x e y.
\item
  \texttt{type}: tipo de gráfico. Pode ser pontos, linhas, escada, entre outros.
\end{itemize}

Para mais detalhes sobre os argumentos, ver \texttt{help(plot)}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{N }\OtherTok{\textless{}{-}} \DecValTok{100}
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{1}\SpecialCharTok{:}\NormalTok{N}
\NormalTok{y }\OtherTok{\textless{}{-}} \DecValTok{5} \SpecialCharTok{+} \DecValTok{2} \SpecialCharTok{*}\NormalTok{ x }\SpecialCharTok{+} \FunctionTok{rnorm}\NormalTok{(N, }\AttributeTok{sd =} \DecValTok{30}\NormalTok{)}

\FunctionTok{plot}\NormalTok{(x, y)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-1-1} \end{center}

No código acima, a função \texttt{rnorm()} gera uma amostra aleatória da distribuição Normal com média 0 e desvio-padrão 30.

O parâmetro \texttt{type\ =\ "l"} indica que queremos que os pontos sejam interligados por linhas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{plot}\NormalTok{(x, y, }\AttributeTok{type =} \StringTok{"l"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-2-1} \end{center}

\hypertarget{histograma}{%
\subsubsection*{Histograma}\label{histograma}}
\addcontentsline{toc}{subsubsection}{Histograma}

Para construir histogramas, utilizamos a função \texttt{hist()}. Os principais parâmetros são:

\begin{itemize}
\tightlist
\item
  \texttt{x}: o vetor numérico para o qual o histograma será construído.
\item
  \texttt{breaks}: número (aproximado) de retângulos.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-3-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{hist}\NormalTok{(}\FunctionTok{rnorm}\NormalTok{(}\DecValTok{1000}\NormalTok{), }\AttributeTok{breaks =} \DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-4-1} \end{center}

\hypertarget{boxplot}{%
\subsubsection*{Boxplot}\label{boxplot}}
\addcontentsline{toc}{subsubsection}{Boxplot}

Para construir boxplots, utilizamos a função \texttt{boxplot()}. Os principais parâmetros são:

\begin{itemize}
\tightlist
\item
  \texttt{x}: o vetor numérico para o qual o boxplot será construído.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(mtcars}\SpecialCharTok{$}\NormalTok{mpg, }\AttributeTok{col =} \StringTok{"lightgray"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-5-1} \end{center}

Observe que o argumento \texttt{col=} muda a cor da caixa do boxplot.

Para mapear duas variáveis ao gráfico, passamos um \emph{data frame} para o argumento \texttt{data=} e utilizamos a seguinte sintaxe \texttt{var\_numerica\ \textasciitilde{}\ var\_categorica}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{boxplot}\NormalTok{(mpg }\SpecialCharTok{\textasciitilde{}}\NormalTok{ cyl, }\AttributeTok{data =}\NormalTok{ mtcars, }\AttributeTok{col =} \StringTok{"purple"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-6-1} \end{center}

\hypertarget{gruxe1fico-de-barras}{%
\subsubsection*{Gráfico de barras}\label{gruxe1fico-de-barras}}
\addcontentsline{toc}{subsubsection}{Gráfico de barras}

Para construir gráficos de barras, precisamos combinar as funções \texttt{table()} e \texttt{barplot()}.

No gráfico abaixo, primeiro criamos uma tabela de frequências com a função \texttt{table()} e, em seguida, construímos o gráfico com a função \texttt{barplot()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabela }\OtherTok{\textless{}{-}} \FunctionTok{table}\NormalTok{(mtcars}\SpecialCharTok{$}\NormalTok{cyl)}
\NormalTok{tabela}
\DocumentationTok{\#\# }
\DocumentationTok{\#\#  4  6  8 }
\DocumentationTok{\#\# 11  7 14}

\FunctionTok{barplot}\NormalTok{(tabela)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{03-r-base_files/figure-latex/r-base-plot-7-1} \end{center}

\hypertarget{pacotes}{%
\chapter{Pacotes}\label{pacotes}}

A primeira aparição da linguagem de progromação R foi em 1993 e, apesar de lá para cá muita coisa ter sido desenvolvida e atualizada, é muito difícil fazer mudanças na base da linguagem sem quebrar os códigos já existentes. Por essa razão, as maiores inovações são realizadas na forma de pacotes.

Um pacote é um conjunto de funções que têm como objetivo resolver um problema específico. São eles que deixam o R poderoso, capaz de enfrentar qualquer tarefa de análise de dados. Assim, fique bastante à vontade para instalar e atualizar muitos e muitos pacotes ao longo da sua experiência com o R.

O legal é que qualquer pessoa pode fazer um novo pacote e disponibilizar para a comunidade, o que acelera bastante o desenvolvemento da ferramenta. Dificilmente você vai fazer uma análise apenas com as funções básicas do R e dificilmente não vai existir um pacote com as funções que você precisa.

\hypertarget{instalauxe7uxe3o-de-pacotes}{%
\section{Instalação de pacotes}\label{instalauxe7uxe3o-de-pacotes}}

Existem três principais maneiras de instalar pacotes. Em ordem de frequência, são:

\begin{itemize}
\tightlist
\item
  Via CRAN (Comprehensive R Archive Network): \texttt{install.packages("nome-do-pacote")}.
\item
  Via Github: \texttt{devtools::install\_github("nome-do-repo/nome-do-pacote")}.
\item
  Via arquivo .zip/.tar.gz: \texttt{install.packages("C:/caminho/nome-do-pacote.zip",\ repos\ =\ NULL)}.
\end{itemize}

Para conseguir instalar alguns pacotes no Linux, você pode precisar instalar dependências do sistema manualmente. Por exemplo, se você quer instalar o pacote devtools no R, será necessário ter as bibliotecas \texttt{curl}, \texttt{openssl}, \texttt{httr} e \texttt{git2r}.

Essas dependências geralmente podem ser instaladas no terminal por meio do comando \texttt{apt-get\ install\ nome-da-biblioteca}. Caso você não consiga instalar um pacote devido a ausência de uma dependência, uma maneira de saber quais bibliotecas você precisa instalar é observar as mensagens que aparecem no console durante a tentativa da instalação do pacote.

\hypertarget{via-cran}{%
\subsection{Via CRAN}\label{via-cran}}

Instale pacotes que não estão na sua biblioteca usando a função \texttt{install.packages("nome\_do\_pacote")}. Por exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"tidyverse"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

E, de agora em diante, não precisa mais instalar. Basta carregar o pacote com \texttt{library(magrittr)}.

\begin{quote}
Escreva nome\_do\_pacote::nome\_da\_funcao() se quiser usar apenas uma função de um determinado pacote. O operador :: serve para isso. Essa forma também é útil quando se tem duas funções com o mesmo nome e precisamos garantir que o código vá usar a função do pacote correto.
\end{quote}

\hypertarget{via-github}{%
\subsection{Via Github}\label{via-github}}

Desenvolvedores costumam disponibilizar a última versão de seus pacotes no Github, e alguns deles sequer estão no CRAN. Mesmo assim ainda é possível utilizá-los instalando diretamente pelo github. O comando é igualmente simples:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"rstudio/shiny"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Apenas será necessário o username e o nome do repositório (que geralmente tem o mesmo nome do pacote). No exemplo, o username foi ``rstudio'' e o repositório foi ``shiny''.

Se você não é familiar com o github, não se preocupe! Os pacotes disponibilizados na plataforma geralmente têm um \texttt{README} cuja primeira instrução é sobre a instalação. Se não tiver, provavelmente este pacote não te merece! =)

\hypertarget{via-arquivo-.zip-ou-.tar.gz}{%
\subsection{Via arquivo .zip ou .tar.gz}\label{via-arquivo-.zip-ou-.tar.gz}}

Se você precisar instalar um pacote que está zipado no seu computador (ou em algum servidor), utilize o seguinte comando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"C:/caminho/para/o/arquivo/zipado/nome{-}do{-}pacote.zip"}\NormalTok{, }\AttributeTok{repos =} \ConstantTok{NULL}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

É semelhante a instalar pacotes via CRAN, com a diferença que agora o nome do pacote é o caminho inteiro até o arquivo. O parâmetro \texttt{repos\ =\ NULL} informa que estamos instalando a partir da máquina local.

A aba \textbf{\emph{Packages}} do RStudio também ajuda a administrar os seus pacotes.

\hypertarget{tidyverse}{%
\section{Tidyverse}\label{tidyverse}}

Muitas pessoas tentam definir \emph{o que é} ciência de dados no mercado e na academia. O problema é que esse termo pode ser descrito de várias formas distintas, seja pela formação específica da pessoa que define ou do interlocutor ao qual ela se comunica. Por isso, a definição de ciência de dados é, de certa forma, vazia.

No entanto, é possível definir \emph{como se faz} ciência de dados. Ou seja, independentemente da definição do termo, o que temos de fazer na prática em projetos reais é algo bastante conhecido.

O ``como faz'' é definido através do \emph{Ciclo da Ciência de Dados}, descrito na Figura \ref{fig:04-ciclo}. Primeiro, os dados brutos são coletados de fontes públicas, como arquivos Excel, portais de dados abertos ou bases de dados internos da companhia. Em seguida, os dados são arrumados, para mitigar problemas de padronização de nomes, obtenção das variáveis de interesse e exclusão de casos que estão fora do escopo de análise, produzindo o que se define como base de dados analítica. A base analítica é então transformada para produzir as tabelas e gráficos e, quando necessário, são utilizadas como insumo para o ajuste de modelos estatísticos. Finalmente, os resultados obtidos são comunicados através de uma série de ferramentas, como relatórios, dashboards interativos, indicadores ou Application Programming Interfaces (API) para automação.

\begin{figure}

{\centering \includegraphics[width=13.31in]{assets/img/manipulacao/ciclo-ciencia-de-dados} 

}

\caption{O Ciclo da Ciência de Dados.}\label{fig:04-ciclo}
\end{figure}

O \texttt{\{tidyverse\}} é um pacote guarda-chuva que consolida uma série de ferramentas que fazem parte o ciclo da ciência de dados. Fazem parte do \texttt{\{tidyverse\}} os pacotes \texttt{\{ggplot2\}}, \texttt{\{dplyr\}}, \texttt{\{tidyr\}}, \texttt{\{purrr\}}, \texttt{\{readr\}}, entre muitos outros, como é possível observar na Figura \ref{fig:04-ciclo-pacotes}. Veremos as características principais desses pacotes nas próximas Seções.

\begin{figure}

{\centering \includegraphics[width=13.31in]{assets/img/pacotes/ciclo-ciencia-de-dados-pacotes} 

}

\caption{A implementação do Ciclo da Ciência de Dados, através do tidyverse. Pela definição estrita do tidyverse, na imagem não fazem parte do tidyverse os pacotes janitor, data.table e os pacotes descritos nas partes de modelagem, comunicação e automatização. No entanto, a maioria desses pacotes também seguem os princípios tidy e podem ser usados em conjunto com o tidyverse sem grandes dificuldades.}\label{fig:04-ciclo-pacotes}
\end{figure}

O \texttt{\{tidyverse\}} traz consigo o \href{https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html}{\emph{manifesto tidy}}. Trata-se de um documento que formaliza uma série de princípios que norteiam o desenvolvimento do tidyverse. Como os pacotes do \texttt{\{tidyverse\}} compartilham os mesmos princípios, podem ser utilizados naturalmente em conjunto.

Pode-se dizer que existe uma linguagem R antes e outra depois do \texttt{\{tidyverse\}}. A linguagem mudou muito, a comunidade abraçou uso desses princípios e criou centenas de novos pacotes que conversam uns com os outros dessa forma.\footnote{Usar a filosofia tidy não é a única forma de fazer pacotes do R. Existem muitos pacotes excelentes que não utilizam essa filosofia. O próprio manifesto diz ``O contrário de tidyverse não é o messyverse, e sim muitos outros universos de pacotes interconectados.''}

Os princípios fundamentais do tidyverse são:

\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Reutilizar estruturas de dados existentes.
\item
  Organizar funções simples usando o \emph{pipe} (Seção \ref{pipe}).
\item
  Aderir à programação funcional (Seção \ref{funcionais}).
\item
  Projetado para ser usado por seres humanos.
\end{enumerate}

No texto do \href{https://cran.r-project.org/web/packages/tidyverse/vignettes/manifesto.html}{manifesto tidy} cada um dos lemas é descrito de forma detalhada. No \href{https://www.curso-r.com/blog/2017-02-16-manifesto-tidy/}{nosso blog}, selecionamos os aspectos que achamos mais importante de cada um deles.

\begin{center}\includegraphics[width=500pt,height=500pt]{assets/img/pacotes/tidyverse_celestial} \end{center}

Na prática, carregar o (veja o código abaixo) é o mesmo que carregar os seguintes pacotes:

\begin{itemize}
\item
  \texttt{\{tibble\}} para \emph{data frames} repaginados;
\item
  \texttt{\{readr\}} para importarmos bases para o R;
\item
  \texttt{\{tidyr\}} e \texttt{\{dplyr\}} para arrumação e manipulação de dados;
\item
  \texttt{\{stringr\}} para trabalharmos com textos;
\item
  \texttt{\{forcats\}} para trabalharmos com fatores;
\item
  \texttt{\{ggplot2\}} para gráficos;
\item
  \texttt{\{purrr\}} para programação funcional.
\end{itemize}

Embora o \texttt{\{tidyverse\}} instale diversos outros pacotes, apenas esses são carrregados. Dificilmente fazemos uma análise de dados em que não precisamos usá-los. Falaremos com mais detalhes de todos eles neste livro.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## -- Attaching packages --------------------------------------- tidyverse 1.3.1 --
\end{verbatim}

\begin{verbatim}
## v ggplot2 3.3.5     v purrr   0.3.4
## v tibble  3.1.2     v dplyr   1.0.7
## v tidyr   1.1.3     v stringr 1.4.0
## v readr   1.4.0     v forcats 0.5.1
\end{verbatim}

\begin{verbatim}
## -- Conflicts ------------------------------------------ tidyverse_conflicts() --
## x dplyr::filter() masks stats::filter()
## x dplyr::lag()    masks stats::lag()
\end{verbatim}

Mensagens de conflito quando carregamos o \texttt{\{tidyverse\}} ou qualquer outro pacote significam que funções anteriormente carregadas foram \emph{mascaradas} por novas funções. No exemplo acima, as funções \texttt{filter()} e \texttt{lag()} do pacote \texttt{stats} foram substituídas na sessão pelas funções \texttt{filter()} e \texttt{lag()} do pacote \texttt{dplyr}. Nesse caso, se quiséssemos usar as funções do pacote \texttt{stats} após carregar o \texttt{\{tidyverse\}}, precisaríamos rodar \texttt{stats::filter()} e \texttt{stats::lag()}.

Se você quiser \emph{descarregar} um pacote, reinicie a sua sessão em \texttt{Session\ \textgreater{}\ Restart\ R} ou use a função \texttt{detach()} como no exemplo abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{detach}\NormalTok{(}\StringTok{"package:tidyverse"}\NormalTok{, }\AttributeTok{unload =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{importacao}{%
\chapter{Importação}\label{importacao}}

Nesta seção, vamos introduzir os principais pacotes para importar dados para o R. Mostraremos como importar dados de arquivos de texto, planilhas do excel e extensões de outros programas estatísticos (SAS e SPSS, por exemplo).

Antes de começarmos, vale a pena destacarmos um ponto importante. As funções de importação do \texttt{tidyverse} importam dados em objetos da classe \texttt{tibble}, que difere da classe \texttt{data.frame} usual em dois pontos importantes:

\begin{itemize}
\item
  imprime os dados na tela (Console) de maneira muito mais organizada, resumida e legível;
\item
  permite a utilização de \emph{list-columns}.
\end{itemize}

Se você não estiver familiarizado com o conceito de \emph{list-columns}, não se preocupe. Trataremos melhor do assunto no Capítulo \ref{funcionais}.

\hypertarget{caminhos}{%
\section{Caminhos}\label{caminhos}}

Um passo importante na tarefa de importação de dados para o R é saber onde está o arquivo que queremos importar. Toda função de importação vai exigir um \textbf{caminho}, uma string que representa o endereço do arquivo no computador.

Há duas formas de passarmos o caminho de arquivo: usar o \textbf{caminho absoluto} ou usar o \textbf{caminho relativo}.

Antes de falarmos sobre a diferença dos dois, precisamos definir o que é o \textbf{diretório de trabalho}.

O diretório de trabalho (\emph{working directory}) nada mais é do que a pasta em que o R vai procurar arquivos na hora de ler informações ou gravar arquivos na hora de salvar objetos.

Se você está usando um projeto, o diretório de trabalho da sua sessão será, por padrão, a pasta raiz do seu projeto (é a pasta que contém o arquivo com extensão \texttt{.Rproj}). Se você não estiver usando um projeto ou simplesmente não souber qual é o seu diretório de trabalho, você pode descobri-lo usando a seguinte função \texttt{getwd()}. Ela vai devolver uma string com o caminho do seu diretório de trabalho.

A função \texttt{setwd()} pode ser utilizada para mudar o diretório de trabalho. Como argumento, ela recebe o caminho para o novo diretório.

Caminhos absolutos são aqueles que tem início na pasta raiz do seu computador/usuário. Por exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{getwd}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "/Users/clente/Documents/livro-material"
\end{verbatim}

Esse é o caminho absoluto para a pasta onde esse livro foi produzido.

Na grande maioria dos casos, caminhos absolutos são uma \textbf{má prática}, pois deixam o código irreprodutível. Se você trocar de computador ou passar o script para outra pessoa rodar, o código não vai funcionar, pois o caminho absoluto para o arquivo muito provavelmente será diferente.

Caminhos relativos são aqueles que tem início no diretório de trabalho da sua sessão. Assim, se você quiser acessar um arquivo \texttt{minha\_base.csv} dentro de uma pasta ``dados'' existente no seu diretório de trabalho, você poderia passar para o R o caminho \texttt{"dados/minha\_base.csv"}.

\textbf{Trabalhar com projetos no RStudio ajuda bastante o uso de caminhos relativos}, pois nos incentiva a colocar todos os arquivos da análise dentro da pasta do projeto. Assim, se você usar apenas caminhos relativos e compartilhar a pasta do projeto com alguém, todos os caminhos existentes nos códigos continuarão a funcionar em qualquer computador!

\hypertarget{readr}{%
\section{O pacote readr}\label{readr}}

O pacote \texttt{\{readr\}}do tidyverse é utilizado para importar arquivos de texto, como \texttt{.txt} ou \texttt{.csv}, para o R. Para carregá-lo, rode o código:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}
\end{Highlighting}
\end{Shaded}

O \texttt{\{readr\}} transforma arquivos de textos em \texttt{tibbles} usando as funções:

\begin{itemize}
\item
  \texttt{read\_csv()}: para arquivos separados por vírgula.
\item
  \texttt{read\_tsv()}: para arquivos separados por tabulação.
\item
  \texttt{read\_delim()}: para arquivos separados por um delimitador genérico. O argumento \texttt{delim=} indica qual caracter separa cada coluna no arquivo de texto.
\item
  \texttt{read\_table()}: para arquivos de texto tabular com colunas separadas por espaço.
\item
  \texttt{read\_fwf()}: para arquivos compactos que devem ter a largura de cada coluna especificada.
\item
  \texttt{read\_log()}: para arquivos padrões de log.
\end{itemize}

Vamos mostrar na próxima seção como importar as extensões mais comuns: \texttt{.csv} e \texttt{.txt}.

\hypertarget{lendo-arquivos-de-texto}{%
\subsection{Lendo arquivos de texto}\label{lendo-arquivos-de-texto}}

Como exemplo, utilizaremos uma base de filmes do IMDB, gravada em diversos formatos. O download dos arquivos pode ser realizado \href{https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.zip}{clicando aqui}.

Primeiro, vamos ler a base em formato \texttt{.csv}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"imdb.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## -- Column specification -------------------------------------------------------------------------------
## cols(
##   titulo = col_character(),
##   ano = col_double(),
##   diretor = col_character(),
##   duracao = col_double(),
##   cor = col_character(),
##   generos = col_character(),
##   pais = col_character(),
##   classificacao = col_character(),
##   orcamento = col_double(),
##   receita = col_double(),
##   nota_imdb = col_double(),
##   likes_facebook = col_double(),
##   ator_1 = col_character(),
##   ator_2 = col_character(),
##   ator_3 = col_character()
## )
\end{verbatim}

A mensagem retornada pela função indica qual classe foi atribuída para cada coluna. Repare que o argumento \texttt{file=} representa o caminho até o arquivo. Se o arquivo a ser lido não estiver no diretório de trabalho da sua sessão, você precisa especificar o caminho até o arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Se o arquivo estiver dentro de uma pasta chamada dados.}
\NormalTok{imdb\_csv }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv}\NormalTok{(}\AttributeTok{file =} \StringTok{"dados/imdb.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A maioria das funções de leitura do \texttt{\{readr\}} possuem argumentos muito úteis para resolver problemas de importação:

\begin{itemize}
\item
  \texttt{col\_names=}: indica se a primeira linha da base contém ou não o nome das colunas. Também pode ser utilizado para (re)nomear colunas.
\item
  \texttt{col\_types=}: caso alguma coluna seja importada com a classe errada (uma coluna de números foi importada como texto, por exemplo), você pode usar esse argumento para especificar a classe das colunas.
\item
  \texttt{locale=}: útil para tratar problema de \emph{encoding}.
\item
  \texttt{skip=}: pula linhas no começo do arquivo antes de iniciar a importação. Útil para quando o arquivo a ser importado vem com metadados ou qualquer tipo de texto nas primeiras linhas, antes da base.
\item
  \texttt{na=}: indica quais \emph{strings} deverão ser considaras \texttt{NA} na hora da importação.
\end{itemize}

Em alguns países, como o Brasil, as vírgulas são utilizadas para separar as casas decimais dos números, inviabilizando o uso de arquivos \texttt{.csv}. Nesses casos, quando a vírgula é o separador de decimal, os arquivos \texttt{.csv} passam a ser separados por ponto-e-vírgula. Para importar bases de arquivos separados por ponto-e-vírgula no R, basta usar a função \texttt{read\_csv2()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_csv2 }\OtherTok{\textless{}{-}} \FunctionTok{read\_csv2}\NormalTok{(}\StringTok{"dados/imdb2.csv"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Arquivos \texttt{.txt} em geral podem ser lidos com a função \texttt{read\_delim()}. Além do caminho até o arquivo, você também precisa indicar qual é o caractere utilizado para separar as colunas da base. Um arquivo separado por tabulação, por exemplo, pode ser lido utilizando a o código abaixo. O código \texttt{\textbackslash{}t} é uma forma textual de representar a tecla TAB.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_txt }\OtherTok{\textless{}{-}} \FunctionTok{read\_delim}\NormalTok{(}\StringTok{"dados/imdb.txt"}\NormalTok{, }\AttributeTok{delim =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Repare que a sintaxe é igual a da função \texttt{read\_csv()}. Em geral, as funções de importação do \texttt{\{tidyverse\}} terão sintaxe e comportamento muito parecidos.

A seguir, vamos falar das funções \texttt{parse\_()}, muito úteis para tratar problemas na classe das variáveis na hora da importação.

\hypertarget{locale}{%
\subsection{Locale}\label{locale}}

Muitas funções de importação e formatação possuem um argumento \texttt{locale}. Esse argumento é utilizado para definir opções de formatação próprias de uma certa localidade, como idioma, formato de data e hora, fuso horário, separador de decimal e milhar ou encoding.

O pacote \texttt{\{readr\}} possui uma função chamada \texttt{locale()}, que pode ser utilizada para definir todos esses atributos. Para saber quais são os padrões atualmente definidos na sua sessão, basta rodar:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{locale}\NormalTok{()}
\DocumentationTok{\#\# \textless{}locale\textgreater{}}
\DocumentationTok{\#\# Numbers:  123,456.78}
\DocumentationTok{\#\# Formats:  \%AD / \%AT}
\DocumentationTok{\#\# Timezone: UTC}
\DocumentationTok{\#\# Encoding: UTF{-}8}
\DocumentationTok{\#\# \textless{}date\_names\textgreater{}}
\DocumentationTok{\#\# Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed), Thursday}
\DocumentationTok{\#\#         (Thu), Friday (Fri), Saturday (Sat)}
\DocumentationTok{\#\# Months: January (Jan), February (Feb), March (Mar), April (Apr), May (May),}
\DocumentationTok{\#\#         June (Jun), July (Jul), August (Aug), September (Sep), October}
\DocumentationTok{\#\#         (Oct), November (Nov), December (Dec)}
\DocumentationTok{\#\# AM/PM:  AM/PM}
\end{Highlighting}
\end{Shaded}

Em geral, teremos padrões norte-americanos. Se quisermos que os nomes de dias e meses fiquem em português, podemos fazer:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{locale}\NormalTok{(}\AttributeTok{date\_names =} \StringTok{"pt"}\NormalTok{)}
\DocumentationTok{\#\# \textless{}locale\textgreater{}}
\DocumentationTok{\#\# Numbers:  123,456.78}
\DocumentationTok{\#\# Formats:  \%AD / \%AT}
\DocumentationTok{\#\# Timezone: UTC}
\DocumentationTok{\#\# Encoding: UTF{-}8}
\DocumentationTok{\#\# \textless{}date\_names\textgreater{}}
\DocumentationTok{\#\# Days:   domingo (dom), segunda{-}feira (seg), terça{-}feira (ter), quarta{-}feira}
\DocumentationTok{\#\#         (qua), quinta{-}feira (qui), sexta{-}feira (sex), sábado (sáb)}
\DocumentationTok{\#\# Months: janeiro (jan), fevereiro (fev), março (mar), abril (abr), maio (mai),}
\DocumentationTok{\#\#         junho (jun), julho (jul), agosto (ago), setembro (set), outubro}
\DocumentationTok{\#\#         (out), novembro (nov), dezembro (dez)}
\DocumentationTok{\#\# AM/PM:  AM/PM}
\end{Highlighting}
\end{Shaded}

Ou trocar o separador de decimal de ponto para vírgula, caso a base a ser importada esteja nesse formato.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{locale}\NormalTok{(}\AttributeTok{decimal\_mark =} \StringTok{","}\NormalTok{)}
\DocumentationTok{\#\# \textless{}locale\textgreater{}}
\DocumentationTok{\#\# Numbers:  123.456,78}
\DocumentationTok{\#\# Formats:  \%AD / \%AT}
\DocumentationTok{\#\# Timezone: UTC}
\DocumentationTok{\#\# Encoding: UTF{-}8}
\DocumentationTok{\#\# \textless{}date\_names\textgreater{}}
\DocumentationTok{\#\# Days:   Sunday (Sun), Monday (Mon), Tuesday (Tue), Wednesday (Wed), Thursday}
\DocumentationTok{\#\#         (Thu), Friday (Fri), Saturday (Sat)}
\DocumentationTok{\#\# Months: January (Jan), February (Feb), March (Mar), April (Apr), May (May),}
\DocumentationTok{\#\#         June (Jun), July (Jul), August (Aug), September (Sep), October}
\DocumentationTok{\#\#         (Oct), November (Nov), December (Dec)}
\DocumentationTok{\#\# AM/PM:  AM/PM}
\end{Highlighting}
\end{Shaded}

A função \texttt{locale()} deve ser utilizada dentro das funções \texttt{read\_()}, no argumento \texttt{locale}. Uma utilização muito comum é a definição do \emph{encoding} do arquivo. O encoding se refere a como o computador traduz os caracteres que vemos na tela para os valores binários que ele utiliza internamente. Existem vários tipos de encoding e isso é um problema principalmente porque o Windows utiliza um encoding diferente do Linux/Mac. Você saberá que tem um problema de encoding quando letras com acento ou outros caracteres especiais ficarem desconfigurados após importar uma base para o R.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vamos produzir um problema de encoding}

\NormalTok{frase\_com\_acentos }\OtherTok{\textless{}{-}} \StringTok{"Você comerá uma maçã amanhã à tarde"}

\CommentTok{\# Vendo encoding. UTF{-}8 é o padrão do Linux/Mac}
\FunctionTok{Encoding}\NormalTok{(frase\_com\_acentos)}
\DocumentationTok{\#\# [1] "UTF{-}8"}

\CommentTok{\# Forçando um novo encoding. }
\CommentTok{\# latin1 é um dos padrões que funcionam no Windows.}
\FunctionTok{Encoding}\NormalTok{(frase\_com\_acentos) }\OtherTok{\textless{}{-}}  \StringTok{"latin1"}

\CommentTok{\# Agora temos um problema de encoding}
\NormalTok{frase\_com\_acentos}
\DocumentationTok{\#\# [1] "VocÃª comerÃ¡ uma maÃ§Ã£ amanhÃ£ Ã  tarde"}
\end{Highlighting}
\end{Shaded}

Quando estivermos enfrentando esse problema, devemos dizer à função \texttt{read\_()} qual o encoding deve ser utilizado no arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_csv}\NormalTok{(}\StringTok{"base\_que\_veio\_do\_windows.csv"}\NormalTok{, }\AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{encoding =} \StringTok{"latin1"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

O \texttt{latin1} é apenas um dos encodings que podem funcionar em arquivos do Windows. Outras sugestões são: \texttt{windows-1250}, \texttt{windows-1252}, \texttt{ISO-8859-2} e \texttt{ISO-8859-1}. Se você estiver lendo um arquivo cruado no Linux/Mac no Windows, basta usar o encoding \texttt{UTF-8}.

\begin{quote}
Eu consegui resolver 99\% dos meus problemas de encoding quando passei a fingir que o Windows não existe. --- Julio Trecenti
\end{quote}

Na seção a seguir, mostramos mais alguns exemplos da função \texttt{locale()}.

\hypertarget{parseando-valores}{%
\subsection{Parseando valores}\label{parseando-valores}}

O pacote \texttt{\{readr\}} possui algumas funções muito úteis para parsear valores. Parsear é um termo muito utilizado em programação e tem o sentido de \emph{arrumar} ou \emph{formatar}. Se estamos parseando um número, por exemplo, estamos pegando um texto que é muito parecido com um número e o transforando em um número de fato.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{parse\_number}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"5"}\NormalTok{, }\StringTok{"5.0"}\NormalTok{, }\StringTok{"5,0"}\NormalTok{, }\StringTok{"R$5.00"}\NormalTok{, }\StringTok{"5 a"}\NormalTok{))}
\DocumentationTok{\#\# [1]  5  5 50  5  5}
\end{Highlighting}
\end{Shaded}

\textbackslash begin\{figure\}

\{\centering \includegraphics[width=49.19in]{assets/img/importacao/parse_number}

\}

\textbackslash caption\{Arte por Allison Horst (\citet{allison_horst}). Veja nas Referências onde encontrá-la.\}\label{fig:unnamed-chunk-14}
\textbackslash end\{figure\}

Veja que podemos usar o argumento \texttt{locale} para especificar coordenadas para o parseamento

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{parse\_number}\NormalTok{(}\StringTok{"5,0"}\NormalTok{, }\AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{decimal\_mark =} \StringTok{","}\NormalTok{))}
\DocumentationTok{\#\# [1] 5}
\end{Highlighting}
\end{Shaded}

ou o idioma usado em datas

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Inglês}
\FunctionTok{parse\_date}\NormalTok{(}
  \StringTok{"01/June/2010"}\NormalTok{, }
  \AttributeTok{format =} \StringTok{"\%d/\%B/\%Y"}
\NormalTok{)}
\DocumentationTok{\#\# [1] "2010{-}06{-}01"}

\CommentTok{\# Português}
\FunctionTok{parse\_date}\NormalTok{(}
  \StringTok{"01/Junho/2010"}\NormalTok{, }
  \AttributeTok{format =} \StringTok{"\%d/\%B/\%Y"}\NormalTok{,}
  \AttributeTok{locale =} \FunctionTok{locale}\NormalTok{(}\AttributeTok{date\_names =} \StringTok{"pt"}\NormalTok{)}
\NormalTok{)}
\DocumentationTok{\#\# [1] "2010{-}06{-}01"}
\end{Highlighting}
\end{Shaded}

Você também pode especificar \texttt{NAs} utilizando o argumento \texttt{na}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{parse\_number}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"5"}\NormalTok{, }\StringTok{"5.0"}\NormalTok{, }\StringTok{"5,0"}\NormalTok{, }\StringTok{"R$5.00"}\NormalTok{, }\StringTok{"5 a"}\NormalTok{), }\AttributeTok{na =} \StringTok{"5 a"}\NormalTok{)}
\DocumentationTok{\#\# [1]  5  5 50  5 NA}
\end{Highlighting}
\end{Shaded}

Outras funções de parseamento úteis são:

\begin{itemize}
\tightlist
\item
  \texttt{readr::parse\_integer()}, para parsear números inteiros.
\item
  \texttt{readr::parse\_character()}, para parsear strings
\item
  \texttt{readr::parse\_date()}, \texttt{readr::parse\_time()}, \texttt{readr::parse\_datetime()}para parsear datas, horas e data/horas.
\end{itemize}

Todas essas funções são utilizadas nas colunas de uma base quando utilizamos as funções de importação do \texttt{\{readr\}}. Assim, se algum valor foi modificado incorretamente durante a importação, você pode testar importar tudo como texto (\texttt{character}) e usar essas funções para reproduzir a transformação que o \texttt{\{readr\}} fez.

\hypertarget{escrevendo-arquivos-de-texto}{%
\subsection{Escrevendo arquivos de texto}\label{escrevendo-arquivos-de-texto}}

Para a maioria das funções \texttt{read\_}, existe uma respectiva função \texttt{write\_}. Essas funções servem para salvar bases em um formato específico de arquivo. Além do caminho/nome do arquivo a ser criado, você também precisa passar o objeto que será escrito. Para o arquivo criado funcionar corretamente, você precisa especificar a extensão correta no nome do arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Arquivo .csv}
\FunctionTok{write\_csv}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{path =} \StringTok{"data/mtcars.csv"}\NormalTok{)}

\CommentTok{\# Base separada por tabulação}
\FunctionTok{write\_delim}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mtcars, }\AttributeTok{path =} \StringTok{"data/mtcars.txt"}\NormalTok{, }\AttributeTok{delim =} \StringTok{"}\SpecialCharTok{\textbackslash{}t}\StringTok{"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{arquivos-.rds}{%
\subsection{Arquivos .rds}\label{arquivos-.rds}}

A linguagem R tem uma extensão própria de arquivos binários chamada \texttt{RDS} ou \texttt{.rds}. Essa extensão pode ser utilizada para guarda qualquer tipo de objeto do R, inclusive bases de dados. Temos duas principais vantagens ao utilizarmos essa extensão para salvarvamos as nossas bases:

\begin{itemize}
\item
  ele salva as classes especificadas para as colunas;
\item
  ele pode ser compactado, gerando arquivos muito menores.
\end{itemize}

A desvantagem é que ele só poderá ser lido dentro do R.

Para criar um arquivo \texttt{.rds}, utilize a função \texttt{write\_rds()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_rds}\NormalTok{(mtcars, }\AttributeTok{path =} \StringTok{"mtcars.rds"}\NormalTok{, }\AttributeTok{compress =} \StringTok{"gz"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O argumento \texttt{compress} é opcional e indica qual o tipo de compactação deve ser feito. O padrão é não compactar.

Para ler um arquivo \texttt{.rds} de volta para o R, utilizamos a função \texttt{read\_rds()}. Repare que essa função não possui outros argumentos, pois o objeto importado será exatamente igual ao objeto que foi gravado no arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_rds }\OtherTok{\textless{}{-}} \FunctionTok{read\_rds}\NormalTok{(}\AttributeTok{path =} \StringTok{"imdb.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{exercuxedcios-9}{%
\subsection*{Exercícios}\label{exercuxedcios-9}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Qual a diferença entre as funções \texttt{read\_csv()} e \texttt{read\_csv2()}?

\textbf{2.} Leia o arquivo \texttt{imdb.csv} utilizando a função \texttt{read\_delim()}.

\textbf{3.} Escreva a base mtcars em um arquivo \texttt{mtcars.csv} que não contenha o nome das colunas.

\textbf{4.} Use a função \texttt{write\_rds()} para salvar em arquivos

\begin{itemize}
\item
  \textbf{a)} Um número.
\item
  \textbf{b)} Um vetor de strings.
\item
  \textbf{c)} Uma lista com valores númericos, textuais e lógicos.
\item
  \textbf{d)} As 3 primeiras colunas da base \texttt{mtcars}.
\end{itemize}

\textbf{5.} Utilize a função \texttt{read\_rds()} para importar de volta para o R os arquivos criados no exercício 4.

\hypertarget{readxl}{%
\section{Os pacotes readxl e writexl}\label{readxl}}

Para ler planilhas do Excel (arquivos \texttt{.xlsx} ou \texttt{.xls}), basta utilizarmos a função \texttt{read\_excel()} do pacote \texttt{readxl}. Instale o pacote antes caso você ainda não o tenha instalado.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"readxl"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(readxl)}

\NormalTok{imdb\_xlsx }\OtherTok{\textless{}{-}} \FunctionTok{read\_xls}\NormalTok{(}\StringTok{"dados/imdb.xlss"}\NormalTok{)}
\NormalTok{imdb\_xlsx }\OtherTok{\textless{}{-}} \FunctionTok{read\_xlsx}\NormalTok{(}\StringTok{"dados/imdb.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

A funçao \texttt{read\_excel()} auto detecta a extensão do arquivo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_excel}\NormalTok{(}\AttributeTok{path =} \StringTok{"assets/data/imdb.xls"}\NormalTok{)}
\FunctionTok{read\_excel}\NormalTok{(}\AttributeTok{path =} \StringTok{"assets/data/imdb.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O pacote disponibiliza 5 exemplos de arquivos com formato \texttt{.xls} e \texttt{.xlsx}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{readxl\_example}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "clippy.xls"    "clippy.xlsx"   "datasets.xls"  "datasets.xlsx"
##  [5] "deaths.xls"    "deaths.xlsx"   "geometry.xls"  "geometry.xlsx"
##  [9] "type-me.xls"   "type-me.xlsx"
\end{verbatim}

Vamos pegar o caminho até o arquivo \texttt{datasets.xlsx} usando a função \texttt{readxl\_example()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{caminho\_datasets }\OtherTok{\textless{}{-}} \FunctionTok{readxl\_example}\NormalTok{(}\StringTok{"datasets.xlsx"}\NormalTok{)}
\NormalTok{caminho\_datasets}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "/Library/Frameworks/R.framework/Versions/4.1/Resources/library/readxl/extdata/datasets.xlsx"
\end{verbatim}

No Excel, um arquivo pode ter várias planilhas. Esse é o caso do arquivo \texttt{datasets.xlsx}. Você pode ver quais planilhas fazem parte do arquivo utilizando a função \texttt{excel\_sheets()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{excel\_sheets}\NormalTok{(caminho\_datasets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "iris"     "mtcars"   "chickwts" "quakes"
\end{verbatim}

Por padrão, as funções de leitura trarão apenas a primeira planilha do arquivo. Para trazer outra planilha, basta utilizarmos o argumento \texttt{sheet}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pega a primeira planilha}
\FunctionTok{read\_excel}\NormalTok{(caminho\_datasets)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 150 x 5
##    Sepal.Length Sepal.Width Petal.Length Petal.Width Species
##           <dbl>       <dbl>        <dbl>       <dbl> <chr>  
##  1          5.1         3.5          1.4         0.2 setosa 
##  2          4.9         3            1.4         0.2 setosa 
##  3          4.7         3.2          1.3         0.2 setosa 
##  4          4.6         3.1          1.5         0.2 setosa 
##  5          5           3.6          1.4         0.2 setosa 
##  6          5.4         3.9          1.7         0.4 setosa 
##  7          4.6         3.4          1.4         0.3 setosa 
##  8          5           3.4          1.5         0.2 setosa 
##  9          4.4         2.9          1.4         0.2 setosa 
## 10          4.9         3.1          1.5         0.1 setosa 
## # ... with 140 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pega a segunda planilha}
\FunctionTok{read\_excel}\NormalTok{(caminho\_datasets, }\AttributeTok{sheet =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # ... with 22 more rows
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pega a planilha selecionada}
\FunctionTok{read\_excel}\NormalTok{(caminho\_datasets, }\AttributeTok{sheet =} \StringTok{\textquotesingle{}chickwts\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 71 x 2
##    weight feed     
##     <dbl> <chr>    
##  1    179 horsebean
##  2    160 horsebean
##  3    136 horsebean
##  4    227 horsebean
##  5    217 horsebean
##  6    168 horsebean
##  7    108 horsebean
##  8    124 horsebean
##  9    143 horsebean
## 10    140 horsebean
## # ... with 61 more rows
\end{verbatim}

A seguir, listamos outros argumentos úteis da função \texttt{read\_excel()}:

\begin{itemize}
\item
  \texttt{col\_names} indica se a primeira linha representa o nome das colunas;
\item
  \texttt{col\_types=} para definir a classe das colunas;
\item
  \texttt{skip=} para pular linhas no começo da planilha;
\item
  \texttt{na=} indica quais strings devem ser interpretadas como NA.
\end{itemize}

Também podemos escrever um arquivo Excel (com extensão \texttt{.xlsx}) utilizando a função \texttt{write\_xlsx()} do pacote \texttt{writexl}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"writexl"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(writexl)}

\FunctionTok{write\_excel}\NormalTok{(mtcars, }\StringTok{"imdb.xlsx"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{haven}{%
\section{haven}\label{haven}}

Para ler arquivos gerados por outros softwares, como SPSS, SAS e STATA, você pode usar as funções do pacote \texttt{haven}. Este pacote faz parte do \texttt{tidyverse} e é um wrapper da biblioteca ReadStat, escrita em C.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(haven)}

\NormalTok{imdb\_sas }\OtherTok{\textless{}{-}} \FunctionTok{read\_sas}\NormalTok{(}\StringTok{"assets/data/imdb.sas7bdat"}\NormalTok{)}
\NormalTok{imdb\_spss }\OtherTok{\textless{}{-}} \FunctionTok{read\_spss}\NormalTok{(}\StringTok{"assets/data/imdb.sav"}\NormalTok{)}
\NormalTok{imdb\_dta }\OtherTok{\textless{}{-}} \FunctionTok{read\_dta}\NormalTok{(}\StringTok{"assets/data/imdb.dta"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

É possível salvar ou escrever bases em SAS e STATA com as funções \texttt{write\_sas} e \texttt{write\_dta}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_dta}\NormalTok{(mtcars, }\StringTok{\textquotesingle{}assets/data/mtcars.dta\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Quando importamos arquivos gerados pelo SAS SPSS ou STATA para o R, os rótulos de uma variável podem não ser importados de forma correta. O pacote \texttt{haven} tem uma soluçao para este problema.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{labelled}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\AttributeTok{Ruim =} \DecValTok{1}\NormalTok{, }\AttributeTok{Bom =} \DecValTok{2}\NormalTok{, }\AttributeTok{Otimo =} \DecValTok{3}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\texttt{labelled()} adiciona rótulos à valores de uma variável. Para verificar quais são estes rótulos, podemos usar a função \texttt{print\_labels()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{print\_labels}\NormalTok{(x)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Labels:
##  value label
##      1  Ruim
##      2   Bom
##      3 Otimo
\end{verbatim}

Existe uma função similar a \texttt{labelled()}, exclusiva para o SPSS, que além de rotular as variáveis, também defini quais símbolos representam valores faltantes, dado que em SPSS pode haver mais de um tipo de \emph{missing}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 }\OtherTok{\textless{}{-}} \FunctionTok{labelled\_spss}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{1}\NormalTok{,}\DecValTok{0}\NormalTok{,}\DecValTok{2}\NormalTok{,}\DecValTok{4}\NormalTok{), }\FunctionTok{c}\NormalTok{(}\AttributeTok{Ruim =} \DecValTok{1}\NormalTok{,}\AttributeTok{Bom =} \DecValTok{2}\NormalTok{, }\AttributeTok{Otimo =} \DecValTok{3}\NormalTok{), }\AttributeTok{na\_values =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{,}\DecValTok{4}\NormalTok{))}
    
\FunctionTok{is.na}\NormalTok{(x1)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE  TRUE
\end{verbatim}

Agora que já definimos os \emph{missings} ``especiais'', podemos transformá-los no \emph{missing} padrão do R, representado pelo símbolo \emph{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x1 }\OtherTok{\textless{}{-}} \FunctionTok{zap\_missing}\NormalTok{(x1)}
\NormalTok{x1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  1  3 NA  2  2  1 NA  2 NA
## attr(,"labels")
##  Ruim   Bom Otimo 
##     1     2     3 
## attr(,"class")
## [1] "haven_labelled"
\end{verbatim}

Existem outras funções \texttt{zap\_} interessantes no \href{https://cran.r-project.org/web/packages/haven/haven.pdf}{pacote}.

Após rotular os valores do vetor, podemos convertê-los, por exemplo, em fator. Para isso, usamos uma função do pacote \texttt{haven}.
A função base \texttt{as.factor()} também poderia ser usada, mas quando a usamos, os rótulos não são considerados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_base }\OtherTok{\textless{}{-}}\NormalTok{ base}\SpecialCharTok{::}\FunctionTok{as.factor}\NormalTok{(x)}
\FunctionTok{levels}\NormalTok{(x\_base)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "1" "2" "3"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x\_factor }\OtherTok{\textless{}{-}}\NormalTok{ haven}\SpecialCharTok{::}\FunctionTok{as\_factor}\NormalTok{(x)}
\FunctionTok{levels}\NormalTok{(x\_factor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Ruim"  "Bom"   "Otimo"
\end{verbatim}

\hypertarget{pipe}{%
\chapter{Pipe}\label{pipe}}

O operador \texttt{\%\textgreater{}\%} (\emph{pipe}) foi uma das grandes revoluções recentes do R, tornando a escrita e leitura de códigos mais intuitiva e compreensível. Ele foi introduzido por \href{https://github.com/smbache}{Stefan Milton Bache} no pacote \texttt{magrittr}, cujo nome é uma referência ao famoso quadro do pintor belga René Magritte \emph{La Trahison des images (Ceci n'est pas une pipe)}.

\begin{figure}
\centering
\includegraphics{assets/img/pipe/ceci-nest-pas-une-pipe.jpg}
\caption{\label{fig:unnamed-chunk-2}Reprodução do quadro La Trahison des images (Ceci n'est pas une pipe). do pintor René Magritte.}
\end{figure}

Para começar a utilizar o \emph{pipe}, instale e carregue o pacote \texttt{magrittr}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"magrittr"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(magrittr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{o-operador-pipe}{%
\section{O operador pipe}\label{o-operador-pipe}}

A ideia do operador \texttt{\%\textgreater{}\%} (\emph{pipe}) é bem simples: usar o valor resultante da expressão do lado esquerdo como primeiro argumento da função do lado direito.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# As duas linhas abaixo são equivalentes.}

\FunctionTok{f}\NormalTok{(x, y)}
\NormalTok{x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{f}\NormalTok{(y)}
\end{Highlighting}
\end{Shaded}

Nos casos mais simples, o \emph{pipe} parece não trazer grandes vantagens. Agora, veja como fica um caso com mais etapas.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vamos calcular a raiz quadrada da soma dos valores de 1 a 4. Primeiro, sem o pipe.}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\FunctionTok{sqrt}\NormalTok{(}\FunctionTok{sum}\NormalTok{(x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.162278
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Agora com o pipe.}

\NormalTok{x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{sum}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{sqrt}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3.162278
\end{verbatim}

O caminho que o código \texttt{x\ \%\textgreater{}\%\ sum\ \%\textgreater{}\%\ sqrt} seguiu foi enviar o objeto \texttt{x} como argumento da função \texttt{sum()} e, em seguida, enviar a saida da expressão \texttt{sum(x)} como argumento da função \texttt{sqrt()}. Observe que escrevemos o código na mesma ordem em que as operações são realizadas. A utilização de parênteses após o nome das funções não é necessário, mas recomendável.

Se você ainda não está convencido com o poder do \emph{pipe}, fica que vai ter bolo!

No exemplo abaixo, vamos ilustrar um caso em que temos um grande número de funções aninhadas. Veja como a utilização do \emph{pipe} transforma um código confuso e difícil de ser lido em algo simples e intuitivo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Receita de bolo sem pipe. Tente entender o que é preciso fazer.}

\FunctionTok{esfrie}\NormalTok{(}
  \FunctionTok{asse}\NormalTok{(}
    \FunctionTok{coloque}\NormalTok{(}
      \FunctionTok{bata}\NormalTok{(}
        \FunctionTok{acrescente}\NormalTok{(}
          \FunctionTok{recipiente}\NormalTok{(}
            \FunctionTok{rep}\NormalTok{(}\StringTok{"farinha"}\NormalTok{, }\DecValTok{2}\NormalTok{), }
            \StringTok{"água"}\NormalTok{, }
            \StringTok{"fermento"}\NormalTok{, }
            \StringTok{"leite"}\NormalTok{, }
            \StringTok{"óleo"}
\NormalTok{          ), }
          \StringTok{"farinha"}\NormalTok{, }
          \AttributeTok{ate =} \StringTok{"macio"}
\NormalTok{        ), }
        \AttributeTok{duracao =} \StringTok{"3min"}
\NormalTok{      ), }
      \AttributeTok{lugar =} \StringTok{"forma"}\NormalTok{, }
      \AttributeTok{tipo =} \StringTok{"grande"}\NormalTok{, }
      \AttributeTok{untada =} \ConstantTok{TRUE}
\NormalTok{    ), }
    \AttributeTok{duracao =} \StringTok{"50min"}
\NormalTok{  ), }
  \AttributeTok{lugar =} \StringTok{"geladeira"}\NormalTok{, }
  \AttributeTok{duracao =} \StringTok{"20min"}
\NormalTok{)}


\CommentTok{\# Veja como o código acima pode ser reescrito utilizando{-}se o pipe. Agora realmente se parece com uma receita de bolo.}

\FunctionTok{recipiente}\NormalTok{(}\FunctionTok{rep}\NormalTok{(}\StringTok{"farinha"}\NormalTok{, }\DecValTok{2}\NormalTok{), }\StringTok{"água"}\NormalTok{, }\StringTok{"fermento"}\NormalTok{, }\StringTok{"leite"}\NormalTok{, }\StringTok{"óleo"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{acrescente}\NormalTok{(}\StringTok{"farinha"}\NormalTok{, }\AttributeTok{ate =} \StringTok{"macio"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{bata}\NormalTok{(}\AttributeTok{duracao =} \StringTok{"3min"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{coloque}\NormalTok{(}\AttributeTok{lugar =} \StringTok{"forma"}\NormalTok{, }\AttributeTok{tipo =} \StringTok{"grande"}\NormalTok{, }\AttributeTok{untada =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{asse}\NormalTok{(}\AttributeTok{duracao =} \StringTok{"50min"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{esfrie}\NormalTok{(}\AttributeTok{lugar =} \StringTok{"geladeira"}\NormalTok{, }\AttributeTok{duracao =} \StringTok{"20min"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Às vezes, queremos que o resultado do lado esquerdo vá para outro argumento do lado direito que não o primeiro. Para isso, utilizamos um \texttt{.} como marcador.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Queremos que o dataset seja recebido pelo segundo argumento (data=) da função "lm".}

\NormalTok{airquality }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{na.omit}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{lm}\NormalTok{(Ozone }\SpecialCharTok{\textasciitilde{}}\NormalTok{ Wind }\SpecialCharTok{+}\NormalTok{ Temp }\SpecialCharTok{+}\NormalTok{ Solar.R, }\AttributeTok{data =}\NormalTok{ .) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summary}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 
## Call:
## lm(formula = Ozone ~ Wind + Temp + Solar.R, data = .)
## 
## Residuals:
##     Min      1Q  Median      3Q     Max 
## -40.485 -14.219  -3.551  10.097  95.619 
## 
## Coefficients:
##              Estimate Std. Error t value Pr(>|t|)    
## (Intercept) -64.34208   23.05472  -2.791  0.00623 ** 
## Wind         -3.33359    0.65441  -5.094 1.52e-06 ***
## Temp          1.65209    0.25353   6.516 2.42e-09 ***
## Solar.R       0.05982    0.02319   2.580  0.01124 *  
## ---
## Signif. codes:  0 '***' 0.001 '**' 0.01 '*' 0.05 '.' 0.1 ' ' 1
## 
## Residual standard error: 21.18 on 107 degrees of freedom
## Multiple R-squared:  0.6059, Adjusted R-squared:  0.5948 
## F-statistic: 54.83 on 3 and 107 DF,  p-value: < 2.2e-16
\end{verbatim}

O \emph{pipe} é a força da gravidade dentro do \texttt{tidyverse}. Veremos nos próximos capítulos como as funções de diferentes pacotes interagem perfeitamente graças a esse operador.

\hypertarget{exercuxedcios-10}{%
\subsection*{Exercícios}\label{exercuxedcios-10}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Reescreva a expressão abaixo utilizando o \texttt{\%\textgreater{}\%}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(}\FunctionTok{sum}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}\SpecialCharTok{/}\DecValTok{3}\NormalTok{), }\AttributeTok{digits =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{Dica}: utilize a função \texttt{magrittr::divide\_by()}. Veja o help da função para mais informações.

\textbf{2.} Reescreva o código abaixo utilizando o \texttt{\%\textgreater{}\%}.

\begin{Shaded}
\begin{Highlighting}[]

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}

\NormalTok{x.pos }\OtherTok{\textless{}{-}}\NormalTok{ x[x}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{]}

\NormalTok{media }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(x.pos)}

\NormalTok{saida }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(media, }\DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{3.} Sem rodar, diga qual a saída do código abaixo. Consulte o help das funções caso precise.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{, }\ConstantTok{NA}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mean}\NormalTok{(}\AttributeTok{na.rm =}\NormalTok{ T) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{equals}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{outros-operadores}{%
\section{Outros operadores}\label{outros-operadores}}

O pacote \texttt{\{magrittr\}} possui outros operadores, que, embora sejam menos utilizados, também são úteis. São eles:

\begin{itemize}
\item
  \emph{Assignment operator} \texttt{\%\textless{}\textgreater{}\%}
\item
  \emph{Operador tee} \texttt{\%T\textgreater{}\%}
\item
  \emph{Exposition operator} \texttt{\%\$\%}
\end{itemize}

Imagine que queremos tirar a raiz quadrada de um vetor de números.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{)}

\NormalTok{x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{sqrt}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.000000 1.414214 1.732051 2.000000 2.236068
\end{verbatim}

Se quisermos sobrescrever o objeto \texttt{x} com a raiz quadrada dos seus valores, basta utilizarmos o nosso bom e velho operador de atribuição \texttt{\textless{}-}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}}\NormalTok{ x }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{sqrt}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Podemos, no entanto, utilizar o operador \texttt{\%\textless{}\textgreater{}\%} para reescrever o código acima de uma maneira mais compacta.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{x }\SpecialCharTok{\%\textless{}\textgreater{}\%} \FunctionTok{sqrt}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

Além de mandar o objeto \texttt{x} para o primeiro argumento da função \texttt{sqrt()}, assim como o \texttt{\%\textgreater{}\%} faria, esse operador também salva o resultado da operação de volta no objeto \texttt{x}, o sobrescrevendo.

Este operador pode ser usado sempre que desejamos fazer algo da forma

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{objeto }\OtherTok{\textless{}{-}}\NormalTok{ objeto }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{funcao\_1}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{funcao\_2}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  ...}
  \FunctionTok{funcao\_n}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

O operador \texttt{\%T\textgreater{}\%} retorna o valor do comando anterior a ele, não o resultado do lado direito como o \texttt{\%\textgreater{}\%} faz. O seguinte exemplo vai imprimir na tela os valores de 1 a 10. Se usássemos o pipe, o código retornaria a soma dos dez números.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{1}\SpecialCharTok{:}\DecValTok{10} \SpecialCharTok{\%T\textgreater{}\%} \FunctionTok{sum}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{cat}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 1 2 3 4 5 6 7 8 9 10
\end{verbatim}

Neste caso, o operador não parece fazer sentido e apenas deixa o código mais complicado, mas se desejamos usar funções como \texttt{cat()} ou \texttt{plot()} que não retornam nada, o operador se torna muito útil.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vamos imprimir na tela os valores de 1 a 10 e depois soma{-}los.}
\DecValTok{1}\SpecialCharTok{:}\DecValTok{10} \SpecialCharTok{\%T\textgreater{}\%} 
  \FunctionTok{cat}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sum}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 1 2 3 4 5 6 7 8 9 10
\end{verbatim}

\begin{verbatim}
## [1] 55
\end{verbatim}

O operador \texttt{\%\$\%} pode ser utilizado para \emph{expor} as colunas de um \emph{data frame} para a função aplicada no lado direito.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Podemos chamar qualquer coluna da base diretamente.}
\NormalTok{mtcars }\SpecialCharTok{\%$\%} \FunctionTok{mean}\NormalTok{(mpg)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20.09062
\end{verbatim}

Se não ficou claro o que esse operador está fazendo, imagine que ele transforma todas as colunas da base em objetos (assim como a nefasta função \texttt{attach()}), mas sem salvar nada no nosso \emph{environment}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%$\%}
\NormalTok{  mpg }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mean}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{sqrt}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.482257
\end{verbatim}

Ele faz um papel equivalente ao operador \texttt{\$}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}\SpecialCharTok{$}\NormalTok{mpg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4
## [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7
## [31] 15.0 21.4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%$\%}\NormalTok{ mpg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4
## [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7
## [31] 15.0 21.4
\end{verbatim}

Para mais informações sobre o \texttt{pipe} e outras funções do pacote \texttt{\{magrittr\}}, visite a página \href{http://cran.r-project.org/web/packages/magrittr/vignettes/magrittr.html}{Ceci n'est pas un pipe}.

\hypertarget{manipulacao}{%
\chapter{Manipulação}\label{manipulacao}}

Esta seção trata do tema \emph{manipulação de dados}. Trata-se de uma tarefa dolorosa e demorada, tomando muitas vezes a maior parte do tempo de uma análise de dados. Apesar de negligenciada pela Estatística, essa etapa é essencial para o sucesso da análise.

\begin{quote}
\emph{The fact that data science exists as a field is a colossal failure of statistics. To me, what I do is what statistics is all about. It is gaining insight from data using modelling and visualization. Data munging and manipulation is hard and statistics has just said that's not our domain.} --- Hadley Wickham
\end{quote}

Usualmente, o cientista de dados parte de uma base ``crua'' e a transforma até obter uma base de dados analítica, que, a menos de transformações simples, está preparada para gerar tabelas e gráficos e alimentar modelos.

\begin{figure}

{\centering \includegraphics[width=13.31in]{assets/img/manipulacao/ciclo-ciencia-de-dados} 

}

\caption{Estamos na etapa de arrumação do ciclo da Ciência de Dados.}\label{fig:transform}
\end{figure}

Um conceito importante para obtenção de uma base analítica é o \emph{data tidying}, ou arrumação de dados. Uma base é considerada \emph{tidy} se

\begin{itemize}
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \tightlist
  \item
    Cada linha da base representa uma observação.
  \end{enumerate}
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi}.}
  \setcounter{enumi}{1}
  \tightlist
  \item
    Cada coluna da base representa uma variável.
  \end{enumerate}
\end{itemize}

A base de dados analítica é estruturada de tal forma que pode ser colocada diretamente em ambientes de modelagem estatística ou de visualização. Nem sempre uma base de dados analítica está no formato \emph{tidy}, mas usualmente são necessários poucos passos para migrar de uma para outra. A filosofia \emph{tidy} é a base do \href{https://www.tidyverse.org/}{tidyverse}.

Os principais pacotes encarregados da tarefa de estruturar os dados são o \texttt{dplyr} e o \texttt{tidyr}. Eles serão o tema desse capítulo. Instale e carregue os pacotes utilizando:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"dplyr"}\NormalTok{, }\StringTok{"tidyr"}\NormalTok{))}

\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(tidyr)}
\end{Highlighting}
\end{Shaded}

Mas antes de apresentar as principais funções do \texttt{dplyr} e do \texttt{tidyr}, precisamos falar sobre o conceito de \texttt{tibbles}.

\hypertarget{tibbles}{%
\section{Tibbles}\label{tibbles}}

Uma \emph{tibble} é um \emph{data frame} com ajustes que as deixam mais amigáveis a nós cientistas de dados. Elas são parte do pacote \texttt{\{tibble\}}. Assim, para começar a usá-las, instale e carregue o pacote.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"tibble"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(tibble)}
\end{Highlighting}
\end{Shaded}

Há duas formas de criar uma \emph{tibble}. A primeira é transformar um \emph{data frame} em \emph{tibble} utilizando a função \texttt{as\_tibble()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as\_tibble}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 32 x 11
##      mpg   cyl  disp    hp  drat    wt  qsec    vs    am  gear  carb
##    <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl> <dbl>
##  1  21       6  160    110  3.9   2.62  16.5     0     1     4     4
##  2  21       6  160    110  3.9   2.88  17.0     0     1     4     4
##  3  22.8     4  108     93  3.85  2.32  18.6     1     1     4     1
##  4  21.4     6  258    110  3.08  3.22  19.4     1     0     3     1
##  5  18.7     8  360    175  3.15  3.44  17.0     0     0     3     2
##  6  18.1     6  225    105  2.76  3.46  20.2     1     0     3     1
##  7  14.3     8  360    245  3.21  3.57  15.8     0     0     3     4
##  8  24.4     4  147.    62  3.69  3.19  20       1     0     4     2
##  9  22.8     4  141.    95  3.92  3.15  22.9     1     0     4     2
## 10  19.2     6  168.   123  3.92  3.44  18.3     1     0     4     4
## # ... with 22 more rows
\end{verbatim}

Veja que, por padrão, apenas as dez primeiras linhas da base são apresentadas. Além disso, colunas que não couberem na largura da tela serão omitidas. Também são apresentadas a dimensão da tabela e as classes de cada coluna. Compare a diferença de impressão com relação a um \emph{data frame}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Mazda RX4           21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## Mazda RX4 Wag       21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## Datsun 710          22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Hornet Sportabout   18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## Valiant             18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Merc 240D           24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## Merc 280            19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## Merc 280C           17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 450SL          17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## Merc 450SLC         15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## Cadillac Fleetwood  10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Chrysler Imperial   14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## Fiat 128            32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## Honda Civic         30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Toyota Corona       21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Camaro Z28          13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## Pontiac Firebird    19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## Fiat X1-9           27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Ford Pantera L      15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## Ferrari Dino        19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## Maserati Bora       15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## Volvo 142E          21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
\end{verbatim}

Veja também que, ao contrário dos \emph{data frames}, \emph{tibbles} não utilizam nome nas linhas.

A segunda forma de criar uma \emph{tibble} é a partir de vetores individuais, utilizando a função \texttt{tibble()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{coluna1 =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"d"}\NormalTok{),}
  \AttributeTok{coluna2 =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{,}
  \AttributeTok{coluna3 =}\NormalTok{ coluna2 }\SpecialCharTok{\^{}} \DecValTok{2}\NormalTok{,}
  \AttributeTok{coluna4 =} \DecValTok{0}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 4
##   coluna1 coluna2 coluna3 coluna4
##   <chr>     <int>   <dbl>   <dbl>
## 1 a             1       1       0
## 2 b             2       4       0
## 3 c             3       9       0
## 4 d             4      16       0
\end{verbatim}

Observamos pelo código acima que:

\begin{itemize}
\tightlist
\item
  podemos criar uma coluna a partir de uma função de colunas anteriores (a \texttt{coluna3} é uma função da \texttt{coluna2});
\item
  se passarmos um vetor de tamanho 1 a uma das colunas, esse vetor será reciclado, igualando-se ao número de linha da \emph{tibble} (o \texttt{0} na \texttt{coluna4} é transformado em \texttt{c(0,\ 0,\ 0,\ 0)}).
\end{itemize}

Uma outra diferença entre \emph{data frames} e \emph{tibbles} está no \emph{subsetting}. \emph{Tibbles} \textbf{nunca fazem correspondência parcial}. Tibbles retornam \texttt{NULL} e um aviso quando você tenta selecionar uma coluna que não existe.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O nome da coluna é disp, mas você pode acessá{-}la}
\CommentTok{\# apenas a procurando por "dis", já que não existe}
\CommentTok{\# nenhuma outra coluna que começa com "dis".}
\NormalTok{mtcars}\SpecialCharTok{$}\NormalTok{dis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8
## [13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0
## [25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Em tibbles isso não funciona.}
\NormalTok{mtcars\_tibble }\OtherTok{\textless{}{-}} \FunctionTok{as\_tibble}\NormalTok{(mtcars)}
\NormalTok{mtcars\_tibble}\SpecialCharTok{$}\NormalTok{dis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Unknown or uninitialised column: `dis`.
\end{verbatim}

\begin{verbatim}
## NULL
\end{verbatim}

Além de nos possibilitar a criar \emph{tibbles}, o pacote \texttt{\{tibble\}} possui algumas funções úteis para manipularmos esses objetos:

\begin{itemize}
\item
  \texttt{add\_row()} e \texttt{add\_column()}: para adicionar linhas e colunas a uma \emph{tibble};
\item
  \texttt{rowid\_to\_column()}: cria uma coluna com um \texttt{id} numérico e sequencial para as linhas, começando de \texttt{1}.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{rowid\_to\_column}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    rowid  mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## 1      1 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## 2      2 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## 3      3 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## 4      4 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## 5      5 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## 6      6 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## 7      7 14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## 8      8 24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## 9      9 22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## 10    10 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
\end{verbatim}

\begin{itemize}
\item
  \texttt{has\_rownames()}: verifica se um \emph{data frame} possui linhas nomeadas.
\item
  \texttt{remove\_rownames()}: remove o nome das linhas de um \emph{data frame}.
\item
  \texttt{rownames\_to\_column()}: transforma o nome das linhas em uma coluna.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{rownames\_to\_column}\NormalTok{(mtcars, }\AttributeTok{var =} \StringTok{"modelo\_do\_carro"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##        modelo_do_carro  mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## 1            Mazda RX4 21.0   6 160.0 110 3.90 2.620 16.46  0  1    4    4
## 2        Mazda RX4 Wag 21.0   6 160.0 110 3.90 2.875 17.02  0  1    4    4
## 3           Datsun 710 22.8   4 108.0  93 3.85 2.320 18.61  1  1    4    1
## 4       Hornet 4 Drive 21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## 5    Hornet Sportabout 18.7   8 360.0 175 3.15 3.440 17.02  0  0    3    2
## 6              Valiant 18.1   6 225.0 105 2.76 3.460 20.22  1  0    3    1
## 7           Duster 360 14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## 8            Merc 240D 24.4   4 146.7  62 3.69 3.190 20.00  1  0    4    2
## 9             Merc 230 22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## 10            Merc 280 19.2   6 167.6 123 3.92 3.440 18.30  1  0    4    4
## 11           Merc 280C 17.8   6 167.6 123 3.92 3.440 18.90  1  0    4    4
## 12          Merc 450SE 16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## 13          Merc 450SL 17.3   8 275.8 180 3.07 3.730 17.60  0  0    3    3
## 14         Merc 450SLC 15.2   8 275.8 180 3.07 3.780 18.00  0  0    3    3
## 15  Cadillac Fleetwood 10.4   8 472.0 205 2.93 5.250 17.98  0  0    3    4
## 16 Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## 17   Chrysler Imperial 14.7   8 440.0 230 3.23 5.345 17.42  0  0    3    4
## 18            Fiat 128 32.4   4  78.7  66 4.08 2.200 19.47  1  1    4    1
## 19         Honda Civic 30.4   4  75.7  52 4.93 1.615 18.52  1  1    4    2
## 20      Toyota Corolla 33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## 21       Toyota Corona 21.5   4 120.1  97 3.70 2.465 20.01  1  0    3    1
## 22    Dodge Challenger 15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## 23         AMC Javelin 15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## 24          Camaro Z28 13.3   8 350.0 245 3.73 3.840 15.41  0  0    3    4
## 25    Pontiac Firebird 19.2   8 400.0 175 3.08 3.845 17.05  0  0    3    2
## 26           Fiat X1-9 27.3   4  79.0  66 4.08 1.935 18.90  1  1    4    1
## 27       Porsche 914-2 26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
## 28        Lotus Europa 30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## 29      Ford Pantera L 15.8   8 351.0 264 4.22 3.170 14.50  0  1    5    4
## 30        Ferrari Dino 19.7   6 145.0 175 3.62 2.770 15.50  0  1    5    6
## 31       Maserati Bora 15.0   8 301.0 335 3.54 3.570 14.60  0  1    5    8
## 32          Volvo 142E 21.4   4 121.0 109 4.11 2.780 18.60  1  1    4    2
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \texttt{column\_to\_rownames()}: transforma uma coluna em nomes das linhas.
\end{itemize}

Mais informações sobre \texttt{tibbles} podem ser encontradas \href{https://tibble.tidyverse.org/}{neste tutorial do RStudio} e \href{http://r4ds.had.co.nz/tibbles.html}{neste caplítulo do R for Data Science}.

\hypertarget{dplyr}{%
\section{O pacote dplyr}\label{dplyr}}

O \texttt{dplyr} é o pacote mais útil para realizar transformação de dados, aliando simplicidade e eficiência de uma forma elegante. Os scripts em R que fazem uso inteligente dos verbos \texttt{dplyr} e as facilidades do operador \emph{pipe} tendem a ficar mais legíveis e organizados sem perder velocidade de execução.

As principais funções do \texttt{dplyr} são:

\begin{itemize}
\tightlist
\item
  \texttt{select()} - seleciona colunas
\item
  \texttt{arrange()} - ordena a base
\item
  \texttt{filter()} - filtra linhas
\item
  \texttt{mutate()} - cria/modifica colunas
\item
  \texttt{group\_by()} - agrupa a base
\item
  \texttt{summarise()} - sumariza a base
\end{itemize}

Todas essas funções seguem as mesmas características:

\begin{itemize}
\tightlist
\item
  O \emph{input} é sempre uma \texttt{tibble} e o \emph{output} é sempre um \texttt{tibble}.
\item
  Colocamos a \texttt{tibble} no primeiro argumento e o que queremos fazer nos outros argumentos.
\item
  A utilização é facilitada com o emprego do operador \texttt{\%\textgreater{}\%}.
\end{itemize}

As principais vantagens de se usar o \texttt{dplyr} em detrimento das funções do R base são:

\begin{itemize}
\tightlist
\item
  Manipular dados se torna uma tarefa muito mais simples.
\item
  O código fica mais intuitivo de ser escrito e mais simples de ser lido.
\item
  O pacote \texttt{dplyr} utiliza \texttt{C} e \texttt{C++} por trás da maioria das funções, o que geralmente torna o código mais rápido.
\item
  É possível trabalhar com diferentes fontes de dados, como bases relacionais (SQL) e \texttt{data.table}.
\end{itemize}

Se você ainda não tiver o \texttt{dplyr} instalado, rode o código abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"dplyr"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

Neste capítulo, vamos trabalhar com uma base de filmes do IMDB. Essa base pode ser baixada \href{https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds}{clicando aqui}.

Assim, utilizaremos o objeto \texttt{imdb} para acessar os dados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"imdb.rds"}\NormalTok{)}
\NormalTok{imdb}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

Agora, vamos avaliar com mais detalhes as principais funções do pacote \texttt{dplyr}.

\hypertarget{selecionando-colunas}{%
\subsection{Selecionando colunas}\label{selecionando-colunas}}

Para selecionar colunas, utilizamos a função \texttt{select()}.

O primeiro argumento da função é a base de dados e os demais argumentos são os nomes das colunas que você gostaria de selecionar. Repare que você não precisa colocar o nome da coluna entre aspas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(imdb, titulo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 1
##    titulo                                     
##    <chr>                                      
##  1 Avatar                                     
##  2 Pirates of the Caribbean: At World's End   
##  3 The Dark Knight Rises                      
##  4 John Carter                                
##  5 Spider-Man 3                               
##  6 Tangled                                    
##  7 Avengers: Age of Ultron                    
##  8 Batman v Superman: Dawn of Justice         
##  9 Superman Returns                           
## 10 Pirates of the Caribbean: Dead Man's Chest 
## # ... with 3,797 more rows
\end{verbatim}

Você também pode selecionar várias colunas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(imdb, titulo, ano, orcamento)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 3
##    titulo                                        ano orcamento
##    <chr>                                       <int>     <int>
##  1 Avatar                                       2009 237000000
##  2 Pirates of the Caribbean: At World's End     2007 300000000
##  3 The Dark Knight Rises                        2012 250000000
##  4 John Carter                                  2012 263700000
##  5 Spider-Man 3                                 2007 258000000
##  6 Tangled                                      2010 260000000
##  7 Avengers: Age of Ultron                      2015 250000000
##  8 Batman v Superman: Dawn of Justice           2016 250000000
##  9 Superman Returns                             2006 209000000
## 10 Pirates of the Caribbean: Dead Man's Chest   2006 225000000
## # ... with 3,797 more rows
\end{verbatim}

O operador \texttt{:} é muito útil para selecionar colunas consecutivas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(imdb, titulo}\SpecialCharTok{:}\NormalTok{cor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 5
##    titulo                                     ano diretor          duracao cor  
##    <chr>                                    <int> <chr>              <int> <chr>
##  1 Avatar                                    2009 James Cameron        178 Color
##  2 Pirates of the Caribbean: At World's En~  2007 Gore Verbinski       169 Color
##  3 The Dark Knight Rises                     2012 Christopher Nol~     164 Color
##  4 John Carter                               2012 Andrew Stanton       132 Color
##  5 Spider-Man 3                              2007 Sam Raimi            156 Color
##  6 Tangled                                   2010 Nathan Greno         100 Color
##  7 Avengers: Age of Ultron                   2015 Joss Whedon          141 Color
##  8 Batman v Superman: Dawn of Justice        2016 Zack Snyder          183 Color
##  9 Superman Returns                          2006 Bryan Singer         169 Color
## 10 Pirates of the Caribbean: Dead Man's Ch~  2006 Gore Verbinski       151 Color
## # ... with 3,797 more rows
\end{verbatim}

O \texttt{dplyr} possui o conjunto de funções auxiliares muito úteis para seleção de colunas. As principais são:

\begin{itemize}
\tightlist
\item
  \texttt{starts\_with()}: para colunas que começam com um texto padrão
\item
  \texttt{ends\_with()}: para colunas que terminam com um texto padrão
\item
  \texttt{contains()}: para colunas que contêm um texto padrão
\end{itemize}

Selecionamos a seguir todas as colunas que começam com o texto ``ator''.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(imdb, }\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 3
##    ator_1          ator_2            ator_3              
##    <chr>           <chr>             <chr>               
##  1 CCH Pounder     Joel David Moore  Wes Studi           
##  2 Johnny Depp     Orlando Bloom     Jack Davenport      
##  3 Tom Hardy       Christian Bale    Joseph Gordon-Levitt
##  4 Daryl Sabara    Samantha Morton   Polly Walker        
##  5 J.K. Simmons    James Franco      Kirsten Dunst       
##  6 Brad Garrett    Donna Murphy      M.C. Gainey         
##  7 Chris Hemsworth Robert Downey Jr. Scarlett Johansson  
##  8 Henry Cavill    Lauren Cohan      Alan D. Purwin      
##  9 Kevin Spacey    Marlon Brando     Frank Langella      
## 10 Johnny Depp     Orlando Bloom     Jack Davenport      
## # ... with 3,797 more rows
\end{verbatim}

Para retirar colunas da base, base acrescentar um \texttt{-} antes da seleção.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{ano, }\SpecialCharTok{{-}}\NormalTok{ diretor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 13
##    titulo  duracao cor   generos pais  classificacao orcamento receita nota_imdb
##    <chr>     <int> <chr> <chr>   <chr> <chr>             <int>   <int>     <dbl>
##  1 Avatar      178 Color Action~ USA   A partir de ~ 237000000  7.61e8       7.9
##  2 Pirate~     169 Color Action~ USA   A partir de ~ 300000000  3.09e8       7.1
##  3 The Da~     164 Color Action~ USA   A partir de ~ 250000000  4.48e8       8.5
##  4 John C~     132 Color Action~ USA   A partir de ~ 263700000  7.31e7       6.6
##  5 Spider~     156 Color Action~ USA   A partir de ~ 258000000  3.37e8       6.2
##  6 Tangle~     100 Color Advent~ USA   Livre         260000000  2.01e8       7.8
##  7 Avenge~     141 Color Action~ USA   A partir de ~ 250000000  4.59e8       7.5
##  8 Batman~     183 Color Action~ USA   A partir de ~ 250000000  3.30e8       6.9
##  9 Superm~     169 Color Action~ USA   A partir de ~ 209000000  2.00e8       6.1
## 10 Pirate~     151 Color Action~ USA   A partir de ~ 225000000  4.23e8       7.3
## # ... with 3,797 more rows, and 4 more variables: likes_facebook <int>,
## #   ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 12
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 3 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>
\end{verbatim}

\hypertarget{exercuxedcios-11}{%
\subsubsection*{Exercícios}\label{exercuxedcios-11}}
\addcontentsline{toc}{subsubsection}{Exercícios}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Teste aplicar a função \texttt{glimpse()} do pacote \texttt{\{dplyr\}} à base \texttt{imdb}. O que ela faz?

\textbf{2.} Crie uma tabela com apenas as colunas \texttt{titulo}, \texttt{diretor}, e \texttt{orcamento.} Salve em um objeto chamado \texttt{imdb\_simples}.

\textbf{3.} Selecione apenas as colunas \texttt{ator\_1}, \texttt{ator\_2} e \texttt{ator\_3} usando o ajudante \texttt{contains()}.

\textbf{4.} Usando a função \texttt{select()} (e seus ajudantes), escreva códigos que retornem a base IMDB sem as colunas \texttt{ator\_1}, \texttt{ator\_2} e \texttt{ator\_3.} Escreva todas as soluções diferentes que você conseguir pensar.

\hypertarget{ordenando-a-base}{%
\subsection{Ordenando a base}\label{ordenando-a-base}}

Para ordenar linhas, utilizamos a função \texttt{arrange()}. O primeiro argumento é a base de dados. Os demais argumentos são as colunas pelas quais queremos ordenar as linhas. No exemplo a seguir, ordenamos as linhas da base por ordem crescente de orçamento.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(imdb, orcamento)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Tarnati~  2003 Jonatha~      88 Color Biograph~ USA   Outros              218
##  2 My Date~  2004 Jon Gunn      90 Color Document~ USA   Livre              1100
##  3 A Plagu~  2013 Benjami~      76 Color Drama|Ho~ USA   Outros             1400
##  4 The Mon~  2005 Anthony~      84 Color Crime|Dr~ USA   A partir de ~      3250
##  5 Primer    2004 Shane C~      77 Color Drama|Sc~ USA   A partir de ~      7000
##  6 El Mari~  1992 Robert ~      81 Color Action|C~ USA   A partir de ~      7000
##  7 Newlywe~  2011 Edward ~      95 Color Comedy|D~ USA   Outros             9000
##  8 Pink Fl~  1972 John Wa~     108 Color Comedy|C~ USA   A partir de ~     10000
##  9 The Tou~  2007 Jane Cl~       7 Color Romance|~ USA   Outros            13000
## 10 Paranor~  2007 Oren Pe~      84 Color Horror    USA   A partir de ~     15000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

Também podemos ordenar de forma decrescente usando a função \texttt{desc()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(imdb, }\FunctionTok{desc}\NormalTok{(orcamento))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  2 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  3 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  4 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Pirates~  2011 Rob Mar~     136 Color Action|A~ USA   A partir de ~ 250000000
## 10 Captain~  2016 Anthony~     147 Color Action|A~ USA   A partir de ~ 250000000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

E claro, ordenar segundo duas ou mais colunas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(imdb, }\FunctionTok{desc}\NormalTok{(ano), }\FunctionTok{desc}\NormalTok{(orcamento))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    <chr>     <int> <chr>      <int> <chr> <chr>    <chr> <chr>             <int>
##  1 Batman v~  2016 Zack Sn~     183 Color Action|~ USA   A partir de ~ 250000000
##  2 Captain ~  2016 Anthony~     147 Color Action|~ USA   A partir de ~ 250000000
##  3 Star Tre~  2016 Justin ~     122 Color Action|~ USA   A partir de ~ 185000000
##  4 The Lege~  2016 David Y~     110 Color Action|~ USA   A partir de ~ 180000000
##  5 The Lege~  2016 David Y~     110 Color Action|~ USA   A partir de ~ 180000000
##  6 X-Men: A~  2016 Bryan S~     144 Color Action|~ USA   A partir de ~ 178000000
##  7 Suicide ~  2016 David A~     123 Color Action|~ USA   A partir de ~ 175000000
##  8 Alice Th~  2016 James B~     113 Color Adventu~ USA   Livre         170000000
##  9 Independ~  2016 Roland ~     120 Color Action|~ USA   A partir de ~ 165000000
## 10 Warcraft   2016 Duncan ~     123 Color Action|~ USA   A partir de ~ 160000000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

\hypertarget{exercuxedcios-12}{%
\subsubsection*{Exercícios}\label{exercuxedcios-12}}
\addcontentsline{toc}{subsubsection}{Exercícios}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Ordene os filmes em ordem crescente de \texttt{ano} e decrescente de \texttt{receita} e salve em um objeto chamado \texttt{filmes\_ordenados}.

\textbf{2.} Selecione apenas as colunas \texttt{titulo} e \texttt{orcamento} e então ordene de forma decrescente pelo \texttt{orcamento.}

\hypertarget{o-pipe-em-auxe7uxe3o}{%
\subsection{O pipe em ação}\label{o-pipe-em-auxe7uxe3o}}

Na grande maioria dos casos, vamos aplicar mais de uma função de manipulação em uma base para obtermos a tabela que desejamos. Poderíamos, por exemplo, querer uma tabela apenas com o título e ano dos filmes, ordenada de forma crescente de lançamento. Para fazer isso, poderíamos aninhar as funções

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{arrange}\NormalTok{(}\FunctionTok{select}\NormalTok{(imdb, titulo, ano), ano)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 2
##    titulo                                              ano
##    <chr>                                             <int>
##  1 Intolerance: Love's Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell's Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # ... with 3,797 more rows
\end{verbatim}

ou criar um objeto intermediário

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_titulo\_ano }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(imdb, titulo, ano)}

\FunctionTok{arrange}\NormalTok{(tab\_titulo\_ano, ano)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 2
##    titulo                                              ano
##    <chr>                                             <int>
##  1 Intolerance: Love's Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell's Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # ... with 3,797 more rows
\end{verbatim}

Os dois códigos funcionam e levam ao mesmo resultado, mas não são muito boas.

A primeira alternativa é ruim de escrever, já que precisamos escrever primeiro a função que roda por último, e de ler, pois é difícil identificar qual argumento pertence a qual função.

A segunda alternativa é ruim pois exige a criação de objetos auxiliares. Se quiséssimos aplicar 10 operações na base, precisaríamos criar 9 objetos intermediários.

A solução para aplicar diversas operações de manipulação em uma base de dados é aplicar o operador pipe: \texttt{\%\textgreater{}\%}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(ano)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 2
##    titulo                                              ano
##    <chr>                                             <int>
##  1 Intolerance: Love's Struggle Throughout the Ages   1916
##  2 Over the Hill to the Poorhouse                     1920
##  3 The Big Parade                                     1925
##  4 The Broadway Melody                                1929
##  5 Hell's Angels                                      1930
##  6 A Farewell to Arms                                 1932
##  7 42nd Street                                        1933
##  8 She Done Him Wrong                                 1933
##  9 It Happened One Night                              1934
## 10 Top Hat                                            1935
## # ... with 3,797 more rows
\end{verbatim}

O que está sendo feito no código com pipe? Da primeira para a segunda linha, estamos aplicando a função \texttt{select()} à base imdb. Da segunda para a terceira, estamos aplicando a função \texttt{arrange()} à base resultante da função \texttt{select()}.

O resultado desse código é identico às tentativas sem pipe, com a vantagem de termos escrito o código na ordem em que as funções são aplicadas, de termos um código muito mais legível e de não precisarmos utilizar objetos intermediários.

\hypertarget{filtrando-linhas}{%
\subsection{Filtrando linhas}\label{filtrando-linhas}}

Para filtrar valores de uma coluna da base, utilizamos a função \texttt{filter()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(nota\_imdb }\SpecialCharTok{\textgreater{}} \DecValTok{9}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 15
##   titulo      ano diretor   duracao cor   generos  pais  classificacao orcamento
##   <chr>     <int> <chr>       <int> <chr> <chr>    <chr> <chr>             <int>
## 1 The Shaw~  1994 Frank Da~     142 Color Crime|D~ USA   A partir de ~  25000000
## 2 The Godf~  1972 Francis ~     175 Color Crime|D~ USA   A partir de ~   6000000
## 3 Kickboxe~  2016 John Sto~      90 <NA>  Action   USA   Outros         17000000
## # ... with 6 more variables: receita <int>, nota_imdb <dbl>,
## #   likes_facebook <int>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

Podemos selecionar apenas as colunas título e nota para visualizarmos as notas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(nota\_imdb }\SpecialCharTok{\textgreater{}} \DecValTok{9}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, nota\_imdb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   titulo                    nota_imdb
##   <chr>                         <dbl>
## 1 The Shawshank Redemption        9.3
## 2 The Godfather                   9.2
## 3 Kickboxer: Vengeance            9.1
\end{verbatim}

Podemos estender o filtro para duas ou mais colunas. Para isso, separamos cada operação por uma vírgula.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{\textgreater{}} \DecValTok{2010}\NormalTok{, nota\_imdb }\SpecialCharTok{\textgreater{}} \FloatTok{8.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 15
##   titulo      ano diretor   duracao cor   generos  pais  classificacao orcamento
##   <chr>     <int> <chr>       <int> <chr> <chr>    <chr> <chr>             <int>
## 1 Interste~  2014 Christop~     169 Color Adventu~ USA   A partir de ~ 165000000
## 2 Running ~  2015 Mike May~      88 Color Family   USA   Outros          5000000
## 3 A Beginn~  2016 Mitchell~      87 Color Comedy|~ USA   Outros               NA
## 4 Kickboxe~  2016 John Sto~      90 <NA>  Action   USA   Outros         17000000
## 5 Butterfl~  2014 Cary Bell      78 Color Documen~ USA   Outros           180000
## # ... with 6 more variables: receita <int>, nota_imdb <dbl>,
## #   likes_facebook <int>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

Também podemos fazer operações com as colunas da base dentro da função filter. O código abaixo devolve uma tabela apenas com os filmes que lucraram.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(receita }\SpecialCharTok{{-}}\NormalTok{ orcamento }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,761 x 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    <chr>     <int> <chr>      <int> <chr> <chr>    <chr> <chr>             <int>
##  1 Avatar     2009 James C~     178 Color Action|~ USA   A partir de ~ 237000000
##  2 Pirates ~  2007 Gore Ve~     169 Color Action|~ USA   A partir de ~ 300000000
##  3 The Dark~  2012 Christo~     164 Color Action|~ USA   A partir de ~ 250000000
##  4 Spider-M~  2007 Sam Rai~     156 Color Action|~ USA   A partir de ~ 258000000
##  5 Avengers~  2015 Joss Wh~     141 Color Action|~ USA   A partir de ~ 250000000
##  6 Batman v~  2016 Zack Sn~     183 Color Action|~ USA   A partir de ~ 250000000
##  7 Pirates ~  2006 Gore Ve~     151 Color Action|~ USA   A partir de ~ 225000000
##  8 Man of S~  2013 Zack Sn~     143 Color Action|~ USA   A partir de ~ 225000000
##  9 The Aven~  2012 Joss Wh~     173 Color Action|~ USA   A partir de ~ 220000000
## 10 The Amaz~  2012 Marc We~     153 Color Action|~ USA   A partir de ~ 230000000
## # ... with 1,751 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

Naturalmente, podemos filtrar colunas categóricas. O exemplo abaixo retorna uma tabela apenas com os filmes com a Angelina Jolie Pitt ou o Brad Pitt no papel principal.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(ator\_1 }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Angelina Jolie Pitt\textquotesingle{}}\NormalTok{, }\StringTok{"Brad Pitt"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 29 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Malefic~  2014 Robert ~      97 Color Action|A~ USA   Livre         180000000
##  2 The Cur~  2008 David F~     166 Color Drama|Fa~ USA   A partir de ~ 150000000
##  3 Kung Fu~  2011 Jennife~      90 Color Action|A~ USA   Livre         150000000
##  4 Troy      2004 Wolfgan~     196 Color Adventure USA   A partir de ~ 175000000
##  5 Kung Fu~  2008 Mark Os~      92 Color Action|A~ USA   Livre         130000000
##  6 Salt      2010 Phillip~     101 Color Action|C~ USA   A partir de ~ 110000000
##  7 Ocean's~  2004 Steven ~     125 Color Crime|Th~ USA   A partir de ~ 110000000
##  8 Mr. & M~  2005 Doug Li~     126 Color Action|C~ USA   A partir de ~ 120000000
##  9 Lara Cr~  2001 Simon W~     100 Color Action|A~ USA   A partir de ~ 115000000
## 10 Ocean's~  2001 Steven ~     116 Color Crime|Th~ USA   A partir de ~  85000000
## # ... with 19 more rows, and 6 more variables: receita <int>, nota_imdb <dbl>,
## #   likes_facebook <int>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

Para filtrar textos sem correspondência exata, podemos utilizar a função auxiliar \texttt{str\_detect()} do pacote \texttt{\{stringr\}}. Ela serve para verificar se cada string de um vetor contém um determinado padrão de texto.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\FunctionTok{str\_detect}\NormalTok{(}
  \AttributeTok{string =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"aa"}\NormalTok{,}\StringTok{"abc"}\NormalTok{, }\StringTok{"bc"}\NormalTok{, }\StringTok{"A"}\NormalTok{, }\ConstantTok{NA}\NormalTok{), }
  \AttributeTok{pattern =} \StringTok{"a"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE  TRUE FALSE FALSE    NA
\end{verbatim}

Podemos utilizá-la para filtrar apenas os filmes que contêm o gênero ação.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# A coluna gêneros apresenta todos os gêneros dos filmes concatenados}
\NormalTok{imdb}\SpecialCharTok{$}\NormalTok{generos[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{6}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Action|Adventure|Fantasy|Sci-Fi"                          
## [2] "Action|Adventure|Fantasy"                                 
## [3] "Action|Thriller"                                          
## [4] "Action|Adventure|Sci-Fi"                                  
## [5] "Action|Adventure|Romance"                                 
## [6] "Adventure|Animation|Comedy|Family|Fantasy|Musical|Romance"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Podemos detectar se o gênero Action aparece na string}
\FunctionTok{str\_detect}\NormalTok{(}
  \AttributeTok{string =}\NormalTok{ imdb}\SpecialCharTok{$}\NormalTok{generos[}\DecValTok{1}\SpecialCharTok{:}\DecValTok{6}\NormalTok{],}
  \AttributeTok{pattern =} \StringTok{"Action"}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE  TRUE  TRUE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Aplicamos essa lógica dentro da função filter, para a coluna completa}
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Action"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 861 x 15
##    titulo      ano diretor  duracao cor   generos  pais  classificacao orcamento
##    <chr>     <int> <chr>      <int> <chr> <chr>    <chr> <chr>             <int>
##  1 Avatar     2009 James C~     178 Color Action|~ USA   A partir de ~ 237000000
##  2 Pirates ~  2007 Gore Ve~     169 Color Action|~ USA   A partir de ~ 300000000
##  3 The Dark~  2012 Christo~     164 Color Action|~ USA   A partir de ~ 250000000
##  4 John Car~  2012 Andrew ~     132 Color Action|~ USA   A partir de ~ 263700000
##  5 Spider-M~  2007 Sam Rai~     156 Color Action|~ USA   A partir de ~ 258000000
##  6 Avengers~  2015 Joss Wh~     141 Color Action|~ USA   A partir de ~ 250000000
##  7 Batman v~  2016 Zack Sn~     183 Color Action|~ USA   A partir de ~ 250000000
##  8 Superman~  2006 Bryan S~     169 Color Action|~ USA   A partir de ~ 209000000
##  9 Pirates ~  2006 Gore Ve~     151 Color Action|~ USA   A partir de ~ 225000000
## 10 The Lone~  2013 Gore Ve~     150 Color Action|~ USA   A partir de ~ 215000000
## # ... with 851 more rows, and 6 more variables: receita <int>, nota_imdb <dbl>,
## #   likes_facebook <int>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\hypertarget{exercuxedcios-13}{%
\subsubsection*{Exercícios}\label{exercuxedcios-13}}
\addcontentsline{toc}{subsubsection}{Exercícios}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Crie um objeto chamado \texttt{filmes\_pb} apenas com filmes preto e branco.

\textbf{2.} Crie um objeto chamado \texttt{curtos\_legais} com filmes de 90 minutos ou menos de duração e nota no imdb maior do que 8.5.

\textbf{3.} Retorne tabelas (\texttt{tibbles}) apenas com:

\begin{itemize}
\item
  \textbf{a.} filmes coloridos anteriores a 1950;
\item
  \textbf{b.} filmes do ``Woody Allen'' ou do ``Wes Anderson'';
\item
  \textbf{c.} filmes do ``Steven Spielberg'' ordenados de forma decrescente por ano, mostrando apenas as colunas \texttt{titulo} e \texttt{ano};
\item
  \textbf{d.} filmes que tenham ``Action'' \textbf{ou} ``Comedy'' entre os seus gêneros;
\item
  \textbf{e.} filmes que tenham ``Action'' \textbf{e} ``Comedy'' entre os seus gêneros e tenha \texttt{nota\_imdb} maior que 8;
\item
  \textbf{f.} filmes que não possuem informação tanto de receita quanto de orçamento (isto é, possuem \texttt{NA} em ambas as colunas).
\end{itemize}

\hypertarget{modificando-e-criando-novas-colunas}{%
\subsection{Modificando e criando novas colunas}\label{modificando-e-criando-novas-colunas}}

Para modificar uma coluna existente ou criar uma nova coluna, utilizamos a função \texttt{mutate()}. O código abaixo divide os valores da coluna duração por 60, mudando a unidade de medida dessa variável de minutos para horas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{duracao =}\NormalTok{ duracao}\SpecialCharTok{/}\DecValTok{60}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <dbl> <chr> <chr>     <chr> <chr>             <int>
##  1 Avatar    2009 James C~    2.97 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~    2.82 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~    2.73 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~    2.2  Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~    2.6  Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~    1.67 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~    2.35 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~    3.05 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~    2.82 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~    2.52 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

Também poderíamos ter criado essa variável em uma nova coluna. Repare que a nova coluna \texttt{duracao\_horas} é colocada no final da tabela.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{duracao\_horas =}\NormalTok{ duracao}\SpecialCharTok{/}\DecValTok{60}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 7 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>, duracao_horas <dbl>
\end{verbatim}

Podemos fazer qualquer operação com uma ou mais colunas. A única regra é que o resultado da operação retorne um vetor com comprimento igual ao número de linhas da base (ou com comprimento 1 para distribuir um mesmo valor em todas as linhas). Você também pode criar/modificar quantas colunas quiser dentro de um mesmo \texttt{mutate}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento, }\AttributeTok{pais =} \StringTok{"Estados Unidos"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, lucro, pais)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 3
##    titulo                                           lucro pais          
##    <chr>                                            <int> <chr>         
##  1 Avatar                                       523505847 Estados Unidos
##  2 Pirates of the Caribbean: At World's End       9404152 Estados Unidos
##  3 The Dark Knight Rises                        198130642 Estados Unidos
##  4 John Carter                                 -190641321 Estados Unidos
##  5 Spider-Man 3                                  78530303 Estados Unidos
##  6 Tangled                                      -59192738 Estados Unidos
##  7 Avengers: Age of Ultron                      208991599 Estados Unidos
##  8 Batman v Superman: Dawn of Justice            80249062 Estados Unidos
##  9 Superman Returns                              -8930592 Estados Unidos
## 10 Pirates of the Caribbean: Dead Man's Chest   198032628 Estados Unidos
## # ... with 3,797 more rows
\end{verbatim}

\hypertarget{exercuxedcios-14}{%
\subsubsection*{Exercícios}\label{exercuxedcios-14}}
\addcontentsline{toc}{subsubsection}{Exercícios}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Crie uma coluna chamada \texttt{prejuizo} (\texttt{orcamento\ -\ receita}) e salve a nova tabela em um objeto chamado \texttt{imdb\_prejuizo}. Em seguida, filtre apenas os filmes que deram prejuízo e ordene a tabela por ordem crescente de prejuízo.

\textbf{2.} Fazendo apenas uma chamada da função mutate(), crie as seguintes colunas novas na base \texttt{imdb}:

\begin{itemize}
\item
  \textbf{a.} \texttt{lucro\ =\ receita\ -\ orcamento}
\item
  \textbf{b.} \texttt{lucro\_medio}
\item
  \textbf{c.} \texttt{lucro\_relativo\ =\ (lucro\ -\ lucro\_medio)/lucro\_medio}
\item
  \textbf{d.} \texttt{houve\_lucro\ =\ ifelse(lucro\ \textgreater{}\ 0,\ "sim",\ "não")}
\end{itemize}

\textbf{3.} Crie uma nova coluna que classifique o filme em \texttt{"recente"} (posterior a 2000) e \texttt{"antigo"} (de 2000 para trás).

\hypertarget{summarisando-a-base}{%
\subsection{Summarisando a base}\label{summarisando-a-base}}

Sumarização é a técnica de se resumir um conjunto de dados utilizando alguma métrica de interesse. A média, a mediana, a variância, a frequência, a proporção, por exemplo, são tipos de sumarização que trazem diferentes informações sobre uma variável.

Para sumarizar uma coluna da base, utilizamos a função \texttt{summarize()}. O código abaixo resume a coluna orçamento pela sua média.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarize}\NormalTok{(}\AttributeTok{media\_orcamento =} \FunctionTok{mean}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   media_orcamento
##             <dbl>
## 1       35755986.
\end{verbatim}

Repare que a saída da função continua sendo uma tibble.

Podemos calcular diversas sumarizações diferentes em um mesmo \texttt{summarize}. Cada sumarização será uma coluna da nova base.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarise}\NormalTok{(}
  \AttributeTok{media\_orcamento =} \FunctionTok{mean}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{mediana\_orcamento =} \FunctionTok{median}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{variancia\_orcamento =} \FunctionTok{var}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##   media_orcamento mediana_orcamento variancia_orcamento
##             <dbl>             <int>               <dbl>
## 1       35755986.          20000000             1.82e15
\end{verbatim}

E também sumarizar diversas colunas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{summarize}\NormalTok{(}
  \AttributeTok{media\_orcamento =} \FunctionTok{mean}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{media\_receita =} \FunctionTok{mean}\NormalTok{(receita, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{media\_lucro =} \FunctionTok{mean}\NormalTok{(receita }\SpecialCharTok{{-}}\NormalTok{ orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 3
##   media_orcamento media_receita media_lucro
##             <dbl>         <dbl>       <dbl>
## 1       35755986.     55214607.   17258230.
\end{verbatim}

Muitas vezes queremos sumarizar uma coluna agrupada pelas categorias de uma segunda coluna. Para isso, além do \texttt{summarize}, utilizamos também a função \texttt{group\_by()}.

O código a seguir calcula a receita média dos filmes para cada categoria da coluna ``cor''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(cor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{receita\_media =} \FunctionTok{mean}\NormalTok{(receita, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 2
##   cor             receita_media
##   <chr>                   <dbl>
## 1 Black and White     36938737.
## 2 Color               55765813.
## 3 <NA>                80014842
\end{verbatim}

A única alteração que a função \texttt{group\_by()} faz na base é a marcação de que a base está agrupada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{group\_by}\NormalTok{(cor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
## # Groups:   cor [3]
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

\hypertarget{exercuxedcios-15}{%
\subsubsection*{Exercícios}\label{exercuxedcios-15}}
\addcontentsline{toc}{subsubsection}{Exercícios}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Calcule a duração média e mediana dos filmes da base.

\textbf{2.} Calcule o lucro médio dos filmes com duração menor que 60 minutos.

\textbf{3.} Apresente na mesma tabela o lucro médio dos filmes com duracao menor que 60 minutos e o lucro médio dos filmes com duracao maior ou igual a 60 minutos.

\textbf{4.} Retorne tabelas (\texttt{tibbles}) apenas com:

\begin{itemize}
\item
  \textbf{a.} a nota IMDB média dos filmes por tipo de classificacao;
\item
  \textbf{b.} a receita média e mediana dos filmes por ano;
\item
  \textbf{c.} apenas o nome dos diretores com mais de 10 filmes.
\end{itemize}

\hypertarget{juntando-duas-bases}{%
\subsection{Juntando duas bases}\label{juntando-duas-bases}}

Podemos juntar duas tabelas a partir de uma (coluna) chave utilizando a função \texttt{left\_join()}. Como exempo, vamos inicialmente calcular o lucro médio dos filmes de cada diretor e salvar no objeto \texttt{tab\_lucro\_diretor}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_lucro\_diretor }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{lucro\_medio =} \FunctionTok{mean}\NormalTok{(receita }\SpecialCharTok{{-}}\NormalTok{ orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}

\NormalTok{tab\_lucro\_diretor}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,813 x 2
##    diretor          lucro_medio
##    <chr>                  <dbl>
##  1 A. Raven Cruz            NaN
##  2 Aaron Hann               NaN
##  3 Aaron Schneider      1676553
##  4 Aaron Seltzer       28546578
##  5 Abel Ferrara       -11272676
##  6 Adam Carolla        -1394057
##  7 Adam Goldberg       -1647420
##  8 Adam Green               NaN
##  9 Adam Jay Epstein         NaN
## 10 Adam Marcus         13435068
## # ... with 1,803 more rows
\end{verbatim}

E se quisermos colocar essa informação na base original? Basta usar a função \texttt{left\_join()} utilizando a coluna \texttt{diretor} como chave. Observe que a coluna \texttt{lucro\_medio} aparece agora no fim da tabela.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_com\_lucro\_medio }\OtherTok{\textless{}{-}} \FunctionTok{left\_join}\NormalTok{(imdb, tab\_lucro\_diretor, }\AttributeTok{by =} \StringTok{"diretor"}\NormalTok{)}

\NormalTok{imdb\_com\_lucro\_medio}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 7 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>, lucro_medio <dbl>
\end{verbatim}

Na tabela \texttt{imdb\_com\_lucro\_medio}, como na tabela \texttt{imdb}, cada linha continua a representar um filme diferente, mas agora temos também a informação do lucro médio do diretor de cada filme.

A primeira linha, por exemplo, traz as informações do filme Avatar. O valor do \texttt{lucro\_medio} nessa linha representa o lucro médio de todos os filmes do James Cameron, que é o diretor de Avatar. Com essa informação, podemos calcular o quanto o lucro do Avatar se afasta do lucro médio do James Cameron.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_com\_lucro\_medio }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento,}
    \AttributeTok{lucro\_relativo =}\NormalTok{ (lucro }\SpecialCharTok{{-}}\NormalTok{ lucro\_medio)}\SpecialCharTok{/}\NormalTok{lucro\_medio,}
    \AttributeTok{lucro\_relativo =}\NormalTok{ scales}\SpecialCharTok{::}\FunctionTok{percent}\NormalTok{(lucro\_relativo)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, diretor, lucro, lucro\_medio, lucro\_relativo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 5
##    titulo                      diretor          lucro lucro_medio lucro_relativo
##    <chr>                       <chr>            <int>       <dbl> <chr>         
##  1 Avatar                      James Cameron   5.24e8  194620985  168.98736%    
##  2 Pirates of the Caribbean: ~ Gore Verbins~   9.40e6   36942999. -74.54416%    
##  3 The Dark Knight Rises       Christopher ~   1.98e8  101028447  96.11372%     
##  4 John Carter                 Andrew Stant~  -1.91e8   46668146  -508.50417%   
##  5 Spider-Man 3                Sam Raimi       7.85e7   63300090. 24.06033%     
##  6 Tangled                     Nathan Greno   -5.92e7  -59192738  0.00000%      
##  7 Avengers: Age of Ultron     Joss Whedon     2.09e8  250221657  -16.47741%    
##  8 Batman v Superman: Dawn of~ Zack Snyder     8.02e7   33149106. 142.08514%    
##  9 Superman Returns            Bryan Singer   -8.93e6   -2887024. 209.33560%    
## 10 Pirates of the Caribbean: ~ Gore Verbins~   1.98e8   36942999. 436.04913%    
## # ... with 3,797 more rows
\end{verbatim}

Observamos então que o Avatar obteve um lucro aproximadamente 169\% maior que a média dos filmes do James Cameron.

Além da função \texttt{left\_join()}, também são muito utilizadas as funções \texttt{right\_join()} e \texttt{full\_join()}.

\begin{itemize}
\item
  \texttt{right\_join()}: retorna todas as linhas da base \texttt{y} e todas as colunas das bases \texttt{x} e \texttt{y}. Linhas de \texttt{y} sem correspondentes em \texttt{x} receberão \texttt{NA} na nova base.
\item
  \texttt{full\_join()}: retorna todas as linhas e colunas de \texttt{x}e \texttt{y}. Valores sem correspondência entre as bases receberão \texttt{NA} na nova base.
\end{itemize}

A figura a seguir esquematiza as operações dessas funções:

\begin{center}\includegraphics[width=9.86in]{assets/img/manipulacao/joins} \end{center}

\hypertarget{exercuxedcios-16}{%
\subsubsection*{Exercícios}\label{exercuxedcios-16}}
\addcontentsline{toc}{subsubsection}{Exercícios}

\textbf{1.} Utilize a base \texttt{imdb} para resolver os itens a seguir.

\textbf{a.} Salve em um novo objeto uma tabela com a
nota média dos filmes de cada diretor. Essa tabela
deve conter duas colunas (\texttt{diretor} e \texttt{nota\_imdb\_media})
e cada linha deve ser um diretor diferente.

\textbf{b.} Use o \texttt{left\_join()} para trazer a coluna
\texttt{nota\_imdb\_media} da tabela do item anterior
para a tabela \texttt{imdb} original.

\hypertarget{dplyr-1.0}{%
\subsection{dplyr 1.0}\label{dplyr-1.0}}

A versão 1.0 do pacote \texttt{dplyr} foi oficialmente lançada em junho de 2020 e contou com diversas novidades. Vamos falar das principais mudanças:

\begin{itemize}
\item
  A nova função \texttt{across()}, que facilita aplicar uma mesma operação em várias colunas.
\item
  A repaginada função \texttt{rowwise()}, para fazer operações por linha.
\item
  Novas funcionalidades das funções \texttt{select()} e \texttt{rename()} e a nova função \texttt{relocate()}.
\end{itemize}

Para trabalhar essas funções, vamos utilizar a base \texttt{casas} do pacote \texttt{dados}. Para instalar esse pacote, rode os códigos abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)}
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"cienciadedatos/dados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Para trazer os dados para o nosso \emph{environment}, podemos rodar:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\OtherTok{\textless{}{-}}\NormalTok{ dados}\SpecialCharTok{::}\NormalTok{casas}
\end{Highlighting}
\end{Shaded}

A base \texttt{casas} possui dados de venda de casas na cidade de Ames, nos Estados Unidos. São 2930 linhas e 77 colunas, sendo que cada linha corresponde a uma casa vendida e cada coluna a uma característica da casa ou da venda. Essa versão é uma tradução da base original, que pode ser encontrada no pacote \texttt{AmesHousing}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"AmesHousing"}\NormalTok{)}
\FunctionTok{data}\NormalTok{(ames\_raw, }\AttributeTok{package =} \StringTok{"AmesHousing"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{a-funuxe7uxe3o-across}{%
\subsubsection*{\texorpdfstring{A função \texttt{across()}}{A função across()}}\label{a-funuxe7uxe3o-across}}
\addcontentsline{toc}{subsubsection}{A função \texttt{across()}}

A função \texttt{across()} substitui a família de verbos \texttt{\_all()}, \texttt{\_if} e \texttt{\_at()}. A ideia é facilitar a aplicação de uma operação a diversas colunas da base. Para sumarizar a base para mais de uma variável, antigamente poderíamos fazer:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(geral\_qualidade) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{lote\_area\_media =} \FunctionTok{mean}\NormalTok{(lote\_area, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{venda\_valor\_medio =} \FunctionTok{mean}\NormalTok{(venda\_valor, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    geral_qualidade lote_area_media venda_valor_medio
##    <chr>                     <dbl>             <dbl>
##  1 abaixo da média           8464.           106485.
##  2 acima da média            9788.           162130.
##  3 boa                      10309.           205026.
##  4 excelente                12777.           368337.
##  5 média                     9996.           134753.
##  6 muito boa                10618.           270914.
##  7 Muito excelente          18071.           450217.
##  8 muito ruim               15214.            48725 
##  9 regular                   9439.            83186.
## 10 ruim                      9326.            52325.
\end{verbatim}

Ou então utilizar a função \texttt{summarise\_at()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(geral\_qualidade) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise\_at}\NormalTok{(}
    \AttributeTok{.vars =} \FunctionTok{vars}\NormalTok{(lote\_area, venda\_valor),}
    \FunctionTok{list}\NormalTok{(mean),}
    \AttributeTok{na.rm =} \ConstantTok{TRUE}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    geral_qualidade lote_area venda_valor
##    <chr>               <dbl>       <dbl>
##  1 abaixo da média     8464.     106485.
##  2 acima da média      9788.     162130.
##  3 boa                10309.     205026.
##  4 excelente          12777.     368337.
##  5 média               9996.     134753.
##  6 muito boa          10618.     270914.
##  7 Muito excelente    18071.     450217.
##  8 muito ruim         15214.      48725 
##  9 regular             9439.      83186.
## 10 ruim                9326.      52325.
\end{verbatim}

Com a nova função \texttt{across()}, fazemos:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(geral\_qualidade) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{across}\NormalTok{(}
    \AttributeTok{.cols =} \FunctionTok{c}\NormalTok{(lote\_area, venda\_valor),}
    \AttributeTok{.fns =}\NormalTok{ mean, }
    \AttributeTok{na.rm =} \ConstantTok{TRUE}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 10 x 3
##    geral_qualidade lote_area venda_valor
##    <chr>               <dbl>       <dbl>
##  1 abaixo da média     8464.     106485.
##  2 acima da média      9788.     162130.
##  3 boa                10309.     205026.
##  4 excelente          12777.     368337.
##  5 média               9996.     134753.
##  6 muito boa          10618.     270914.
##  7 Muito excelente    18071.     450217.
##  8 muito ruim         15214.      48725 
##  9 regular             9439.      83186.
## 10 ruim                9326.      52325.
\end{verbatim}

A sintaxe é parecida com a função \texttt{summarise\_at()}, mas agora não precisamos mais usar a função \texttt{vars()} e nem usar \texttt{list(nome\_da\_funcao)}para definir a função aplicada nas colunas.

Usando \texttt{across()}, podemos facilmente aplicar uma função em todas as colunas da nossa base. Abaixo, calculamos o número de valores distintos para todas as variáveis da base \texttt{casas}. O padrão do parâmetro \texttt{.cols} é \texttt{everithing()}, que representa ``todas as colunas''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\AttributeTok{.fns =}\NormalTok{ n\_distinct))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 82
##   ordem   pid moradia_classe moradia_zoneamento lote_fachada lote_area rua_tipo
##   <int> <int>          <int>              <int>        <int>     <int>    <int>
## 1  2930  2930             16                  7          129      1960        2
## # ... with 75 more variables: beco_tipo <int>, lote_formato <int>,
## #   terreno_contorno <int>, utilidades <int>, lote_config <int>,
## #   terreno_declive <int>, vizinhanca <int>, condicao_1 <int>,
## #   condicao_2 <int>, moradia_tipo <int>, moradia_estilo <int>,
## #   geral_qualidade <int>, geral_condicao <int>, construcao_ano <int>,
## #   remodelacao_ano <int>, telhado_estilo <int>, telhado_material <int>,
## #   exterior_cobertura_1 <int>, exterior_cobertura_2 <int>,
## #   alvenaria_tipo <int>, alvenaria_area <int>, exterior_qualidade <int>,
## #   exterior_condicao <int>, fundacao_tipo <int>, porao_qualidade <int>,
## #   porao_condicao <int>, porao_exposicao <int>, porao_acabamento_1 <int>,
## #   porao_area_com_acabamento_1 <int>, porao_acabamento_2 <int>,
## #   porao_area_com_acabamento_2 <int>, porao_area_sem_acabamento <int>,
## #   porao_area_total <int>, porao_num_banheiros <int>,
## #   porao_num_banheiros_lavabos <int>, aquecimento_tipo <int>,
## #   aquecimento_qualidade_condicao <int>, ar_condicionado_central <int>,
## #   sistema_eletrico_tipo <int>, primeiro_andar_area <int>,
## #   segundo_andar_area <int>, acabamento_baixa_qualidade_area <int>,
## #   acima_solo_area <int>, acima_solo_num_banheiros <int>,
## #   acima_solo_num_lavabos <int>, acima_solo_num_quartos <int>,
## #   acima_solo_num_cozinhas <int>, cozinha_qualidade <int>,
## #   acima_solo_num_comodos <int>, funcional <int>, total_num_lareiras <int>,
## #   lareira_qualidade <int>, garagem_tipo <int>, garagem_ano_construcao <int>,
## #   garagem_acabamento <int>, garagem_capacidade_carros <int>,
## #   garagem_area <int>, garagem_qualidade <int>, garagem_condicao <int>,
## #   entrada_veiculo_pavimentada <int>, deck_madeira_area <int>,
## #   varanda_aberta_area <int>, varanda_fechada_area <int>,
## #   varanda_3ssn_area <int>, varanda_com_tela_area <int>, piscina_area <int>,
## #   piscina_qualidade <int>, cerca_qualidade <int>,
## #   funcionalidades_diversas <int>, funcionalidades_valor <int>,
## #   venda_mes <int>, venda_ano <int>, venda_tipo <int>, venda_condicao <int>,
## #   venda_valor <int>
\end{verbatim}

Para fazer essa mesma operação, antes utilizaríamos a função \texttt{summarise\_all()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise\_all}\NormalTok{(}\AttributeTok{.funs =} \SpecialCharTok{\textasciitilde{}}\FunctionTok{n\_distinct}\NormalTok{(.x))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 82
##   ordem   pid moradia_classe moradia_zoneamento lote_fachada lote_area rua_tipo
##   <int> <int>          <int>              <int>        <int>     <int>    <int>
## 1  2930  2930             16                  7          129      1960        2
## # ... with 75 more variables: beco_tipo <int>, lote_formato <int>,
## #   terreno_contorno <int>, utilidades <int>, lote_config <int>,
## #   terreno_declive <int>, vizinhanca <int>, condicao_1 <int>,
## #   condicao_2 <int>, moradia_tipo <int>, moradia_estilo <int>,
## #   geral_qualidade <int>, geral_condicao <int>, construcao_ano <int>,
## #   remodelacao_ano <int>, telhado_estilo <int>, telhado_material <int>,
## #   exterior_cobertura_1 <int>, exterior_cobertura_2 <int>,
## #   alvenaria_tipo <int>, alvenaria_area <int>, exterior_qualidade <int>,
## #   exterior_condicao <int>, fundacao_tipo <int>, porao_qualidade <int>,
## #   porao_condicao <int>, porao_exposicao <int>, porao_acabamento_1 <int>,
## #   porao_area_com_acabamento_1 <int>, porao_acabamento_2 <int>,
## #   porao_area_com_acabamento_2 <int>, porao_area_sem_acabamento <int>,
## #   porao_area_total <int>, porao_num_banheiros <int>,
## #   porao_num_banheiros_lavabos <int>, aquecimento_tipo <int>,
## #   aquecimento_qualidade_condicao <int>, ar_condicionado_central <int>,
## #   sistema_eletrico_tipo <int>, primeiro_andar_area <int>,
## #   segundo_andar_area <int>, acabamento_baixa_qualidade_area <int>,
## #   acima_solo_area <int>, acima_solo_num_banheiros <int>,
## #   acima_solo_num_lavabos <int>, acima_solo_num_quartos <int>,
## #   acima_solo_num_cozinhas <int>, cozinha_qualidade <int>,
## #   acima_solo_num_comodos <int>, funcional <int>, total_num_lareiras <int>,
## #   lareira_qualidade <int>, garagem_tipo <int>, garagem_ano_construcao <int>,
## #   garagem_acabamento <int>, garagem_capacidade_carros <int>,
## #   garagem_area <int>, garagem_qualidade <int>, garagem_condicao <int>,
## #   entrada_veiculo_pavimentada <int>, deck_madeira_area <int>,
## #   varanda_aberta_area <int>, varanda_fechada_area <int>,
## #   varanda_3ssn_area <int>, varanda_com_tela_area <int>, piscina_area <int>,
## #   piscina_qualidade <int>, cerca_qualidade <int>,
## #   funcionalidades_diversas <int>, funcionalidades_valor <int>,
## #   venda_mes <int>, venda_ano <int>, venda_tipo <int>, venda_condicao <int>,
## #   venda_valor <int>
\end{verbatim}

Se quisermos selecionar as colunas a serem modificadas a partir de um teste lógico, utilizamos o ajudante \texttt{where()}.

No exemplo abaixo, calculamos o número de valores distintos das colunas de categóricas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.character), n\_distinct))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 47
##     pid moradia_classe moradia_zoneamento rua_tipo beco_tipo lote_formato
##   <int>          <int>              <int>    <int>     <int>        <int>
## 1  2930             16                  7        2         3            4
## # ... with 41 more variables: terreno_contorno <int>, utilidades <int>,
## #   lote_config <int>, terreno_declive <int>, vizinhanca <int>,
## #   condicao_1 <int>, condicao_2 <int>, moradia_tipo <int>,
## #   moradia_estilo <int>, geral_qualidade <int>, geral_condicao <int>,
## #   telhado_estilo <int>, telhado_material <int>, exterior_cobertura_1 <int>,
## #   exterior_cobertura_2 <int>, alvenaria_tipo <int>, exterior_qualidade <int>,
## #   exterior_condicao <int>, fundacao_tipo <int>, porao_qualidade <int>,
## #   porao_condicao <int>, porao_exposicao <int>, porao_acabamento_1 <int>,
## #   porao_acabamento_2 <int>, aquecimento_tipo <int>,
## #   aquecimento_qualidade_condicao <int>, ar_condicionado_central <int>,
## #   sistema_eletrico_tipo <int>, cozinha_qualidade <int>, funcional <int>,
## #   lareira_qualidade <int>, garagem_tipo <int>, garagem_acabamento <int>,
## #   garagem_qualidade <int>, garagem_condicao <int>,
## #   entrada_veiculo_pavimentada <int>, piscina_qualidade <int>,
## #   cerca_qualidade <int>, funcionalidades_diversas <int>, venda_tipo <int>,
## #   venda_condicao <int>
\end{verbatim}

Todas as colunas da base resultante eram colunas com classe \texttt{character} na base \texttt{casas}.

Anteriormente, utilizávamos a função \texttt{summarise\_if()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise\_if}\NormalTok{(is.character, n\_distinct)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 47
##     pid moradia_classe moradia_zoneamento rua_tipo beco_tipo lote_formato
##   <int>          <int>              <int>    <int>     <int>        <int>
## 1  2930             16                  7        2         3            4
## # ... with 41 more variables: terreno_contorno <int>, utilidades <int>,
## #   lote_config <int>, terreno_declive <int>, vizinhanca <int>,
## #   condicao_1 <int>, condicao_2 <int>, moradia_tipo <int>,
## #   moradia_estilo <int>, geral_qualidade <int>, geral_condicao <int>,
## #   telhado_estilo <int>, telhado_material <int>, exterior_cobertura_1 <int>,
## #   exterior_cobertura_2 <int>, alvenaria_tipo <int>, exterior_qualidade <int>,
## #   exterior_condicao <int>, fundacao_tipo <int>, porao_qualidade <int>,
## #   porao_condicao <int>, porao_exposicao <int>, porao_acabamento_1 <int>,
## #   porao_acabamento_2 <int>, aquecimento_tipo <int>,
## #   aquecimento_qualidade_condicao <int>, ar_condicionado_central <int>,
## #   sistema_eletrico_tipo <int>, cozinha_qualidade <int>, funcional <int>,
## #   lareira_qualidade <int>, garagem_tipo <int>, garagem_acabamento <int>,
## #   garagem_qualidade <int>, garagem_condicao <int>,
## #   entrada_veiculo_pavimentada <int>, piscina_qualidade <int>,
## #   cerca_qualidade <int>, funcionalidades_diversas <int>, venda_tipo <int>,
## #   venda_condicao <int>
\end{verbatim}

Com o \texttt{across()}, podemos combinar os efeitos de um \texttt{summarise\_if()} e um \texttt{summarise\_at()} em um único \texttt{summarise()}. A seguir, calculamos as áreas médias, garantindo que pegamos apenas variáveis numéricas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric) }\SpecialCharTok{\&} \FunctionTok{contains}\NormalTok{(}\StringTok{"\_area"}\NormalTok{), mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 17
##   lote_area alvenaria_area porao_area_com_ac~ porao_area_com_a~ porao_area_sem_~
##       <dbl>          <dbl>              <dbl>             <dbl>            <dbl>
## 1    10148.           102.               443.              49.7             559.
## # ... with 12 more variables: porao_area_total <dbl>,
## #   primeiro_andar_area <dbl>, segundo_andar_area <dbl>,
## #   acabamento_baixa_qualidade_area <dbl>, acima_solo_area <dbl>,
## #   garagem_area <dbl>, deck_madeira_area <dbl>, varanda_aberta_area <dbl>,
## #   varanda_fechada_area <dbl>, varanda_3ssn_area <dbl>,
## #   varanda_com_tela_area <dbl>, piscina_area <dbl>
\end{verbatim}

Além disso, com a função \texttt{across()}, podemos fazer sumarizações complexas que não seria possível utilizando apenas as funções \texttt{summarise()}, \texttt{summarise\_if()} e \texttt{summarise\_at()}. No exemplo a seguir, calculamos a média das áreas, o número de \texttt{NAs} de variáveis categóricas e o número de casas para cada tipo de fundação. Tudo em um mesmo \texttt{summarise()}!

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(fundacao\_tipo) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric) }\SpecialCharTok{\&} \FunctionTok{contains}\NormalTok{(}\StringTok{"area"}\NormalTok{), mean, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \FunctionTok{across}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.character), }\SpecialCharTok{\textasciitilde{}}\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(.x))),}
    \AttributeTok{n\_obs =} \FunctionTok{n}\NormalTok{(),}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, n\_obs)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 5
##   fundacao_tipo       lote_area alvenaria_area porao_area_com_acabamento_1 n_obs
##   <chr>                   <dbl>          <dbl>                       <dbl> <int>
## 1 bloco de concreto      10616.           85.0                       468.   1244
## 2 concreto derrramado    10054.          144.                        506.   1310
## 3 laje                   10250.           35.2                         0      49
## 4 madeira                 9838.           16                         812.      5
## 5 pedra                   8659.            0                          43.9    11
## 6 tijolo e telha          8712.           10.2                       151.    311
\end{verbatim}

Embora a nova sintaxe, usando \texttt{across()}, não seja muito diferente do que fazíamos antes, realizar sumarizações complexas não é a única vantagem desse novo \emph{framework}.

O \texttt{across()} pode ser utilizado em todos os verbos do \texttt{\{dplyr\}} (com exceção do \texttt{select()} e \texttt{rename()}, já que ele não trás vantagens com relação ao que já podia ser feito) e isso unifica o modo de fazermos essas operações no \texttt{dplyr}. Em vez de termos uma família de funções para cada verbo, temos agora apenas o próprio verbo e a função \texttt{across()}.

Vamos ver um exemplo para o \texttt{mutate()} e para o \texttt{filter()}.

O código abaixo transforma todas as variáveis que possuem ``area'' no nome, passando os valores de pés quadrados para metros quadrados.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\FunctionTok{across}\NormalTok{(}
    \FunctionTok{contains}\NormalTok{(}\StringTok{"area"}\NormalTok{),}
    \SpecialCharTok{\textasciitilde{}}\NormalTok{ .x }\SpecialCharTok{/} \FloatTok{10.764}
\NormalTok{  ))}
\end{Highlighting}
\end{Shaded}

Já o código a seguir filtra apenas as casas que possuem varanda aberta, cerca e lareira (o \texttt{NA} nessa base significa que a casa não possui tal característica).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{across}\NormalTok{(}
    \FunctionTok{c}\NormalTok{(varanda\_aberta\_area, cerca\_qualidade, lareira\_qualidade),}
    \SpecialCharTok{\textasciitilde{}!}\FunctionTok{is.na}\NormalTok{(.x)}
\NormalTok{  )) }
\end{Highlighting}
\end{Shaded}

Não precisamos do \texttt{across()} na hora de selecionar colunas. A função \texttt{select()} já usa naturalmente o mecanismo de seleção de colunas que o \texttt{across()} proporciona.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{select}\NormalTok{(}\FunctionTok{where}\NormalTok{(is.numeric))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2,930 x 35
##    ordem lote_fachada lote_area construcao_ano remodelacao_ano alvenaria_area
##    <int>        <int>     <int>          <int>           <int>          <int>
##  1     1          141     31770           1960            1960            112
##  2     2           80     11622           1961            1961              0
##  3     3           81     14267           1958            1958            108
##  4     4           93     11160           1968            1968              0
##  5     5           74     13830           1997            1998              0
##  6     6           78      9978           1998            1998             20
##  7     7           41      4920           2001            2001              0
##  8     8           43      5005           1992            1992              0
##  9     9           39      5389           1995            1996              0
## 10    10           60      7500           1999            1999              0
## # ... with 2,920 more rows, and 29 more variables:
## #   porao_area_com_acabamento_1 <int>, porao_area_com_acabamento_2 <int>,
## #   porao_area_sem_acabamento <int>, porao_area_total <int>,
## #   porao_num_banheiros <int>, porao_num_banheiros_lavabos <int>,
## #   primeiro_andar_area <int>, segundo_andar_area <int>,
## #   acabamento_baixa_qualidade_area <int>, acima_solo_area <int>,
## #   acima_solo_num_banheiros <int>, acima_solo_num_lavabos <int>,
## #   acima_solo_num_quartos <int>, acima_solo_num_cozinhas <int>,
## #   acima_solo_num_comodos <int>, total_num_lareiras <int>,
## #   garagem_ano_construcao <int>, garagem_capacidade_carros <int>,
## #   garagem_area <int>, deck_madeira_area <int>, varanda_aberta_area <int>,
## #   varanda_fechada_area <int>, varanda_3ssn_area <int>,
## #   varanda_com_tela_area <int>, piscina_area <int>,
## #   funcionalidades_valor <int>, venda_mes <int>, venda_ano <int>,
## #   venda_valor <int>
\end{verbatim}

O mesmo vale para o \texttt{rename()}. Se quisermos renomer várias colunas, a partir de uma função, utilizamos o \texttt{rename\_with()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rename\_with}\NormalTok{(toupper, }\FunctionTok{contains}\NormalTok{(}\StringTok{"venda"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2,930 x 82
##    ordem pid    moradia_classe  moradia_zoneame~ lote_fachada lote_area rua_tipo
##    <int> <chr>  <chr>           <chr>                   <int>     <int> <chr>   
##  1     1 05263~ 020             Residencial bai~          141     31770 pavimen~
##  2     2 05263~ 020             Residencial alt~           80     11622 pavimen~
##  3     3 05263~ 020             Residencial bai~           81     14267 pavimen~
##  4     4 05263~ 020             Residencial bai~           93     11160 pavimen~
##  5     5 05271~ 060             Residencial bai~           74     13830 pavimen~
##  6     6 05271~ 060             Residencial bai~           78      9978 pavimen~
##  7     7 05271~ desenvolviment~ Residencial bai~           41      4920 pavimen~
##  8     8 05271~ desenvolviment~ Residencial bai~           43      5005 pavimen~
##  9     9 05271~ desenvolviment~ Residencial bai~           39      5389 pavimen~
## 10    10 05271~ 060             Residencial bai~           60      7500 pavimen~
## # ... with 2,920 more rows, and 75 more variables: beco_tipo <chr>,
## #   lote_formato <chr>, terreno_contorno <chr>, utilidades <chr>,
## #   lote_config <chr>, terreno_declive <chr>, vizinhanca <chr>,
## #   condicao_1 <chr>, condicao_2 <chr>, moradia_tipo <chr>,
## #   moradia_estilo <chr>, geral_qualidade <chr>, geral_condicao <chr>,
## #   construcao_ano <int>, remodelacao_ano <int>, telhado_estilo <chr>,
## #   telhado_material <chr>, exterior_cobertura_1 <chr>,
## #   exterior_cobertura_2 <chr>, alvenaria_tipo <chr>, alvenaria_area <int>,
## #   exterior_qualidade <chr>, exterior_condicao <chr>, fundacao_tipo <chr>,
## #   porao_qualidade <chr>, porao_condicao <chr>, porao_exposicao <chr>,
## #   porao_acabamento_1 <chr>, porao_area_com_acabamento_1 <int>,
## #   porao_acabamento_2 <chr>, porao_area_com_acabamento_2 <int>,
## #   porao_area_sem_acabamento <int>, porao_area_total <int>,
## #   porao_num_banheiros <int>, porao_num_banheiros_lavabos <int>,
## #   aquecimento_tipo <chr>, aquecimento_qualidade_condicao <chr>,
## #   ar_condicionado_central <chr>, sistema_eletrico_tipo <chr>,
## #   primeiro_andar_area <int>, segundo_andar_area <int>,
## #   acabamento_baixa_qualidade_area <int>, acima_solo_area <int>,
## #   acima_solo_num_banheiros <int>, acima_solo_num_lavabos <int>,
## #   acima_solo_num_quartos <int>, acima_solo_num_cozinhas <int>,
## #   cozinha_qualidade <chr>, acima_solo_num_comodos <int>, funcional <chr>,
## #   total_num_lareiras <int>, lareira_qualidade <chr>, garagem_tipo <chr>,
## #   garagem_ano_construcao <int>, garagem_acabamento <chr>,
## #   garagem_capacidade_carros <int>, garagem_area <int>,
## #   garagem_qualidade <chr>, garagem_condicao <chr>,
## #   entrada_veiculo_pavimentada <chr>, deck_madeira_area <int>,
## #   varanda_aberta_area <int>, varanda_fechada_area <int>,
## #   varanda_3ssn_area <int>, varanda_com_tela_area <int>, piscina_area <int>,
## #   piscina_qualidade <chr>, cerca_qualidade <chr>,
## #   funcionalidades_diversas <chr>, funcionalidades_valor <int>,
## #   VENDA_MES <int>, VENDA_ANO <int>, VENDA_TIPO <chr>, VENDA_CONDICAO <chr>,
## #   VENDA_VALOR <int>
\end{verbatim}

\hypertarget{a-funuxe7uxe3o-relocate}{%
\subsubsection*{\texorpdfstring{A função \texttt{relocate()}}{A função relocate()}}\label{a-funuxe7uxe3o-relocate}}
\addcontentsline{toc}{subsubsection}{A função \texttt{relocate()}}

O \texttt{\{dplyr\}} possui agora uma função própria para reorganizar colunas: \texttt{relocate()}. Por padrão, ela coloca uma ou mais colunas no começo da base.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{relocate}\NormalTok{(venda\_valor, venda\_tipo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2,930 x 82
##    venda_valor venda_tipo ordem pid    moradia_classe          moradia_zoneamen~
##          <int> <chr>      <int> <chr>  <chr>                   <chr>            
##  1      215000 "WD "          1 05263~ 020                     Residencial baix~
##  2      105000 "WD "          2 05263~ 020                     Residencial alta~
##  3      172000 "WD "          3 05263~ 020                     Residencial baix~
##  4      244000 "WD "          4 05263~ 020                     Residencial baix~
##  5      189900 "WD "          5 05271~ 060                     Residencial baix~
##  6      195500 "WD "          6 05271~ 060                     Residencial baix~
##  7      213500 "WD "          7 05271~ desenvolvimento de uni~ Residencial baix~
##  8      191500 "WD "          8 05271~ desenvolvimento de uni~ Residencial baix~
##  9      236500 "WD "          9 05271~ desenvolvimento de uni~ Residencial baix~
## 10      189000 "WD "         10 05271~ 060                     Residencial baix~
## # ... with 2,920 more rows, and 76 more variables: lote_fachada <int>,
## #   lote_area <int>, rua_tipo <chr>, beco_tipo <chr>, lote_formato <chr>,
## #   terreno_contorno <chr>, utilidades <chr>, lote_config <chr>,
## #   terreno_declive <chr>, vizinhanca <chr>, condicao_1 <chr>,
## #   condicao_2 <chr>, moradia_tipo <chr>, moradia_estilo <chr>,
## #   geral_qualidade <chr>, geral_condicao <chr>, construcao_ano <int>,
## #   remodelacao_ano <int>, telhado_estilo <chr>, telhado_material <chr>,
## #   exterior_cobertura_1 <chr>, exterior_cobertura_2 <chr>,
## #   alvenaria_tipo <chr>, alvenaria_area <int>, exterior_qualidade <chr>,
## #   exterior_condicao <chr>, fundacao_tipo <chr>, porao_qualidade <chr>,
## #   porao_condicao <chr>, porao_exposicao <chr>, porao_acabamento_1 <chr>,
## #   porao_area_com_acabamento_1 <int>, porao_acabamento_2 <chr>,
## #   porao_area_com_acabamento_2 <int>, porao_area_sem_acabamento <int>,
## #   porao_area_total <int>, porao_num_banheiros <int>,
## #   porao_num_banheiros_lavabos <int>, aquecimento_tipo <chr>,
## #   aquecimento_qualidade_condicao <chr>, ar_condicionado_central <chr>,
## #   sistema_eletrico_tipo <chr>, primeiro_andar_area <int>,
## #   segundo_andar_area <int>, acabamento_baixa_qualidade_area <int>,
## #   acima_solo_area <int>, acima_solo_num_banheiros <int>,
## #   acima_solo_num_lavabos <int>, acima_solo_num_quartos <int>,
## #   acima_solo_num_cozinhas <int>, cozinha_qualidade <chr>,
## #   acima_solo_num_comodos <int>, funcional <chr>, total_num_lareiras <int>,
## #   lareira_qualidade <chr>, garagem_tipo <chr>, garagem_ano_construcao <int>,
## #   garagem_acabamento <chr>, garagem_capacidade_carros <int>,
## #   garagem_area <int>, garagem_qualidade <chr>, garagem_condicao <chr>,
## #   entrada_veiculo_pavimentada <chr>, deck_madeira_area <int>,
## #   varanda_aberta_area <int>, varanda_fechada_area <int>,
## #   varanda_3ssn_area <int>, varanda_com_tela_area <int>, piscina_area <int>,
## #   piscina_qualidade <chr>, cerca_qualidade <chr>,
## #   funcionalidades_diversas <chr>, funcionalidades_valor <int>,
## #   venda_mes <int>, venda_ano <int>, venda_condicao <chr>
\end{verbatim}

Podemos usar os argumentos \texttt{.after} e \texttt{.before} para fazer mudanças mais complexas.

O código baixo coloca a coluna \texttt{venda\_ano} depois da coluna \texttt{construcao\_ano}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{relocate}\NormalTok{(venda\_ano, }\AttributeTok{.after =}\NormalTok{ construcao\_ano)}
\end{Highlighting}
\end{Shaded}

O código baixo coloca a coluna \texttt{venda\_ano} antes da coluna \texttt{construcao\_ano}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{relocate}\NormalTok{(venda\_ano, }\AttributeTok{.before =}\NormalTok{ construcao\_ano)}
\end{Highlighting}
\end{Shaded}

\hypertarget{a-funuxe7uxe3o-rowwise}{%
\subsubsection*{\texorpdfstring{A função \texttt{rowwise()}}{A função rowwise()}}\label{a-funuxe7uxe3o-rowwise}}
\addcontentsline{toc}{subsubsection}{A função \texttt{rowwise()}}

Por fim, vamos discutir operações feitas por linha. Tome como exemplo a tabela abaixo. Ela apresenta as notas de alunos em quatro provas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_notas }\OtherTok{\textless{}{-}} \FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{student\_id =} \DecValTok{1}\SpecialCharTok{:}\DecValTok{5}\NormalTok{,}
  \AttributeTok{prova1 =} \FunctionTok{sample}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \AttributeTok{prova2 =} \FunctionTok{sample}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \AttributeTok{prova3 =} \FunctionTok{sample}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{),}
  \AttributeTok{prova4 =} \FunctionTok{sample}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{, }\DecValTok{5}\NormalTok{)}
\NormalTok{)}

\NormalTok{tab\_notas}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 5
##   student_id prova1 prova2 prova3 prova4
##        <int>  <int>  <int>  <int>  <int>
## 1          1      5      2      4      8
## 2          2      6     10      6      2
## 3          3      3      5      0      7
## 4          4      2      1      1     10
## 5          5      4      0      9      0
\end{verbatim}

Se quisermos gerar uma coluna com a nota média de cada aluno nas quatro provas, não poderíamos usar o \texttt{mutate()} diretamente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_notas }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{mutate}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(}\FunctionTok{c}\NormalTok{(prova1, prova2, prova3, prova4)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 6
##   student_id prova1 prova2 prova3 prova4 media
##        <int>  <int>  <int>  <int>  <int> <dbl>
## 1          1      5      2      4      8  4.25
## 2          2      6     10      6      2  4.25
## 3          3      3      5      0      7  4.25
## 4          4      2      1      1     10  4.25
## 5          5      4      0      9      0  4.25
\end{verbatim}

Neste caso, todas as colunas estão sendo empilhadas e gerando uma única média, passada a todas as linhas da coluna \texttt{media}.

Para fazermos a conta para cada aluno, podemos agrupar por aluno. Agora sim a média é calculada apenas nas notas de cada estudante.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_notas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(student\_id) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(}\FunctionTok{c}\NormalTok{(prova1, prova2, prova3, prova4)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 6
## # Groups:   student_id [5]
##   student_id prova1 prova2 prova3 prova4 media
##        <int>  <int>  <int>  <int>  <int> <dbl>
## 1          1      5      2      4      8  4.75
## 2          2      6     10      6      2  6   
## 3          3      3      5      0      7  3.75
## 4          4      2      1      1     10  3.5 
## 5          5      4      0      9      0  3.25
\end{verbatim}

Também podemos nos aproveitar da sintaxe do \texttt{across()} neste caso. Para isso, precisamos substutir a função \texttt{c()} pela função \texttt{c\_across()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_notas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(student\_id) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"prova"}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 6
## # Groups:   student_id [5]
##   student_id prova1 prova2 prova3 prova4 media
##        <int>  <int>  <int>  <int>  <int> <dbl>
## 1          1      5      2      4      8  4.75
## 2          2      6     10      6      2  6   
## 3          3      3      5      0      7  3.75
## 4          4      2      1      1     10  3.5 
## 5          5      4      0      9      0  3.25
\end{verbatim}

Equivalentemente ao \texttt{group\_by()}, neste caso, podemos usar a função \texttt{rowwise()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_notas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rowwise}\NormalTok{(student\_id) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"prova"}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 6
## # Rowwise:  student_id
##   student_id prova1 prova2 prova3 prova4 media
##        <int>  <int>  <int>  <int>  <int> <dbl>
## 1          1      5      2      4      8  4.75
## 2          2      6     10      6      2  6   
## 3          3      3      5      0      7  3.75
## 4          4      2      1      1     10  3.5 
## 5          5      4      0      9      0  3.25
\end{verbatim}

Ela é muito útil quando queremos fazer operação por linhas, mas não temos uma coluna de identificação. Por padrão, se não indicarmos nenhuma coluna, cada linha será um ``grupo''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_notas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{rowwise}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(}\FunctionTok{c\_across}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"prova"}\NormalTok{))))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 6
## # Rowwise: 
##   student_id prova1 prova2 prova3 prova4 media
##        <int>  <int>  <int>  <int>  <int> <dbl>
## 1          1      5      2      4      8  4.75
## 2          2      6     10      6      2  6   
## 3          3      3      5      0      7  3.75
## 4          4      2      1      1     10  3.5 
## 5          5      4      0      9      0  3.25
\end{verbatim}

Veja que \texttt{student\_id} não é passada para a função \texttt{rowwise()}. Não precisaríamos dessa coluna na base para reproduzir a geração da columa \texttt{media} neste caso.

\hypertarget{exercuxedcios-17}{%
\subsubsection*{Exercícios}\label{exercuxedcios-17}}
\addcontentsline{toc}{subsubsection}{Exercícios}

A base \texttt{casas} abaixo pode ser encontrada a partir do código abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"cienciadedatos/dados"}\NormalTok{)}
\NormalTok{dados}\SpecialCharTok{::}\NormalTok{casas}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Reescreva os códigos abaixo utilizando as funções \texttt{across()} e \texttt{where()}.

\textbf{a.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(geral\_qualidade) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{acima\_solo\_area\_media =} \FunctionTok{mean}\NormalTok{(acima\_solo\_area, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{garagem\_area\_media =} \FunctionTok{mean}\NormalTok{(garagem\_area, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{valor\_venda\_medio =} \FunctionTok{mean}\NormalTok{(venda\_valor, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\textbf{b.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter\_at}\NormalTok{(}
    \FunctionTok{vars}\NormalTok{(porao\_qualidade, varanda\_fechada\_area, cerca\_qualidade),}
    \SpecialCharTok{\textasciitilde{}!}\FunctionTok{is.na}\NormalTok{(.x)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\textbf{c.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate\_if}\NormalTok{(is.character, }\SpecialCharTok{\textasciitilde{}}\NormalTok{tidyr}\SpecialCharTok{::}\FunctionTok{replace\_na}\NormalTok{(.x, }\AttributeTok{replace =} \StringTok{"Não possui"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{2.} Utilizando a base \texttt{casas}, resolva os itens a seguir.

\begin{itemize}
\item
  \textbf{a.} Usando o \texttt{case\_when()} crie um código para categorizar a variável venda\_valor da seguinte maneira:

  \begin{itemize}
  \tightlist
  \item
    \textbf{barata}: \$0 a \$129.500\\
  \item
    \textbf{preço mediano}: \$129.500 a \$180.796
  \item
    \textbf{cara}: \$ 180.796 a \$213.500
  \item
    \textbf{muito cara}: maior que \$213.500
  \end{itemize}
\end{itemize}

\begin{itemize}
\tightlist
\item
  \textbf{b.} Utilize o código feito na letra (a) para agrupar a base \texttt{casas} pela variável venda\_valor categorizada e calcular todas as áreas médias para cada uma dessas categorias.
\end{itemize}

\textbf{3.} Escreva um código que receba a base \texttt{casas} e retorne uma tabela com apenas

\begin{itemize}
\item
  \textbf{a.} as colunas referentes à garagem da casa.
\item
  \textbf{b.} as colunas referentes a variáveis de qualidade.
\item
  \textbf{c.} colunas numéricas que representam áreas da casa e do terreno.
\item
  \textbf{d.} colunas numéricas.
\item
  \textbf{e.} colunas referentes à piscina, porão e o valor de venda.
\end{itemize}

\textbf{4.} Usando a função \texttt{rename\_with()}, troque todos os \texttt{"\_"} dos nomes das colunas por um espaço \texttt{"\ "}.

\textbf{5.} Escreva um código para colocar todas as colunas relativas a venda no começo da base \texttt{casas}.

\textbf{6.} 5. Escreva um código para colocar todas as colunas numéricas da base \texttt{casas} no começo da tabela e todas as colunas categóricas no final.

\hypertarget{tidyr}{%
\section{O pacote tidyr}\label{tidyr}}

Dentro do \texttt{tidyverse}, uma base \emph{tidy} é uma base fácil de se trabalhar, isto é, fácil de se fazer manipulação de dados, fácil de se criar visualizações, fácil de se ajustar modelos e por aí vai.

Na prática, uma base \emph{tidy} é aquela que se encaixa bem no \emph{framework} do \texttt{tidyverse}, pois os pacotes como o \texttt{dplyr} e o \texttt{ggplot2} foram desenvolvidos para funcionar bem com bases \emph{tidy}. E assim como esses pacotes motivaram o uso de bases \emph{tidy}, o conceito \emph{tidy} motiva o surgimento de novos \emph{frameworks}, como o \texttt{tidymodels} para modelagem.

As duas propriedades mais importantes de uma base \emph{tidy} são:

\begin{itemize}
\item
  cada coluna é uma variável;
\item
  cada linha é uma observação.
\end{itemize}

Essa definição proporciona uma maneira consistente de se referir a variáveis (nomes de colunas) e observações (índices das linhas).

O pacote \texttt{\{tidyr\}} possui funções que nos ajudam a deixar uma base bagunçada em uma base \emph{tidy}. Ou então, nos ajudam a bagunçar um pouquinho a nossa base quando isso nos ajudar a produzir o resultados que queremos.

Vamos ver aqui algumas de suas principais funções:

\begin{itemize}
\item
  \texttt{separate()} e \texttt{unite()}: para separar variáveis concatenadas em uma única coluna ou uni-las.
\item
  \texttt{pivot\_wider()} e \texttt{pivot\_longer()}: para pirvotar a base.
\item
  \texttt{nest()} e \texttt{unnest()}: para criar \emph{list columns}.
\end{itemize}

Como motivação para utilizar esssas funções, vamos utilizar a nossa boa e velha base \texttt{imdb}. Essa base pode ser baixada \href{https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds}{clicando aqui}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(tidyr)}
\FunctionTok{library}\NormalTok{(ggplot2)}

\NormalTok{imdb }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"imdb.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{separate-e-unite}{%
\subsection{\texorpdfstring{\texttt{separate()} e \texttt{unite()}}{separate() e unite()}}\label{separate-e-unite}}

A função \texttt{separate()} separa duas ou mais variáveis que estão concatenadas em uma mesma coluna. A sintaxe da função está apresentada abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{separate}\NormalTok{( }
    \AttributeTok{col =}\NormalTok{ coluna\_velha, }
    \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"colunas"}\NormalTok{, }\StringTok{"novas"}\NormalTok{),}
    \AttributeTok{sep =} \StringTok{"separador"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Como exemplo, vamos transformar a coluna \texttt{generos} da base IMDB em três colunas, cada uma com um dos gêneros do filme. Lembrando que os valores da coluna \texttt{generos} estão no seguinte formato:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{pull}\NormalTok{(generos) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Action|Adventure|Fantasy|Sci-Fi"                          
## [2] "Action|Adventure|Fantasy"                                 
## [3] "Action|Thriller"                                          
## [4] "Action|Adventure|Sci-Fi"                                  
## [5] "Action|Adventure|Romance"                                 
## [6] "Adventure|Animation|Comedy|Family|Fantasy|Musical|Romance"
\end{verbatim}

Veja que agora, temos 3 colunas de gênero. Filmes com menos de 3 gêneros recebem \texttt{NA} na coluna \texttt{genero2} e/ou \texttt{genero3}. Os gêneros sobressalentes são descartados, assim como a coluna \texttt{generos} original.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{separate}\NormalTok{( }
    \AttributeTok{col =}\NormalTok{ generos,}
    \AttributeTok{into =} \FunctionTok{c}\NormalTok{(}\StringTok{"genero1"}\NormalTok{, }\StringTok{"genero2"}\NormalTok{, }\StringTok{"genero3"}\NormalTok{), }
    \AttributeTok{sep =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{|"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Expected 3 pieces. Additional pieces discarded in 1052 rows [1, 6, 12,
## 13, 16, 18, 23, 24, 25, 28, 32, 34, 36, 39, 40, 43, 47, 48, 49, 50, ...].
\end{verbatim}

\begin{verbatim}
## Warning: Expected 3 pieces. Missing pieces filled with `NA` in 1537 rows [3, 19,
## 21, 42, 84, 88, 92, 102, 106, 111, 113, 129, 138, 147, 178, 183, 186, 219, 222,
## 233, ...].
\end{verbatim}

\begin{verbatim}
## # A tibble: 3,807 x 17
##    titulo             ano diretor    duracao cor   genero1 genero2 genero3 pais 
##    <chr>            <int> <chr>        <int> <chr> <chr>   <chr>   <chr>   <chr>
##  1 Avatar            2009 James Cam~     178 Color Action  Advent~ Fantasy USA  
##  2 Pirates of the ~  2007 Gore Verb~     169 Color Action  Advent~ Fantasy USA  
##  3 The Dark Knight~  2012 Christoph~     164 Color Action  Thrill~ <NA>    USA  
##  4 John Carter       2012 Andrew St~     132 Color Action  Advent~ Sci-Fi  USA  
##  5 Spider-Man 3      2007 Sam Raimi      156 Color Action  Advent~ Romance USA  
##  6 Tangled           2010 Nathan Gr~     100 Color Advent~ Animat~ Comedy  USA  
##  7 Avengers: Age o~  2015 Joss Whed~     141 Color Action  Advent~ Sci-Fi  USA  
##  8 Batman v Superm~  2016 Zack Snyd~     183 Color Action  Advent~ Sci-Fi  USA  
##  9 Superman Return~  2006 Bryan Sin~     169 Color Action  Advent~ Sci-Fi  USA  
## 10 Pirates of the ~  2006 Gore Verb~     151 Color Action  Advent~ Fantasy USA  
## # ... with 3,797 more rows, and 8 more variables: classificacao <chr>,
## #   orcamento <int>, receita <int>, nota_imdb <dbl>, likes_facebook <int>,
## #   ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

A função \texttt{unite()} realiza a operação inversa da função \texttt{separate()}. Ela concatena os valores de várias variáveis em uma única coluna. A sintaxe é a seguinte:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unite}\NormalTok{(}
    \AttributeTok{col =}\NormalTok{ coluna\_nova, }
\NormalTok{    colunas\_para\_juntar, }
    \AttributeTok{sep =} \StringTok{"separador"} 
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Como exemplo, vamos agora transformar as colunas \texttt{ator1}, \texttt{ator2} e \texttt{ator3} em uma única coluna \texttt{atores}. Lembrando que essas colunas estão no formato abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{select}\NormalTok{(}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{head}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3 x 3
##   ator_1      ator_2           ator_3              
##   <chr>       <chr>            <chr>               
## 1 CCH Pounder Joel David Moore Wes Studi           
## 2 Johnny Depp Orlando Bloom    Jack Davenport      
## 3 Tom Hardy   Christian Bale   Joseph Gordon-Levitt
\end{verbatim}

Veja que agora a coluna \texttt{atores} possui os 3 atores concatenados. Se a ordem das colunas \texttt{ator1}, \texttt{ator2} e \texttt{ator3} nos trazia a informação de protagonismo, essa informação passa a ficar implícita nesse novo formato. As 3 colunas originais são removidas da base resultante.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unite}\NormalTok{(}
    \AttributeTok{col =} \StringTok{"elenco"}\NormalTok{,}
    \FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{), }
    \AttributeTok{sep =} \StringTok{" {-} "}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(elenco)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 1
##    elenco                                                  
##    <chr>                                                   
##  1 CCH Pounder - Joel David Moore - Wes Studi              
##  2 Johnny Depp - Orlando Bloom - Jack Davenport            
##  3 Tom Hardy - Christian Bale - Joseph Gordon-Levitt       
##  4 Daryl Sabara - Samantha Morton - Polly Walker           
##  5 J.K. Simmons - James Franco - Kirsten Dunst             
##  6 Brad Garrett - Donna Murphy - M.C. Gainey               
##  7 Chris Hemsworth - Robert Downey Jr. - Scarlett Johansson
##  8 Henry Cavill - Lauren Cohan - Alan D. Purwin            
##  9 Kevin Spacey - Marlon Brando - Frank Langella           
## 10 Johnny Depp - Orlando Bloom - Jack Davenport            
## # ... with 3,797 more rows
\end{verbatim}

\hypertarget{pivotagem}{%
\subsection{Pivotagem}\label{pivotagem}}

O conceito de pivotagem no \emph{tidyverse} se refere a mudança da estrutura da base, geralmente para alcançar o formato \emph{tidy}.

Geralmente realizamos pivotagem quando nossas linhas não são unidades observacionais ou nossas colunas não são variáveis. Ela é similiar à pivotagem do Excel, mas um pouco mais complexa.

O ato de pivotar resulta em transformar uma base de dados \emph{long} em \emph{wide} e vice-versa.

Uma base no formato \emph{long} possui mais linhas e pode ter menos colunas, enquanto no formato \emph{wide} poussi menos linhas e pode ter mais colunas

Esses formatos são sempre relativos às colunas que estão sendo pivotadas, sendo que uma base \emph{tidy} pode estar tanto no formato \emph{long} quanto \emph{wide}.

Antigamente, utilizávamos as funções \texttt{gather()} e \texttt{spread()} para fazer as operações de pivotagem.

Agora, no lugar de \texttt{gather()}, utilizamos a função \texttt{pivot\_longer()}. Abaixo, transformamos as colunas \texttt{ator1}, \texttt{ator2} e \texttt{ator3} em duas colunas: \texttt{ator\_atriz} e \texttt{protagonismo}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}
    \AttributeTok{cols =} \FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{), }
    \AttributeTok{names\_to =} \StringTok{"protagonismo"}\NormalTok{,}
    \AttributeTok{values\_to =} \StringTok{"ator\_atriz"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, ator\_atriz, protagonismo) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
##   titulo                                    ator_atriz       protagonismo
##   <chr>                                     <chr>            <chr>       
## 1 Avatar                                    CCH Pounder      ator_1      
## 2 Avatar                                    Joel David Moore ator_2      
## 3 Avatar                                    Wes Studi        ator_3      
## 4 Pirates of the Caribbean: At World's End  Johnny Depp      ator_1      
## 5 Pirates of the Caribbean: At World's End  Orlando Bloom    ator_2      
## 6 Pirates of the Caribbean: At World's End  Jack Davenport   ator_3
\end{verbatim}

Se considerarmos que na análise da base IMDB cada observação deve ser um filme, então essa nova base já não mais \emph{tidy}, pois agora cada filme aparece em três linhas diferentes, uma vez para cada um de seus atores.

Nesse sentido, embora possa parecer que a variável \texttt{protagonismo} estava implícita na base original, ela não é uma variável de fato. Todos filmes têm um \texttt{ator\_1}, um \texttt{ator\_2} e um \texttt{ator\_3}. Não existe nenhuma informação sobre o filme que podemos tirar da coluna \texttt{protagonismo}, pois ela qualifica apenas os atores, não o filme em si.

A função \texttt{pivot\_wider()} faz a operação inversa da \texttt{pivot\_longer()}. Sem aplicarmos as duas funções em sequência, voltamos para a base original.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_longer}\NormalTok{(}
    \AttributeTok{cols =} \FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{), }
    \AttributeTok{names\_to =} \StringTok{"ator\_protagonismo"}\NormalTok{,}
    \AttributeTok{values\_to =} \StringTok{"ator\_nome"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_wider}\NormalTok{(}
    \AttributeTok{names\_from =} \StringTok{"ator\_protagonismo"}\NormalTok{,}
    \AttributeTok{values\_from =} \StringTok{"ator\_nome"}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Values are not uniquely identified; output will contain list-cols.
## * Use `values_fn = list` to suppress this warning.
## * Use `values_fn = length` to identify where the duplicates arise
## * Use `values_fn = {summary_fun}` to summarise duplicates
\end{verbatim}

\begin{verbatim}
## # A tibble: 4 x 15
##   titulo      ano diretor  duracao cor   generos   pais  classificacao orcamento
##   <chr>     <int> <chr>      <int> <chr> <chr>     <chr> <chr>             <int>
## 1 Avatar     2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
## 2 Pirates ~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
## 3 The Dark~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
## 4 John Car~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
## # ... with 6 more variables: receita <int>, nota_imdb <dbl>,
## #   likes_facebook <int>, ator_1 <list>, ator_2 <list>, ator_3 <list>
\end{verbatim}

A base \texttt{imdb} não possui nenhuma variável que faça sentido aplicarmos diretamente a função \texttt{pivot\_wider()}. Vamos então considerar a seguinte tabela derivada da base \texttt{imdb}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab\_romance\_terror }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{\textgreater{}=} \DecValTok{2010}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{genero =} \FunctionTok{case\_when}\NormalTok{(}
\NormalTok{      stringr}\SpecialCharTok{::}\FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Romance"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"Romance"}\NormalTok{,}
\NormalTok{      stringr}\SpecialCharTok{::}\FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Horror"}\NormalTok{) }\SpecialCharTok{\textasciitilde{}} \StringTok{"Horror"}\NormalTok{,}
      \ConstantTok{TRUE} \SpecialCharTok{\textasciitilde{}} \ConstantTok{NA\_character\_}
\NormalTok{    )}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(genero)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(ano, genero) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{receita\_media =} \FunctionTok{mean}\NormalTok{(receita, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'ano'. You can override using the `.groups` argument.
\end{verbatim}

Essa tabela possui a receita média dos filmes de romance e terror nos anos de 2010 a 2016.

Para apresentar essa tabela em uma reunião, por exemplo, pode ficar ser mais agradável ter os anos nas colunas e não nas linhas. Para isso, basta utilizarmos a função \texttt{pivot\_wider()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tabela original}
\NormalTok{tab\_romance\_terror}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 14 x 3
## # Groups:   ano [7]
##      ano genero  receita_media
##    <int> <chr>           <dbl>
##  1  2010 Horror      30242147.
##  2  2010 Romance     48834552 
##  3  2011 Horror      33186210.
##  4  2011 Romance     40780528.
##  5  2012 Horror      36090815.
##  6  2012 Romance     53134506.
##  7  2013 Horror      56829163 
##  8  2013 Romance     25590508 
##  9  2014 Horror      37324785.
## 10  2014 Romance     51353872.
## 11  2015 Horror      27965711.
## 12  2015 Romance     60166036.
## 13  2016 Horror      57896396.
## 14  2016 Romance    105439985.
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tabela com os anos nas colunas}
\NormalTok{tab\_romance\_terror }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pivot\_wider}\NormalTok{(}
    \AttributeTok{names\_from =}\NormalTok{ ano,}
    \AttributeTok{values\_from =}\NormalTok{ receita\_media}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 8
##   genero     `2010`    `2011`    `2012`   `2013`    `2014`    `2015`     `2016`
##   <chr>       <dbl>     <dbl>     <dbl>    <dbl>     <dbl>     <dbl>      <dbl>
## 1 Horror  30242147. 33186210. 36090815. 56829163 37324785. 27965711.  57896396.
## 2 Romance 48834552  40780528. 53134506. 25590508 51353872. 60166036. 105439985.
\end{verbatim}

Esse é um caso que \emph{bagunçar} um pouquinho a tabela nos trouxe um resultado desejado.

\hypertarget{list-columns}{%
\subsection{\texorpdfstring{\emph{List columns}}{List columns}}\label{list-columns}}

Um terceiro conceito de dados \emph{tidy} é que cada célula da tabela possui um valor. No entanto, quando estamos programando, muitas vezes vale apena abandonar essa definição e guardarmos objetos mais complexos nas células de uma tabela.

Utilizando as chamadas \emph{list columns} podemos guardar virtualmente qualquer objeto em nossas \emph{tibbles}, como gráficos, resultados de modelos ou até mesmo outras tabelas.

Uma forma de trabalhar com \emph{list columns} consiste em utilizarmos as funções

\begin{itemize}
\item
  \texttt{nest()}: para criar uma \emph{list column};
\item
  \texttt{unnest()}: para desfazer uma \emph{list column}.
\end{itemize}

A forma mais simples de utilizarmos uma \emph{list column} é \emph{aninhar} a nossa base com relação a uma variável.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_nest }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{nest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(ano)}

\FunctionTok{head}\NormalTok{(imdb\_nest, }\DecValTok{8}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 8 x 2
## # Groups:   ano [8]
##     ano data             
##   <int> <list>           
## 1  1916 <tibble [1 x 14]>
## 2  1920 <tibble [1 x 14]>
## 3  1925 <tibble [1 x 14]>
## 4  1929 <tibble [1 x 14]>
## 5  1930 <tibble [1 x 14]>
## 6  1932 <tibble [1 x 14]>
## 7  1933 <tibble [2 x 14]>
## 8  1934 <tibble [1 x 14]>
\end{verbatim}

A base \texttt{imdb\_nest} possui duas colunas \texttt{ano} e \texttt{data} e uma linha para cada ano. Na coluna \texttt{data}, temos o restante da base \texttt{imdb}, recortada para cada um dos anos.

Abaixo, acessmos os dados do único filme de 1916 (primeira linha da base \texttt{imdb\_nest}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_nest}\SpecialCharTok{$}\NormalTok{data[[}\DecValTok{1}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 14
##   titulo    diretor  duracao cor   generos pais  classificacao orcamento receita
##   <chr>     <chr>      <int> <chr> <chr>   <chr> <chr>             <int>   <int>
## 1 Intolera~ D.W. Gr~     123 Blac~ Drama|~ USA   Outros           385907      NA
## # ... with 5 more variables: nota_imdb <dbl>, likes_facebook <int>,
## #   ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

Imagine que queiramos fazer, para cada ano, um gráfico de dispersão da receita contra o orçamento dos filmes lançados no ano.

Com a base no formato de \emph{list columns}, basta criarmos uma função para gerar o gráfico e utilizarmos a função \texttt{purrr::map()}.

Abaixo, construímos a função \texttt{fazer\_grafico\_dispersao()}, que será aplicada a cada uma das bases contidas na coluna \texttt{data} da base \texttt{imdb\_nest}. Os gráficos, respectivamos a cada ano, são salvos na coluna \texttt{grafico}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fazer\_grafico\_dispersao }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{()}
\NormalTok{\}}

\NormalTok{imdb\_graficos }\OtherTok{\textless{}{-}}\NormalTok{ imdb\_nest }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{grafico =}\NormalTok{ purrr}\SpecialCharTok{::}\FunctionTok{map}\NormalTok{(data, fazer\_grafico\_dispersao)}
\NormalTok{  )}

\FunctionTok{head}\NormalTok{(imdb\_graficos, }\DecValTok{6}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 6 x 3
## # Groups:   ano [6]
##     ano data              grafico
##   <int> <list>            <list> 
## 1  1916 <tibble [1 x 14]> <gg>   
## 2  1920 <tibble [1 x 14]> <gg>   
## 3  1925 <tibble [1 x 14]> <gg>   
## 4  1929 <tibble [1 x 14]> <gg>   
## 5  1930 <tibble [1 x 14]> <gg>   
## 6  1932 <tibble [1 x 14]> <gg>
\end{verbatim}

Para acessar cada um dos gráficos, basta rodar o código abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Pegando o gráfico referente ao ano de 2000}
\NormalTok{imdb\_graficos}\SpecialCharTok{$}\NormalTok{grafico[[}\DecValTok{74}\NormalTok{]]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 5 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{073-tidyr_files/figure-latex/unnamed-chunk-17-1} \end{center}

Ou, escolhendo diretamente pelo ano

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_graficos }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==} \DecValTok{2000}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(grafico)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
\end{verbatim}

\begin{verbatim}
## Warning: Removed 5 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{073-tidyr_files/figure-latex/unnamed-chunk-18-1} \end{center}

A função \texttt{unnest()} remove a estrutura de \emph{list column}. Fazendo a operação abaixo, voltamos para a base \texttt{imdb} original.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_nest }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{unnest}\NormalTok{(}\AttributeTok{cols =} \StringTok{"data"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 15
## # Groups:   ano [91]
##      ano titulo    diretor  duracao cor   generos  pais  classificacao orcamento
##    <int> <chr>     <chr>      <int> <chr> <chr>    <chr> <chr>             <int>
##  1  1916 Intolera~ D.W. Gr~     123 Blac~ Drama|H~ USA   Outros           385907
##  2  1920 Over the~ Harry F~     110 Blac~ Crime|D~ USA   Outros           100000
##  3  1925 The Big ~ King Vi~     151 Blac~ Drama|R~ USA   Outros           245000
##  4  1929 The Broa~ Harry B~     100 Blac~ Musical~ USA   Outros           379000
##  5  1930 Hell's A~ Howard ~      96 Blac~ Drama|W~ USA   Outros          3950000
##  6  1932 A Farewe~ Frank B~      79 Blac~ Drama|R~ USA   Outros           800000
##  7  1933 42nd Str~ Lloyd B~      89 Blac~ Comedy|~ USA   Outros           439000
##  8  1933 She Done~ Lowell ~      66 Blac~ Comedy|~ USA   Outros           200000
##  9  1934 It Happe~ Frank C~      65 Blac~ Comedy|~ USA   Outros           325000
## 10  1935 Top Hat   Mark Sa~      81 Blac~ Comedy|~ USA   Outros           609000
## # ... with 3,797 more rows, and 6 more variables: receita <int>,
## #   nota_imdb <dbl>, likes_facebook <int>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

\hypertarget{exercuxedcios-18}{%
\subsection{Exercícios}\label{exercuxedcios-18}}

\textbf{1.} Crie 5 novas colunas de gêneros na base imdb, cada uma com um dos gêneros contidos na coluna generos. Para os filmes com menos de 5 gêneros, substitua os valores \texttt{NA} pela string ``inexistente''.

\textbf{2.} Substitua os ``????'' no código abaixo para criar uma tabela do lucro médio dos filmes ao longo dos anos de 2000 a 2016, com cada ano sendo uma coluna da base.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{\%in\%} \StringTok{"????"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(}\StringTok{"????"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{lucro\_medio =} \StringTok{"????"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{pivot\_wider}\NormalTok{(}\AttributeTok{names\_from =} \StringTok{"????"}\NormalTok{, }\AttributeTok{values\_from =} \StringTok{"????"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Para os exercícios 3, 4 e 5, vamos utilize a base \texttt{pokemon}, disponível no pacote \texttt{basesCursoR}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)}
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"curso{-}r/basesCursoR"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{3.} Utilize a função \texttt{unite()} para juntar as duas colunas de tipo em uma única coluna na base pokemon.

\textbf{4.} Utilize a função \texttt{unite()} para juntar as três colunas de cor em uma única coluna na base pokemon. Faça isso sem remover as 3 colunas originais.

\textbf{5.} Utilizando a base \texttt{pokemon}, resolva os itens abaixo:

\textbf{a.} Utilize a função \texttt{pivot\_longer()} para criar uma única coluna de tipo na base pokemon.

\textbf{b.} Utilize a base criada no item (a) e escreva um código para descobrir qual o tipo mais frequente na base, independentemente se ele é primário (tipo\_1) ou secundário (tipo\_2).

\textbf{6.} Escreva uma função que receba uma base qualquer e o nome de uma coluna numérica dessa base e retorne uma figura com um gráfico de dispersão da coluna escolhida contra cada uma das outras variáveis numéricas da base.

\hypertarget{o-pacote-stringr}{%
\section{O pacote stringr}\label{o-pacote-stringr}}

\hypertarget{introduuxe7uxe3o}{%
\subsection{Introdução}\label{introduuxe7uxe3o}}

Variáveis de texto são muito comuns nos bancos de dados e, geralmente, dão bastante trabalho para serem manipuladas. É muito comum encontrarmos colunas com categorias não padronizadas, como, por exemplo, uma variável \texttt{Estado} com ``SP'', ``sp'', ``Sao Paulo'', ``São Paulo'' etc, todas indicando o mesmo estado.

O R possui várias funções para manipular textos (ou \emph{strings}). No entanto, as funções do \texttt{base} não possuem uma interface consistente e cada uma tem a sua forma de passar os parâmetros, dificultando a programação durante a análise.

Pensando nisso, Hadley Wickham deu aquela força para a comunidade R e criou o pacote \texttt{stringr}, que possui uma sintaxe consistente, permitindo o usuário manipular textos com muito mais facilidade.

\hypertarget{vantagens-do-stringr-em-relauxe7uxe3o-uxe0s-funuxe7uxf5es-do-r-base}{%
\paragraph*{Vantagens do stringr em relação às funções do R base}\label{vantagens-do-stringr-em-relauxe7uxe3o-uxe0s-funuxe7uxf5es-do-r-base}}
\addcontentsline{toc}{paragraph}{Vantagens do stringr em relação às funções do R base}

\begin{itemize}
\item
  Sintaxe unificada, o que auxilia na memorização das funções e leitura do código.
\item
  Todas as funções são vetorizadas.
\item
  Construído sobre a \href{http://site.icu-project.org/}{biblioteca ICU}, implementada em \texttt{C} e \texttt{C++}, uma garantia de resultados mais rápidos.
\end{itemize}

\hypertarget{regras-buxe1sicas-do-pacote}{%
\paragraph*{Regras básicas do pacote}\label{regras-buxe1sicas-do-pacote}}
\addcontentsline{toc}{paragraph}{Regras básicas do pacote}

\begin{itemize}
\item
  As funções de manipulação de texto começam com \texttt{str\_}. Caso esqueça o nome de uma função, basta digitar \texttt{stringr::str\_} e apertar \texttt{TAB} para ver quais são as opções.
\item
  O primeiro argumento da função é sempre uma \emph{string} ou um vetor de \emph{strings}.
\end{itemize}

\hypertarget{curiosidade}{%
\paragraph*{Curiosidade}\label{curiosidade}}
\addcontentsline{toc}{paragraph}{Curiosidade}

Inicialmente, o \texttt{stringr} era um \emph{wrapper} de funções do \texttt{base}. Depois disso, surgiu um novo pacote \texttt{stringi}, com sintaxe similar ao \texttt{stringr}, mas funcionando como \emph{wrapper} da biblioteca ICU. Wickham gostou tanto do pacote \texttt{stringi} que decidiu reescrever o \texttt{stringr} como um \emph{wrapper} do \texttt{stringi}.

Veja \href{https://github.com/tidyverse/stringr/blob/master/NEWS.md}{essa página} para detalhes.

\hypertarget{comeuxe7ando-a-usar}{%
\paragraph*{Começando a usar}\label{comeuxe7ando-a-usar}}
\addcontentsline{toc}{paragraph}{Começando a usar}

Todas as funções do \texttt{stringr} começam com o prefixo \texttt{str\_}. Isso ajuda na hora de encontrar a função que você está procurando. No RStudio, digite \texttt{str\_} e aperte \textbf{TAB} para visualizar a lista de funções com esse prefixo. Você pode verificar o que cada função faz até encontrar a que atende às suas necessidades.

\begin{center}\includegraphics[width=9.99in]{assets/img/manipulacao/str_tab} \end{center}

Na próxima seção, vamos apresentar as funções mais simples do \texttt{\{stringr\}}. Em seguida, vamos falar um pouco de expressões regulares (regex) e então veremos funções mais avançadas do pacote, que utilizam regex para identificar padrões.

Antes de mais nada, instale e carregue o pacote \texttt{stringr}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"stringr"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{funuxe7uxf5es-buxe1sicas}{%
\subsection{Funções básicas}\label{funuxe7uxf5es-buxe1sicas}}

A seguir, apresentamos as funções mais simples do \texttt{\{stringr\}}, que não utilizam o conceito de expressões regulares.

\hypertarget{str_length}{%
\paragraph*{str\_length}\label{str_length}}
\addcontentsline{toc}{paragraph}{str\_length}

A função mais simples do \texttt{stringr()} é a função \texttt{str\_length()}. Esta função recebe como argumento um vetor de \emph{strings} e retorna o número de caracteres de cada \emph{string}. Repare que o espaço \texttt{"\ "} é considerado um caracter.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_length}\NormalTok{(}\StringTok{"São Paulo"}\NormalTok{)}
\DocumentationTok{\#\# [1] 9}
\FunctionTok{str\_length}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"Rio de Janeiro"}\NormalTok{, }
             \StringTok{"Rio Grande do Norte"}\NormalTok{, }\StringTok{"Acre"}\NormalTok{))}
\DocumentationTok{\#\# [1]  9 14 19  4}
\end{Highlighting}
\end{Shaded}

Note que \texttt{str\_length()} é diferente de \texttt{length()}. O primeiro retorna o número de caracteres e o segundo retorna o comprimento do objeto. Isso fica mais claro no seguinte exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"Rio de Janeiro"}\NormalTok{, }
       \StringTok{"Rio Grande do Norte"}\NormalTok{, }\StringTok{"Acre"}\NormalTok{)}

\FunctionTok{str\_length}\NormalTok{(s)}
\DocumentationTok{\#\# [1]  9 14 19  4}
\FunctionTok{length}\NormalTok{(s)}
\DocumentationTok{\#\# [1] 4}
\end{Highlighting}
\end{Shaded}

A função \texttt{str\_length()} retornou um vetor com o número de caracteres de cada elemento do vetor \texttt{s}, enquanto \texttt{length()} retornou o comprimento do vetor \texttt{s}.

\hypertarget{str_to_upper-str_to_lower-str_to_title}{%
\paragraph*{str\_to\_upper, str\_to\_lower, str\_to\_title}\label{str_to_upper-str_to_lower-str_to_title}}
\addcontentsline{toc}{paragraph}{str\_to\_upper, str\_to\_lower, str\_to\_title}

Essas funções servem para modificar a caixa das letras. Veja alguns exemplos:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \StringTok{"Somos a curso{-}r"}
\FunctionTok{str\_to\_lower}\NormalTok{(s)}
\DocumentationTok{\#\# [1] "somos a curso{-}r"}
\FunctionTok{str\_to\_upper}\NormalTok{(s)}
\DocumentationTok{\#\# [1] "SOMOS A CURSO{-}R"}
\FunctionTok{str\_to\_title}\NormalTok{(s)}
\DocumentationTok{\#\# [1] "Somos A Curso{-}R"}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_trim}{%
\paragraph*{str\_trim}\label{str_trim}}
\addcontentsline{toc}{paragraph}{str\_trim}

É muito comum encontrar textos que vêm com espaços a mais, principalmente de dados
provenientes de formulários em que cada usuário escreve da forma que prefere. Isso é um problema pois cria categorias diferentes para valores que deveriam ser iguais. Espaços antes e após o texto são especialmente chatos, pois pode ser difícil detectá-los.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{" M"}\NormalTok{, }\StringTok{" F "}\NormalTok{, }\StringTok{"M"}\NormalTok{)}
\FunctionTok{as.factor}\NormalTok{(s)}
\DocumentationTok{\#\# [1] M   F   F    M   F  M  }
\DocumentationTok{\#\# Levels:  F   M F M}
\end{Highlighting}
\end{Shaded}

A função \texttt{str\_trim()} ajuda removendo os espaços excedentes antes e depois da string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{string\_aparada }\OtherTok{\textless{}{-}} \FunctionTok{str\_trim}\NormalTok{(s)}
\FunctionTok{as.factor}\NormalTok{(string\_aparada)}
\DocumentationTok{\#\# [1] M F F M F M}
\DocumentationTok{\#\# Levels: F M}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_sub}{%
\paragraph*{str\_sub}\label{str_sub}}
\addcontentsline{toc}{paragraph}{str\_sub}

Não é raro você precisar obter uma parte fixa de uma \emph{string}, como, por exemplo, manipular textos da forma:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"01{-}Feminino"}\NormalTok{, }\StringTok{"02{-}Masculino"}\NormalTok{, }\StringTok{"03{-}Indefinido"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Você pode querer apenas a parte final da string. Neste caso, pode usar a função \texttt{str\_sub()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# pegar do quarto até o último caractere}
\FunctionTok{str\_sub}\NormalTok{(s, }\AttributeTok{start =} \DecValTok{4}\NormalTok{) }
\DocumentationTok{\#\# [1] "Feminino"   "Masculino"  "Indefinido"}
\end{Highlighting}
\end{Shaded}

Também é possível obter apenas os números.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# pegar apenas os dois primeiros caracteres}
\FunctionTok{str\_sub}\NormalTok{(s, }\AttributeTok{end =} \DecValTok{2}\NormalTok{) }
\DocumentationTok{\#\# [1] "01" "02" "03"}
\end{Highlighting}
\end{Shaded}

Em outros casos você precisa obter os últimos 2 caracteres.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Feminino{-}01"}\NormalTok{, }\StringTok{"Masculino{-}02"}\NormalTok{, }\StringTok{"Indefinido{-}03"}\NormalTok{)}
\FunctionTok{str\_sub}\NormalTok{(s, }\AttributeTok{end =} \SpecialCharTok{{-}}\DecValTok{4}\NormalTok{)}
\DocumentationTok{\#\# [1] "Feminino"   "Masculino"  "Indefinido"}
\FunctionTok{str\_sub}\NormalTok{(s, }\AttributeTok{start =} \SpecialCharTok{{-}}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] "01" "02" "03"}
\end{Highlighting}
\end{Shaded}

É possível usar os argumentos \texttt{start} e \texttt{end} conjuntamente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"\_\_SP\_\_"}\NormalTok{, }\StringTok{"\_\_MG\_\_"}\NormalTok{, }\StringTok{"\_\_RJ\_\_"}\NormalTok{)}
\FunctionTok{str\_sub}\NormalTok{(s, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\DocumentationTok{\#\# [1] "SP" "MG" "RJ"}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_c}{%
\paragraph*{str\_c}\label{str_c}}
\addcontentsline{toc}{paragraph}{str\_c}

Análoga à função \texttt{paste0()} do R base, concatena \emph{strings} em uma única string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{string1 }\OtherTok{\textless{}{-}} \StringTok{"O valor p é: "}
\NormalTok{string2 }\OtherTok{\textless{}{-}} \FloatTok{0.03}

\FunctionTok{str\_c}\NormalTok{(string1, string2) }
\DocumentationTok{\#\# [1] "O valor p é: 0.03"}
\end{Highlighting}
\end{Shaded}

Pode misturar objetos com strings definidas diretamente na função.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{string1 }\OtherTok{\textless{}{-}} \StringTok{"Brigadeiro"}
\NormalTok{string2 }\OtherTok{\textless{}{-}} \StringTok{"bom"}
\NormalTok{string3 }\OtherTok{\textless{}{-}} \StringTok{"melhor"}

\FunctionTok{str\_c}\NormalTok{(string1, }\StringTok{" é a prova de que não existe nada tão "}\NormalTok{, string2,}
      \StringTok{" que não pode ficar "}\NormalTok{, string3, }\StringTok{"."}\NormalTok{)}
\DocumentationTok{\#\# [1] "Brigadeiro é a prova de que não existe nada tão bom que não pode ficar melhor."}
\end{Highlighting}
\end{Shaded}

A função é vetorizada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{string1 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Brigadeiro"}\NormalTok{, }\StringTok{"A política brasileira"}\NormalTok{)}
\NormalTok{string2 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"bom"}\NormalTok{, }\StringTok{"ruim"}\NormalTok{)}
\NormalTok{string3 }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"melhor"}\NormalTok{, }\StringTok{"pior"}\NormalTok{)}

\FunctionTok{str\_c}\NormalTok{(string1, }\StringTok{" é a prova de que não existe nada tão "}\NormalTok{, string2,}
      \StringTok{" que não pode ficar "}\NormalTok{, string3, }\StringTok{"."}\NormalTok{)}
\DocumentationTok{\#\# [1] "Brigadeiro é a prova de que não existe nada tão bom que não pode ficar melhor."          }
\DocumentationTok{\#\# [2] "A política brasileira é a prova de que não existe nada tão ruim que não pode ficar pior."}
\end{Highlighting}
\end{Shaded}

Essas são as funções mais simples do pacote \texttt{stringr} e não exigem nenhum conhecimento de \textbf{expressões regulares}. Note que nenhuma delas possui o parâmetro \texttt{pattern}. Você verá como especificar esse parâmetro nas próximas seções.

\hypertarget{expressuxf5es-regulares}{%
\subsection{Expressões Regulares}\label{expressuxf5es-regulares}}

Trabalhar com textos exige um certo conhecimento de \href{https://pt.wikipedia.org/wiki/Express\%C3\%A3o_regular}{expressões regulares}. As expressões regulares --- ou simplesmente \textbf{regex} --- permitem identificar conjuntos de caracteres, palavras e outros padrões por meio de uma sintaxe concisa.

O \texttt{stringr} utiliza regex da forma descrita \href{http://www.gagolewski.com/software/stringi/manual/?manpage=stringi-search-regex}{neste documento}. A própria \href{https://stat.ethz.ch/R-manual/R-devel/library/base/html/regex.html}{definição} de regex do R é um ótimo manual.

Vamos estudar expressões regulares por meio de exemplos e da função \texttt{str\_detect()}. Ela retorna \texttt{TRUE} se uma \emph{string} atende a uma expressão regular e \texttt{FALSE} caso contrário. Por exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_detect}\NormalTok{(}\StringTok{"sao paulo"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"paulo$"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{str\_detect}\NormalTok{(}\StringTok{"sao paulo sp"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"paulo$"}\NormalTok{)}
\DocumentationTok{\#\# [1] FALSE}
\end{Highlighting}
\end{Shaded}

A regex/pattern ``paulo\$'' indica que o texto deve ser terminado em ``paulo''. Existem diversos caracteres auxiliares que vão auxiliar na manipulação dos textos, assim como o ``\$''.

\begin{quote}
\textbf{Importante}: o valor passado para o argumento \texttt{pattern} de qualquer função do pacote \texttt{stringr} será entendido como uma regex.
\end{quote}

A tabela abaixo mostra a aplicação de cinco regex em seis \emph{strings} distintas.

\begin{itemize}
\item
  `\^{}ban' reconhece apenas o que começa exatamente com ``ban''.
\item
  `b ?an' reconhece tudo que tenha ``ban'', com ou sem espaço entre o ``b'' e o ``a''.
\item
  `ban' reconhece tudo que tenha ``ban'', apenas minúsculo.
\item
  BAN' reconhece tudo que tenha ``BAN'', apenas maiúsculo.
\item
  `ban\$' reconhece apenas o que termina exatamente em ``ban''
\end{itemize}

\begin{tabular}{l|l|l|l|l|l}
\hline
strings & \textasciicircum{}ban & b ?an & ban & BAN & ban\$\\
\hline
abandonado & FALSE & TRUE & TRUE & FALSE & FALSE\\
\hline
ban & TRUE & TRUE & TRUE & FALSE & TRUE\\
\hline
banana & TRUE & TRUE & TRUE & FALSE & FALSE\\
\hline
BANANA & FALSE & FALSE & FALSE & TRUE & FALSE\\
\hline
ele levou ban & FALSE & TRUE & TRUE & FALSE & TRUE\\
\hline
pranab anderson & FALSE & TRUE & FALSE & FALSE & FALSE\\
\hline
\end{tabular}

\hypertarget{quantificadores}{%
\paragraph*{Quantificadores}\label{quantificadores}}
\addcontentsline{toc}{paragraph}{Quantificadores}

Os caracteres \texttt{+}, \texttt{*} e \texttt{\{x,y\}} indicam quantas vezes um padrão se repete:

\begin{itemize}
\item
  \texttt{ey+} significa \texttt{e} e depois \texttt{y} ``\textbf{uma vez} ou mais''. Por exemplo, reconhece \texttt{hey}, \texttt{heyy}, \texttt{a\ eyyy}, mas não reconhece \texttt{e}, \texttt{y} nem \texttt{yy}.
\item
  \texttt{ey*} significa ``\textbf{nenhuma vez} ou mais''. Por exemplo, reconhece \texttt{hey}, \texttt{heyy}, \texttt{a\ eyyy} e \texttt{e}, mas não reconhece \texttt{y} nem \texttt{yy}.
\item
  \texttt{ey\{3\}} significa ``exatamente três vezes''. Por exemplo, reconhece \texttt{eyyy} e \texttt{eyyyy}, mas não reconhece \texttt{eyy}.
\item
  \texttt{ey\{1,3\}} significa ``entre uma e três vezes''.
\end{itemize}

Para aplicar um quantificador a um conjunto de caracteres, use parênteses. Por exemplo, \texttt{(ey\ )+} reconhece \texttt{ey\ ey}.

\hypertarget{conjuntos}{%
\paragraph*{Conjuntos}\label{conjuntos}}
\addcontentsline{toc}{paragraph}{Conjuntos}

Colocando caracteres dentro de \texttt{{[}{]}}, reconhecemos quaisquer caracteres desse conjunto. Alguns exemplos práticos:

\begin{itemize}
\item
  \texttt{{[}Cc{]}asa} para reconhecer ``casa'' em maiúsculo ou minúsculo.
\item
  \texttt{{[}0-9{]}} para reconhecer somente números. O mesmo vale para letras \texttt{{[}a-z{]}}, \texttt{{[}A-Z{]}}, \texttt{{[}a-zA-Z{]}} etc.
\item
  O símbolo \texttt{\^{}} dentro do colchete significa negação. Por exemplo, \texttt{{[}\^{}0-9{]}} significa pegar tudo o que não é número.
\item
  O símbolo \texttt{.} fora do colchete indica ``qualquer caractere'', mas dentro do colchete é apenas ponto.
\item
  Use \texttt{{[}{[}:space:{]}{]}+} para reconhecer espaços e \texttt{{[}{[}:punct:{]}{]}+} para reconhecer pontuações.
\end{itemize}

\hypertarget{misceluxe2nea}{%
\paragraph*{Miscelânea}\label{misceluxe2nea}}
\addcontentsline{toc}{paragraph}{Miscelânea}

\begin{itemize}
\item
  Use \texttt{abjutils::rm\_accent()} para retirar os acentos de um texto.
\item
  Use \texttt{\textbar{}} para opções. Por exemplo, \texttt{desfavor\textbar{}desprov} reconhece tanto ``desfavorável'' quanto ``desprovido''.
\item
  O código \texttt{\textbackslash{}n} pula linha, \texttt{\textbackslash{}f} é final da página, \texttt{\textbackslash{}t} é tab. Use \texttt{\textbackslash{}} para transformar caracteres especiais em literais.
\end{itemize}

A lista de possibilidades com expressões regulares é extensa.
Um bom lugar para testar o funcionamento das regex é o \href{https://regex101.com/}{regex101}.

\hypertarget{funuxe7uxf5es-que-utilizam-regex}{%
\subsection{Funções que utilizam regex}\label{funuxe7uxf5es-que-utilizam-regex}}

Agora que já vimos as funções básicas do \texttt{stringr} e aprendemos um pouco de regex, vamos às funções mais avançadas. Basicamente, essas funções buscarão \texttt{patterns} em um vetor de \emph{strings} e farão alguma coisa quando encontrá-lo.

Como já vimos na sessão sobre regex, a função mais simples que possui o argumento \texttt{pattern=} é a \texttt{str\_detect()}.

\hypertarget{str_detect}{%
\paragraph*{str\_detect()}\label{str_detect}}
\addcontentsline{toc}{paragraph}{str\_detect()}

Retorna \texttt{TRUE} se a regex é compatível com a string e \texttt{FALSE} caso contrário.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{str\_detect}\NormalTok{(}\StringTok{"sao paulo"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"paulo$"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{str\_detect}\NormalTok{(}\StringTok{"sao paulo sp"}\NormalTok{, }\AttributeTok{pattern =} \StringTok{"paulo$"}\NormalTok{)}
\DocumentationTok{\#\# [1] FALSE}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_replace-e-str_replace_all}{%
\paragraph*{str\_replace() e str\_replace\_all()}\label{str_replace-e-str_replace_all}}
\addcontentsline{toc}{paragraph}{str\_replace() e str\_replace\_all()}

Substituem um padrão (ou todos) encontrado para um outro padrão.

Substituindo apenas a primeira ocorrência.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cidades }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"S. José do Rio Preto"}\NormalTok{, }\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"S. José dos Campos"}\NormalTok{, }\StringTok{"São Roque"}\NormalTok{, }\StringTok{"S. S. da Grama"}\NormalTok{)}

\FunctionTok{str\_replace}\NormalTok{(cidades, }\StringTok{"S[.]"}\NormalTok{, }\StringTok{"São"}\NormalTok{)}
\DocumentationTok{\#\# [1] "São José do Rio Preto" "São Paulo"             "São José dos Campos"  }
\DocumentationTok{\#\# [4] "São Roque"             "São S. da Grama"}
\end{Highlighting}
\end{Shaded}

Veja que no exemplo anterior precisamos colocar o \texttt{.} entre colchetes. Se não tivéssemos colocado, ele seria interpretado como uma regex e o padrão procurado seria \emph{``S'' seguido de qualquer caracter}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cidades }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"S. José do Rio Preto"}\NormalTok{, }\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"S. José dos Campos"}\NormalTok{, }\StringTok{"São Roque"}\NormalTok{, }\StringTok{"S. S. da Grama"}\NormalTok{)}

\FunctionTok{str\_replace}\NormalTok{(cidades, }\StringTok{"S."}\NormalTok{, }\StringTok{"São"}\NormalTok{)}
\DocumentationTok{\#\# [1] "São José do Rio Preto" "Sãoo Paulo"            "São José dos Campos"  }
\DocumentationTok{\#\# [4] "Sãoo Roque"            "São S. da Grama"}
\end{Highlighting}
\end{Shaded}

Nesses casos, podemos usar a função \texttt{fixed()} para indicar que o padrão procurado não é uma regex:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cidades }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"S. José do Rio Preto"}\NormalTok{, }\StringTok{"São Paulo"}\NormalTok{, }\StringTok{"S. José dos Campos"}\NormalTok{, }\StringTok{"São Roque"}\NormalTok{, }\StringTok{"S. S. da Grama"}\NormalTok{)}

\FunctionTok{str\_replace}\NormalTok{(cidades, }\FunctionTok{fixed}\NormalTok{(}\StringTok{"S."}\NormalTok{), }\StringTok{"São"}\NormalTok{)}
\DocumentationTok{\#\# [1] "São José do Rio Preto" "São Paulo"             "São José dos Campos"  }
\DocumentationTok{\#\# [4] "São Roque"             "São S. da Grama"}
\end{Highlighting}
\end{Shaded}

A função \texttt{str\_replace()} substitui apenas a primeira ocorrência encontrada. No exemplo anterior, apenas o primeiro ``S.'' era substituído por ``São''. Se quisermos substituir todas as ocorrências de um padrão dentro de uma string, utilizamos a função \texttt{str\_replace\_all()}.

No exemplo abaixo, substituímos todas as ocorrências de \texttt{.} e \texttt{-} por um espaço.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cpf }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"303.030.111{-}33"}\NormalTok{, }\StringTok{"102{-}177{-}011{-}20"}\NormalTok{, }\StringTok{"987.220.199.00"}\NormalTok{)}

\FunctionTok{str\_replace\_all}\NormalTok{(cpf, }\StringTok{"[.{-}]"}\NormalTok{, }\StringTok{" "}\NormalTok{)}
\DocumentationTok{\#\# [1] "303 030 111 33" "102 177 011 20" "987 220 199 00"}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_extract-e-str_extract_all}{%
\paragraph*{str\_extract() e str\_extract\_all()}\label{str_extract-e-str_extract_all}}
\addcontentsline{toc}{paragraph}{str\_extract() e str\_extract\_all()}

As funções \texttt{str\_extract()} e \texttt{str\_extract\_all()} extraem padrões de uma \emph{string}. No exemplo abaixo, pegamos apenas os sobrenomes de cada integrante do grupo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{r\_core\_group }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{\textquotesingle{}Douglas Bates\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}John Chambers\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Peter Dalgaard\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}Robert Gentleman\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Kurt Hornik\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Ross Ihaka\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Tomas Kalibera\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}Michael Lawrence\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Friedrich Leisch\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Uwe Ligges\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}...\textquotesingle{}}
\NormalTok{)}

\NormalTok{sobrenomes }\OtherTok{\textless{}{-}} \FunctionTok{str\_extract}\NormalTok{(r\_core\_group, }\StringTok{\textquotesingle{}[:alpha:]+$\textquotesingle{}}\NormalTok{)}
\NormalTok{sobrenomes}
\DocumentationTok{\#\#  [1] "Bates"     "Chambers"  "Dalgaard"  "Gentleman" "Hornik"    "Ihaka"    }
\DocumentationTok{\#\#  [7] "Kalibera"  "Lawrence"  "Leisch"    "Ligges"    NA}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_split-e-str_split_fixed}{%
\paragraph*{str\_split() e str\_split\_fixed()}\label{str_split-e-str_split_fixed}}
\addcontentsline{toc}{paragraph}{str\_split() e str\_split\_fixed()}

Essas funções separam uma \emph{string} em várias de acordo com um separador.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{texto }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Durante um longo período de tempo o "R" foi escrito "P" como no alfabeto cirílico. O seu nome no alfabeto fenício era "rech". Seu significado era o de uma cabeça, representada pela adaptação do hieróglifo egípcio de uma cabeça. Transformou{-}se no "rô" dos gregos. Os romanos modificaram o rô acrescentando um pequeno traço para diferenciá{-}lo do no nosso P.\textquotesingle{}}

\FunctionTok{str\_split}\NormalTok{(texto, }\FunctionTok{fixed}\NormalTok{(}\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{))}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] "Durante um longo período de tempo o \textbackslash{}"R\textbackslash{}" foi escrito \textbackslash{}"P\textbackslash{}" como no alfabeto cirílico"                }
\DocumentationTok{\#\# [2] " O seu nome no alfabeto fenício era \textbackslash{}"rech\textbackslash{}""                                                         }
\DocumentationTok{\#\# [3] " Seu significado era o de uma cabeça, representada pela adaptação do hieróglifo egípcio de uma cabeça"}
\DocumentationTok{\#\# [4] " Transformou{-}se no \textbackslash{}"rô\textbackslash{}" dos gregos"                                                                 }
\DocumentationTok{\#\# [5] " Os romanos modificaram o rô acrescentando um pequeno traço para diferenciá{-}lo do no nosso P"         }
\DocumentationTok{\#\# [6] ""}
\end{Highlighting}
\end{Shaded}

O \texttt{str\_split\_fixed} faz o mesmo que \texttt{str\_split()}, mas separa apenas \texttt{n} vezes.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_split\_fixed}\NormalTok{(texto, }\FunctionTok{fixed}\NormalTok{(}\StringTok{\textquotesingle{}.\textquotesingle{}}\NormalTok{), }\DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\#      [,1]                                                                                   }
\DocumentationTok{\#\# [1,] "Durante um longo período de tempo o \textbackslash{}"R\textbackslash{}" foi escrito \textbackslash{}"P\textbackslash{}" como no alfabeto cirílico"}
\DocumentationTok{\#\#      [,2]                                          }
\DocumentationTok{\#\# [1,] " O seu nome no alfabeto fenício era \textbackslash{}"rech\textbackslash{}""}
\DocumentationTok{\#\#      [,3]                                                                                                                                                                                                                                      }
\DocumentationTok{\#\# [1,] " Seu significado era o de uma cabeça, representada pela adaptação do hieróglifo egípcio de uma cabeça. Transformou{-}se no \textbackslash{}"rô\textbackslash{}" dos gregos. Os romanos modificaram o rô acrescentando um pequeno traço para diferenciá{-}lo do no nosso P."}
\end{Highlighting}
\end{Shaded}

\hypertarget{str_subset}{%
\paragraph*{str\_subset()}\label{str_subset}}
\addcontentsline{toc}{paragraph}{str\_subset()}

A função \texttt{str\_subset()} retorna somente as strings compatíveis com a regex.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{frases }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}a roupa do rei\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}de roma\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}o rato roeu\textquotesingle{}}\NormalTok{)}
\FunctionTok{str\_subset}\NormalTok{(frases, }\StringTok{\textquotesingle{}d[eo]\textquotesingle{}}\NormalTok{)}
\DocumentationTok{\#\# [1] "a roupa do rei" "de roma"}
\end{Highlighting}
\end{Shaded}

É o mesmo que fazer subset usando a função \texttt{str\_detect}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{frases[}\FunctionTok{str\_detect}\NormalTok{(frases, }\StringTok{"d[eo]"}\NormalTok{)]}
\DocumentationTok{\#\# [1] "a roupa do rei" "de roma"}
\end{Highlighting}
\end{Shaded}

\hypertarget{exercuxedcios-19}{%
\subsection{Exercícios}\label{exercuxedcios-19}}

\textbf{1.} O CPF é um número de 11 dígitos, por exemplo: 54491651884. No entanto para facilitar a visualização costumamos mostrá-lo com separadores a cada 3 casas: 544.916.518-84. Crie uma função que transforma um número de 11 dígitos em uma string com as separações, como um CPF.

\textbf{2.} Transforme o vetor de \emph{strings} abaixo em \texttt{"01\ -\ Alto"\ "02\ -\ Médio"\ "03\ -\ Baixo"}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Alto\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Médio\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Baixo\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{3.} Crie uma regex que capture múltiplas versões da palavra `casa'. Ela deve funcionar com as palavras `Casa', `CASA', `CaSa', `CAsa'. Teste-a usando a função \texttt{str\_detect()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Casa\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CASA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CaSa\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CAsa\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{4.} Imagine que a seguinte \emph{string} é a parte final de uma URL.

\begin{itemize}
\tightlist
\item
  \texttt{/ac/rio-branco/xpto-xyz-1-0-1fds2396-5}
\end{itemize}

Transforme-a em ``AC - Rio Branco'' utilizando funções do pacote \texttt{\{stringr\}}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}/ac/rio{-}branco/xpto{-}xyz{-}1{-}0{-}1fds2396{-}5\textquotesingle{}}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{5.} Crie uma função que retorna \texttt{TRUE} quando a string é um \href{https://pt.wikipedia.org/wiki/Pal\%C3\%ADndromo}{palíndromo} e \texttt{FALSO} caso não seja.

\textbf{6.} De acordo com as regras da língua portuguesa, antes de ``p'' ou ``b'' devemos usar a letra ``m''. Em outras palavras, com outras consoantes, usamos a letra ``N''. Suponha que você tem o seguinte texto com erros gramaticais:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{texto }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Nós chamamos os bonbeiros quando começou o incêmdio.\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Crie uma função para corrigi-lo.

\textbf{7.} Considere o seguinte texto

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{txt }\OtherTok{\textless{}{-}} \StringTok{"A função mais importante para leitura de dados no \textasciigrave{}lubridate\textasciigrave{} é a \textasciigrave{}ymd\textasciigrave{}. Essa função serve para ler qualquer data de uma \textasciigrave{}string\textasciigrave{} no formato \textasciigrave{}YYYY{-}MM{-}DD\textasciigrave{}. Essa função é útil pois funciona com qualquer separador entre os elementos da data e também porque temos uma função para cada formato (\textasciigrave{}mdy\textasciigrave{}, \textasciigrave{}dmy\textasciigrave{}, \textasciigrave{}dym\textasciigrave{}, \textasciigrave{}myd\textasciigrave{}, \textasciigrave{}ydm\textasciigrave{})."}
\end{Highlighting}
\end{Shaded}

Extraia todas as combinações da função \texttt{ymd}, sem repetições.

\textbf{8.} Considere as frases abaixo

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{\textquotesingle{}O produto é muito bom.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é bom.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é muito bom.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é ruim.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é não bom.\textquotesingle{}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Crie uma regra para identificar se o texto refere-se a um feedback positivo ou negativo sobre o produto (considere ``não bom = ruim'' e ``não ruim = bom''). Retorne um vetor lógico que vale \texttt{TRUE} se o feedback é positivo e \texttt{FALSE} caso contrário.

\hypertarget{o-pacote-lubridate}{%
\section{O pacote lubridate}\label{o-pacote-lubridate}}

Trabalhar com datas no R era uma chateação. As funções do R base são, em grande parte, contraintuitivas e podem mudar de acordo com o tipo do objeto que você está usando (data, hora, data/hora). Além disso, características como fusos horários, anos bissextos, horários de verão, entre outras, podem não estar bem especificadas ou nem mesmo sendo levadas em conta.

O pacote \texttt{\{lubridate\}}, criado por \href{https://github.com/garrettgman}{Garrett Grolemund} e \href{https://github.com/hadley}{Hadley Wickham}, surgiu para lidar com esses problemas, fazendo o trabalho com datas ser muito mais fácil.

Antes de começar a usar, você precisa instalar e carregar o pacote.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"lubridate"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(lubridate)}
\end{Highlighting}
\end{Shaded}

Neste seção, falaremos sobre:

\begin{itemize}
\tightlist
\item
  transformar e extrair datas;
\item
  algumas funções úteis para trabalhar com datas;
\item
  trabalhar com fusos horários; e
\item
  operações aritméticas com datas.
\end{itemize}

\hypertarget{a-classe-date}{%
\subsection{\texorpdfstring{A classe \texttt{date}}{A classe date}}\label{a-classe-date}}

Datas no R são tratadas como um tipo especial de objeto, com classe \texttt{date}. Há várias formas de criar objetos dessa classe com o pacote \texttt{\{lubridate\}}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_string }\OtherTok{\textless{}{-}} \StringTok{"21{-}10{-}2015"}
\FunctionTok{class}\NormalTok{(data\_string)}
\DocumentationTok{\#\# [1] "character"}

\NormalTok{data\_date }\OtherTok{\textless{}{-}} \FunctionTok{date}\NormalTok{(data\_string)}
\FunctionTok{class}\NormalTok{(data\_date)}
\DocumentationTok{\#\# [1] "Date"}
\NormalTok{data\_date}
\DocumentationTok{\#\# [1] "0021{-}10{-}20"}

\NormalTok{data\_as\_date }\OtherTok{\textless{}{-}} \FunctionTok{as\_date}\NormalTok{(data\_string)}
\DocumentationTok{\#\# Warning: All formats failed to parse. No formats found.}
\FunctionTok{class}\NormalTok{(data\_as\_date)}
\DocumentationTok{\#\# [1] "Date"}
\NormalTok{data\_as\_date}
\DocumentationTok{\#\# [1] NA}

\NormalTok{data\_mdy }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(data\_string)}
\FunctionTok{class}\NormalTok{(data\_mdy)}
\DocumentationTok{\#\# [1] "Date"}
\NormalTok{data\_mdy}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\end{Highlighting}
\end{Shaded}

Veja que as funções \texttt{date()} e \texttt{as\_date()} converteram a \emph{string} para data, mas não devolveram o valor esperado. A função \texttt{dmy()} resolve esse problema estabelecendo explicitamente a ordem dia-mês-ano. Existem funções para todas as ordens possíveis: \texttt{dmy()}, \texttt{mdy()}, \texttt{myd()}, \texttt{ymd()}, \texttt{ydm()} etc.

As funções \texttt{date()} e \texttt{as\_date()} assumem que a ordem segue o padrão da língua inglesa: ano-mês-dia (ymd).

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{date}\NormalTok{(}\StringTok{"2015{-}10{-}21"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\FunctionTok{as\_date}\NormalTok{(}\StringTok{"2015{-}10{-}21"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\end{Highlighting}
\end{Shaded}

Uma grande facilidade que essas funções trazem é poder criar objetos com classe \texttt{date} a partir de números e \emph{strings} em diversos formatos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{dmy}\NormalTok{(}\DecValTok{21102015}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\FunctionTok{dmy}\NormalTok{(}\StringTok{"21102015"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\FunctionTok{dmy}\NormalTok{(}\StringTok{"21/10/2015"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\FunctionTok{dmy}\NormalTok{(}\StringTok{"21.10.2015"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\end{Highlighting}
\end{Shaded}

Se além da data você precisar especificar o horário, basta usar as funções do tipo \texttt{ymd\_h()}, \texttt{ymd\_hm()}, \texttt{ymd\_hms()}, sendo que também há uma função para cada formato de dia-mês-ano.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ymd\_hms}\NormalTok{(}\DecValTok{20151021165411}\NormalTok{)}
\DocumentationTok{\#\# [1] "2015{-}10{-}21 16:54:11 UTC"}
\end{Highlighting}
\end{Shaded}

No R base, utilizamos a função \texttt{as.Date()} para transformar uma string em data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data\_base }\OtherTok{\textless{}{-}} \FunctionTok{as.Date}\NormalTok{(}\StringTok{"2015{-}10{-}21"}\NormalTok{)}
\FunctionTok{class}\NormalTok{(data\_base)}
\DocumentationTok{\#\# [1] "Date"}
\NormalTok{data\_base}
\DocumentationTok{\#\# [1] "2015{-}10{-}21"}
\end{Highlighting}
\end{Shaded}

Repare que a função \texttt{date()} do R base retorna a data e horário no momento da execução:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{base}\SpecialCharTok{::}\FunctionTok{date}\NormalTok{()}
\DocumentationTok{\#\# [1] "Wed Jul 14 12:09:46 2021"}
\end{Highlighting}
\end{Shaded}

\hypertarget{funuxe7uxf5es-uxfateis}{%
\subsection{Funções úteis}\label{funuxe7uxf5es-uxfateis}}

O \texttt{lubridate} traz diversas funções para extrair os componentes de um objeto da classe \texttt{date}.

\begin{itemize}
\tightlist
\item
  \texttt{second()} - extrai os segundos.
\item
  \texttt{minute()} - extrai os minutos.
\item
  \texttt{hour()} - extrai a hora.
\item
  \texttt{wday()} - extrai o dia da semana.
\item
  \texttt{mday()} - extrai o dia do mês.
\item
  \texttt{month()} - extrai o mês.
\item
  \texttt{year()} - extrai o ano.
\end{itemize}

Os nomes são tão óbvios que a explicação do que cada função faz é praticamente desnecessária.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{bday }\OtherTok{\textless{}{-}} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{"1989{-}07{-}29 030142"}\NormalTok{)}
\NormalTok{bday}
\DocumentationTok{\#\# [1] "1989{-}07{-}29 03:01:42 UTC"}

\FunctionTok{second}\NormalTok{(bday)}
\DocumentationTok{\#\# [1] 42}
\FunctionTok{day}\NormalTok{(bday)}
\DocumentationTok{\#\# [1] 29}
\FunctionTok{month}\NormalTok{(bday)}
\DocumentationTok{\#\# [1] 7}
\FunctionTok{year}\NormalTok{(bday)}
\DocumentationTok{\#\# [1] 1989}

\FunctionTok{wday}\NormalTok{(bday)}
\DocumentationTok{\#\# [1] 7}
\FunctionTok{wday}\NormalTok{(bday, }\AttributeTok{label =} \ConstantTok{TRUE}\NormalTok{)}
\DocumentationTok{\#\# [1] Sat}
\DocumentationTok{\#\# Levels: Sun \textless{} Mon \textless{} Tue \textless{} Wed \textless{} Thu \textless{} Fri \textless{} Sat}
\end{Highlighting}
\end{Shaded}

Você também pode usar essas funções para atribuir esses componentes a uma data:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"01/04/1991"}\NormalTok{)}
\NormalTok{data}
\DocumentationTok{\#\# [1] "1991{-}04{-}01"}

\FunctionTok{hour}\NormalTok{(data) }\OtherTok{\textless{}{-}} \DecValTok{20}
\NormalTok{data}
\DocumentationTok{\#\# [1] "1991{-}04{-}01 20:00:00 UTC"}
\end{Highlighting}
\end{Shaded}

Também existem funções para extrair a data no instante da execução.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Data e horário do dia em que essa página foi editada pela última vez.}
\FunctionTok{today}\NormalTok{() }
\DocumentationTok{\#\# [1] "2021{-}07{-}14"}
\FunctionTok{now}\NormalTok{()}
\DocumentationTok{\#\# [1] "2021{-}07{-}14 12:09:46 {-}03"}
\end{Highlighting}
\end{Shaded}

\hypertarget{fusos-horuxe1rios}{%
\subsection{Fusos horários}\label{fusos-horuxe1rios}}

Uma característica inerente das datas é o fuso horário. Se você estiver trabalhando com datas de eventos no Brasil e na Escócia, por exemplo, é preciso verificar se os valores seguem o mesmo fuso horário. Além disso, quando a data exata de um evento for relevante, você pode precisar converter horários para outros fusos para comunicar seus resultados em outros países.

Para fazer essas coisas, o \texttt{lubridate} fornece as funções \texttt{with\_tz()} e \texttt{force\_tz()}. Veja um exemplo de como usá-las.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{estreia\_GoT }\OtherTok{\textless{}{-}} \FunctionTok{ymd\_hms}\NormalTok{(}\StringTok{"2017{-}07{-}16 22:00:00"}\NormalTok{, }\AttributeTok{tz =} \StringTok{"America/Sao\_Paulo"}\NormalTok{)}
\NormalTok{estreia\_GoT}
\DocumentationTok{\#\# [1] "2017{-}07{-}16 22:00:00 {-}03"}

\CommentTok{\# Devolve qual seria a data em outro fuso}

\FunctionTok{with\_tz}\NormalTok{(estreia\_GoT, }\AttributeTok{tzone =} \StringTok{"GMT"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2017{-}07{-}17 01:00:00 GMT"}
\FunctionTok{with\_tz}\NormalTok{(estreia\_GoT, }\AttributeTok{tzone =} \StringTok{"US/Alaska"}\NormalTok{)  }
\DocumentationTok{\#\# [1] "2017{-}07{-}16 17:00:00 AKDT"}

\CommentTok{\# Altera o fuso sem mudar a hora}

\FunctionTok{force\_tz}\NormalTok{(estreia\_GoT, }\AttributeTok{tzone =} \StringTok{"GMT"}\NormalTok{)}
\DocumentationTok{\#\# [1] "2017{-}07{-}16 22:00:00 GMT"}
\end{Highlighting}
\end{Shaded}

\hypertarget{operauxe7uxf5es-com-datas}{%
\subsection{Operações com datas}\label{operauxe7uxf5es-com-datas}}

O pacote \texttt{lubridate} possui ainda funções para calcular intervalos e fazer operações aritméticas com datas.

\hypertarget{intervalos}{%
\subsubsection*{Intervalos}\label{intervalos}}
\addcontentsline{toc}{subsubsection}{Intervalos}

Intervalos podem ser salvos em objetos com classe \texttt{interval}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{inicio }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"01{-}04{-}1991"}\NormalTok{)}
\NormalTok{evento }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"31{-}10{-}1993"}\NormalTok{)}

\NormalTok{sobrev }\OtherTok{\textless{}{-}} \FunctionTok{interval}\NormalTok{(inicio, evento)}
\NormalTok{sobrev}
\DocumentationTok{\#\# [1] 1991{-}04{-}01 UTC{-}{-}1993{-}10{-}31 UTC}
\FunctionTok{class}\NormalTok{(sobrev)}
\DocumentationTok{\#\# [1] "Interval"}
\DocumentationTok{\#\# attr(,"package")}
\DocumentationTok{\#\# [1] "lubridate"}
\end{Highlighting}
\end{Shaded}

Você pode verificar se dois intervalos tem intersecção com a função \texttt{int\_overlaps()}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Outra forma de definir um intervalo: o operador \%{-}{-}\%}
\NormalTok{intervalo\_1 }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"01{-}02{-}2003"}\NormalTok{) }\SpecialCharTok{\%{-}{-}\%} \FunctionTok{dmy}\NormalTok{(}\StringTok{"02{-}03{-}2005"}\NormalTok{)  }

\NormalTok{intervalo\_2 }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"04{-}05{-}2004"}\NormalTok{) }\SpecialCharTok{\%{-}{-}\%} \FunctionTok{dmy}\NormalTok{(}\StringTok{"12{-}03{-}2012"}\NormalTok{)  }

\FunctionTok{int\_overlaps}\NormalTok{(intervalo\_1, intervalo\_2)}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

\hypertarget{aritmuxe9tica-com-datas}{%
\subsubsection{Aritmética com datas}\label{aritmuxe9tica-com-datas}}

Veja alguns exemplos de operações aritméticas que você pode fazer utilizando funções do \texttt{lubridate}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Somando datas}

\NormalTok{data }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"31/01/2000"}\NormalTok{)}

\NormalTok{data }\SpecialCharTok{+} \FunctionTok{ddays}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\DocumentationTok{\#\# [1] "2000{-}02{-}01"}
\NormalTok{data }\SpecialCharTok{+} \FunctionTok{dyears}\NormalTok{(}\DecValTok{1}\NormalTok{)}
\DocumentationTok{\#\# [1] "2001{-}01{-}30 06:00:00 UTC"}

\CommentTok{\# A operação abaixo retornaria uma data inválida}
\CommentTok{\# por isso obtemos NA}
\NormalTok{data }\SpecialCharTok{+} \FunctionTok{months}\NormalTok{(}\DecValTok{1}\NormalTok{)  }
\DocumentationTok{\#\# [1] NA}

\CommentTok{\# Criando datas recorrentes}

\NormalTok{reuniao }\OtherTok{\textless{}{-}} \FunctionTok{dmy}\NormalTok{(}\StringTok{"18{-}03{-}2017"}\NormalTok{)}
\NormalTok{reunioes }\OtherTok{\textless{}{-}}\NormalTok{ reuniao }\SpecialCharTok{+} \FunctionTok{weeks}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\NormalTok{reunioes}
\DocumentationTok{\#\#  [1] "2017{-}03{-}18" "2017{-}03{-}25" "2017{-}04{-}01" "2017{-}04{-}08" "2017{-}04{-}15"}
\DocumentationTok{\#\#  [6] "2017{-}04{-}22" "2017{-}04{-}29" "2017{-}05{-}06" "2017{-}05{-}13" "2017{-}05{-}20"}
\DocumentationTok{\#\# [11] "2017{-}05{-}27"}

\CommentTok{\# Duração de um intervalo }

\NormalTok{intervalo }\OtherTok{\textless{}{-}}\FunctionTok{dmy}\NormalTok{(}\StringTok{"01{-}03{-}2003"}\NormalTok{) }\SpecialCharTok{\%{-}{-}\%} \FunctionTok{dmy}\NormalTok{(}\StringTok{"31{-}03{-}2003"}\NormalTok{) }

\NormalTok{intervalo }\SpecialCharTok{/} \FunctionTok{ddays}\NormalTok{(}\DecValTok{1}\NormalTok{)               }\CommentTok{\# Número de dias}
\DocumentationTok{\#\# [1] 30}
\NormalTok{intervalo }\SpecialCharTok{/} \FunctionTok{dminutes}\NormalTok{(}\DecValTok{1}\NormalTok{)            }\CommentTok{\# Número de minutos}
\DocumentationTok{\#\# [1] 43200}

\FunctionTok{as.period}\NormalTok{(intervalo)}
\DocumentationTok{\#\# [1] "30d 0H 0M 0S"}
\end{Highlighting}
\end{Shaded}

Para mais informações sobre o\texttt{lubridate}, visite o \href{https://cran.r-project.org/web/packages/lubridate/vignettes/lubridate.html}{vignette do pacote}.

\hypertarget{exercuxedcios-20}{%
\subsection{Exercícios}\label{exercuxedcios-20}}

Nos exercícios a seguir, vamos utilizar a base \texttt{lakers}, que contém estatísticas jogo a jogo do \href{http://www.nba.com/lakers/}{Los Angeles Lakers} na temporada 2008-2009.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{as\_tibble}\NormalTok{()}
\DocumentationTok{\#\# \# A tibble: 34,624 x 13}
\DocumentationTok{\#\#      date opponent game\_type time  period etype team  player result points type }
\DocumentationTok{\#\#     \textless{}int\textgreater{} \textless{}chr\textgreater{}    \textless{}chr\textgreater{}     \textless{}chr\textgreater{}  \textless{}int\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{} \textless{}chr\textgreater{}  \textless{}chr\textgreater{}   \textless{}int\textgreater{} \textless{}chr\textgreater{}}
\DocumentationTok{\#\#  1 2.01e7 POR      home      12:00      1 jump\textasciitilde{} OFF   ""     ""          0 ""   }
\DocumentationTok{\#\#  2 2.01e7 POR      home      11:39      1 shot  LAL   "Pau \textasciitilde{} "miss\textasciitilde{}      0 "hoo\textasciitilde{}}
\DocumentationTok{\#\#  3 2.01e7 POR      home      11:37      1 rebo\textasciitilde{} LAL   "Vlad\textasciitilde{} ""          0 "off"}
\DocumentationTok{\#\#  4 2.01e7 POR      home      11:25      1 shot  LAL   "Dere\textasciitilde{} "miss\textasciitilde{}      0 "lay\textasciitilde{}}
\DocumentationTok{\#\#  5 2.01e7 POR      home      11:23      1 rebo\textasciitilde{} LAL   "Pau \textasciitilde{} ""          0 "off"}
\DocumentationTok{\#\#  6 2.01e7 POR      home      11:22      1 shot  LAL   "Pau \textasciitilde{} "made"      2 "hoo\textasciitilde{}}
\DocumentationTok{\#\#  7 2.01e7 POR      home      11:22      1 foul  POR   "Greg\textasciitilde{} ""          0 "sho\textasciitilde{}}
\DocumentationTok{\#\#  8 2.01e7 POR      home      11:22      1 free\textasciitilde{} LAL   "Pau \textasciitilde{} "made"      1 ""   }
\DocumentationTok{\#\#  9 2.01e7 POR      home      11:00      1 foul  LAL   "Vlad\textasciitilde{} ""          0 "per\textasciitilde{}}
\DocumentationTok{\#\# 10 2.01e7 POR      home      10:53      1 shot  POR   "LaMa\textasciitilde{} "made"      2 "jum\textasciitilde{}}
\DocumentationTok{\#\# \# ... with 34,614 more rows, and 2 more variables: x \textless{}int\textgreater{}, y \textless{}int\textgreater{}}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Repare que a coluna \texttt{date} no data.frame é um vetor de inteiros. Transforme essa coluna em um vetor de valores com classe \texttt{date}.

\textbf{2.} Crie uma coluna que junte as informações de data e tempo de jogo (colunas \texttt{date} e \texttt{time}) em objetos da classe \texttt{date}.

\textbf{3.} Crie as colunas \texttt{dia}, \texttt{mês} e \texttt{ano} com as respectivas informações sobre a data do jogo.

\textbf{4.} Em média, quanto tempo o Lakers demora para arremessar a primeira bola no primeiro período?

\textbf{Dica}: arremessos são representados pela categoria \texttt{shot} da coluna \texttt{etype}.

\textbf{5.} Em média, quanto tempo demora para sair a primeira cesta de três pontos? Considere toda a base, e cestas de ambos os times.

\textbf{6.} Construa boxplots do tempo entre pontos consecultivos para cada períodos. Considere toda a base de dados e apenas pontos do Lakers.

\textbf{7.} Qual foi o dia e mês do jogo que o Lakers demorou mais tempo para fazer uma cesta? Quanto tempo foi?

\hypertarget{forcats}{%
\section{O pacote forcats}\label{forcats}}

Se você utiliza R antes do surgimento do \texttt{tidyverse}, provavelmente já escreveu a expressão \texttt{stringsAsFactors\ =\ F} quando importava dados usando as funções \texttt{read.csv} ou \texttt{read.table}. É muito frustrante quando uma coluna de \texttt{strings} é lida como um fator, pois fatores não podem ser manipulados do mesmo jeito que manipulamos vetores de \texttt{strings}.

Felizmente, depois de aprender a usar o \texttt{readr} você não terá mais esse problema, pois as funções do pacote não lê colunas de caracteres como fatores por padrão. Mas isso não significa que fatores são inúteis. Eles representam uma forma muito prática de lidar com variáveis categorizadas, tanto para fins de modelagem quanto para fins de visualização.

Grande parte da frustração associada ao uso de fatores no R existe por conta da falta de algumas ferramentas úteis no pacote \texttt{base}. Para resolver esse o problema, Hadley Wickham ajudou a comunidade R (de novo) desenvolvendo o pacote \texttt{forcats}(\textbf{for} \textbf{cat}egorial variable\textbf{s}), que implementa algumas dessas ferramentas.

As principais funções do \texttt{forcats} servem para alterar a \textbf{ordem} e modificar os \textbf{níveis} de um fator. Para exemplificar a utilidade dessas funções, nesta seção vamos utilizá-las em situações corriqueiras.

Se você não tem o pacote \texttt{\{forcats\}}, instalado rode o código abaixo antes de utilizá-lo:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"forcats"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Nos exemplos a seguir, utilizarmos os seguintes pacotes:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(forcats)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{o-que-suxe3o-fatores}{%
\subsection{O que são fatores?}\label{o-que-suxe3o-fatores}}

Como vimos na Seção \ref{fatores}, fatores são uma classe de objetos no R criada para representar as variáveis categóricas numericamente.

Eles são necessários pois muitas vezes precisamos representar variáveis categóricas como números. Quando estamos fazendo um gráfico, por exemplo, só podemos mapear variáveis numéricas em seus eixos, pois o plano cartesiano é formado por duas retas de números reais.

O que fazemos então quando plotamos uma variável categórica? Nós a transformamos em fatores.

Mas como a manipulação de fatores é diferente da manipulação de números e strings (graças aos famosos \emph{levels}), tarefas que parecem simples, como ordenar as barras de um gráfico de barras, acabam se tornando grandes desafios quando não sabemos lidar com essa classe de valores.

Nos exemplos a seguir, vamos utilizar a base \texttt{starwars} (do pacote \texttt{\{dplyr\}}) para aprendermos a fazer as principais operações com fatores utilizando o pacote \texttt{\{forcats\}}.

\hypertarget{modificando-nuxedveis-de-um-fator}{%
\subsection{Modificando níveis de um fator}\label{modificando-nuxedveis-de-um-fator}}

Vamos trabalhar primeiro com a coluna \texttt{sex}, que diz qual é o sexo de cada personagem. As possibilidades são:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unique}\NormalTok{()}
\DocumentationTok{\#\# [1] "male"           "none"           "female"         "hermaphroditic"}
\DocumentationTok{\#\# [5] NA}
\end{Highlighting}
\end{Shaded}

Veja que se transformarmos a coluna em fator, esses serão os \emph{levels} da variável, não importa se o sub-conjunto que estivermos observando possua ou não todas as categorias.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{sex =} \FunctionTok{as.factor}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{()}
\DocumentationTok{\#\# [1] male   none   none   male   female male  }
\DocumentationTok{\#\# Levels: female hermaphroditic male none}
\end{Highlighting}
\end{Shaded}

Vamos criar um objeto com os 16 primeiros valores da coluna \texttt{sex} já transformados em fator.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator\_sex }\OtherTok{\textless{}{-}}\NormalTok{ starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{as.factor}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{head}\NormalTok{(}\DecValTok{16}\NormalTok{)}
\NormalTok{fator\_sex}
\DocumentationTok{\#\#  [1] male           none           none           male           female        }
\DocumentationTok{\#\#  [6] male           female         none           male           male          }
\DocumentationTok{\#\# [11] male           male           male           male           male          }
\DocumentationTok{\#\# [16] hermaphroditic}
\DocumentationTok{\#\# Levels: female hermaphroditic male none}
\end{Highlighting}
\end{Shaded}

Para mudar os níveis de um fator, podemos utilizar a função \texttt{lvls\_revalue()}. Veja que, ao mudarmos os níveis de um fator, o \emph{label} de cada valor também muda. Os novos valores precisam ser passados conforme a ordem dos níveis antigos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lvls\_revalue}\NormalTok{(}
\NormalTok{  fator\_sex, }
  \AttributeTok{new\_levels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{)}
\NormalTok{)}
\DocumentationTok{\#\#  [1] Macho        Nenhum       Nenhum       Macho        Fêmea       }
\DocumentationTok{\#\#  [6] Macho        Fêmea        Nenhum       Macho        Macho       }
\DocumentationTok{\#\# [11] Macho        Macho        Macho        Macho        Macho       }
\DocumentationTok{\#\# [16] Hermafrodita}
\DocumentationTok{\#\# Levels: Fêmea Hermafrodita Macho Nenhum}
\end{Highlighting}
\end{Shaded}

Essa função é uma boa alternativa para mudar o nome das categorias de uma variável antes de construir um gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{lvls\_revalue}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{))}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ n)) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-7-1} \end{center}

Como as colunas no gráfico respeitam a ordem dos níveis do fator, não importa a ordem que as linhas aparecem na tabela, o gráfico sempre será gerado com as colunas na mesma ordem. Assim, se quiséssemos alterar a ordem das barras do gráfico anterior, precisamos mudar a ordem dos níveis do fator \texttt{sex}.

\hypertarget{mudando-a-ordem-dos-nuxedveis-de-um-fator}{%
\subsection{Mudando a ordem dos níveis de um fator}\label{mudando-a-ordem-dos-nuxedveis-de-um-fator}}

Para mudar a ordem dos níveis de um fator, podemos utilizar a função \texttt{lvls\_reorder()}. Basta passarmos qual a nova ordem dos fatores, com relação à ordem anterior. No exemplo abaixo definimos que, na nova ordem,

\begin{itemize}
\item
  a primeira posição terá o nível que estava na terceira posição na ordem antiga;
\item
  a segunda posição terá o nível que estava na primeira posição na ordem antiga;
\item
  a terceira posição terá o nível que estava na quarta posição na ordem antiga;
\item
  a quarta posição terá o nível que estava na segunda posição na ordem antiga.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{lvls\_reorder}\NormalTok{(fator\_sex, }\FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\DocumentationTok{\#\#  [1] male           none           none           male           female        }
\DocumentationTok{\#\#  [6] male           female         none           male           male          }
\DocumentationTok{\#\# [11] male           male           male           male           male          }
\DocumentationTok{\#\# [16] hermaphroditic}
\DocumentationTok{\#\# Levels: male female none hermaphroditic}
\end{Highlighting}
\end{Shaded}

Assim, poderíamos usar essa nova ordem para ordenar as colunas do nosso gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{lvls\_revalue}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{)),}
    \AttributeTok{sex =} \FunctionTok{lvls\_reorder}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\DecValTok{3}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ n)) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-9-1} \end{center}

Repare que precisamos passar a nova ordem na mão, o que pode deixar de funcionar se a nossa base mudar (recebemos mais linhas ou fizermos um filtro anteriormente).

Anterior ao \texttt{mutate()} temos a seguinte tabela:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(sex) }
\DocumentationTok{\#\# \# A tibble: 4 x 2}
\DocumentationTok{\#\#   sex                n}
\DocumentationTok{\#\#   \textless{}chr\textgreater{}          \textless{}int\textgreater{}}
\DocumentationTok{\#\# 1 female            16}
\DocumentationTok{\#\# 2 hermaphroditic     1}
\DocumentationTok{\#\# 3 male              60}
\DocumentationTok{\#\# 4 none               6}
\end{Highlighting}
\end{Shaded}

O que queremos é que os níveis da coluna \texttt{sex} sejam ordenados segundo os valores da coluna \texttt{n}, isto é, quem tiver o maior valor de \texttt{n} deve ser o primeiro nível, o segundo maior valor de \texttt{n} seja o segundo nível e assim por diante.

Podemos melhorar esse código utilizando a função \texttt{fct\_reorder()}. Com ela, em vez de definirmos na mão a ordem dos níveis do fator, podemos ordená-lo segundo valores de uma segunda variável.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{lvls\_revalue}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{)),}
    \AttributeTok{sex =} \FunctionTok{fct\_reorder}\NormalTok{(sex, n)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ n)) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-11-1} \end{center}

É quase o que queríamos! O problema é que os níveis estão sendo ordenados de forma crescente e gostaríamos de ordenar na ordem decrescente. Para isso, basta utilizarmos o parâmetro \texttt{.desc}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(sex) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{lvls\_revalue}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{)),}
    \AttributeTok{sex =} \FunctionTok{fct\_reorder}\NormalTok{(sex, n, }\AttributeTok{.desc =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ n)) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-12-1} \end{center}

Agora sim! Com esse código, as colunas estarão sendo ordenadas pela frequência, independentemente dos valores de \texttt{n} e \texttt{sex} que chegarem no \texttt{mutate()}.

Se olharmos a documentação da função \texttt{fct\_reorder()} vamos descobrir que esse exemplo é apenas um caso particular de como podemos utilizá-la. No contexto geral, ela ordena os níveis de um fator segundo \textbf{uma função} dos valores de uma segunda variável.

Se em vez de construirmos um gráfico de barras da frequência da variável \texttt{sex}, construíssemos boxplots da altura para cada sexo diferente, teríamos o gráfico a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ height))}
\DocumentationTok{\#\# Warning: Removed 5 rows containing non{-}finite values (stat\_boxplot).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-13-1} \end{center}

Se quiséssemos ordenar cada boxplot (pela mediana, por exemplo), continuamos podendo usar a função \texttt{fct\_reorder()}. Veja que ela possui o argumento \texttt{.fun}, que indica qual função será utilizada na variável secundária para determinar a ordem dos níveis.

No exemplo abaixo, utilizamos \texttt{.fun\ =\ median}, o que significa que, para cada nível da variável \texttt{sex}, vamos calcular a mediana da variável \texttt{height} e ordenaremos os níveis de \texttt{sex} conforme a ordem dessas medianas. Assim, o primeiro nível será o sexo com menor altura mediana, o segundo nível será o sexo com a segunda menor algura media e assim por diante. Se quiséssemos ordenar de forma decrescente, bastaria utilizar o argumento \texttt{.desc\ =\ TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{lvls\_revalue}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{)),}
    \AttributeTok{sex =} \FunctionTok{fct\_reorder}\NormalTok{(sex, height, }\AttributeTok{.fun =}\NormalTok{ median, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ height))}
\DocumentationTok{\#\# Warning: Removed 5 rows containing non{-}finite values (stat\_boxplot).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-14-1} \end{center}

Também poderíamos ordenar pelo máximo, utilizando \texttt{.fun\ =\ max}. Neste argumento, podemos usar qualquer função sumarizadora: \texttt{min()}, \texttt{mean()}, \texttt{median()}, \texttt{max()}, \texttt{sd()}, \texttt{var()} etc.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(sex)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{sex =} \FunctionTok{lvls\_revalue}\NormalTok{(sex, }\FunctionTok{c}\NormalTok{(}\StringTok{"Fêmea"}\NormalTok{, }\StringTok{"Hermafrodita"}\NormalTok{, }\StringTok{"Macho"}\NormalTok{, }\StringTok{"Nenhum"}\NormalTok{)),}
    \AttributeTok{sex =} \FunctionTok{fct\_reorder}\NormalTok{(sex, height, }\AttributeTok{.fun =}\NormalTok{ max, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
\FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ sex, }\AttributeTok{y =}\NormalTok{ height))}
\DocumentationTok{\#\# Warning: Removed 5 rows containing non{-}finite values (stat\_boxplot).}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-15-1} \end{center}

\hypertarget{colapsando-nuxedveis-de-um-fator}{%
\subsection{Colapsando níveis de um fator}\label{colapsando-nuxedveis-de-um-fator}}

Imagine que quermos fazer um gráfico de barras com a frequência de personagens por espécie.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-16-1} \end{center}

O gráfico resultante é horrível, pois temos muitas espécies diferentes. Uma solução seria agrupar as espécies menos frequentes, criando uma nova categoria (\emph{outras}, por exemplo).

Para isso, podemos usar a função \texttt{fct\_lump()}. Vamos fazer isso primeiro com o vetor de espécies.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator\_especies }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(starwars}\SpecialCharTok{$}\NormalTok{species)}
\NormalTok{fator\_especies}
\DocumentationTok{\#\#  [1] Human          Droid          Droid          Human          Human         }
\DocumentationTok{\#\#  [6] Human          Human          Droid          Human          Human         }
\DocumentationTok{\#\# [11] Human          Human          Wookiee        Human          Rodian        }
\DocumentationTok{\#\# [16] Hutt           Human          Human          Yoda\textquotesingle{}s species Human         }
\DocumentationTok{\#\# [21] Human          Droid          Trandoshan     Human          Human         }
\DocumentationTok{\#\# [26] Mon Calamari   Human          Human          Ewok           Sullustan     }
\DocumentationTok{\#\# [31] Human          Neimodian      Human          Gungan         Gungan        }
\DocumentationTok{\#\# [36] Gungan         \textless{}NA\textgreater{}           Toydarian      Dug            \textless{}NA\textgreater{}          }
\DocumentationTok{\#\# [41] Human          Zabrak         Twi\textquotesingle{}lek        Twi\textquotesingle{}lek        Vulptereen    }
\DocumentationTok{\#\# [46] Xexto          Toong          Human          Cerean         Nautolan      }
\DocumentationTok{\#\# [51] Zabrak         Tholothian     Iktotchi       Quermian       Kel Dor       }
\DocumentationTok{\#\# [56] Chagrian       Human          Human          Human          Geonosian     }
\DocumentationTok{\#\# [61] Mirialan       Mirialan       Human          Human          Human         }
\DocumentationTok{\#\# [66] Human          Clawdite       Besalisk       Kaminoan       Kaminoan      }
\DocumentationTok{\#\# [71] Human          Aleena         Droid          Skakoan        Muun          }
\DocumentationTok{\#\# [76] Togruta        Kaleesh        Wookiee        Human          \textless{}NA\textgreater{}          }
\DocumentationTok{\#\# [81] Pau\textquotesingle{}an         Human          Human          Human          Droid         }
\DocumentationTok{\#\# [86] \textless{}NA\textgreater{}           Human         }
\DocumentationTok{\#\# 37 Levels: Aleena Besalisk Cerean Chagrian Clawdite Droid Dug ... Zabrak}
\end{Highlighting}
\end{Shaded}

Temos 37 espécies diferentes na base. Podemos deixar apenas as 3 mais frequentes da seguinte forma:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_lump}\NormalTok{(fator\_especies, }\AttributeTok{n =} \DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\#  [1] Human  Droid  Droid  Human  Human  Human  Human  Droid  Human  Human }
\DocumentationTok{\#\# [11] Human  Human  Other  Human  Other  Other  Human  Human  Other  Human }
\DocumentationTok{\#\# [21] Human  Droid  Other  Human  Human  Other  Human  Human  Other  Other }
\DocumentationTok{\#\# [31] Human  Other  Human  Gungan Gungan Gungan \textless{}NA\textgreater{}   Other  Other  \textless{}NA\textgreater{}  }
\DocumentationTok{\#\# [41] Human  Other  Other  Other  Other  Other  Other  Human  Other  Other }
\DocumentationTok{\#\# [51] Other  Other  Other  Other  Other  Other  Human  Human  Human  Other }
\DocumentationTok{\#\# [61] Other  Other  Human  Human  Human  Human  Other  Other  Other  Other }
\DocumentationTok{\#\# [71] Human  Other  Droid  Other  Other  Other  Other  Other  Human  \textless{}NA\textgreater{}  }
\DocumentationTok{\#\# [81] Other  Human  Human  Human  Droid  \textless{}NA\textgreater{}   Human }
\DocumentationTok{\#\# Levels: Droid Gungan Human Other}
\end{Highlighting}
\end{Shaded}

O fator resultante possui 4 níveis: \texttt{Droid}, \texttt{Gungan}, \texttt{Human} e \texttt{Other}. Os 3 primeiros níveis são os mais frequentes, enquanto o nível \texttt{Other} foi atribuído a todos os outros 34 níveis que existiam anteiormente.

Poderíamos definir o nome do nível \texttt{Others} usando o argumento \texttt{other\_level}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_lump}\NormalTok{(fator\_especies, }\AttributeTok{n =} \DecValTok{3}\NormalTok{, }\AttributeTok{other\_level =} \StringTok{"Outras espécies"}\NormalTok{)}
\DocumentationTok{\#\#  [1] Human           Droid           Droid           Human          }
\DocumentationTok{\#\#  [5] Human           Human           Human           Droid          }
\DocumentationTok{\#\#  [9] Human           Human           Human           Human          }
\DocumentationTok{\#\# [13] Outras espécies Human           Outras espécies Outras espécies}
\DocumentationTok{\#\# [17] Human           Human           Outras espécies Human          }
\DocumentationTok{\#\# [21] Human           Droid           Outras espécies Human          }
\DocumentationTok{\#\# [25] Human           Outras espécies Human           Human          }
\DocumentationTok{\#\# [29] Outras espécies Outras espécies Human           Outras espécies}
\DocumentationTok{\#\# [33] Human           Gungan          Gungan          Gungan         }
\DocumentationTok{\#\# [37] \textless{}NA\textgreater{}            Outras espécies Outras espécies \textless{}NA\textgreater{}           }
\DocumentationTok{\#\# [41] Human           Outras espécies Outras espécies Outras espécies}
\DocumentationTok{\#\# [45] Outras espécies Outras espécies Outras espécies Human          }
\DocumentationTok{\#\# [49] Outras espécies Outras espécies Outras espécies Outras espécies}
\DocumentationTok{\#\# [53] Outras espécies Outras espécies Outras espécies Outras espécies}
\DocumentationTok{\#\# [57] Human           Human           Human           Outras espécies}
\DocumentationTok{\#\# [61] Outras espécies Outras espécies Human           Human          }
\DocumentationTok{\#\# [65] Human           Human           Outras espécies Outras espécies}
\DocumentationTok{\#\# [69] Outras espécies Outras espécies Human           Outras espécies}
\DocumentationTok{\#\# [73] Droid           Outras espécies Outras espécies Outras espécies}
\DocumentationTok{\#\# [77] Outras espécies Outras espécies Human           \textless{}NA\textgreater{}           }
\DocumentationTok{\#\# [81] Outras espécies Human           Human           Human          }
\DocumentationTok{\#\# [85] Droid           \textless{}NA\textgreater{}            Human          }
\DocumentationTok{\#\# Levels: Droid Gungan Human Outras espécies}
\end{Highlighting}
\end{Shaded}

Também podemos transformar em \texttt{Outras} os níveis cuja frequência relativa é menor que um determinado limite, por exemplo, 2\%. No exemplo abaixo, apenas espécies que representam mais de 2\% dos personagem na base são mantidas. As demais foram transformadas em \texttt{Outras}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_lump}\NormalTok{(fator\_especies, }\AttributeTok{p =} \FloatTok{0.02}\NormalTok{, }\AttributeTok{other\_level =} \StringTok{"Outras"}\NormalTok{)}
\DocumentationTok{\#\#  [1] Human    Droid    Droid    Human    Human    Human    Human    Droid   }
\DocumentationTok{\#\#  [9] Human    Human    Human    Human    Wookiee  Human    Outras   Outras  }
\DocumentationTok{\#\# [17] Human    Human    Outras   Human    Human    Droid    Outras   Human   }
\DocumentationTok{\#\# [25] Human    Outras   Human    Human    Outras   Outras   Human    Outras  }
\DocumentationTok{\#\# [33] Human    Gungan   Gungan   Gungan   \textless{}NA\textgreater{}     Outras   Outras   \textless{}NA\textgreater{}    }
\DocumentationTok{\#\# [41] Human    Zabrak   Twi\textquotesingle{}lek  Twi\textquotesingle{}lek  Outras   Outras   Outras   Human   }
\DocumentationTok{\#\# [49] Outras   Outras   Zabrak   Outras   Outras   Outras   Outras   Outras  }
\DocumentationTok{\#\# [57] Human    Human    Human    Outras   Mirialan Mirialan Human    Human   }
\DocumentationTok{\#\# [65] Human    Human    Outras   Outras   Kaminoan Kaminoan Human    Outras  }
\DocumentationTok{\#\# [73] Droid    Outras   Outras   Outras   Outras   Wookiee  Human    \textless{}NA\textgreater{}    }
\DocumentationTok{\#\# [81] Outras   Human    Human    Human    Droid    \textless{}NA\textgreater{}     Human   }
\DocumentationTok{\#\# 9 Levels: Droid Gungan Human Kaminoan Mirialan Twi\textquotesingle{}lek Wookiee ... Outras}
\end{Highlighting}
\end{Shaded}

Com isso, já conseguimos fazer um gráfico de barras mais agradável.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(species)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{species =} \FunctionTok{fct\_lump}\NormalTok{(species, }\AttributeTok{n =} \DecValTok{2}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-21-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]


\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(species)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{species =} \FunctionTok{fct\_lump}\NormalTok{(species, }\AttributeTok{p =} \FloatTok{0.02}\NormalTok{),}
    \AttributeTok{species =} \FunctionTok{fct\_infreq}\NormalTok{(species) }\CommentTok{\# Ordena pela frequência de cada nível}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ species)) }\SpecialCharTok{+}
  \FunctionTok{geom\_bar}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-21-2} \end{center}

Também é possível colapsar níveis criando manualmente os grupos. Para isso, utilizamos a função \texttt{fct\_collapse()}. No exemplo a seguir, reclassificamos os níveis da variável \texttt{eye\_color}. Os níveis não listados são reclassificados como \texttt{"outros"}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator\_cor\_olhos }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(starwars}\SpecialCharTok{$}\NormalTok{eye\_color)}

\FunctionTok{fct\_collapse}\NormalTok{(}
\NormalTok{  fator\_cor\_olhos,}
  \AttributeTok{preto =} \StringTok{"black"}\NormalTok{,}
  \AttributeTok{castanho =} \FunctionTok{c}\NormalTok{(}\StringTok{"brown"}\NormalTok{, }\StringTok{"hazel"}\NormalTok{),}
  \AttributeTok{azul\_verde =} \FunctionTok{c}\NormalTok{(}\StringTok{"blue"}\NormalTok{, }\StringTok{"green"}\NormalTok{),}
  \AttributeTok{exotico =} \FunctionTok{c}\NormalTok{(}\StringTok{"pink"}\NormalTok{, }\StringTok{"red"}\NormalTok{, }\StringTok{"white"}\NormalTok{),}
  \AttributeTok{colorido =} \FunctionTok{c}\NormalTok{(}\StringTok{"red, blue"}\NormalTok{, }\StringTok{"green, yellow"}\NormalTok{),}
  \AttributeTok{other\_level =} \StringTok{"outros"}
\NormalTok{)}
\DocumentationTok{\#\# Warning: Unknown levels in \textasciigrave{}f\textasciigrave{}: green}
\DocumentationTok{\#\#  [1] azul\_verde outros     exotico    outros     castanho   azul\_verde}
\DocumentationTok{\#\#  [7] azul\_verde exotico    castanho   outros     azul\_verde azul\_verde}
\DocumentationTok{\#\# [13] azul\_verde castanho   preto      outros     castanho   azul\_verde}
\DocumentationTok{\#\# [19] castanho   outros     castanho   exotico    exotico    castanho  }
\DocumentationTok{\#\# [25] azul\_verde outros     azul\_verde castanho   castanho   preto     }
\DocumentationTok{\#\# [31] azul\_verde exotico    azul\_verde outros     outros     outros    }
\DocumentationTok{\#\# [37] azul\_verde outros     outros     castanho   castanho   outros    }
\DocumentationTok{\#\# [43] exotico    castanho   outros     preto      outros     castanho  }
\DocumentationTok{\#\# [49] outros     preto      castanho   azul\_verde outros     outros    }
\DocumentationTok{\#\# [55] preto      azul\_verde castanho   castanho   azul\_verde outros    }
\DocumentationTok{\#\# [61] azul\_verde azul\_verde castanho   castanho   castanho   castanho  }
\DocumentationTok{\#\# [67] outros     outros     preto      preto      azul\_verde outros    }
\DocumentationTok{\#\# [73] colorido   outros     outros     preto      colorido   azul\_verde}
\DocumentationTok{\#\# [79] castanho   exotico    preto      outros     castanho   castanho  }
\DocumentationTok{\#\# [85] preto      outros     castanho  }
\DocumentationTok{\#\# Levels: preto azul\_verde castanho colorido exotico outros}
\end{Highlighting}
\end{Shaded}

\hypertarget{outras-funuxe7uxf5es-uxfateis}{%
\subsection{Outras funções úteis}\label{outras-funuxe7uxf5es-uxfateis}}

A seguir, listamos outras funções úteis do pacote \texttt{\{forcats\}}, apresentando exemplos simples de como usá-las.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{))}
\NormalTok{fator}
\DocumentationTok{\#\# [1] a b a c c a}
\DocumentationTok{\#\# Levels: a b c}
\end{Highlighting}
\end{Shaded}

\hypertarget{fct_c}{%
\subsubsection*{\texorpdfstring{\texttt{fct\_c()}}{fct\_c()}}\label{fct_c}}
\addcontentsline{toc}{subsubsection}{\texttt{fct\_c()}}

Junta dois fatores (e seus níveis).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator2 }\OtherTok{\textless{}{-}} \FunctionTok{factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{))}
\FunctionTok{fct\_c}\NormalTok{(fator, fator2)}
\DocumentationTok{\#\# [1] a b a c c a d e}
\DocumentationTok{\#\# Levels: a b c d e}
\end{Highlighting}
\end{Shaded}

\hypertarget{fct_count}{%
\subsubsection*{\texorpdfstring{\texttt{fct\_count()}}{fct\_count()}}\label{fct_count}}
\addcontentsline{toc}{subsubsection}{\texttt{fct\_count()}}

Devolve a frequência dos níveis de um vetor.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_count}\NormalTok{(fator)}
\DocumentationTok{\#\# \# A tibble: 3 x 2}
\DocumentationTok{\#\#   f         n}
\DocumentationTok{\#\#   \textless{}fct\textgreater{} \textless{}int\textgreater{}}
\DocumentationTok{\#\# 1 a         3}
\DocumentationTok{\#\# 2 b         1}
\DocumentationTok{\#\# 3 c         2}
\end{Highlighting}
\end{Shaded}

\hypertarget{fct_expand}{%
\subsubsection*{\texorpdfstring{\texttt{fct\_expand()}}{fct\_expand()}}\label{fct_expand}}
\addcontentsline{toc}{subsubsection}{\texttt{fct\_expand()}}

Acrescenta níveis a um fator

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_expand}\NormalTok{(fator, }\FunctionTok{c}\NormalTok{(}\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{))}
\DocumentationTok{\#\# [1] a b a c c a}
\DocumentationTok{\#\# Levels: a b c d e}
\end{Highlighting}
\end{Shaded}

\hypertarget{fct_rev}{%
\subsubsection*{\texorpdfstring{\texttt{fct\_rev()}}{fct\_rev()}}\label{fct_rev}}
\addcontentsline{toc}{subsubsection}{\texttt{fct\_rev()}}

Inverte os níveis de um fator.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{fct\_rev}\NormalTok{(fator)}
\DocumentationTok{\#\# [1] a b a c c a}
\DocumentationTok{\#\# Levels: c b a}
\end{Highlighting}
\end{Shaded}

\hypertarget{exercuxedcios-21}{%
\subsection{Exercícios}\label{exercuxedcios-21}}

A base \texttt{casas} nos exercícios abaixo está no pacote \texttt{dados}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"cienciadedatos/dados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Qual a diferença nos fatores criados com os códigos abaixo?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator1 }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"z"}\NormalTok{, }\StringTok{"B"}\NormalTok{))}
\NormalTok{fator2 }\OtherTok{\textless{}{-}}\NormalTok{ forcats}\SpecialCharTok{::}\FunctionTok{as\_factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"z"}\NormalTok{, }\StringTok{"B"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{2.} Ordene os níveis do fator \texttt{frutas} conforme a sua preferência, isto é, as que você mais gosta primeiro e as que você menos gosta por último.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{frutas }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"maçã"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"mamão"}\NormalTok{, }\StringTok{"laranja"}\NormalTok{, }\StringTok{"melancia"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{3.} Com base no vetor \texttt{series}, resolva os itens a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{series }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Game of Thrones"}\NormalTok{, }\StringTok{"How I Met your Mother"}\NormalTok{, }\StringTok{"Friends"}\NormalTok{, }\StringTok{"Lost"}\NormalTok{, }\StringTok{"The Office"}\NormalTok{, }\StringTok{"Breaking Bad"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \textbf{a.} Ordene os níveis do vetor \texttt{series} conforme a sua preferência, isto é, as que você mais gosta primeiro e as que você menos gosta por último.
\item
  \textbf{b.} Junte ao vetor \texttt{series} o vetor \texttt{novas\_series} a seguir, reordenando os níveis para manter a sua ordem de preferência.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{novas\_series }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"The Boys"}\NormalTok{, }\StringTok{"Stranger Things"}\NormalTok{, }\StringTok{"Queen\textquotesingle{}s Gambit"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \textbf{c.} Renomeie o níveis do vetor criado no item (b) para os nomes em Português das séries. Mantenha o mesmo nome caso não haja tradução.
\end{itemize}

\textbf{4.} Ordene as categorias do eixo y do gráfico abaixo para que os pontos no eixo x fique em ordem crescente.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{rownames\_to\_column}\NormalTok{(}\StringTok{"modelo"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mpg, }\AttributeTok{y =}\NormalTok{ modelo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.75\linewidth]{076-forcats_files/figure-latex/unnamed-chunk-33-1} \end{center}

\textbf{5.} Utilize a base \texttt{dados::casas} para fazer um gráfico de barras mostrando as vizinhanças (coluna \texttt{vizinhanca}) com casas mais caras (segundo a coluna \texttt{venda\_valor}). O gráfico deve conter as 9 vizinhanças mais frequentes e as demais devem ser agrupadas em uma categoria chamada \texttt{Outras\ vizinhanças}.

\hypertarget{graficos}{%
\chapter{Visualização}\label{graficos}}

Agora que já temos em mãos as ferramentas para importar, arrumar, transformar e sumarizar os nossos dados, podemos dar um passo adiante no ciclo da Ciência de Dados: a construção de \emph{visualizações}.

Visualizar os dados é uma etapa importantíssima da análise estatística, pois é a partir dela que criamos boa parte da intuição necessária para escolher o teste ou modelo mais adequado para o nosso problema. Muitas vezes, um problema de análise de dados pode ser resolvido apenas com visualizações. Além disso, elas são o principal combustível da etapa de Comunicação da análise.

Visualizações podem ser uma simples medida resumo (frequência, média, variância, mínimo, máximo etc), um conjunto dessas medidas organizadas em uma tabela ou a representação (de uma parte) dos dados em um gráfico. Neste capítulo, mostraremos como construir gráficos e tabelas bem formatadas dentro do R. Começaremos com a construção de gráficos e, em seguida, falaremos sobre a formatação de tabelas\footnote{Em geral, boa parte do trabalho necessário para a construção de uma tabela descritiva pode ser feito com as funções dos pacotes \texttt{\{dplyr\}} e \texttt{\{tidyr\}}, vistas no capítulo anterior.}.

Mas, antes de mais nada, o que é um gráfico estatístico?

\hypertarget{o-pacote-ggplot2}{%
\section{O pacote ggplot2}\label{o-pacote-ggplot2}}

A construção de gráficos no R foi revolucionada com a criação do pacote \texttt{ggplot2}, fruto da tese de doutorado do \href{https://github.com/hadley}{Hadley Wickham}. Essa revolução teve base na filosofia que Hadley adotou para responder a pergunta ``O que é um gráfico estatístico?''.

Em 2005, o estatístico norte-americano Leland Wilkinson publicou o livro \href{http://www.springer.com/statistics/computational+statistics/book/978-0-387-24544-7}{\emph{The Grammar of graphics}} (\emph{A gramática dos gráficos}, em português), uma fonte de princípios fundamentais para a construção de gráficos estatísticos. No livro, ele defende que um gráfico é o mapeamento dos dados em atributos estéticos (posição, cor, forma, tamanho) de formas geométricas (pontos, linhas, barras, caixas).

A partir dessa definição, Hadley escreveu \href{http://vita.had.co.nz/papers/layered-grammar.html}{A Layered Grammar of Graphics} (\emph{Uma gramática em camada dos gráficos}), acrescentando que os elementos de um gráfico (dados, sistema de coordenadas, rótulos, anotações, entre outros) são as suas camadas e que a construção de um gráfico se dá pela sobreposição dessas camadas.

Essa é a essência do \texttt{ggplot2}: construir um gráfico camada por camada.

Além de uma filosofia bem fundamentada, o \texttt{ggplot2} ainda traz outras vantagens em relação aos gráficos do R base:

\begin{itemize}
\tightlist
\item
  gráficos naturalmente mais bonitos;
\item
  fácil personalização (mais simples deixar o gráfico do jeito que você quer);
\item
  a estrutura padronizada das funções deixa o aprendizado muito mais intuitivo;
\item
  a diferença no código entre tipos diferentes de gráficos é muito pequena.
\end{itemize}

Para discutir os principais aspectos da construção de gráficos com o \texttt{ggplot2}, vamos continuar utilizando a base de filmes do IMDB. Você pode baixá-la \href{https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds}{clicando aqui}.

Na próxima seção, vamos conhecer as principais funções do \texttt{ggplot2} e começar a construir nossos primeiros gráficos. Não se esqueça de instalar e carregar o pacote antes de rodar os exemplos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"ggplot2"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\hypertarget{gruxe1ficos-de-pontos-dispersuxe3o}{%
\subsection{Gráficos de pontos (dispersão)}\label{gruxe1ficos-de-pontos-dispersuxe3o}}

No \texttt{ggplot2}, os gráficos são construídos camada por camada, sendo a primeira delas dada pela função \texttt{ggplot()} (repare que não tem o ``2''). Essa função recebe um \emph{data frame} e cria a camada base do gráfico, o nosso \emph{canvas}, onde acrescentaremos todos os outros elementos (camadas).

Se rodarmos apenas a função \texttt{ggplot()}, obteremos um painel em branco.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"assets/data/imdb.rds"}\NormalTok{)}
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ imdb)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-4-1} \end{center}

Apesar de termos passado os dados para a função, precisamos especificar como as observações serão mapeadas nos aspectos visuais do gráfico e quais formas geométricas serão utilizadas para isso.

O código abaixo constrói um gráfico de dispersão entre as variáveis orçamento e receita.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(imdb) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-5-1} \end{center}

Observe que:

\begin{itemize}
\tightlist
\item
  a primeira camada é dada pela função \texttt{ggplot()} e recebe a nossa base \texttt{imdb};
\item
  a segunda camada é dada pela função \texttt{geom\_point()}, especificando a forma \textbf{geom}étrica utilizada no mapeamento das observações (pontos);
\item
  as camadas são unidas com um \texttt{+};
\item
  o mapeamento na função \texttt{geom\_point()} recebe a função \texttt{aes()}, responsável por descrever como as variáveis serão mapeadas nos aspectos visuais dos pontos (a forma geométrica escolhida);
\item
  neste caso, os aspectos visuais mapeados são a posição do ponto no eixo x e a posição do ponto no eixo y;
\item
  o \texttt{Warning} nos avisa sobre a exclusão das observações que possuem \texttt{NA} na variável receita e/ou orçamento;
\item
  todas essas funções são do pacote \texttt{\{ggplot2\}}.
\end{itemize}

A combinação da função \texttt{ggplot()} e de uma ou mais funções \texttt{geom\_()} definirá o tipo de gráfico gerado.

O primeiro argumento de qualquer função \texttt{geom} é o \texttt{mapping}. Esse argumento serve para mapear os dados nos atributos estéticos da forma geométrica escolhida. Ele sempre receberá a função \texttt{aes()}, cujos argumentos vão sempre depender da forma geométrica que estamos utilizando. No caso de um gráfico de dispersão, precisamos definir a posição dos pontos nos eixos x e y. No exemplo, a posição do ponto no eixo x foi dada pela coluna \texttt{orcamento} e a posição do ponto no eixo y pela coluna \texttt{receita}.

\begin{quote}
\textbf{Atenção!} As camadas dos gráficos são empilhadas utilizando-se o sinal \texttt{+}. Como a estrutura é muito parecida com a do \emph{pipe}, é comum trocarmos o \texttt{+} por um \texttt{\%\textgreater{}\%} no meio do código, resultando em erro.
\end{quote}

Podemos acrescentar uma terceira camada ao gráfico, desenhando a reta \texttt{y\ =\ x} para visualizarmos os filmes não se pagaram.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(imdb) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-6-1} \end{center}

Os pontos abaixo da reta representam os filmes com orçamento maior que a receita, isto é, aqueles que deram prejuízo.

A reta x = y foi acrescentada ao gráfico pela função \texttt{geom\_abline()}. Esse \texttt{geom} pode ser utilizado para desenhar qualquer reta do tipo \texttt{y\ =\ a\ +\ b\ *\ x}, sendo \texttt{a} o intercepto (\emph{intercept}) da reta e \texttt{b} o seu coeficiente angular (\emph{slope}).

Neste caso, como não estamos mapeando colunas da base a essa reta (isto é, essa reta não depende dos dados), não precisamos utilizar o argumento \texttt{mapping} da função \texttt{geom\_abline()}, tampouco a função \texttt{aes()}.

Para ver como um ggplot realmente é construído por camadas, veja o que acontece quando colocamos a camada da reta antes da camada dos pontos:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(imdb) }\SpecialCharTok{+}
  \FunctionTok{geom\_abline}\NormalTok{(}\AttributeTok{intercept =} \DecValTok{0}\NormalTok{, }\AttributeTok{slope =} \DecValTok{1}\NormalTok{, }\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-7-1} \end{center}

Além da posição nos eixos x e y, podemos mapear a cor dos pontos a uma variável.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr, }\AttributeTok{warn.conflicts =} \ConstantTok{FALSE}\NormalTok{)}

\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita, }\AttributeTok{color =}\NormalTok{ lucro))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-8-1} \end{center}

O gráfico acima tem a cor dos pontos definida pelo valor da variável lucro. Como a coluna \texttt{lucro} é numérica, um degradê é criado para a cor dos pontos. O azul é a cor padrão nesses casos (veremos mais adiante como escolher a cor).

Veja que criamos a coluna \texttt{lucro} utilizando a função \texttt{mutate()} antes de iniciarmos a construção do gráfico. O fluxo \texttt{base\ \%\textgreater{}\%\ manipulação\ \%\textgreater{}\%\ ggplot} é muito comum no dia-a-dia.

\begin{quote}
\textbf{Lembre-se}: por trás de um grande gráfico sempre existe uma grande tabela.
\end{quote}

Poderíamos também classificar os filmes entre aqueles que lucraram ou não. Neste caso, como a coluna \texttt{lucrou} é textual, uma cor é atribuída a cada categoria.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
   \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento,}
    \AttributeTok{lucro =} \FunctionTok{ifelse}\NormalTok{(lucro }\SpecialCharTok{\textless{}=} \DecValTok{0}\NormalTok{, }\StringTok{"Não"}\NormalTok{, }\StringTok{"Sim"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(lucro)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita, }\AttributeTok{color =}\NormalTok{ lucro))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-9-1} \end{center}

Um erro comum na hora de definir atributos estéticos de um gráfico é definir valores para atributos estéticos dentro da função \texttt{aes()}. Repare o que acontece quando tentamos definir diretamente a cor dos pontos dentro dessa função.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(imdb) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita, }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-10-1} \end{center}

Estranho, não? O que aconteceu foi o seguinte: a função \texttt{aes()} espera uma coluna para ser mapeada a cada atributo, então o valor \texttt{blue} é tratado como uma nova variável/coluna que tem essa string para todas as observações. Assim, todos pontos têm a mesma cor (vermelha, padrão do ggplot) pois pertencem todos à essa ``categoria \emph{blue}''.

No caso, o que gostaríamos é de ter pintado todos os pontos de azul. A forma certa de fazer isso é colocando o atributo \texttt{color=} fora da função \texttt{aes()}:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(imdb) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita), }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-11-1} \end{center}

\hypertarget{gruxe1ficos-de-linhas}{%
\subsection{Gráficos de linhas}\label{gruxe1ficos-de-linhas}}

Utilizamos o \texttt{geom\_line} para fazer gráficos de linhas. Assim como nos gráficos de pontos, precisamos definir as posições \texttt{x} e \texttt{y}. O gráfico abaixo representa a evolução da nota média dos filmes ao longo dos anos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row(s) containing missing values (geom_path).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-12-1} \end{center}

Gráficos de linha são muito utilizados para representar \textbf{séries temporais}, isto é, observações medidas repetidamente em intervalos equidistantes\footnote{Em geral consideramos intervalos equidistantes, mas também existem séries definidas em intervalos não equidistantes de tempo.} de tempo. O gráfico anterior apresenta a série da nota IMDB média ao longo dos anos.

Podemos colocar pontos e retas no mesmo gráfico. Basta acrescentar os dois \texttt{geoms}. O gráfico abaixo mostra a nota média anual dos filmes do Robert De Niro.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ator\_1 }\SpecialCharTok{==} \StringTok{"Robert De Niro"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-13-1} \end{center}

Quando precisamos usar o mesmo \texttt{aes()} em vários \texttt{geoms}, podemos defini-lo dentro da função \texttt{ggplot()}. Esse \texttt{aes()} será então distribuído para todo \texttt{geom} do gráfico. O código anterior pode ser reescrito da seguinte forma.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ator\_1 }\SpecialCharTok{==} \StringTok{"Robert De Niro"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-14-1} \end{center}

Se algum \texttt{geom} necessitar de um atributo que os outros não precisam, esse atributo pode ser especificado normalmente dentro dele. Abaixo, utilizamos o \texttt{geom\_label} para colocar as notas médias no gráfico. Além do \texttt{x} e \texttt{y}, o \texttt{geom\_label} também precisa do texto que será escrito no gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ator\_1 }\SpecialCharTok{==} \StringTok{"Robert De Niro"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{round}\NormalTok{(nota\_media, }\DecValTok{1}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{label =}\NormalTok{ nota\_media))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-15-1} \end{center}

\hypertarget{gruxe1ficos-de-barras}{%
\subsection{Gráficos de barras}\label{gruxe1ficos-de-barras}}

Para construir gráficos de barras, utilizamos o \texttt{geom\_col}. A seguir, construímos um gráfico de barras do número de filmes dos 10 diretores que mais aparecem na nossa base do IMDB.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{10}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ n))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-16-1} \end{center}

Gráficos de barras também precisam dos atributos \texttt{x} e \texttt{y}, sendo que o atributo \texttt{y} representará a altura de cada barra.

No gráfico anterior, vemos que o \texttt{NA} é considerado uma ``categoria'' de diretor e entra no gráfico. Podemos retirar os \texttt{NAs} dessa coluna previamente utilizando a função \texttt{filter()}.

A seguir, além de retirar os \texttt{NAs}, atribuímos a coluna \texttt{diretor} à cor das colunas. Repare que, nesse caso, não utilizamos o atributo \texttt{color} e sim \texttt{fill}. A regra é a seguinte: o atributo \texttt{color} colore objetos sem área (pontos, linhas, contornos), o atributo \texttt{fill} preenche objetos com cor (barras, áreas, polígonos em geral).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{10}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ diretor),}
    \AttributeTok{show.legend =} \ConstantTok{FALSE}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-17-1} \end{center}

Para consertar as labels do eixo \texttt{x}, a melhor prática é invertermos os eixos do gráfico, construindo barras horizontais.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{10}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ diretor, }\AttributeTok{x =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ diretor),}
    \AttributeTok{show.legend =} \ConstantTok{FALSE}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-18-1} \end{center}

Para ordenar as colunas, precisamos mudar a ordem dos níveis do \emph{fator} \texttt{diretor}. Para isso, utilizamos a função \texttt{fct\_reorder()} do pacote \texttt{forcats}. A nova ordem será estabelecida pela coluna \texttt{n} (quantidade de filmes).

Fatores dentro do R são números inteiros (1, 2, 3, \ldots) que possuem uma representação textual (Ver Seção \ref{forcats}). Variáveis categóricas são transformadas em fatores pelo ggplot pois todo eixo cartesiano é numérico. Assim, os textos de uma variável categórica são, internamente, números inteiros.

Por padrão, os inteiros são atribuídos a cada categoria de uma variável pela ordem alfabética (repare na ordem dos diretores nos gráficos anteriores). Assim, se transformássemos o vetor \texttt{c("banana",\ "uva",\ "melancia")} em um fator, a atribuição de inteiros seria: ``banana'' vira 1, ``melancia'' vira 2 e ``uva'' vira 3. Embora sejam inteiros internamente, sempre que chamássemos esse novo vetor, ainda sim veríamos os textos ``banana'', ``uva'' e ``melancia''.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{10}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{diretor =}\NormalTok{ forcats}\SpecialCharTok{::}\FunctionTok{fct\_reorder}\NormalTok{(diretor, n)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ diretor, }\AttributeTok{x =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ diretor),}
    \AttributeTok{show.legend =} \ConstantTok{FALSE}
\NormalTok{  ) }
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-19-1} \end{center}

Por fim, podemos colocar uma label com o número de filmes de cada diretor dentro de cada barra.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{10}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{diretor =}\NormalTok{ forcats}\SpecialCharTok{::}\FunctionTok{fct\_reorder}\NormalTok{(diretor, n)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ diretor), }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{geom\_label}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ n}\SpecialCharTok{/}\DecValTok{2}\NormalTok{, }\AttributeTok{label =}\NormalTok{ n)) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-20-1} \end{center}

\hypertarget{histogramas-e-boxplots}{%
\subsection{Histogramas e boxplots}\label{histogramas-e-boxplots}}

Para construir histogramas, usamos o \texttt{geom\_histogram}. Esse \texttt{geom} só precisa do atributo \texttt{x} (o eixo y é construído automaticamente). Histogramas são úteis para avaliarmos a distribuição de uma variável.

A seguir, construímos o histograma do lucro dos filmes do diretor Steven Spielberg.
O primeiro \emph{warning} nos diz que o eixo x foi dividido em 30 intervalos para a construção do histograma.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{==} \StringTok{"Steven Spielberg"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lucro))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `stat_bin()` using `bins = 30`. Pick better value with `binwidth`.
\end{verbatim}

\begin{verbatim}
## Warning: Removed 1 rows containing non-finite values (stat_bin).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-21-1} \end{center}

Para definir o tamanho de cada intervalo, podemos utilizar o argumento \texttt{bindwidth}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{==} \StringTok{"Steven Spielberg"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lucro), }
    \AttributeTok{binwidth =} \DecValTok{100000000}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"white"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 rows containing non-finite values (stat_bin).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-22-1} \end{center}

Boxplots também são úteis para estudarmos a distribuição de uma variável, principalmente quando queremos comparar várias distribuições.

Para construir um boxplot no ggplot, utilizamos a função \texttt{geom\_boxplot}. Ele precisa dos atributos \texttt{x} e \texttt{y}, sendo que ao atributo \texttt{x} devemos mapear uma variável categórica.

A seguir, construímos boxplots do lucro dos filmes dos diretores que fizeram mais de 15 filmes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{n}\NormalTok{() }\SpecialCharTok{\textgreater{}=} \DecValTok{15}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ lucro))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 10 rows containing non-finite values (stat_boxplot).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-23-1} \end{center}

Também podemos reordenar a ordem dos boxplots utilizando a função \texttt{forcats::fct\_reorder}. Neste caso, os diretores são ordenados pela mediana do lucro\footnote{A mediana é usada por padrão pela função \texttt{fct\_reorder()}. É possível trocar a função utilizada por meio do argumento \texttt{.fun}.}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{n}\NormalTok{() }\SpecialCharTok{\textgreater{}=} \DecValTok{15}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento,}
    \AttributeTok{diretor =}\NormalTok{ forcats}\SpecialCharTok{::}\FunctionTok{fct\_reorder}\NormalTok{(diretor, lucro, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ lucro))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 10 rows containing non-finite values (stat_boxplot).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-24-1} \end{center}

\hypertarget{tuxedtulos-e-labels}{%
\subsection{\texorpdfstring{Títulos e \emph{labels}}{Títulos e labels}}\label{tuxedtulos-e-labels}}

Os títulos e \emph{labels} do gráfico também são considerados camadas e são criados ou modificados pela função \texttt{labs()}. O exemplo a seguir coloca um título e um subtítulo no gráfico, além de modificar os \emph{labels} do eixo x e y e da legenda.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita, }\AttributeTok{color =}\NormalTok{ lucro)) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}
    \AttributeTok{x =} \StringTok{"Orçamento ($)"}\NormalTok{,}
    \AttributeTok{y =} \StringTok{"Receita ($)"}\NormalTok{,}
    \AttributeTok{color =} \StringTok{"Lucro ($)"}\NormalTok{,}
    \AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{,}
    \AttributeTok{subtitle =} \StringTok{"Receita vs Orçamento"}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-25-1} \end{center}

\hypertarget{escalas}{%
\subsection{Escalas}\label{escalas}}

O pacote \texttt{\{ggplot2\}} possui uma família de funções \texttt{scale\_} para modificarmos propriedades referentes às escalas do gráfico. Como podemos ter escalas de números, categorias, cores, datas, entre outras, temos uma função específica para cada tipo de escala.

Considere o gráfico a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row(s) containing missing values (geom_path).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-26-1} \end{center}

Vamos redefinir as quebras dos eixos \texttt{x} e \texttt{y}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1916}\NormalTok{, }\DecValTok{2016}\NormalTok{, }\DecValTok{10}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row(s) containing missing values (geom_path).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-27-1} \end{center}

Como as escalas dos eixos x e y são numéricas, utilizamos nesse caso as funções \texttt{scale\_x\_continuous()} e \texttt{scale\_y\_continuous()}. Veja que, mesmo definindo as quebras entre 0 e 10, o limite do eixo y não é alterado. Para alterá-lo, usamos a função \texttt{coord\_cartesian()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{scale\_x\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{1916}\NormalTok{, }\DecValTok{2016}\NormalTok{, }\DecValTok{10}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{scale\_y\_continuous}\NormalTok{(}\AttributeTok{breaks =} \FunctionTok{seq}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{+}
  \FunctionTok{coord\_cartesian}\NormalTok{(}\AttributeTok{ylim =} \FunctionTok{c}\NormalTok{(}\DecValTok{0}\NormalTok{, }\DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row(s) containing missing values (geom_path).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-28-1} \end{center}

Para mudarmos as escalas de cores, usamos as funções do tipo: \texttt{scale\_color\_} e \texttt{scale\_fill\_}.

Para escolher manualmente as cores de um gráfico, utilize as funções
\texttt{scale\_color\_manual()} e \texttt{scale\_fill\_manual()}. A seguir substituímos as cores padrão do gráfico por um outro conjunto de cores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{5}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ diretor),}
    \AttributeTok{show.legend =} \ConstantTok{FALSE}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}\AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"red"}\NormalTok{, }\StringTok{"blue"}\NormalTok{, }\StringTok{"green"}\NormalTok{, }\StringTok{"pink"}\NormalTok{, }\StringTok{"purple"}\NormalTok{, }\StringTok{"black"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-29-1} \end{center}

Também podemos usar códigos hexadecimais.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{5}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ diretor, }\AttributeTok{y =}\NormalTok{ n, }\AttributeTok{fill =}\NormalTok{ diretor),}
    \AttributeTok{show.legend =} \ConstantTok{FALSE}
\NormalTok{  ) }\SpecialCharTok{+}
  \FunctionTok{coord\_flip}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{scale\_fill\_manual}\NormalTok{(}
    \AttributeTok{values =} \FunctionTok{c}\NormalTok{(}\StringTok{"\#ff4500"}\NormalTok{, }\StringTok{"\#268b07"}\NormalTok{, }\StringTok{"\#ff7400"}\NormalTok{, }\StringTok{"\#0befff"}\NormalTok{, }\StringTok{"\#a4bdba"}\NormalTok{, }\StringTok{"\#b1f91a"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-30-1} \end{center}

Para trocar as cores de um gradiente, utilize as funções \texttt{scale\_color\_gradient()} e \texttt{scale\_fill\_gradient()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita, }\AttributeTok{color =}\NormalTok{ lucro)) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_gradient}\NormalTok{(}\AttributeTok{low =} \StringTok{"red"}\NormalTok{, }\AttributeTok{high =} \StringTok{"green"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-31-1} \end{center}

Para trocar o nome das categorias de uma legenda de cores, utilize as funções \texttt{scale\_color\_discrete()} e \texttt{scale\_fill\_discrete()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(cor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano, cor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{num\_filmes =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ num\_filmes, }\AttributeTok{color =}\NormalTok{ cor)) }\SpecialCharTok{+}
  \FunctionTok{scale\_color\_discrete}\NormalTok{(}\AttributeTok{labels =} \FunctionTok{c}\NormalTok{(}\StringTok{"Preto e branco"}\NormalTok{, }\StringTok{"Colorido"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'ano'. You can override using the `.groups` argument.
\end{verbatim}

\begin{verbatim}
## Warning: Removed 2 row(s) containing missing values (geom_path).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-32-1} \end{center}

\hypertarget{temas}{%
\subsection{Temas}\label{temas}}

Os gráficos que vimos até agora usam o tema padrão do ggplot2. Existem outros temas prontos para utilizarmos presentes na família de funções \texttt{theme\_}.

\hypertarget{theme_minimal}{%
\paragraph*{theme\_minimal()}\label{theme_minimal}}
\addcontentsline{toc}{paragraph}{theme\_minimal()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
  \FunctionTok{theme\_minimal}\NormalTok{() }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-33-1} \end{center}

\hypertarget{theme_bw}{%
\paragraph*{theme\_bw()}\label{theme_bw}}
\addcontentsline{toc}{paragraph}{theme\_bw()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
  \FunctionTok{theme\_bw}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-34-1} \end{center}

\hypertarget{theme_classic}{%
\paragraph*{theme\_classic()}\label{theme_classic}}
\addcontentsline{toc}{paragraph}{theme\_classic()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
  \FunctionTok{theme\_classic}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-35-1} \end{center}

\hypertarget{theme_dark}{%
\paragraph*{theme\_dark()}\label{theme_dark}}
\addcontentsline{toc}{paragraph}{theme\_dark()}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
  \FunctionTok{theme\_dark}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-36-1} \end{center}

Você também pode criar o seu próprio tema utilizando a função \texttt{theme()}. Nesse caso, para trocar os elementos estéticos do gráfico precisamos usar as funções \texttt{element\_text()} para textos, \texttt{element\_line()} para linhas, \texttt{element\_rect()} para áreas e \texttt{element\_blank()} para remover elementos.

No exemplo a seguir, fizemos as seguintes modificações no tema padrão:

\begin{itemize}
\tightlist
\item
  Alinhamos o título no centro do gráfico.
\item
  Alinhamos o subtítulo no centro do gráfico.
\item
  Pintamos o título dos eixos de roxo.
\item
  Preenchemos o fundo do gráfico de preto.
\item
  Removemos o grid do gráfico.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita), }\AttributeTok{color =} \StringTok{"white"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{labs}\NormalTok{(}\AttributeTok{title =} \StringTok{"Gráfico de dispersão"}\NormalTok{, }\AttributeTok{subtitle =} \StringTok{"Receita vs Orçamento"}\NormalTok{) }\SpecialCharTok{+}
  \FunctionTok{theme}\NormalTok{(}
    \AttributeTok{plot.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{plot.subtitle =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{hjust =} \FloatTok{0.5}\NormalTok{),}
    \AttributeTok{axis.title =} \FunctionTok{element\_text}\NormalTok{(}\AttributeTok{color =} \StringTok{"purple"}\NormalTok{),}
    \AttributeTok{panel.background =} \FunctionTok{element\_rect}\NormalTok{(}\AttributeTok{fill =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{panel.grid =} \FunctionTok{element\_blank}\NormalTok{()}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-37-1} \end{center}

\hypertarget{juntando-gruxe1ficos}{%
\subsection{Juntando gráficos}\label{juntando-gruxe1ficos}}

No ggplot, temos várias formas de juntar gráficos. Vamos apresentar a seguir as principais.

\hypertarget{vuxe1rios-geoms-no-mesmo-gruxe1fico}{%
\subsubsection*{Vários geoms no mesmo gráfico}\label{vuxe1rios-geoms-no-mesmo-gruxe1fico}}
\addcontentsline{toc}{subsubsection}{Vários geoms no mesmo gráfico}

Como vimos anteriormente, podemos acrescentar vários \texttt{geoms} em um mesmo gráfico, apenas adicionando novas camadas. No código a seguir, construímos o gráfico de dispersão da receita pelo orçamento dos filmes, acrescentando também uma reta de tendência linear aos pontos.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(imdb, }\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_smooth}\NormalTok{(}\AttributeTok{se =} \ConstantTok{FALSE}\NormalTok{, }\AttributeTok{method =} \StringTok{"lm"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `geom_smooth()` using formula 'y ~ x'
\end{verbatim}

\begin{verbatim}
## Warning: Removed 733 rows containing non-finite values (stat_smooth).
\end{verbatim}

\begin{verbatim}
## Warning: Removed 733 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-38-1} \end{center}

\hypertarget{replicando-um-gruxe1fico-para-cada-categoria-de-uma-variuxe1vel}{%
\subsubsection*{Replicando um gráfico para cada categoria de uma variável}\label{replicando-um-gruxe1fico-para-cada-categoria-de-uma-variuxe1vel}}
\addcontentsline{toc}{subsubsection}{Replicando um gráfico para cada categoria de uma variável}

Uma funcionalidade muito útil do \texttt{ggplot2} é a possibilidade de usar \texttt{facets} para replicar um gráfico para cada categoria de uma variável.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(classificacao }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Livre"}\NormalTok{, }\StringTok{"A partir de 13 anos"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ nota\_imdb)) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{classificacao, }\AttributeTok{nrow =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 85 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-39-1} \end{center}

Repare que usamos uma fórmula para dizer à função qual variável vamos utilizar para quebrar o gráfico. Podemos especificar se queremos os gráficos lado a lado ou um embaixo do outro pelos argumentos \texttt{nrow=} e \texttt{ncol=}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(classificacao }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"Livre"}\NormalTok{, }\StringTok{"A partir de 13 anos"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ nota\_imdb)) }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\SpecialCharTok{\textasciitilde{}}\NormalTok{classificacao, }\AttributeTok{ncol =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 85 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-40-1} \end{center}

\hypertarget{juntando-gruxe1ficos-diferentes}{%
\subsubsection*{Juntando gráficos diferentes}\label{juntando-gruxe1ficos-diferentes}}
\addcontentsline{toc}{subsubsection}{Juntando gráficos diferentes}

Diversos outros pacotes trazem ferramentas super úteis para trabalharmos com o \texttt{ggplot2}. Um deles é o pacote \texttt{\{patchwork\}}. Após carregá-lo, podemos juntar dois gráficos em uma mesma figura com um simples \texttt{+}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Instale antes de carregar}
\CommentTok{\# install.packages("patchwork")}

\FunctionTok{library}\NormalTok{(patchwork)}

\NormalTok{p1 }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{==} \StringTok{"Steven Spielberg"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media))}

\NormalTok{p2 }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{==} \StringTok{"Steven Spielberg"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_histogram}\NormalTok{(}
    \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ lucro),}
    \AttributeTok{fill =} \StringTok{"lightblue"}\NormalTok{, }
    \AttributeTok{color =} \StringTok{"darkblue"}\NormalTok{, }
    \AttributeTok{binwidth =} \DecValTok{100000000}
\NormalTok{  )}

\NormalTok{p1 }\SpecialCharTok{+}\NormalTok{ p2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 rows containing non-finite values (stat_bin).
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-41-1} \end{center}

\hypertarget{exercuxedcios-22}{%
\subsection{Exercícios}\label{exercuxedcios-22}}

\textbf{1.} O que acontece quando rodamos o código \texttt{ggplot(data\ =\ mtcars)}?

\textbf{2.} O que tem de errado no código abaixo? Por que os pontos não ficaram azuis?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mpg) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ displ, }\AttributeTok{y =}\NormalTok{ hwy, }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-42-1} \end{center}

\textbf{3.} Mapeie uma variável contínua para a cor, o tamanho e a forma de um gráfico de pontos. Como esses atributos estéticos se comportam diferente para variáveis categóricas vs contínuas?

\textbf{4.} Utilizando o \texttt{mtcars}, faça um gráfico de dispersão de \texttt{mpg} por \texttt{qsec}.

\textbf{5.} Utilizando o \texttt{mtcars}, o que acontece se você fizer um gráfico de dispersão de \texttt{vs} por \texttt{mpg}? Por que o gráfico não é útil?

Para resolver os exercícios a seguir, utilize a base \texttt{imdb}.

\textbf{6.} Crie um gráfico de dispersão da nota do imdb pelo orçamento.

\textbf{7.} Faça um gráfico de linhas do orçamento médio dos filmes ao longo dos anos.

\textbf{8.} Transforme o gráfico do exercício anterior em um gráfico de barras.

\textbf{9.} Descubra quais são os 5 atores que mais aparecem na coluna ator\_1 e faça um boxplot do lucro dos filmes desses atores.

\textbf{10.} Com base no código abaixo, resolva os itens a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diretores }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"Steven Spielberg"}\NormalTok{, }
  \StringTok{"Quentin Tarantino"}\NormalTok{, }
  \StringTok{"Christopher Nolan"}\NormalTok{,}
  \StringTok{"Martin Scorsese"}
\NormalTok{)}

\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{\%in\%}\NormalTok{ diretores) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano, diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\FunctionTok{vars}\NormalTok{(diretor))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'ano'. You can override using the `.groups` argument.
\end{verbatim}

\begin{center}\includegraphics{08-graficos_files/figure-latex/unnamed-chunk-43-1} \end{center}

\begin{itemize}
\item
  \textbf{a.} Analisando o gráfico gerado, descreva o que a função \texttt{facet\_wrap()} faz.
\item
  \textbf{.b} Utilize os argumentos nrow e \texttt{ncol} da função \texttt{facet\_wrap()} para colocar os quatro gráficos em uma única coluna.
\end{itemize}

\textbf{11.} Resovla os itens a seguir para fazer um gráfico de barras da frequência de filmes com nota maior que 8 ao longo dos anos.

\begin{itemize}
\item
  \textbf{a.} Crie uma nova coluna na base IMDB indicando se a nota de um filme é maior que 8 ou não.
\item
  \textbf{b.} b. Utilizando a coluna criada em (a) crie uma tabela com o número anual de filmes com nota maior 8.
\item
  \textbf{c.} Utilize a tabela criada em (b) para fazer um gráfico de barras do número de filmes com nota maior que 8 ao longo dos anos.
\end{itemize}

\hypertarget{extensuxf5es-do-pacote-ggplot2}{%
\section{Extensões do pacote ggplot2}\label{extensuxf5es-do-pacote-ggplot2}}

O site \href{https://exts.ggplot2.tidyverse.org/}{ggplot2 extensions} tem uma galeria com diversos pacotes que deixam o ggplot2 bem mais poderoso, indo de novos geoms até animações.

A seguir, listamos algumas das mais famosas.

\hypertarget{gghighlight}{%
\subsection{gghighlight}\label{gghighlight}}

O \href{https://yutannihilation.github.io/gghighlight/}{\texttt{gghighlight}} é uma extensões do \texttt{\{ggplot2\}} que serve para realçar partes de um gráfico feito com \texttt{ggplot}.

A seguir, mostramos como utilizar essa extensão pare realçar gráficos de pontos e linhas.

\hypertarget{realuxe7ando-pontos}{%
\subsubsection*{Realçando pontos}\label{realuxe7ando-pontos}}
\addcontentsline{toc}{subsubsection}{Realçando pontos}

Muitas vezes temos um gráfico de dispersão em que queremos realçar alguns pontos de acordo com alguma característica. Por exemplo, abaixo estamos realçando os pontos que possuem \texttt{carat\ \textgreater{}\ 4}, além disso colocamos uma label em cada um.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ carat, }\AttributeTok{y =}\NormalTok{ price)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  gghighlight}\SpecialCharTok{::}\FunctionTok{gghighlight}\NormalTok{(carat }\SpecialCharTok{\textgreater{}} \DecValTok{4}\NormalTok{, }\AttributeTok{label\_key =}\NormalTok{ carat)}
\end{Highlighting}
\end{Shaded}

\includegraphics{082-extensoes-ggplot2_files/figure-latex/unnamed-chunk-2-1.pdf}

Também é possível configurar a cor dos pontos que serão realçados e dos que não serão, bem como o estilo das labels.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diamonds }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ carat, }\AttributeTok{y =}\NormalTok{ price)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{color =} \StringTok{"red"}\NormalTok{) }\SpecialCharTok{+}
\NormalTok{  gghighlight}\SpecialCharTok{::}\FunctionTok{gghighlight}\NormalTok{(}
\NormalTok{    carat }\SpecialCharTok{\textgreater{}} \DecValTok{4}\NormalTok{, }
    \AttributeTok{label\_key =}\NormalTok{ carat,}
    \AttributeTok{unhighlighted\_params =} \FunctionTok{list}\NormalTok{(}\AttributeTok{colour =} \StringTok{"black"}\NormalTok{),}
    \AttributeTok{label\_params =} \FunctionTok{list}\NormalTok{(}\AttributeTok{size =} \DecValTok{10}\NormalTok{, }\AttributeTok{fill =} \StringTok{"grey"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\includegraphics{082-extensoes-ggplot2_files/figure-latex/unnamed-chunk-3-1.pdf}

\hypertarget{realuxe7ando-linhas}{%
\subsubsection*{Realçando linhas}\label{realuxe7ando-linhas}}
\addcontentsline{toc}{subsubsection}{Realçando linhas}

Com o \texttt{\{gghighlight\}} também é possível realçar linhas em um gráfico que possui varias linhas. Isso é interessante quando você quer ver como uma série temporal se compara com relação à um conjunto de outras séries.

No gráfico a seguir mostramos o número de downloads de cada um dos pacotes do tidyverse no ano de 2019. Uma das séries se destaca por mudar de padrão no meio do ano. Usamos o \texttt{\{gghighlight\}} para destacá-la no gráfico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab }\OtherTok{\textless{}{-}}\NormalTok{ cranlogs}\SpecialCharTok{::}\FunctionTok{cran\_downloads}\NormalTok{(}
  \AttributeTok{packages =}\NormalTok{ tidyverse}\SpecialCharTok{::}\FunctionTok{tidyverse\_deps}\NormalTok{()}\SpecialCharTok{$}\NormalTok{package,}
  \AttributeTok{from =} \StringTok{"2019{-}01{-}01"}\NormalTok{, }\AttributeTok{to =} \StringTok{"2019{-}12{-}31"}
\NormalTok{)}

\NormalTok{tab }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ date, }\AttributeTok{y =}\NormalTok{ count, }\AttributeTok{group =}\NormalTok{ package)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
\NormalTok{  gghighlight}\SpecialCharTok{::}\FunctionTok{gghighlight}\NormalTok{(}\FunctionTok{max}\NormalTok{(count) }\SpecialCharTok{\textgreater{}} \DecValTok{100000}\NormalTok{, }\AttributeTok{label\_key =}\NormalTok{ package)}
\end{Highlighting}
\end{Shaded}

\includegraphics{082-extensoes-ggplot2_files/figure-latex/unnamed-chunk-4-1.pdf}

Para mais informações sobre o \texttt{\{gghighlight\}}, recomendamos a leitura da \href{https://yutannihilation.github.io/gghighlight/index.html}{excelente documentação oficial}.

\hypertarget{ggridges}{%
\subsection{ggridges}\label{ggridges}}

A extensão \texttt{\{ggridges\}} é uma ótima alternativa para histogramas e boxplots, quando queremos comparar a distribuição de uma variável A em vários níveis de uma variável B.

Primeiro, instale o pacote.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"ggridges"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

No gráfico abaixo, comparamos a distribuição da receita dos filmes em cada um dos anos de 2005 a 2016. Para isso, utilizamos o novo \texttt{geom\_density\_ridges()}, disponibilizado pelo pacote \texttt{\{ggridges\}}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(ggridges)}
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{\textgreater{}} \DecValTok{2005}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{ano =} \FunctionTok{as.factor}\NormalTok{(ano)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ ano, }\AttributeTok{x =}\NormalTok{ receita, }\AttributeTok{fill =}\NormalTok{ ano)) }\SpecialCharTok{+}
  \FunctionTok{geom\_density\_ridges}\NormalTok{(}\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{, }\AttributeTok{show.legend =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Picking joint bandwidth of 17300000
\end{verbatim}

\includegraphics{082-extensoes-ggplot2_files/figure-latex/unnamed-chunk-6-1.pdf}

Você pode baixar a base IMDB utilizada \href{https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds}{clicando aqui}.

\hypertarget{relatorios}{%
\chapter{Relatórios}\label{relatorios}}

Depois de fazer toda a nossa análise dentro do R, não é justamente na hora de mostrá-la ao mundo que vamos abandonar as vantagens de estarmos dentro de uma linguagem de programação.

Com a ajuda do R Markdown, uma interface de anotações que combina texto livre com códigos em R, podemos construir relatórios não só reprodutíveis, mas elegantemente bem formatados, sem sair do R!

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{assets/img/relatorios/rmarkdown_wizards} 

}

\caption{Ilustração por <a href='https://github.com/allisonhorst/stats-illustrations'>Allison Horst</a>.}\label{fig:unnamed-chunk-1}
\end{figure}

Além do próprio \texttt{\{rmarkdown\}}, existem diversos pacotes que podem ser utilizados para ampliar os produtos que elaboramos com R Markdown. Podemos criar/escrever:

\begin{itemize}
\item
  blogs e sites --- \href{https://bookdown.org/yihui/blogdown/}{blogdown} e \href{https://rstudio.github.io/distill/}{distill};
\item
  livros (como este!) --- \href{https://bookdown.org/}{bookdown};
\item
  apresentações --- \href{https://github.com/yihui/xaringan}{xaringan};
\item
  currículos, cartas e trabalhos acadêmicos --- \href{https://github.com/rstudio/pagedown}{pagedown};
\item
  tutoriais interativos --- \href{https://rstudio.github.io/learnr/}{learnr};
\item
  artigos científicos --- \href{https://github.com/rstudio/rticles}{rticles}.
\end{itemize}

Antes de mais nada, vamos instalar os pacotes \texttt{\{rmarkdown\}} e \texttt{\{knitr\}}. O primeiro reune todas as funcionalidades para juntar nossos textos narrativos e códigos de R. O segundo vai fazer a \emph{magia} de transformar nossos simples arquivos de texto em arquivos HTML, PDF e Word (\texttt{.doc}) bonitões.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"rmarkdown"}\NormalTok{, }\StringTok{"knitr"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

Nas seções a seguir, vamos mostrar como começar a utilizar o R Markdown para criar esses documentos. Não se esqueça de conferir (e deixar por perto) as folhas de cola sobre R Markdown:

\begin{itemize}
\item
  \href{https://www.rstudio.com/wp-content/uploads/2015/02/rmarkdown-cheatsheet.pdf}{\texttt{rmarkdown} cheatsheet}
\item
  \href{http://www.rstudio.com/wp-content/uploads/2016/03/rmarkdown-cheatsheet-2.0.pdf}{\texttt{rmarkdown} cheatsheet 2.0}
\end{itemize}

\hypertarget{markdown}{%
\section{Markdown}\label{markdown}}

Se você é uma pessoa que utiliza R, sabe das possibilidades de utilizar R Markdown (e os pacotes que expandem mais ainda as possibilidades) e gostaria de começar a utilizá-lo, é importante conhecer o Markdown. Por quê? O R Markdown tem como base a linguagem de marcação \href{https://www.markdownguide.org/}{Markdown}.

Os arquivos markdown podem ser abertos por qualquer software que suporte este formato aberto. Além disso, independente da plataforma de trabalho, pode-se migrar para um arquivo de texto sem perder a formatação. O Markdown também é usado em outros lugares, como no \href{https://github.com/}{GitHub} e no \href{https://discourse.curso-r.com}{Fórum da Curso-R}.

Uma referência interessante para ter sempre em mãos é a Folha de cola (\emph{Cheatsheet}) do \href{https://github.com/adam-p/markdown-here/wiki/Markdown-Cheatsheet}{Markdown}.

Nas seções seguintes, descreveremos como podemos marcar os nossos textos e códigos usando \texttt{markdown}, e você poderá usar isso tanto em arquivos \texttt{.Rmd}, quanto em outros lugares que também utilizam essa marcação (como no \href{https://discourse.curso-r.com}{Fórum da Curso-R}!).

\hypertarget{uxeanfase}{%
\subsection{Ênfase}\label{uxeanfase}}

\hypertarget{negrito}{%
\subsubsection*{Negrito}\label{negrito}}
\addcontentsline{toc}{subsubsection}{Negrito}

Para destacar um texto em negrito, coloque \texttt{**} ou \texttt{\_\_} ao redor do texto.

Por exemplo:

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{Esse\ é\ um\ texto\ com\ uma\ palavra\ destacada\ em\ **negrito**.} & Esse é um texto com uma palavra destacada em \textbf{negrito}. \\
\texttt{Esse\ é\ um\ texto\ com\ uma\ palavra\ destacada\ em\ \_\_negrito\_\_.} & Esse é um texto com uma palavra destacada em \textbf{negrito}. \\
\bottomrule
\end{longtable}

\hypertarget{ituxe1lico}{%
\subsubsection*{Itálico}\label{ituxe1lico}}
\addcontentsline{toc}{subsubsection}{Itálico}

Para destacar um texto em itálico, coloque \texttt{*} ou \texttt{\_} ao redor do texto.

Por exemplo:

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{Esse\ é\ um\ texto\ com\ uma\ palavra\ destacada\ em\ *itálico*.} & Esse é um texto com uma palavra destacada em \emph{itálico}. \\
\texttt{Esse\ é\ um\ texto\ com\ uma\ palavra\ destacada\ em\ \_itálico\_.} & Esse é um texto com uma palavra destacada em \emph{itálico}. \\
\bottomrule
\end{longtable}

\hypertarget{riscado-ou-tachado}{%
\subsubsection*{Riscado (ou tachado)}\label{riscado-ou-tachado}}
\addcontentsline{toc}{subsubsection}{Riscado (ou tachado)}

Para riscar/tachar um texto, coloque \texttt{\textasciitilde{}\textasciitilde{}} ao redor do texto.

Por exemplo:

Esse é um texto com uma palavra \sout{riscada/tachada}.

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{Esse\ é\ um\ texto\ com\ uma\ palavra\ \textasciitilde{}\textasciitilde{}riscada/tachada\textasciitilde{}\textasciitilde{}.} & Esse é um texto com uma palavra \sout{riscada/tachada}. \\
\bottomrule
\end{longtable}

\hypertarget{tuxedtulos}{%
\subsection{Títulos}\label{tuxedtulos}}

Os títulos funcionam como uma hierarquia, e para criar um título é necessário colocar um \texttt{\#} no início da linha. Então um \texttt{\#} marca um título, \texttt{\#\#} marca um sub-título, e assim sucessivamente. Veja os exemplos:

\begin{longtable}[]{@{}rr@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{\#\ Título\ 1} \texttt{\#\#\ Título\ 2} \texttt{\#\#\#\ Título\ 3} & \\
\includegraphics[width=4.72in]{assets/img/relatorios/titulos} & \\
\bottomrule
\end{longtable}

\hypertarget{listas-1}{%
\subsection{Listas}\label{listas-1}}

\hypertarget{listas-ordenadas}{%
\subsubsection*{Listas ordenadas}\label{listas-ordenadas}}
\addcontentsline{toc}{subsubsection}{Listas ordenadas}

Você pode fazer uma lista ordenada usando somente números. Você pode repetir o número quantas vezes quiser:

Como é escrito no código:

\begin{quote}
\texttt{1.\ Maçã}

\texttt{1.\ Banana}

\texttt{1.\ Uva}
\end{quote}

Como aparece no relatório:

\begin{quote}
\begin{enumerate}
\def\labelenumi{\arabic{enumi}.}
\tightlist
\item
  Maçã
\item
  Banana
\item
  Uva
\end{enumerate}
\end{quote}

\hypertarget{listas-nuxe3o-ordenadas}{%
\subsubsection*{Listas não ordenadas}\label{listas-nuxe3o-ordenadas}}
\addcontentsline{toc}{subsubsection}{Listas não ordenadas}

Você pode fazer uma lista não ordenada escrevendo com hífens ou asteriscos, como a seguir:

\begin{quote}
\texttt{*\ Maçã}

\texttt{*\ Banana}

\texttt{*\ Uva}
\end{quote}

\begin{quote}
\texttt{-\ Maçã}

\texttt{-\ Banana}

\texttt{-\ Uva}
\end{quote}

O resultado será:

\begin{quote}
\begin{itemize}
\tightlist
\item
  Maçã
\item
  Banana
\item
  Uva
\end{itemize}
\end{quote}

Você também pode adicionar sub-itens na lista indicando a hierarquia através da identação no Markdown (dica: utilize a tecla \texttt{tab} do teclado):

\begin{quote}
\begin{itemize}
\tightlist
\item
  Frutas

  \begin{itemize}
  \tightlist
  \item
    Maçã
  \item
    Banana
  \item
    Uva
  \end{itemize}
\end{itemize}
\end{quote}

\hypertarget{equauxe7uxf5es}{%
\subsection{Equações}\label{equauxe7uxf5es}}

Você pode adicionar equações utilizando \href{https://pt.wikipedia.org/wiki/LaTeX}{LaTeX}.
Você pode saber mais na \href{https://www.overleaf.com/learn/latex/mathematical_expressions}{página do Overleaf sobre expressões matemáticas}.
Além disso, existem \href{https://www.codecogs.com/latex/eqneditor.php?latex=D}{geradores de equações online} que ajudam a escrevâ-las em LaTeX, HTML, entre outras linguagens de marcação.

É possível centralizar a equação envolvendo o código com \texttt{\$\$}. Veja o exemplo abaixo:

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{\$\$y\ =\ \textbackslash{}mu\ +\ \textbackslash{}sum\_\{i=1\}\^{}p\ \textbackslash{}beta\_i\ x\_i\ +\ \textbackslash{}epsilon\$\$} & \(y = \mu + \sum_{i=1}^p \beta_i x_i + \epsilon\) \\
\bottomrule
\end{longtable}

Também é possível adicionar a equação na mesma linha que o texto, envolvendo o código com \texttt{\$}. Veja o exemplo abaixo:

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{Ou\ também\ na\ linha\ \$y\ =\ \textbackslash{}mu\ +\ \textbackslash{}sum\_\{i=1\}\^{}p\ \textbackslash{}beta\_i\ x\_i\ +\ \textbackslash{}epsilon\$\ ,\ junto\ ao\ texto!} & Ou também na linha \(y = \mu + \sum_{i=1}^p \beta_i x_i + \epsilon\) , junto ao texto! \\
\bottomrule
\end{longtable}

\hypertarget{cuxf3digo}{%
\subsection{Código}\label{cuxf3digo}}

É possível \textbf{marcar textos para que fiquem formatados como códigos}, usando a crase: `

Mas atenção: o texto será \textbf{formatado como código}, porém não será executado!

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{\textasciigrave{}mean(pinguins\$massa\_corporal,\ na.rm\ =\ TRUE)\textasciigrave{}} & \texttt{mean(pinguins\$massa\_corporal,\ na.rm\ =\ TRUE)} \\
\bottomrule
\end{longtable}

Também é possível delimitar um trecho maior de código, utilizando três crases.

\textbf{Exemplo:}

\textbf{Como é escrito no código:}

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\InformationTok{library(dados)}
\InformationTok{mean(pinguins$massa\_corporal, na.rm = TRUE)}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\textbf{Como aparece no relatório:}

\begin{verbatim}
library(dados)
mean(pinguins$massa_corporal, na.rm = TRUE)
\end{verbatim}

\hypertarget{links}{%
\subsection{Links}\label{links}}

\begin{itemize}
\tightlist
\item
  Você pode criar um link utilizando esta estrutura:
\end{itemize}

\texttt{{[}texto{]}(http://url-da-pagina.com)}.

Por exemplo:

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{Você\ pode\ consultar\ mais\ {[}materiais\ sobre\ R\ nesta\ página{]}(https://curso-r.com/material/).} & Você pode consultar mais \href{https://curso-r.com/material/}{materiais sobre R nesta página}. \\
\bottomrule
\end{longtable}

\hypertarget{imagens}{%
\subsection{Imagens}\label{imagens}}

Você pode incluir uma imagem utilizando esta estrutura:

\texttt{!{[}descricao\ da\ imagem{]}(http://url-da-imagem.com)}.

Não se esqueça: a descrição da imagem é importante para
acessibilidade do conteúdo através de leitores de tela!

\begin{longtable}[]{@{}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}
  >{\raggedleft\arraybackslash}p{(\columnwidth - 2\tabcolsep) * \real{0.50}}@{}}
\toprule
Como é escrito no código & Como aparece no relatório \\
\midrule
\endhead
\texttt{!{[}Logo\ da\ Curso-R{]}(assets/img/relatorios/logo\_cursor\_full.png)} & \includegraphics{assets/img/relatorios/logo_cursor_full.png} \\
\bottomrule
\end{longtable}

\hypertarget{tabelas}{%
\subsection{Tabelas}\label{tabelas}}

As tabelas em Markdown têm uma estrutura definida, como mostra o exemplo abaixo.

É possível usar ferramentas online para gerar tabelas em Markdown, como por exemplo o \href{https://www.tablesgenerator.com/markdown_tables}{Tables Generator}.

\textbf{Em Markdown:}

\begin{verbatim}
|  a|  b|  c|
|--:|--:|--:|
|  1|  2|  3|
|  2|  3|  4|
\end{verbatim}

\textbf{Resultado:}

\begin{quote}
\begin{longtable}[]{@{}rrr@{}}
\toprule
a & b & c \\
\midrule
\endhead
1 & 2 & 3 \\
2 & 3 & 4 \\
\bottomrule
\end{longtable}
\end{quote}

\hypertarget{recapitulando}{%
\subsection{Recapitulando}\label{recapitulando}}

Nesta seção, aprendemos que o Markdown é uma linguagem de marcação, usada para marcar textos. Podemos usar o Markdown para formatar textos e adicionar elementos no nossos relatórios.

Porém existem elementos (como código, imagens, tabelas, entre outros) que podemos também adiconar nos relatórios utilizando R. É isso que veremos na seção seguinte!

\hypertarget{exercicios-md}{%
\subsection*{Exercícios}\label{exercicios-md}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Leia a primeira página o \href{https://rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf}{guia de referência do RMarkdown}

\textbf{2.} Liste abaixo outros lugares que utilizam o Markdown como base (Dica: outras linguagens de programação, fóruns, aplicativos de mensagem, etc)

\textbf{3.} Qual é o output se você criar uma lista ordenada começando no 2? Por exemplo:

\begin{verbatim}
2. primeiro item

2. segundo item

2. terceiro item
\end{verbatim}

\textbf{4.} O que são os \emph{sabores} de Markdown (Markdown flavor)?

\textbf{5.} Experimente o pandoc no \href{https://pandoc.org/try/}{site de demonstração da ferramenta}.

\hypertarget{r-markdown}{%
\section{R Markdown}\label{r-markdown}}

O R Markdown é a junção da linguagem Markdown com o poder de códigos em R. A mágica acontece em arquivos do tipo \texttt{.Rmd}, onde é possível adicionar textos, códigos, resultados de códigos e muito mais!

\hypertarget{criando-um-arquivo-.rmd}{%
\subsection{\texorpdfstring{Criando um arquivo \texttt{.Rmd}}{Criando um arquivo .Rmd}}\label{criando-um-arquivo-.rmd}}

Falamos que mágica acontece em arquivos do tipo \texttt{.Rmd}, porém, como podemos criar esses arquivos? Primeiramente, no menu superior, clique em \textbf{File} \textgreater{} \textbf{New File} \textgreater{} \textbf{R Markdown}, ou utilize os botões da interface gráfica, como mostrado na imagem a seguir:

\begin{figure}

{\centering \includegraphics[width=5.31in]{assets/img/relatorios/criar-rmd} 

}

\caption{Captura de tela da IDE RStudio}\label{fig:unnamed-chunk-1}
\end{figure}

Uma janela será aberta, chamada \textbf{New R Markdown}. Neste momento, iremos focar na seção inicial (\textbf{Document}). Nessa janela, é possível informar o título do relatório, o nome das pessoas autoras, e o formato em que deseja criar o relatório (sendo HTML, PDF ou Word). Caso queira gerar um PDF, será necessário instalar o LaTeX (saiba como no \protect\hyperlink{instalacao-latex}{capítulo sobre instalações adicionais}).

Para facilitar o aprendizado, recomendamos que escolha a opção HTML, sendo que é possível alterar todos esses campos posteriormente. Para que o arquivo seja criado, é necessário clicar no botão \textbf{OK}.

\begin{figure}

{\centering \includegraphics[width=16.28in]{assets/img/relatorios/criar-rmd-2} 

}

\caption{Captura de tela da IDE RStudio}\label{fig:unnamed-chunk-2}
\end{figure}

\hypertarget{estrutura-do-arquivo-r-markdown}{%
\subsection{Estrutura do arquivo R Markdown}\label{estrutura-do-arquivo-r-markdown}}

Quando criamos um novo arquivo \texttt{.Rmd} (como descrito na seção anterior), o arquivo vem com alguns conteúdos para nos ajudar a organizar corretamente.

O arquivo \texttt{.Rmd} possui a seguinte estrutura, ilustrada pela figura a seguir:

\begin{itemize}
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi})}
  \tightlist
  \item
    \textbf{YAML} - Uma seção de metadados, que apresenta códigos \texttt{YAML}. Essa seção apresenta informações que serão usadas para gerar o arquivo final, como por exemplo: título do relatório, autoria, data, formato gerado, etc. É necessário cuidado ao editar essa seção, pois coisas simples como indentação incorreta, fechamento incorreto de textos, etc, podem resultar em um erro ao gerar seu relatório. Essa seção deve estar sempre ao início do documento, e é delimitado por três traços no começo e no final: \texttt{-\/-\/-}.
  \end{enumerate}
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi})}
  \setcounter{enumi}{1}
  \tightlist
  \item
    \textbf{Chunks} - Nos campos de código (também chamados de \emph{chunks}) podemos adicionar códigos em R (ou em algumas outras linguagens). Os chunks são delimitados por três crases, e a linguagem deve ser especificada entre chaves. Caso queira adicionar chunks com código em Python, é necessário ter o pacote \href{https://rstudio.github.io/reticulate/}{\{reticulate\}} instalado. Exemplo de um chunk que apresenta código em R:
  \end{enumerate}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}}
\InformationTok{1 + 1 }
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\item
  \begin{enumerate}
  \def\labelenumi{\arabic{enumi})}
  \setcounter{enumi}{2}
  \tightlist
  \item
    \textbf{Markdown} - Textos marcados com Markdown podem ser adicionados ao longo do relatório, fora das demarcações do YAMl e dos Chunks. Caso queira saber mais sobre como marcar textos com Markdown, é possível ler mais \protect\hyperlink{markdown}{na seção anterior deste capítulo}.
  \end{enumerate}
\end{itemize}

\begin{figure}

{\centering \includegraphics[width=39.94in]{assets/img/relatorios/rmarkdown} 

}

\caption{Captura de tela da IDE RStudio}\label{fig:unnamed-chunk-3}
\end{figure}

\hypertarget{adicionando-conteuxfado}{%
\subsection{Adicionando conteúdo}\label{adicionando-conteuxfado}}

Nesta seção, utilizaremos como exemplos alguns códigos envolvendo a base de dados de pinguins. A versão original deste dataset (em Inglês) está disponível no pacote \href{https://github.com/allisonhorst/palmerpenguins}{palmerpenguins}, e a versão traduzida para Português está disponível no pacote \href{https://cienciadedatos.github.io/dados/}{dados}.

\begin{figure}

{\centering \includegraphics[width=0.8\linewidth]{assets/img/relatorios/lter_penguins} 

}

\caption{Conheça os Pinguins do dataset PalmerPenguins! Ilustração por <a href='https://github.com/allisonhorst/stats-illustrations'>Allison Horst</a>.}\label{fig:unnamed-chunk-4}
\end{figure}

Caso não tenha o pacote \href{https://cienciadedatos.github.io/dados/}{dados} instalado, é possível instalar com o seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"remotes"}\NormalTok{)}
\NormalTok{remotes}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"cienciadedatos/dados"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Agora carregue os pacotes necessários:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dados)  }\CommentTok{\# Pacote com bases de dados em Português}
\FunctionTok{library}\NormalTok{(magrittr)  }\CommentTok{\# Pacote para utilizar o Pipe \%\textgreater{}\%}
\end{Highlighting}
\end{Shaded}

\hypertarget{cuxf3digos-em-r}{%
\subsubsection{Códigos em R}\label{cuxf3digos-em-r}}

Ao analisar dados, escrevemos códigos que calculam estatísticas descritivas, geram gráficos e tabelas, entre outros.
Para adicionar esses resultados nos relatórios, não é muito prático adicionar manualmente o resultado final (copiando e colando, por exemplo), pois em caso de alguma mudança na base de dados, será necessário gerar novamente estes resultados e adicioná-los novamente!

Com RMarkdown, podemos adicionar códigos nos nossos relatórios que geram os resultados, assim a cada vez que compilarmos o relatório os códigos que geram estes resultados serão executados, e o relatório terá sempre os resultados atualizados.

Caso você queira que o código seja executado como código R, existem duas possibilidades:

\begin{itemize}
\item
  \textbf{chunks de código} ou \textbf{campos de código} ( \emph{chunks} em Inglês), quando o código é executado em um campo de código em R.
\item
  \textbf{código em linha} (ou `\emph{inline code}' em Inglês), quando o resultado aparece junto ao texto;
\end{itemize}

\hypertarget{campos-de-cuxf3digo-chunks}{%
\paragraph*{Campos de código (chunks)}\label{campos-de-cuxf3digo-chunks}}
\addcontentsline{toc}{paragraph}{Campos de código (chunks)}

É possível adicionar campos de código utilizando a seguinte sintaxe:

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}}
\InformationTok{codigo em R aqui}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

Um exemplo de campo de código é o campo abaixo, onde é possível executar o código e visualizar o resultado.

\textbf{Exemplo:}

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r\}}
\InformationTok{ \# calcula a média}
\InformationTok{media\_massa\_g \textless{}{-}}
\InformationTok{  mean(pinguins$massa\_corporal, na.rm = TRUE) }

\InformationTok{ \# converte de gramas para kilogramas}
\InformationTok{media\_massa\_kg\_completo \textless{}{-}}
\InformationTok{  media\_massa\_g / 1000 }

\InformationTok{ \# arredonda o valor para ter uma casa decimal}
\InformationTok{media\_massa\_kg \textless{}{-} round(media\_massa\_kg\_completo, 1)}

\InformationTok{ \# exibe o resultado}
\InformationTok{media\_massa\_kg }
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\textbf{Resultado:}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# calcula a média}
\NormalTok{media\_massa\_g }\OtherTok{\textless{}{-}}
  \FunctionTok{mean}\NormalTok{(pinguins}\SpecialCharTok{$}\NormalTok{massa\_corporal, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }

\CommentTok{\# converte de gramas para kilogramas}
\NormalTok{media\_massa\_kg\_completo }\OtherTok{\textless{}{-}}
\NormalTok{  media\_massa\_g }\SpecialCharTok{/} \DecValTok{1000} 

\CommentTok{\# arredonda o valor para ter uma casa decimal}
\NormalTok{media\_massa\_kg }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(media\_massa\_kg\_completo, }\DecValTok{1}\NormalTok{)}

\CommentTok{\# exibe o resultado}
\NormalTok{media\_massa\_kg }
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4.2
\end{verbatim}

Veja que no resultado obtivemos o código em R e também o resultado deste código. Dependendo do público alvo do relatório, não queremos mostrar códigos. É possível escondê-los (e fazer muito mais!) alterando as opções de chunks (ou \emph{chunk options} em Inglês). Veremos mais sobre isso posteriormente!

\hypertarget{inline-code}{%
\paragraph*{Inline code}\label{inline-code}}
\addcontentsline{toc}{paragraph}{Inline code}

Para que um resultado de código apareça ao longo do texto, é possivel usar a seguinte estrutura: \texttt{\textasciigrave{}r\ \textasciigrave{}} .

\textbf{Exemplo:}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{A média da massa corporal dos pinguins é }\InformationTok{\textasciigrave{}r media\_massa\_kg\textasciigrave{}}\NormalTok{ kg.}
\end{Highlighting}
\end{Shaded}

\textbf{Resultado:}

\begin{quote}
A média da massa corporal dos pinguins é 4.2 kg.
\end{quote}

\hypertarget{imagens-1}{%
\subsubsection{Imagens}\label{imagens-1}}

Na seção anterior (sobre \protect\hyperlink{markdown}{Markdown}), mostramos como é possóvel adicionar uma imagem em um relatório utilizando Markdown.

Porém, quando utilizamos arquivos RMarkdown também podemos adicionar imagens usando código em R, com a função \texttt{include\_graphics} do pacote \texttt{knitr}.

Usando o \texttt{knitr} é possível personalizar de forma mais intuitiva como a imagem aparecerá no arquivo final: você pode adicionar uma imagem utilizando como primeiro argumento a url da imagem ou o caminho onde ela está no projeto. Além disso, com as opções de chunks (ou \emph{chunk options} em Inglês), poderemos personalizar diversos atributos da imagem, como: legenda, tamanho, alinhamento, entre outros.

Veja o exemplo abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{knitr}\SpecialCharTok{::}\FunctionTok{include\_graphics}\NormalTok{(}\StringTok{"assets/img/relatorios/dados{-}hex.png"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics[width=0.3\linewidth]{assets/img/relatorios/dados-hex} \end{center}

\hypertarget{tabelas-1}{%
\subsubsection{Tabelas}\label{tabelas-1}}

Na seção anterior (sobre \protect\hyperlink{markdown}{Markdown}), foi apresentado como adicionar uma tabela utilizando Markdown.

Porém quando utilizamos arquivos R Markdown também é possível adicionar tabelas que resultam de códigos em R.

Existem algumas funções diferentes para fazer isso. Para apresentar alguns exemplos, primeiramente vamos salvar uma versão da base pinguins:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{media\_massa }\OtherTok{\textless{}{-}}\NormalTok{ pinguins }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# usamos a base de pinguins}
  \CommentTok{\# agrupamos por especie e ilhas}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(especie, ilha) }\SpecialCharTok{\%\textgreater{}\%}  
  \CommentTok{\# calculamos a média da massa corporal }
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}\AttributeTok{media\_massa =} \FunctionTok{mean}\NormalTok{(massa\_corporal, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \CommentTok{\# criamos uma nova coluna, com a massa em kg, e arredondada com 2 casas decimais}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{media\_massa\_kg =} \FunctionTok{round}\NormalTok{(media\_massa }\SpecialCharTok{/} \DecValTok{1000}\NormalTok{, }\DecValTok{2}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}  
  \CommentTok{\# removemos a coluna da massa em gramas}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{media\_massa)}

\CommentTok{\# Apresentamos o resultado da tabela:}
\NormalTok{media\_massa}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 5 x 3
## # Groups:   especie [3]
##   especie             ilha      media_massa_kg
##   <fct>               <fct>              <dbl>
## 1 Pinguim-de-adélia   Biscoe              3.71
## 2 Pinguim-de-adélia   Dream               3.69
## 3 Pinguim-de-adélia   Torgersen           3.71
## 4 Pinguim-de-barbicha Dream               3.73
## 5 Pinguim-gentoo      Biscoe              5.08
\end{verbatim}

Acima, a tabela é apresentada como ela é escrita no console do R. Porém essa forma não é elegante de ser apresentada em um relatório! Podemos utilizar funções de diferentes pacotes para que as tabelas fiquem formatadas de uma forma mais atraente:

\begin{itemize}
\tightlist
\item
  Utilizando o pacote \texttt{knitr}: função \texttt{kable()}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{media\_massa }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{l|l|r}
\hline
especie & ilha & media\_massa\_kg\\
\hline
Pinguim-de-adélia & Biscoe & 3.71\\
\hline
Pinguim-de-adélia & Dream & 3.69\\
\hline
Pinguim-de-adélia & Torgersen & 3.71\\
\hline
Pinguim-de-barbicha & Dream & 3.73\\
\hline
Pinguim-gentoo & Biscoe & 5.08\\
\hline
\end{tabular}

\begin{itemize}
\tightlist
\item
  Utilizando o pacote \texttt{DT}: função \texttt{datatable()}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{media\_massa }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  DT}\SpecialCharTok{::}\FunctionTok{datatable}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\includegraphics{092-rmarkdown_files/figure-latex/exemplo-DT-1.pdf}

Os exemplos anteriores são as formas mais simples de apresentar as tabelas, porém cada pacote possibilita diferentes personalizações (por exemplo, alterar o nome das colunas, etc). Existem outros pacotes que permitem adicionar tabela nos relatórios em RMarkdown, como por exemplo:

\begin{itemize}
\item
  \href{https://gt.rstudio.com/}{gt}
\item
  \href{https://glin.github.io/reactable/index.html}{reactable}
\item
  \href{https://davidgohel.github.io/flextable/articles/overview.html}{flextable}
\item
  \href{https://cran.r-project.org/web/packages/kableExtra/vignettes/awesome_table_in_html.html}{kableExtra}
\end{itemize}

\hypertarget{dicas-para-o-rstudio}{%
\subsection{Dicas para o RStudio}\label{dicas-para-o-rstudio}}

A versão mais recente do RStudio possui uma ferramenta de edição de Markdown visual, que disponibiliza botões para editar o texto com Markdown.

Veja mais \href{https://blog.rstudio.com/2020/09/30/rstudio-v1-4-preview-visual-markdown-editing/}{neste post no blog da RStudio}, e também a animação disponível neste post:

\hypertarget{exercicios-rmd}{%
\subsection*{Exercícios}\label{exercicios-rmd}}
\addcontentsline{toc}{subsection}{Exercícios}

\textbf{1.} Leia o \href{https://rstudio.com/wp-content/uploads/2015/03/rmarkdown-reference.pdf}{guia de referência do RMarkdown} até o final.

\textbf{2.} Qual o propósito do YAML do documento?

\textbf{3.} Quais são as opções e resultados do parâmetro \texttt{results=}?

\begin{Shaded}
\begin{Highlighting}[]
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}\{r results=\textquotesingle{}markup\textquotesingle{}\}}
\InformationTok{knitr::kable(head(cars))}
\InformationTok{\textasciigrave{}\textasciigrave{}\textasciigrave{}}
\end{Highlighting}
\end{Shaded}

\hypertarget{funcionais}{%
\chapter{Programação funcional (purrr)}\label{funcionais}}

Programação funcional (PF) é um paradigma de programação com o qual a maior parte
dos estatísticos não está familiarizada. Essa técnica costuma ser ignorada na
maioria dos tutoriais de R por não estar diretamente envolvida com manipulação e
visualização de dados, mas isso não quer dizer que ela não tenha suas vantagens.

Usando programação funcional podemos criar códigos mais concisos e \emph{pipeáveis}, características que por tabela também tornam mais simples o processo de encontrar erros. Além disso, códigos funcionais geralmente são paralelizáveis, permitindo que tratemos problemas muito grandes com poucas modificações.

Apesar de o R \texttt{base} já ter funções que podem ser consideradas elementos de PF, a
implementação destas não é tão elegante e, portanto, este tutorial abordará
somente a implementação de PF realizada pelo pacote \texttt{purrr}.

Para instalar e carregar o \texttt{purrr}, rode o código a seguir. Nas próximas seções
deste tutorial, assumiremos que você têm esse pacote instalado e carregado.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"purrr"}\NormalTok{)}
\FunctionTok{library}\NormalTok{(purrr)}
\end{Highlighting}
\end{Shaded}

\hypertarget{iterauxe7uxf5es-buxe1sicas}{%
\section{Iterações básicas}\label{iterauxe7uxf5es-buxe1sicas}}

A primeira família de funções do \texttt{purrr} que veremos também é a mais útil e
extensível. As funções \texttt{map()} são quase como substitutas para laços \texttt{for},
elas abstraem a iteração em apenas uma linha. Veja esse exemplo de laço usando
\texttt{for}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_um }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{ \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(obj)) \{}
\NormalTok{  obj[i] }\OtherTok{\textless{}{-}} \FunctionTok{soma\_um}\NormalTok{(obj[i])}
\NormalTok{\}}
\NormalTok{obj}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11 12 13 14 15 16
\end{verbatim}

O que de fato estamos tentando fazer com o laço acima? Temos um vetor (\texttt{obj}) e
queremos aplicar uma função (\texttt{soma\_um()}) em cada elemento dele. A função \texttt{map()}
remove a necessidade de declaramos um objeto iterador auxiliar (\texttt{i}) e
simplesmente aplica a função desejada em cada elemento do objeto dado.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_um }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{ \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{obj }\OtherTok{\textless{}{-}} \FunctionTok{map}\NormalTok{(obj, soma\_um)}
\NormalTok{obj}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 11
## 
## [[2]]
## [1] 12
## 
## [[3]]
## [1] 13
## 
## [[4]]
## [1] 14
## 
## [[5]]
## [1] 15
## 
## [[6]]
## [1] 16
\end{verbatim}

Como você deve ter percebido, o resultado da execução acima não é exatamente
igual ao que tivemos com o laço. Isso acontece porque a \texttt{map()} tenta ser
extremamente genérica, retornando por padrão uma lista com um elemento para
cada saída.

Se quisermos ``achatar'' o resultado, devemos informar qual será o seu tipo. Isso
é super simples e pode ser feito com as irmãs da \texttt{map()}: \texttt{map\_chr()} (para
strings), \texttt{map\_dbl()} (para números reais), \texttt{map\_int()} (para números inteiros) e
\texttt{map\_lgl()} (para booleanos).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{map\_dbl}\NormalTok{(obj, soma\_um)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11 12 13 14 15 16
\end{verbatim}

\begin{quote}
O \texttt{purrr} também nos fornece outra ferramenta interessante para
achatar listas: a família \texttt{flatten()}. No fundo, \texttt{map\_chr()}
é quase um atalho para \texttt{map()\ \%\textgreater{}\%\ flatten\_chr()}!
\end{quote}

Algo bastante útil da família \texttt{map()} é a possibilidade de passar argumentos
fixos para a função que será aplicada. A primeira forma de fazer isso envolve
fórmulas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_n }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{n =} \DecValTok{1}\NormalTok{) \{ x }\SpecialCharTok{+}\NormalTok{ n \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{map\_dbl}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}}\FunctionTok{soma\_n}\NormalTok{(.x, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 12 13 14 15 16 17
\end{verbatim}

Como vemos no exemplo acima, para utilizar fórmulas precisamos colocar um til
(\texttt{\textasciitilde{}}) antes da função que será chamada. Feito isso, podemos utilizar o
placeholder \texttt{.x} para indicar onde deve ser colocado cada elemento de \texttt{obj}.

A outra forma de passar argumentos para a função é através das reticências da
\texttt{map()}. Desta maneira precisamos apenas dar o nome do argumento e seu valor
logo após a função \texttt{soma\_n()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_n }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, }\AttributeTok{n =} \DecValTok{1}\NormalTok{) \{ x }\SpecialCharTok{+}\NormalTok{ n \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{map\_dbl}\NormalTok{(obj, soma\_n, }\AttributeTok{n =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 12 13 14 15 16 17
\end{verbatim}

Usando fórmulas temos uma maior flexibilidade (podemos, por exemplo, declarar
funções anônimas como \texttt{\textasciitilde{}.x+2}), enquanto com as reticências temos maior
legibilidade.

\hypertarget{iterauxe7uxf5es-intermediuxe1rias}{%
\section{Iterações intermediárias}\label{iterauxe7uxf5es-intermediuxe1rias}}

Agora que já exploramos os básicos da família \texttt{map()} podemos partir para
iterações um pouco mais complexas. Observe o laço a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_ambos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{ x }\SpecialCharTok{+}\NormalTok{ y \}}
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{obj\_2 }\OtherTok{\textless{}{-}} \DecValTok{20}\SpecialCharTok{:}\DecValTok{25}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(obj\_1)) \{}
\NormalTok{  obj\_1[i] }\OtherTok{\textless{}{-}} \FunctionTok{soma\_ambos}\NormalTok{(obj\_1[i], obj\_2[i])}
\NormalTok{\}}
\NormalTok{obj\_1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 30 32 34 36 38 40
\end{verbatim}

Com a função \texttt{map2()} podemos reproduzir o laço acima em apenas uma linha. Ela
abstrai a iteração em paralelo, aplica a função em cada par de elementos das
entradas e, assim como sua prima \texttt{map()}, pode achatar o objeto retornado com os
sufixos \texttt{\_chr}, \texttt{\_dbl}, \texttt{\_int} e \texttt{\_lgl}.

\begin{quote}
O termo ``paralelo'' neste capítulos se refere a laços em mais de uma estrutura e não a paralelização de computações em mais de uma unidade de processamento.
\end{quote}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_ambos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{ x }\SpecialCharTok{+}\NormalTok{ y \}}
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{obj\_2 }\OtherTok{\textless{}{-}} \DecValTok{20}\SpecialCharTok{:}\DecValTok{25}
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \FunctionTok{map2\_dbl}\NormalTok{(obj\_1, obj\_2, soma\_ambos)}
\NormalTok{obj\_1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 30 32 34 36 38 40
\end{verbatim}

Como o pacote \texttt{purrr} é extremamente consistente, a \texttt{map2()} também funciona com
reticências e fórmulas. Poderíamos, por exemplo, transformar \texttt{soma\_ambos()} em
uma função anônima:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{obj\_2 }\OtherTok{\textless{}{-}} \DecValTok{20}\SpecialCharTok{:}\DecValTok{25}
\FunctionTok{map2\_dbl}\NormalTok{(obj\_1, obj\_2, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{+}\NormalTok{.y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 30 32 34 36 38 40
\end{verbatim}

Desta vez também temos acesso ao placeholder \texttt{.y} para indicar onde os elementos
de do segundo vetor devem ir.

Para não precisar oferecer uma função para cada número de argumentos, o pacote
\texttt{purrr} fornece a \texttt{pmap()}. Para essa função devemos passar uma lista em que cada
elemento é um dos objetos a ser iterado:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_varios }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, z) \{ x }\SpecialCharTok{+}\NormalTok{ y }\SpecialCharTok{+}\NormalTok{ z \}}
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{obj\_2 }\OtherTok{\textless{}{-}} \DecValTok{20}\SpecialCharTok{:}\DecValTok{25}
\NormalTok{obj\_3 }\OtherTok{\textless{}{-}} \DecValTok{30}\SpecialCharTok{:}\DecValTok{35}
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \FunctionTok{pmap\_dbl}\NormalTok{(}\FunctionTok{list}\NormalTok{(obj\_1, obj\_2, obj\_3), soma\_varios)}
\NormalTok{obj\_1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 60 63 66 69 72 75
\end{verbatim}

Com a \texttt{pmap()} infelizmente não podemos usar fórmulas. Se quisermos usar uma
função anônima com ela, precisamos declará-la a função no seu corpo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj\_1 }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\NormalTok{obj\_2 }\OtherTok{\textless{}{-}} \DecValTok{20}\SpecialCharTok{:}\DecValTok{25}
\NormalTok{obj\_3 }\OtherTok{\textless{}{-}} \DecValTok{30}\SpecialCharTok{:}\DecValTok{35}
\FunctionTok{pmap\_dbl}\NormalTok{(}\FunctionTok{list}\NormalTok{(obj\_1, obj\_2, obj\_3), }\ControlFlowTok{function}\NormalTok{(x, y, z) \{ x }\SpecialCharTok{+}\NormalTok{ y }\SpecialCharTok{+}\NormalTok{ z \})}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 60 63 66 69 72 75
\end{verbatim}

A última função que veremos nessa seção é a \texttt{imap()}. No fundo ela é um
atalho para \texttt{map2(x,\ names(x),\ ...)} quando \texttt{x} tem nomes e para
\texttt{map2(x,\ seq\_along(x),\ ...)} caso contrário:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{imap\_dbl}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{+}\NormalTok{.y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11 13 15 17 19 21
\end{verbatim}

Como podemos observar, agora \texttt{.y} é o placeholder para o índice atual (equivalente
ao \texttt{i} no laço com \texttt{for}). Naturalmente, assim como toda a família \texttt{map()}, a
\texttt{imap()} também funciona com os sufixos de achatamento.

\hypertarget{iterauxe7uxf5es-avanuxe7adas}{%
\section{Iterações avançadas}\label{iterauxe7uxf5es-avanuxe7adas}}

Agora que já vimos como substituir iterações de nível básico e de nível
intermediário com a família \texttt{map()}, podemos passar para os tipos mais obscuros
de laços. Cada item desta seção será mais denso do que os das passadas, por isso
encorajamos todos os leitores para que também leiam a documentação de cada função
aqui abordada.

\hypertarget{iterauxe7uxf5es-com-condicionais}{%
\subsection{Iterações com condicionais}\label{iterauxe7uxf5es-com-condicionais}}

Imagine que precisamos aplicar uma função somente em alguns elementos de um vetor.
Com um laço isso é uma tarefa fácil, mas com as funções da família \texttt{map()}
apresentadas até agora isso seria extremamente difícil. Veja o trecho de código
a seguir por exemplo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dobra }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x}\SpecialCharTok{*}\DecValTok{2}\NormalTok{ \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \FunctionTok{seq\_along}\NormalTok{(obj)) \{}
  \ControlFlowTok{if}\NormalTok{ (obj[i] }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{1}\NormalTok{) \{ obj[i] }\OtherTok{\textless{}{-}} \FunctionTok{dobra}\NormalTok{(obj[i]) \}}
  \ControlFlowTok{else}\NormalTok{                  \{ obj[i] }\OtherTok{\textless{}{-}}\NormalTok{ obj[i] \}}
\NormalTok{\}}
\NormalTok{obj}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 22 12 26 14 30
\end{verbatim}

No exemplo acima, aplicamos a função \texttt{dobra()} apenas nos elementos ímpares do
vetor \texttt{obj}. Com o pacote \texttt{purrr} temos duas maneiras de fazer isso: com
\texttt{map\_if()} ou \texttt{map\_at()}.

A primeira dessas funções aplica a função dada apenas quando um predicado é
\texttt{TRUE}. Esse predicado pode ser uma função ou uma fórmula (que serão aplicadas
em cada elemento da entrada e devem retornar \texttt{TRUE} ou \texttt{FALSE}). Infelizmente
a \texttt{map\_if()} não funciona com sufixos, então devemos achatar o resultado:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{eh\_impar }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x}\SpecialCharTok{\%\%}\DecValTok{2} \SpecialCharTok{==} \DecValTok{1}\NormalTok{ \}}
\NormalTok{dobra }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x}\SpecialCharTok{*}\DecValTok{2}\NormalTok{ \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{map\_if}\NormalTok{(obj, eh\_impar, dobra) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{flatten\_dbl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 22 12 26 14 30
\end{verbatim}

Com fórmulas poderíamos eliminar completamente a necessidade de funções
declaradas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{map\_if}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{\%\%}\DecValTok{2} \SpecialCharTok{==} \DecValTok{1}\NormalTok{, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{*}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{flatten\_dbl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 22 12 26 14 30
\end{verbatim}

A segunda dessas funções é a irmã gêmea de \texttt{map\_if()} e funciona de forma muito
semelhante. Para \texttt{map\_at()} devemos passar um vetor de nomes ou índices onde a
função deve ser aplicada:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{map\_at}\NormalTok{(obj, }\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{, }\DecValTok{6}\NormalTok{), }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{*}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{flatten\_dbl}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 22 12 26 14 30
\end{verbatim}

\hypertarget{iterauxe7uxf5es-com-tabelas-e-funuxe7uxf5es}{%
\subsection{Iterações com tabelas e funções}\label{iterauxe7uxf5es-com-tabelas-e-funuxe7uxf5es}}

Duas funções menos utilizadas da família \texttt{map()} são \texttt{map\_dfc()} e \texttt{map\_dfr()},
que equivalem a um \texttt{map()} seguido de um \texttt{dplyr::bind\_cols()} ou de um
\texttt{dplyr::bind\_rows()} respectivamente.

\begin{quote}
A maior utilidade dessas funções é quando temos uma tabela espalhada em muitos
arquivos. Se elas estiverem divididas por grupos de colunas, podemos usar algo
como \texttt{map\_dfc(arquivos,\ readr::read\_csv)} e se elas estiverem
divididas por grupos de linhas, \texttt{map\_dfr(arquivos,\ readr::read\_csv)}
\end{quote}

Outro membro obscuro da família \texttt{map()} é a \texttt{invoke\_map()}. Na verdade essa
função pode ser considerada um membro da família \texttt{invoke()}, mas vamos ver
que as semelhanças são muitas. Primeiramente, vamos demonstrar o que faz a
\texttt{invoke()} sozinha:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_ambos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{ x }\SpecialCharTok{+}\NormalTok{ y \}}
\FunctionTok{invoke}\NormalTok{(soma\_ambos, }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{15}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 25
\end{verbatim}

É fácil de ver que essa função recebe uma função e uma lista de argumentos para
usar em uma chamada desta. Agora generalizando esta lógica temos \texttt{invoke\_map()},
que chama uma mesma função com uma lista de listas de argumentos ou uma lista
de funções com uma lista de argumentos. A família \texttt{invoke()} também aceita os
sufixos como veremos a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_ambos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{ x }\SpecialCharTok{+}\NormalTok{ y \}}
\NormalTok{soma\_um }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{ \}}
\NormalTok{soma\_dois }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x }\SpecialCharTok{+} \DecValTok{2}\NormalTok{ \}}
\FunctionTok{invoke\_map\_dbl}\NormalTok{(soma\_ambos, }\FunctionTok{list}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{10}\NormalTok{, }\AttributeTok{y =} \DecValTok{15}\NormalTok{), }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{20}\NormalTok{, }\AttributeTok{y =} \DecValTok{25}\NormalTok{)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 25 45
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{invoke\_map\_dbl}\NormalTok{(}\FunctionTok{list}\NormalTok{(soma\_um, soma\_dois), }\FunctionTok{list}\NormalTok{(}\AttributeTok{x =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 11 12
\end{verbatim}

\hypertarget{reduuxe7uxe3o-e-acuxfamulo}{%
\subsection{Redução e acúmulo}\label{reduuxe7uxe3o-e-acuxfamulo}}

Outras funções simbólicas de programação funcional além da \texttt{map()} são \texttt{reduce}
e \texttt{accumulate}, que aplicam transformações em valores acumulados. Observe o laço
a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_ambos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{ x }\SpecialCharTok{+}\NormalTok{ y \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{2}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(obj)) \{}
\NormalTok{  obj[i] }\OtherTok{\textless{}{-}} \FunctionTok{soma\_ambos}\NormalTok{(obj[i}\DecValTok{{-}1}\NormalTok{], obj[i])}
\NormalTok{\}}
\NormalTok{obj}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 21 33 46 60 75
\end{verbatim}

Essa soma cumulativa é bastante simples, mas não é difícil imaginar uma situação
em que um programador desavisado confunde um índice com o outro e o \emph{bug} acaba
passando desapercebido. Para evitar esse tipo de situação, podemos utilizar
\texttt{accumulate()} (tanto com uma função quanto com uma fórmula):

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_ambos }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{ x }\SpecialCharTok{+}\NormalTok{ y \}}
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{accumulate}\NormalTok{(obj, soma\_ambos)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 21 33 46 60 75
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{accumulate}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{+}\NormalTok{.y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10 21 33 46 60 75
\end{verbatim}

\textbf{Obs.:} Nesse caso, os placeholders têm significados ligeiramente diferentes.
Aqui, \texttt{.x} é o valor acumulado e \texttt{.y} é o valor ``atual'' do objeto sendo iterado.

Se não quisermos o valor acumulado em cada passo da iteração, podemos usar
\texttt{reduce()}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \DecValTok{10}\SpecialCharTok{:}\DecValTok{15}
\FunctionTok{reduce}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}}\NormalTok{.x}\SpecialCharTok{+}\NormalTok{.y)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 75
\end{verbatim}

Para a nossa comodidade, essas duas funções também têm variedades paralelas
(\texttt{accumulate2()} e \texttt{reduce2()}), assim como variedades invertidas
\texttt{accumulate\_right()} e \texttt{reduce\_right()}).

\hypertarget{misceluxe2nea-1}{%
\section{Miscelânea}\label{misceluxe2nea-1}}

Por fim, veremos algumas funções do \texttt{purrr} que nêo têm exatamente a ver com
laços, mas que acabam sendo bastante úteis quando usando as funções que vimos
até agora. Elas não serão apresentadas em nenhuma ordem específica, este é apenas
um apanhado de funções sortidas que achamos úteis enquanto programando com o
\texttt{purrr}.

\hypertarget{manter-e-descartar}{%
\subsection{Manter e descartar}\label{manter-e-descartar}}

Se quisermos filtrar elementos de um vetor ou lista, podemos usar as funções
\texttt{keep()} e \texttt{discard()}. Elas funcionam com fórmulas e podem ser extremamente úteis
em situações que \texttt{dplyr::select()} e \texttt{magrittr::extract()} não conseguem cobrir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{15}\NormalTok{, }\DecValTok{20}\SpecialCharTok{:}\DecValTok{25}\NormalTok{, }\FunctionTok{c}\NormalTok{(}\DecValTok{30}\SpecialCharTok{:}\DecValTok{34}\NormalTok{, }\ConstantTok{NA}\NormalTok{))}
\FunctionTok{keep}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}}\FunctionTok{any}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(.x)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 30 31 32 33 34 NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{discard}\NormalTok{(obj, }\SpecialCharTok{\textasciitilde{}!}\FunctionTok{any}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(.x)))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [[1]]
## [1] 30 31 32 33 34 NA
\end{verbatim}

No exemplo acima descartamos todos os vetores da lista que não têm pelo menos um
elemento omisso (\texttt{NA}).

\hypertarget{a-famuxedlia-is}{%
\subsection{\texorpdfstring{A família \texttt{is}}{A família is}}\label{a-famuxedlia-is}}

Uma outra família do pacote \texttt{purrr} é a \texttt{is()}. Com essa série de funções podemos
fazer verificações extremamente estritas em objetos dos mais variados tipos. Seguem
alguns poucos exemplos:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is\_scalar\_integer}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is\_bare\_integer}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is\_atomic}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{is\_vector}\NormalTok{(}\DecValTok{10}\SpecialCharTok{:}\DecValTok{15}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\hypertarget{andar-e-modificar}{%
\subsection{Andar e modificar}\label{andar-e-modificar}}

\texttt{walk()} e \texttt{modify()} são pequenas alterações da família \texttt{map()} que vêm a calhar
em diversas situações. A primeira destas funciona exatamente igual à \texttt{map()} mas
não devolve resultado, apenas efeitos colaterais; a segunda, não muda a
estrutura do objeto sendo iterado, ela substitui os próprios elementos da entrada.

\begin{quote}
A maior utilidade de \texttt{walk} é quando precisamos salvar múltiplas
tabelas. Para fazer isso, podemos usar algo como
\texttt{walk(tabelas,\ readr::write\_csv)}.
\end{quote}

Um caso de uso interessante da \texttt{modify()} é ao lado do sufixo \texttt{\_if()},
combinação que nos permite iterar nas colunas de uma tabela e aplicar
transformações de tipo apenas quando um predicado for verdade (geralmente de
queremos transformar as colunas de fator para caractere).

\hypertarget{transposiuxe7uxe3o-e-indexauxe7uxe3o-profunda}{%
\subsection{Transposição e indexação profunda}\label{transposiuxe7uxe3o-e-indexauxe7uxe3o-profunda}}

Quando precisarmos lidar com listas complexas e profundas, o \texttt{purrr} nos fornece
duas funções extremamente úteis: \texttt{transpose()} e \texttt{pluck()}. A primeira transpõe
uma lista, enquanto a segunda é capaz de acessar elementos profundos de uma lista
sem a necessidade de colchetes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{obj }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{1}\NormalTok{, }\AttributeTok{b =} \DecValTok{2}\NormalTok{, }\AttributeTok{c =} \DecValTok{3}\NormalTok{), }\FunctionTok{list}\NormalTok{(}\AttributeTok{a =} \DecValTok{4}\NormalTok{, }\AttributeTok{b =} \DecValTok{5}\NormalTok{, }\AttributeTok{c =} \DecValTok{6}\NormalTok{))}
\FunctionTok{str}\NormalTok{(obj)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 2
##  $ :List of 3
##   ..$ a: num 1
##   ..$ b: num 2
##   ..$ c: num 3
##  $ :List of 3
##   ..$ a: num 4
##   ..$ b: num 5
##   ..$ c: num 6
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{pluck}\NormalTok{(obj, }\DecValTok{2}\NormalTok{, }\StringTok{"b"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(}\FunctionTok{transpose}\NormalTok{(obj))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## List of 3
##  $ a:List of 2
##   ..$ : num 1
##   ..$ : num 4
##  $ b:List of 2
##   ..$ : num 2
##   ..$ : num 5
##  $ c:List of 2
##   ..$ : num 3
##   ..$ : num 6
\end{verbatim}

\textbf{Obs.:} Se você estiver com muitos problemas com listas profundas, dê uma olhada
nas funções relacionadas a \texttt{depth()} pois elas podem ser muito úteis.

\hypertarget{aplicauxe7uxe3o-parcial}{%
\subsection{Aplicação parcial}\label{aplicauxe7uxe3o-parcial}}

Se quisermos pré-preencher os argumentos de uma função (seja para usá-la em uma
pipeline ou com alguma função do próprio \texttt{purrr}), temos \texttt{partial()}. Ela funciona
nos moldes da família \texttt{invoke()} e pode ser bastante útil para tornar suas
pipelines mais enxutas:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_varios }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y, z) \{ x }\SpecialCharTok{+}\NormalTok{ y }\SpecialCharTok{+}\NormalTok{ z \}}
\NormalTok{nova\_soma }\OtherTok{\textless{}{-}} \FunctionTok{partial}\NormalTok{(soma\_varios, }\AttributeTok{x =} \DecValTok{1}\NormalTok{, }\AttributeTok{y =} \DecValTok{2}\NormalTok{)}
\FunctionTok{nova\_soma}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6
\end{verbatim}

\hypertarget{execuuxe7uxe3o-segura}{%
\subsection{Execução segura}\label{execuuxe7uxe3o-segura}}

Não é incomum executarmos uma função e recebermos um erro de volta. Isso pode ser
lidado com facilidade em um laço com um condicional, mas essa tarefa já é mais
complexa quando se trata de programação funcional. Para isso, no \texttt{purrr} temos
algumas funções que embrulham uma função e, quando esta retornar um erro, o
silenciam e retornam um valor padrão em seu lugar.

\texttt{quietly()} retorna uma lista com resultado, saída, mensagem e alertas, \texttt{safely()}
retorna uma lista com resultado e erro (um destes sempre é \texttt{NULL}), e \texttt{possibly()}
silencia o erro e retorna um valor dado pelo usuário.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma\_um }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{ x }\SpecialCharTok{+} \DecValTok{1}\NormalTok{ \}}
\NormalTok{s\_soma\_um }\OtherTok{\textless{}{-}} \FunctionTok{safely}\NormalTok{(soma\_um, }\DecValTok{0}\NormalTok{)}
\NormalTok{obj }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{11}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\DecValTok{13}\NormalTok{, }\DecValTok{14}\NormalTok{, }\DecValTok{15}\NormalTok{)}
\FunctionTok{s\_soma\_um}\NormalTok{(obj)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## $result
## [1] 0
## 
## $error
## <simpleError in x + 1: non-numeric argument to binary operator>
\end{verbatim}

\hypertarget{exercuxedcios-23}{%
\section{Exercícios}\label{exercuxedcios-23}}

A base \texttt{imdb} nos exercícios abaixo pode ser baixada \href{https://github.com/curso-r/livro-material/raw/master/assets/data/imdb.rds}{clicando aqui}.

\textbf{1.} Utilize a função \texttt{map()} para calcular a média de cada coluna da base \texttt{mtcars}.

\textbf{2.} Use a função \texttt{map()} para testar se cada elemento do vetor \texttt{letters} é uma vogal ou não. Dica: você precisará criar uma função para testar se é uma letra é vogal. Faça o resultado ser (a) uma lista de \texttt{TRUE/FALSE} e (b) um vetor de \texttt{TRUE/FALSE}.

\textbf{3} Faça uma função que divida um número por 2 se ele for par ou multiplique ele por 2 caso seja ímpar. Utilize uma função \texttt{map} para aplicar essa função ao vetor \texttt{1:100}. O resultado do código deve ser um vetor numérico.

\textbf{4.} Use a função \texttt{map()} para criar gráficos de dispersão da receita vs orçamento para os filmes da base \texttt{imdb}. Os filmes de cada ano deverão compor um gráfico diferente. Faça o resultado ser (a) uma lista de gráficos e (b) uma nova coluna na base \texttt{imdb} (utilizando a função \texttt{tidyr::nest()}).

\textbf{5.} Utilize a função \texttt{walk} para salvar cada ano da base \texttt{imdb} em um arquivo \texttt{.rds} diferente, isto é, o arquivo \texttt{imdb\_2001.rds}, por exemplo, deve conter apenas filmes do ano de 2001.

\hypertarget{ravancado}{%
\chapter{R avançado}\label{ravancado}}

Neste capítulo, abordaremos alguns assuntos avançados, porém muito úteis no dia-a-dia de quem faz Ciência de Dados no R.

\hypertarget{nse}{%
\section{NSE}\label{nse}}

Se o \texttt{\{tidyverse\}} é o conjunto mais incrível de pacotes, faz sentido querermos criar nossos pacotes e fazer nossas análises usando seus princípios. Funções cujo primeiro argumento é um \emph{data frame} e operações ``pipeáveis'' são apenas o começo.

Uma das características mais marcantes do \texttt{\{tidyverse\}} é a possibilidade de trabalhar com colunas como se elas fossem objetos comuns, criados fora da função. Basta pensar na \texttt{mutate()}: como ela sabe que \texttt{mpg} é uma coluna da tabela e não um objeto externo com o mesmo nome?

Existe uma ferramenta especial (e exclusiva ao R!) que nos permite fazer esse tipo de mágica: a \emph{non-standard evaluation} (NSE) ou, em português, a avaliação não-padrão. Usamos NSE desde a primeira vez que escrevemos o comando \texttt{library()}, mas o seu funcionamento ainda é um mistério para a maioria.

Para criar funções flexíveis e exutas como as do \texttt{\{tidyverse\}}, é necessário entender o básico da NSE e de como trabalhar com alguns operadores desse novo mundo.

\hypertarget{o-que-uxe9}{%
\subsection{O que é?}\label{o-que-uxe9}}

\emph{Non-standard evaluation} é uma propriedade do R que permite capturar o seu código sem avaliá-lo. Isso mesmo: o R deixa de ser uma caixa para a qual nós enviamos comandos a serem executados e passa a ter a capacidade de \textbf{interpretar e trabalhar} os próprios comandos. Genericamente isso se chama \textbf{metaprogramação}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objeto \textquotesingle{}dplyr\textquotesingle{} simplesmente não existe...}
\NormalTok{dplyr}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in eval(expr, envir, enclos): object 'dplyr' not found
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Por que então esse comando funciona?}
\FunctionTok{library}\NormalTok{(dplyr)}
\end{Highlighting}
\end{Shaded}

Na chamada \texttt{library()} acima, a palavra ``dplyr'' não se refere a nenhum objeto! O R consegue ler o código que nós escrevemos e agir em cima dessa informação. Apesar de ser comum para nós, outras linguagens são incapazes de fazer isso por causa da forma com que elas tratam seus argumentos.

O R tem o que chamamos de avaliação tardia (\emph{delayed evaluation}), ou seja, uma expressão só é avaliada quando ela é necessária e não logo que ela é criada. No R, \texttt{print(1\ +\ 2)} é diferente de \texttt{print(3)}, mas nas outras linguagens isso não é o caso!

\hypertarget{tidy-evaluation}{%
\subsection{Tidy evaluation}\label{tidy-evaluation}}

A faceta da NSE que nos interessa no momento é a chamada \emph{tidy evaluation}, ou \textbf{tidy eval}, a avaliação não-padrão utilizada pelas funções do \texttt{\{tidyverse\}} e outros pacotes feitos para trabalhar com o mesmo paradigma.

\begin{itemize}
\tightlist
\item
  O mundo sem tidy eval é extremamente verborrágico, pois a tabela precisa ser especificada toda vez que nos referirmos a uma coluna:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{starwars[starwars}\SpecialCharTok{$}\NormalTok{homeworld }\SpecialCharTok{==} \StringTok{"Naboo"} \SpecialCharTok{\&}\NormalTok{ starwars}\SpecialCharTok{$}\NormalTok{species }\SpecialCharTok{==} \StringTok{"Human"}\NormalTok{, ,]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  Para não precisar do \texttt{\$}, a nossa única saída é criar objetos com as colunas:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{homeworld }\OtherTok{\textless{}{-}}\NormalTok{ starwars}\SpecialCharTok{$}\NormalTok{homeworld; species }\OtherTok{\textless{}{-}}\NormalTok{ starwars}\SpecialCharTok{$}\NormalTok{species}
\NormalTok{starwars[homeworld }\SpecialCharTok{==} \StringTok{"Naboo"} \SpecialCharTok{\&}\NormalTok{ species }\SpecialCharTok{==} \StringTok{"Human"}\NormalTok{, ,]}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  O \texttt{\{tidyverse\}} permite criar um ``mini ambiente'' em que as colunas da tabela estão disponíveis como se fossem objetos declarados explicitamente:
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{filter}\NormalTok{(starwars, homeworld }\SpecialCharTok{==} \StringTok{"Naboo"}\NormalTok{, species }\SpecialCharTok{==} \StringTok{"Human"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

O problema de capturar o código sem avaliá-lo é que fica difícil avaliar algo antes que ele seja capturado.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O código \textquotesingle{}birth\_year\textquotesingle{} é capturado}
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(birth\_year)) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 44
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objetivo é filtrar uma coluna especificada pelo usuário}
\NormalTok{filter\_na }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, col) \{}
  \FunctionTok{filter}\NormalTok{(df, }\FunctionTok{is.na}\NormalTok{(col))}
\NormalTok{\}}

\CommentTok{\# A função captura o código \textquotesingle{}col\textquotesingle{}}
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter\_na}\NormalTok{(}\AttributeTok{col =}\NormalTok{ birth\_year) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error: Problem with `filter()` input `..1`.
## i Input `..1` is `is.na(col)`.
## x object 'birth_year' not found
\end{verbatim}

\hypertarget{curly-curly}{%
\subsection{Curly-curly}\label{curly-curly}}

O operador que vai resolver nosso problema é o \texttt{\{\{\ \}\}} (lê-se \emph{curly curly}), que permite interpolar o código, ou seja, avaliá-lo antes da captura.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objetivo é filtrar uma coluna especificada pelo usuário}
\NormalTok{filter\_na }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, col) \{}
  \FunctionTok{filter}\NormalTok{(df, }\FunctionTok{is.na}\NormalTok{( \{\{col\}\} ))}
\NormalTok{\}}

\CommentTok{\# Agora a função captura o código \textquotesingle{}birth\_year\textquotesingle{}}
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter\_na}\NormalTok{(}\AttributeTok{col =}\NormalTok{ birth\_year) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{nrow}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 44
\end{verbatim}

Essa sintaxe vem da interpolação de strings:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{col }\OtherTok{\textless{}{-}} \StringTok{"birth\_year"}
\NormalTok{stringr}\SpecialCharTok{::}\FunctionTok{str\_glue}\NormalTok{(}\StringTok{"Interpolando \textquotesingle{}\{col\}\textquotesingle{}!"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Interpolando 'birth_year'!
\end{verbatim}

Para passar múltiplos argumentos nem é necessário usar o curly-curly já que a reticência já possui as capacidades de tidy eval:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objetivo é permitir vários cálculos}
\NormalTok{summarise\_by }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, ..., by) \{}
\NormalTok{  df }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{group\_by}\NormalTok{( \{\{by\}\} ) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{summarise}\NormalTok{(...)}
\NormalTok{\}}
  
\NormalTok{starwars }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise\_by}\NormalTok{(}
    \AttributeTok{media =} \FunctionTok{mean}\NormalTok{(height, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{maximo =} \FunctionTok{max}\NormalTok{(height, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{by =}\NormalTok{ gender}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

Note como não houve necessidade de interpolar \texttt{media} e \texttt{maximo}: a
\texttt{summarise()} não tentou criar uma coluna chamada \texttt{...}.

\hypertarget{strings-como-argumentos}{%
\subsection{Strings como argumentos}\label{strings-como-argumentos}}

E se quisermos passar strings para as funções do \texttt{\{tidyverse\}}? Se pedirmos o nome de uma coluna para um usuário, a resposta virá como string.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objetivo é dar um nome para a média}
\NormalTok{summarise\_mean }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, nome, col) \{}
  \FunctionTok{summarise}\NormalTok{(df, }\AttributeTok{nome =} \FunctionTok{mean}\NormalTok{(col, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{\}}

\CommentTok{\# É criada uma coluna \textquotesingle{}nome\textquotesingle{} sem valor (\textquotesingle{}col\textquotesingle{} não existe)}
\FunctionTok{summarise\_mean}\NormalTok{(starwars, }\StringTok{"media"}\NormalTok{, }\StringTok{"height"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in mean.default(col, na.rm = TRUE): argument is not numeric or logical:
## returning NA
\end{verbatim}

\begin{verbatim}
## # A tibble: 1 x 1
##    nome
##   <dbl>
## 1    NA
\end{verbatim}

Quando o ``lado esquerdo'' (\textbf{antes de um igual}) de uma expressão com tidy eval é uma string (ou se tornará uma quando avaliado), precisamos apenas usar o operador \texttt{:=} (lê-se \emph{walrus}, ``morsa''):

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objetivo é dar um nome para a média}
\NormalTok{summarise\_mean }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, nome, col) \{}
  \FunctionTok{summarise}\NormalTok{(df, \{\{nome\}\} }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{mean}\NormalTok{(col, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{\}}

\CommentTok{\# É criada uma coluna \textquotesingle{}media\textquotesingle{} sem valor (\textquotesingle{}col\textquotesingle{} não existe)}
\FunctionTok{summarise\_mean}\NormalTok{(starwars, }\StringTok{"media"}\NormalTok{, }\StringTok{"height"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning in mean.default(col, na.rm = TRUE): argument is not numeric or logical:
## returning NA
\end{verbatim}

\begin{verbatim}
## # A tibble: 1 x 1
##   media
##   <dbl>
## 1    NA
\end{verbatim}

Quando uma string (ou algo que se tornará uma quando avaliado) está no ``lado direito'' (\textbf{depois de um igual ou quando não há igual}) de uma expressão com tidy eval, precisamos apenas usar o pronome \texttt{.data}:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# O objetivo é dar um nome para a média}
\NormalTok{summarise\_mean }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(df, nome, col) \{}
  \FunctionTok{summarise}\NormalTok{(df, \{\{nome\}\} }\SpecialCharTok{:}\ErrorTok{=} \FunctionTok{mean}\NormalTok{(.data[[col]], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{\}}

\CommentTok{\# É criada uma coluna \textquotesingle{}media\textquotesingle{} com a média de \textquotesingle{}height\textquotesingle{}}
\FunctionTok{summarise\_mean}\NormalTok{(starwars, }\StringTok{"media"}\NormalTok{, }\StringTok{"height"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   media
##   <dbl>
## 1  174.
\end{verbatim}

É como se estivéssemos chamando \texttt{df{[}{[}"height"{]}{]}}, mas, como \texttt{df} não faria sentido dentro da expressão, usamos \texttt{.data}.

\hypertarget{exercuxedcios-24}{%
\subsection{Exercícios}\label{exercuxedcios-24}}

\textbf{1.} Escreva uma função que recebe uma \emph{tibble} e uma coluna qualquer
e devolve uma \emph{tibble} sem as linhas contendo \texttt{NA} na coluna especificada.

\textbf{2.} Escreva uma função que recebe uma \emph{tibble} e uma coluna e faz um gráfico de barras da frequência dessa coluna.

\textbf{3.} Escreva uma função que recebe uma \emph{tibble} e o nome de duas colunas numéricas e faz um gráfico de dispersão dessas colunas.

\textbf{4.} Escreva uma função que recebe uma \emph{tibble}, o nome de uma coluna categótica e o nome de uma coluna numérica e devolva uma tabela com a média da coluna numérica para cada categoria da coluna categórica.

\hypertarget{misc}{%
\chapter{Miscelânea}\label{misc}}

\hypertarget{arrumando-banco-de-dados-o-pacote-janitor}{%
\section{Arrumando banco de dados: o pacote janitor}\label{arrumando-banco-de-dados-o-pacote-janitor}}

O pacote \href{https://garthtarr.github.io/meatR/janitor.html}{\texttt{janitor}} disponibiliza algumas funções para limpar bases de dados.

Primeiramente, instale e carregue o pacote:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{install.packages}\NormalTok{(}\StringTok{"janitor"}\NormalTok{) }\CommentTok{\# Instale a versão do CRAN, OU:}

\NormalTok{devtools}\SpecialCharTok{::}\FunctionTok{install\_github}\NormalTok{(}\StringTok{"sfirke/janitor"}\NormalTok{) }\CommentTok{\# Versão de desenvolvimento}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(tidyverse)}
\FunctionTok{library}\NormalTok{(janitor)}
\end{Highlighting}
\end{Shaded}

\hypertarget{arrumando-o-nome-das-variuxe1veis}{%
\subsection{Arrumando o nome das variáveis}\label{arrumando-o-nome-das-variuxe1veis}}

Utilizaremos a base com informações de pacientes com arritmia cardíaca. O código para obter essa base de exemplo está descrito abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# URL da base para baixar}
\NormalTok{url }\OtherTok{\textless{}{-}} \StringTok{"https://github.com/curso{-}r/livro{-}material/raw/master/assets/data/dados\_nomes\_variaveis\_livro.xlsx"}

\CommentTok{\# Arquivo de destino onde a base deverá ser salva}
\NormalTok{destfile }\OtherTok{\textless{}{-}} \StringTok{"dados\_nomes\_variaveis\_livro.xlsx"}

\CommentTok{\# Fazer o download da base}
\NormalTok{curl}\SpecialCharTok{::}\FunctionTok{curl\_download}\NormalTok{(url, destfile)}

\CommentTok{\# Importar a base }
\NormalTok{dados\_brutos }\OtherTok{\textless{}{-}}\NormalTok{ readxl}\SpecialCharTok{::}\FunctionTok{read\_excel}\NormalTok{(destfile)}
\end{Highlighting}
\end{Shaded}

As variáveis presentes na base são:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_brutos }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{names}\NormalTok{() }\CommentTok{\# Ver o nome das variáveis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "ID"                   "Sexo"                 "Nascimento"          
##  [4] "Idade"                "Inclusão"             "Cor"                 
##  [7] "Peso"                 "Altura"               "cintura"             
## [10] "IMC"                  "Superfície corporal"  "Tabagismo"           
## [13] "cg.tabag (cig/dia)"   "Alcool (dose/semana)" "Drogas ilícitas"     
## [16] "Cafeína/dia"          "Refrig/dia"           "Sedentario"          
## [19] "ativ. Fisica"
\end{verbatim}

Os nomes das variáveis contém letras maiúsculas, acentos, parênteses, pontos e barras, o que atrapalha na hora da programação. Para resolver esse problema, usamos a função \texttt{clean\_names()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_brutos }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{clean\_names}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# Limpar os nomes das variáveis}
  \FunctionTok{names}\NormalTok{() }\CommentTok{\# Ver o nome das variáveis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "id"                  "sexo"                "nascimento"         
##  [4] "idade"               "inclusao"            "cor"                
##  [7] "peso"                "altura"              "cintura"            
## [10] "imc"                 "superficie_corporal" "tabagismo"          
## [13] "cg_tabag_cig_dia"    "alcool_dose_semana"  "drogas_ilicitas"    
## [16] "cafeina_dia"         "refrig_dia"          "sedentario"         
## [19] "ativ_fisica"
\end{verbatim}

Veja que a função removeu os parênteses, pontos e barras e substituiu os espaços por \texttt{\_}.

E para substituir na base, precisamos atribuir o resultado em um novo objeto:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados }\OtherTok{\textless{}{-}}\NormalTok{ dados\_brutos }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{clean\_names}\NormalTok{() }\CommentTok{\# Limpar os nomes das variáveis}
\end{Highlighting}
\end{Shaded}

\hypertarget{removendo-linhas-e-colunas-vazias}{%
\subsection{Removendo linhas e colunas vazias}\label{removendo-linhas-e-colunas-vazias}}

Esse banco de dados também contém outro problema: linhas vazias. Na verdade, elas não eram completamente vazias, pois havia algumas informações de identificação da(o) paciente, mas nenhuma outra variável tinha sido computada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{slice}\NormalTok{(}\DecValTok{3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} \CommentTok{\# Apresentar apenas a linha 3}
\NormalTok{  knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|l|l|r|l|l|r|r|l|r|l|l|r|r|l|r|r|l|l}
\hline
id & sexo & nascimento & idade & inclusao & cor & peso & altura & cintura & imc & superficie\_corporal & tabagismo & cg\_tabag\_cig\_dia & alcool\_dose\_semana & drogas\_ilicitas & cafeina\_dia & refrig\_dia & sedentario & ativ\_fisica\\
\hline
3 & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA & NA\\
\hline
\end{tabular}

Para resolver o problema, é possível utilizar a função \texttt{remove\_empty()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_sem\_linhas\_vazias }\OtherTok{\textless{}{-}}\NormalTok{ dados }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{as.data.frame}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{id) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{remove\_empty}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{rowid\_to\_column}\NormalTok{(}\StringTok{"id"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(id, }\FunctionTok{everything}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{()}

\NormalTok{dados\_sem\_linhas\_vazias }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|l|l|r|l|l|r|r|l|r|l|l|r|r|l|r|r|l|l}
\hline
id & sexo & nascimento & idade & inclusao & cor & peso & altura & cintura & imc & superficie\_corporal & tabagismo & cg\_tabag\_cig\_dia & alcool\_dose\_semana & drogas\_ilicitas & cafeina\_dia & refrig\_dia & sedentario & ativ\_fisica\\
\hline
1 & F & 1964-01-31 & 41 & 2006-02-17 & branca & 75 & 1.63 & 98 & 28.22839 & 1.81 & N & 0 & 0 & N & 100 & 0 & S & N\\
\hline
2 & M & 1959-01-28 & 45 & 2005-11-29 & negra & 71 & 1.70 & NT & 24.57000 & 1.83 & N & 0 & 35 & N & 50 & 300 & N & insuficiente\\
\hline
3 & M & 1957-09-13 & 50 & 2008-02-13 & NT & 80 & 1.64 & NT & 29.74420 & 1.87 & N & 0 & 0 & N & 500 & 0 & S & N\\
\hline
4 & F & 1938-02-06 & 71 & 2009-06-25 & parda & 56 & 1.51 & 96 & 24.56033 & 1,51 & N & 0 & 0 & N & 50 & 0 & S & N\\
\hline
\end{tabular}

Foi necessário converter para \texttt{data.frame} primeiro porque não é possível definir os nomes das linhas de uma \texttt{tibble}. Se a linha estivesse completamente vazia, bastaria usar diretamente a função \texttt{remove\_empty\_rows()}.

Equivalentemente para colunas, existe a função \texttt{remove\_empty\_cols()}.

Outra forma de realizar este mesmo procedimento é utilizando a função \texttt{drop\_na()} do pacote \texttt{tidyr}:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados\_sem\_linhas\_vazias }\OtherTok{\textless{}{-}}\NormalTok{ dados }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tidyr}\SpecialCharTok{::}\FunctionTok{drop\_na}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{id) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{select}\NormalTok{(}\SpecialCharTok{{-}}\NormalTok{id) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{rowid\_to\_column}\NormalTok{(}\StringTok{"id"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{relocate}\NormalTok{(id, }\AttributeTok{.before =}\NormalTok{ sexo)}

\NormalTok{dados\_sem\_linhas\_vazias }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ knitr}\SpecialCharTok{::}\FunctionTok{kable}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{tabular}{r|l|l|r|l|l|r|r|l|r|l|l|r|r|l|r|r|l|l}
\hline
id & sexo & nascimento & idade & inclusao & cor & peso & altura & cintura & imc & superficie\_corporal & tabagismo & cg\_tabag\_cig\_dia & alcool\_dose\_semana & drogas\_ilicitas & cafeina\_dia & refrig\_dia & sedentario & ativ\_fisica\\
\hline
1 & F & 1964-01-31 & 41 & 2006-02-17 & branca & 75 & 1.63 & 98 & 28.22839 & 1.81 & N & 0 & 0 & N & 100 & 0 & S & N\\
\hline
2 & M & 1959-01-28 & 45 & 2005-11-29 & negra & 71 & 1.70 & NT & 24.57000 & 1.83 & N & 0 & 35 & N & 50 & 300 & N & insuficiente\\
\hline
3 & M & 1957-09-13 & 50 & 2008-02-13 & NT & 80 & 1.64 & NT & 29.74420 & 1.87 & N & 0 & 0 & N & 500 & 0 & S & N\\
\hline
4 & F & 1938-02-06 & 71 & 2009-06-25 & parda & 56 & 1.51 & 96 & 24.56033 & 1,51 & N & 0 & 0 & N & 50 & 0 & S & N\\
\hline
\end{tabular}

\hypertarget{identificando-linhas-duplicadas}{%
\subsection{Identificando linhas duplicadas}\label{identificando-linhas-duplicadas}}

O pacote \texttt{janitor} possui uma função para identificar entradas duplicadas numa base de dados: \texttt{get\_dupes()}. Vamos criar uma base genérica para testá-la.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Criar a base de exemplo}
\NormalTok{p\_nome }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Athos"}\NormalTok{, }\StringTok{"Daniel"}\NormalTok{, }\StringTok{"Fernando"}\NormalTok{, }\StringTok{"Julio"}\NormalTok{, }\StringTok{"William"}\NormalTok{)}
\NormalTok{sobrenome }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"Damiani"}\NormalTok{, }\StringTok{"Falbel"}\NormalTok{, }\StringTok{"Corrêa"}\NormalTok{, }\StringTok{"Trecenti"}\NormalTok{, }\StringTok{"Amorim"}\NormalTok{)}

\NormalTok{base\_exemplo }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{nome =} \FunctionTok{sample}\NormalTok{(p\_nome, }\DecValTok{25}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{sobrenome =} \FunctionTok{sample}\NormalTok{(sobrenome, }\DecValTok{25}\NormalTok{, }\AttributeTok{replace =} \ConstantTok{TRUE}\NormalTok{),}
  \AttributeTok{variavel\_importante =} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{25}\NormalTok{)}
\NormalTok{)}
\CommentTok{\# Dar uma espiada na base de exemplo}
\NormalTok{dplyr}\SpecialCharTok{::}\FunctionTok{glimpse}\NormalTok{(base\_exemplo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 25
## Columns: 3
## $ nome                <chr> "Julio", "Athos", "William", "Athos", "Fernando", ~
## $ sobrenome           <chr> "Amorim", "Falbel", "Trecenti", "Corrêa", "Damiani~
## $ variavel_importante <dbl> 1.03090446, 2.05103806, -1.15686279, 0.77013281, 0~
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Ver as duplicatas com a função get\_dupes()}
\NormalTok{janitor}\SpecialCharTok{::}\FunctionTok{get\_dupes}\NormalTok{(base\_exemplo, nome, sobrenome)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 13 x 4
##    nome     sobrenome dupe_count variavel_importante
##    <chr>    <chr>          <int>               <dbl>
##  1 Athos    Falbel             2              2.05  
##  2 Athos    Falbel             2             -1.09  
##  3 Athos    Trecenti           2             -0.306 
##  4 Athos    Trecenti           2             -0.698 
##  5 Daniel   Damiani            3              0.651 
##  6 Daniel   Damiani            3             -0.322 
##  7 Daniel   Damiani            3              0.148 
##  8 Fernando Damiani            2              0.253 
##  9 Fernando Damiani            2              0.451 
## 10 Julio    Amorim             2              1.03  
## 11 Julio    Amorim             2             -0.0404
## 12 William  Corrêa             2              1.23  
## 13 William  Corrêa             2             -0.636
\end{verbatim}

Todas as linhas na \texttt{tibble} resultante representam uma combinação de nome-sobrenome repetida.

\hypertarget{outras-funuxe7uxf5es}{%
\subsection{Outras funções}\label{outras-funuxe7uxf5es}}

Por fim, o \texttt{janitor} também tem funções equivalentes à \texttt{table()} para produzir tabelas de frequência:

\begin{itemize}
\tightlist
\item
  \texttt{tabyl()} - similar a \texttt{table()}, mas pipe-ável e com mais recursos.
\item
  \texttt{adorn\_totals()} - acrescenta o total das linhas ou colunas.
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fazer uma tabela de frequência}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ janitor}\SpecialCharTok{::}\FunctionTok{tabyl}\NormalTok{(cyl)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  cyl  n percent
##    4 11 0.34375
##    6  7 0.21875
##    8 14 0.43750
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fazer uma tabela de frequência com valores totais,}
\CommentTok{\# e porcentagem}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{tabyl}\NormalTok{(cyl) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{adorn\_totals}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    cyl  n percent
##      4 11 0.34375
##      6  7 0.21875
##      8 14 0.43750
##  Total 32 1.00000
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Fazer uma tabela de frequência com duas variáveis,}
\CommentTok{\# e valores totais}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{tabyl}\NormalTok{(cyl, am) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  janitor}\SpecialCharTok{::}\FunctionTok{adorn\_totals}\NormalTok{(}\AttributeTok{where =} \StringTok{"col"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  cyl  0 1 Total
##    4  3 8    11
##    6  4 3     7
##    8 12 2    14
\end{verbatim}

Esperamos que essas dicas e o pacote \texttt{janitor} ajudem a agilizar as suas análises!

\hypertarget{respostas}{%
\chapter{Respostas}\label{respostas}}

Não há apenas uma maneira de resolver os exercícios. Você pode encontrar soluções diferentes das nossas, algumas vezes mais práticas e eficientes, outras vezes menos. Quando estiver fazendo suas análises, tente buscar o equilíbrio entre eficiência e pragmatismo. Economizar 1 hora com a execução do código pode não valer a pena se você demorou 2 horas a mais para programá-lo.

\hypertarget{r-buxe1sico}{%
\section{R básico}\label{r-buxe1sico}}

\hypertarget{r-como-calculadora-1}{%
\subsection*{R como calculadora}\label{r-como-calculadora-1}}
\addcontentsline{toc}{subsection}{R como calculadora}

\textbf{1.} Qual a diferença entre o R e o RStudio?

\emph{O R é uma linguagem de programação e um programa que instalamos no nosso computador para interpretar código em linguagem R. O RStudio é um ambiente de desenvolvimento para programação em R, isto é, é um programa que nos ajuda a trabalhar com a linguagem R.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Podemos usar o RStudio sem o R? E o R sem o RStudio?

\emph{Não podemos usar o RStudio sem o R, pois o programa R é que interpreta os nossos códigos e devolve os resultados. Por outro lado, podemos usar o R sem o RStudio (ou qualquer outro ambiente de desenvolvimento), mas a nossa vida de pessoa programadora se torna muito mais difícil.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Precisamos compilar nossos códigos de R?

\emph{Não. Um código em R é interpretado linha a linha, isto é, podemos ir rodando nosso código parcialmente, conforme vamos escrevendo.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Calcule o número de ouro no R. Dica: o número de ouro é dado pela expressão \(\frac{1 + \sqrt{5}}{2}\).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DecValTok{1} \SpecialCharTok{+} \DecValTok{5}\SpecialCharTok{\^{}}\NormalTok{(}\DecValTok{1} \SpecialCharTok{/} \DecValTok{2}\NormalTok{))}\SpecialCharTok{/}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.618034
\end{verbatim}

\emph{Também poderia ser resolvido usando a função \texttt{sqrt()} para calcular a raiz quadrada.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(}\DecValTok{1} \SpecialCharTok{+} \FunctionTok{sqrt}\NormalTok{(}\DecValTok{5}\NormalTok{))}\SpecialCharTok{/}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.618034
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Por que é preferível escrevermos sempre o nosso código no \emph{script} e não no \emph{Console}?

\emph{Porque o código é a documentação da nossa análise. Se parte da análise for feita diretamente no Console, parte da documentação será perdida.}

\hypertarget{objetos-e-funuxe7uxf5es}{%
\subsection*{Objetos e funções}\label{objetos-e-funuxe7uxf5es}}
\addcontentsline{toc}{subsection}{Objetos e funções}

\textbf{1.} Qual a diferença entre os códigos abaixo?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Código 1}
\DecValTok{33} \SpecialCharTok{/} \DecValTok{11}

\CommentTok{\# Código 2}
\NormalTok{divisao }\OtherTok{\textless{}{-}} \DecValTok{33} \SpecialCharTok{/} \DecValTok{11}
\end{Highlighting}
\end{Shaded}

\emph{O primeiro código calcula a divisão de 33 por 11 e devolve o resultado na tela. O segundo código faz o mesmo cálculo, mas guardo o resultado no objeto \texttt{divisao}, isto é, o resultado não é retornado na tela.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Multiplique a sua idade por meses e salve o resultado em um objeto chamado \texttt{idade\_em\_meses}. Em seguida, multiplique esse objeto por 30 e salve o resultado em um objeto chamado \texttt{idade\_em\_dias}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{idade\_em\_meses }\OtherTok{\textless{}{-}} \DecValTok{31} \SpecialCharTok{*} \DecValTok{12}

\NormalTok{idade\_em\_dias }\OtherTok{\textless{}{-}}\NormalTok{ idade\_em\_meses }\SpecialCharTok{*} \DecValTok{30}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Por que o nome \texttt{meu-objeto} não pode ser utilizado para criar um objeto? O que significa a mensagem de erro resultante?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{meu}\SpecialCharTok{{-}}\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in meu - objeto <- 1: object 'meu' not found
\end{verbatim}

\emph{Porque o sinal \texttt{-} é utilizado pelo R como o operador de subtração. O código acima está sendo interpretado como a subtração dos objetos \texttt{meu} e \texttt{objeto}. Como nenhum dos objetos existe na sessão, é devolvido um erro dizendo que o objeto \texttt{meu} (o primeiro deles) não foi encontrado.}

\emph{No entanto, mesmo que os objetos existissem, seria retornado um erro. Neste caso, seria um erro de sintaxe, pois o R não sabe como interpretar a atribuição do valor \texttt{3} à operação \texttt{meu\ -\ objeto}. Veja que a mensagem de erro não é muito intuitiva, pois o R entende que \texttt{-\textless{}-} é uma função que esquecemos de definir.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{meu }\OtherTok{\textless{}{-}} \DecValTok{1}
\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{2}
\NormalTok{meu}\SpecialCharTok{{-}}\NormalTok{objeto }\OtherTok{\textless{}{-}} \DecValTok{1}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in meu - objeto <- 1: could not find function "-<-"
\end{verbatim}

\hypertarget{classes-1}{%
\subsection*{Classes}\label{classes-1}}
\addcontentsline{toc}{subsection}{Classes}

\textbf{1.} Guarde em um objeto chamado \texttt{nome} uma \emph{string} contendo o seu nome completo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nome }\OtherTok{\textless{}{-}} \StringTok{"William Nilson de Amorim"}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Guarde em um objeto chamado \texttt{cidade} o nome da cidade onde você mora. Em seguida, guarde em um objeto chamado \texttt{estado} o nome do estado onde você mora. Usando esses objetos, resolva os itens abaixo:

\textbf{a.} Utilize a função \texttt{nchar()} para contar o número de caracteres em cada cada string.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cidade }\OtherTok{\textless{}{-}} \StringTok{"São Paulo"}
\NormalTok{estado }\OtherTok{\textless{}{-}} \StringTok{"SP"}

\FunctionTok{nchar}\NormalTok{(cidade)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nchar}\NormalTok{(estado)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\textbf{b.} Interprete o resultado do seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, estado)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo SP"
\end{verbatim}

\emph{A função \texttt{paste} juntou (colou) as duas strings, uma do lado da outra, separando-as por um espaço. O resultado gerado foi uma única string.}

\textbf{c.} Interprete o resultado do seguinte código:

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, estado, }\AttributeTok{sep =} \StringTok{" {-} "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo - SP"
\end{verbatim}

\emph{O argumento \texttt{sep} da função \texttt{paste()} nos permite escolher qual caracter será utilizado para separar as duas strings. Por padrão será utilizado um espaço em branco \texttt{"\ "}. No exemplo, foi utilizado um espaço, seguido de um traço, seguido de outro espaço. Sem os espaços o resultado seria:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, estado, }\AttributeTok{sep =} \StringTok{"{-}"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo-SP"
\end{verbatim}

\emph{Veja que qualquer caracter ou string pode ser utilizada como separador:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, estado, }\AttributeTok{sep =} \StringTok{" \#tricolor "}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo #tricolor SP"
\end{verbatim}

\textbf{d.} Desafio. Como você reproduziria o mesmo resultado do item (c) sem utilizar o argumento \texttt{sep}?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, }\StringTok{"{-}"}\NormalTok{, estado)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo - SP"
\end{verbatim}

\textbf{e.} Qual a diferença entre as funções \texttt{paste()} e \texttt{paste0()}?

\emph{A função \texttt{paste0()} é equivalente à função \texttt{paste()} com o argumento \texttt{sep\ =\ ""}.}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, }\StringTok{"{-}"}\NormalTok{, estado)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo - SP"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(cidade, }\StringTok{"{-}"}\NormalTok{, estado, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo-SP"
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste0}\NormalTok{(cidade, }\StringTok{"{-}"}\NormalTok{, estado)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "São Paulo-SP"
\end{verbatim}

\hypertarget{vetores-1}{%
\subsection*{Vetores}\label{vetores-1}}
\addcontentsline{toc}{subsection}{Vetores}

\textbf{1.} Guarde em um objeto a sequência de números de 0 a 5 e resolva os itens abaixos.

\textbf{a.} Use subsetting para fazer o R devolver o primeiro número dessa sequência. Em seguida, faça o R devolver o último número da sequência.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{:}\DecValTok{5}

\CommentTok{\# Primeiro elemento}
\NormalTok{vetor[}\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Último elemento}
\NormalTok{vetor[}\DecValTok{6}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\textbf{b.} Multiplique todos os valores do vetor por -1. Guarde o resultado em
um novo objeto chamado \texttt{vetor\_negativo}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor\_negativo }\OtherTok{\textless{}{-}}\NormalTok{ vetor }\SpecialCharTok{*} \SpecialCharTok{{-}}\DecValTok{1}
\NormalTok{vetor\_negativo}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  0 -1 -2 -3 -4 -5
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Crie um vetor com o nome de tres frutas, guarde em um objeto chamado \texttt{frutas} e resolva os itens abaixo.

\textbf{a.} Utilize a a função \texttt{length()} para verificar o tamanho do vetor.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{frutas }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"banana"}\NormalTok{, }\StringTok{"maçã"}\NormalTok{, }\StringTok{"mamão"}\NormalTok{)}

\FunctionTok{length}\NormalTok{(frutas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3
\end{verbatim}

\textbf{b.} Inspecione a saída de \texttt{paste("eu\ gosto\ de",\ frutas)} e responda se o tamanho do vetor mudou.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{paste}\NormalTok{(}\StringTok{"eu gosto de"}\NormalTok{, frutas)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "eu gosto de banana" "eu gosto de maçã"   "eu gosto de mamão"
\end{verbatim}

\emph{O tamanho do vetor não muda. O que aconteceu foi o acréscimo do prefixo ``eu gosto de'' a cada valor do vetor \texttt{frutas}. Podemos confirmar essa afirmação calculando o comprimento do novo vetor:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(}\FunctionTok{paste}\NormalTok{(}\StringTok{"eu gosto de"}\NormalTok{, frutas))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 3
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} O que é reciclagem? Escreva um código em R que exemplifique esse comportamento.

\emph{Reciclagem é a repetição de valores de um vetor para que uma operação com vetores de tamanhos diferentes possa ser realizada. Embora pareça um comportamento estranho, utilizamos a reciclagem o tempo todo dentro do R, muitas vezes sem perceber. No exemplo a seguir, os valores do \texttt{vetor\_menor} serão repetidos (reciclados) até o dois vetores terem o mesmo tamanho. Então, o primeiro valor do vetor menor será somado com o promeiro valor do vetor maior, o segundo do menor somado com o segundo do maior e assim por diante.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Exemplo}
\NormalTok{vetor\_menor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{)}
\NormalTok{vetor\_maior }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{4}\NormalTok{)}

\NormalTok{vetor\_menor }\SpecialCharTok{+}\NormalTok{ vetor\_maior}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2 5 4 7
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} O que é coerção? Escreva um código em R que exemplifique esse comportamento.

\emph{Coerção é a homogenização da classe dos valores de um vetor. Se construirmos um vetor com valores de classes diferentes, todos os valores serão reprimidos para a classe mais dominante entre eles. No exemplo abaixo, todos os valores do vetor foram transformados em \texttt{character}, pois \texttt{character} é mais dominante do que as demais classes presentes (\texttt{numeric} e \texttt{logical}).}

\emph{Considerando apenas as principais classes, temos a seguinte ordem de dominância: \texttt{character\ \textgreater{}\ numeric\ \textgreater{}\ integer\ \textgreater{}\ logical}}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{3}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "1"    "-3"   "a"    "TRUE"
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Por que a coerção pode ser um problema na hora de importarmos bases de dados para o R?

\emph{Porque as colunas podem acabar sendo importadas com uma classe diferente daquela que estamos esperando e nenhum erro ou warning será devolvido. Por exemplo, se uma coluna da base que deveria ser numérica tiver, por algum descuido, qualquer tipo de caracter não numérico (texto), toda a coluna será importada como texto.}

\emph{O caso mais comum desse problema é gerado pelo separador de decimais. Se não especificarmos corretamente qual é o separador de decimais que estamos utilizando na nossa base de dados na hora da importação, qualquer coluna com valores decimais será importada como texto.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{6.} Use a função \texttt{sum()} para somar os valores de 1 a 100.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5050
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{7.} Considere o vetor booleano a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dolar\_subiu }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{, }\ConstantTok{FALSE}\NormalTok{, }\ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Este vetor tem informação de uma semana (7 dias, começando no domingo) indicando se o dólar subiu (TRUE) ou não subiu (FALSE) no respectivo dia. Interprete o resultado dos códigos abaixo:

\textbf{a.} \texttt{length(dolar\_subiu)}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{length}\NormalTok{(dolar\_subiu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\emph{Devolve o comprimento do vetor \texttt{dolar\_subiu}. Podemos interpretar como o número de dias analisados nesse estudo.}

\textbf{b.} \texttt{dolar\_subiu{[}2{]}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dolar\_subiu[}\DecValTok{2}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\emph{Verifica se o dólar subiu no segundo dia do estudo (segunda-feira).}

\textbf{c.} \texttt{sum(dolar\_subiu)}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(dolar\_subiu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\emph{Verifica o número de dias que o dólar subiu (já que na soma, os valores \texttt{TRUE} viram 1 e os valores \texttt{FALSE} viram 0), no caso, 4 dias com alta do dólar.}

\textbf{d.} \texttt{mean(dolar\_subiu)}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(dolar\_subiu)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0.5714286
\end{verbatim}

\emph{Verifica a proporção de dias em que o dólar subiu (a média de valores 0 e 1 é igual a proporção de valores 1), no caso, cerca de 57\% dos dias.}

\hypertarget{testes-luxf3gicos-1}{%
\subsection*{Testes lógicos}\label{testes-luxf3gicos-1}}
\addcontentsline{toc}{subsection}{Testes lógicos}

\textbf{1.} O código abaixo vai guardar no objeto \texttt{segredo} um número inteiro entre 0 e 10. Sem olhar qual número foi guardado no objeto, resolva os itens a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(}\FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{min =} \DecValTok{0}\NormalTok{, }\AttributeTok{max =} \DecValTok{10}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{a.} Teste se o segredo é maior ou igual a 0.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\SpecialCharTok{\textgreater{}=} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\textbf{b.} Teste se o segredo é menor ou igual a 10.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\SpecialCharTok{\textless{}=} \DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\textbf{c.} Teste se o segredo é maior que 5.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\SpecialCharTok{\textgreater{}} \DecValTok{5}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\textbf{d.} Teste se o segredo é par.

\emph{Precisamos verificar se o resto da divisão por 2 é igual a zero.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resto da divisão por 2}
\NormalTok{segredo }\SpecialCharTok{\%\%} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Guardando o resultado}
\NormalTok{resto }\OtherTok{\textless{}{-}}\NormalTok{ segredo }\SpecialCharTok{\%\%} \DecValTok{2}

\CommentTok{\# Teste}
\NormalTok{resto }\SpecialCharTok{==} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Equivalentemente poderíamos fazer}
\NormalTok{segredo }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\textbf{e.} Teste se \texttt{segredo\ *\ 5} é maior que a sua idade.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\SpecialCharTok{*} \DecValTok{5} \SpecialCharTok{\textgreater{}} \DecValTok{31}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE
\end{verbatim}

\textbf{f.} Desafio. Escreva um teste para descobrir o valor do segredo.

\emph{Vamos descobrir a posição do segredo no vetor \texttt{0:10}.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numeros\_possiveis }\OtherTok{\textless{}{-}} \DecValTok{0}\SpecialCharTok{:}\DecValTok{10}
\NormalTok{numeros\_possiveis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  0  1  2  3  4  5  6  7  8  9 10
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{segredo }\SpecialCharTok{==}\NormalTok{ numeros\_possiveis}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1]  TRUE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE FALSE
\end{verbatim}

\emph{No código acima, para cada valor de \texttt{numero\_possiveis}, foi testado se esse valor é igual ao segredo. Em caso afirmativo, um TRUE é devolvido. Veja que há apenas um TRUE no vetor resultante. Essa é posição do nosso segredo dentro do vetor \texttt{numeros\_possiveis}.}

\emph{Podemos usar esse vetor de TRUE/FALSE para recuperar o valor do segredo fazendo subsetting.}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Eis o valor do segredo}
\NormalTok{numeros\_possiveis[segredo }\SpecialCharTok{==}\NormalTok{ numeros\_possiveis]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\emph{No código acima, foi retornado apenas o número associado ao valor TRUE dado pelo teste \texttt{segredo\ ==\ numeros\_possiveis}}.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Escreva um código em R que devolva apenas os valores maiores
ou iguais a 10 do vetor abaixo:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{15}\NormalTok{, }\DecValTok{16}\NormalTok{, }\DecValTok{23}\NormalTok{, }\DecValTok{42}\NormalTok{)}

\CommentTok{\# Resposta}
\NormalTok{vetor[vetor }\SpecialCharTok{\textgreater{}=} \DecValTok{10}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 15 16 23 42
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Use o vetor numeross abaixo para responder as questoes seguintes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numeros }\OtherTok{\textless{}{-}} \SpecialCharTok{{-}}\DecValTok{4}\SpecialCharTok{:}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\textbf{a.} Escreva um código que devolva apenas valores positivos do vetor \texttt{numeros}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numeros[numeros }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1 2
\end{verbatim}

\textbf{b.} Escreva um código que devolta apenas os valores pares do vetor \texttt{numeros}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Resto da divisão por 2}
\NormalTok{numeros }\SpecialCharTok{\%\%} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0 1 0 1 0 1 0
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Quais números são pares?}
\NormalTok{numeros }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1]  TRUE FALSE  TRUE FALSE  TRUE FALSE  TRUE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Usando para filtrar o vetor}
\NormalTok{numeros[numeros }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{0}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -4 -2  0  2
\end{verbatim}

\textbf{c.} Filtre o vetor para que retorne apenas aqueles valores que, quando elevados a 2, são menores do que 4.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Quadrado dos valores do vetor}
\NormalTok{numeros}\SpecialCharTok{\^{}}\DecValTok{2}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 16  9  4  1  0  1  4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Aqueles menores que 4}
\NormalTok{numeros}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{\textless{}} \DecValTok{4}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] FALSE FALSE FALSE  TRUE  TRUE  TRUE FALSE
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Usando para filtrar}
\NormalTok{numeros[numeros}\SpecialCharTok{\^{}}\DecValTok{2} \SpecialCharTok{\textless{}} \DecValTok{4}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] -1  0  1
\end{verbatim}

\hypertarget{valores-especiais}{%
\subsection*{Valores especiais}\label{valores-especiais}}
\addcontentsline{toc}{subsection}{Valores especiais}

\textbf{1.} Quais as diferenças entre \texttt{NaN}, \texttt{NULL}, \texttt{NA} e \texttt{Inf}? Digite expressões que retornem cada um desses valores.

\begin{itemize}
\tightlist
\item
  \emph{O \texttt{NaN} representa uma indefinição matemática. Todo \texttt{NaN} é um \texttt{NA}, mas o contrário não é verdade.}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{0}\SpecialCharTok{/}\DecValTok{0}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NaN
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \emph{O \texttt{NA} representa o nosso desconhecimento acerca de um valor. Esse valor existe, mas nós não o conhecemos. Na Estatística, ele é conhecido como valor omisso ou valor faltante.}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\ConstantTok{NA}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] NA
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \emph{O \texttt{NULL} é um valor especial para o R, isto é, ao contrário do NA, ele não tem um significado prático para a análise de dados, mas sim computacional. Ele representa a ausência de um vetor e é útil na construção da lógica de programação de alguns códigos.}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}\SpecialCharTok{$}\NormalTok{coluna\_que\_nao\_existe}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## NULL
\end{verbatim}

\begin{itemize}
\tightlist
\item
  \emph{O \texttt{Inf} representa um número muito grande (que o computador não consegue representar) ou um limite matemático.}
\end{itemize}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2}\SpecialCharTok{\^{}}\DecValTok{2000}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] Inf
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Escreva um código que conte o número de \texttt{NAs} do vetor \texttt{b}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{b }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{0}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{7}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{2}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{10}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{, }\ConstantTok{NA}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(b))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 12
\end{verbatim}

\hypertarget{data-frames-1}{%
\subsection*{Data frames}\label{data-frames-1}}
\addcontentsline{toc}{subsection}{Data frames}

\textbf{1.} Quais códigos abaixo retornam \textbf{um vetor} com a coluna \texttt{mpg} do data frame \texttt{mtcars}?

\textbf{a.} \texttt{mtcars\$mpg}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars}\SpecialCharTok{$}\NormalTok{mpg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4
## [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7
## [31] 15.0 21.4
\end{verbatim}

\emph{Retorna!}

\textbf{b.} \texttt{mtcars{[}\ ,\ 3{]}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[ , }\DecValTok{3}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 160.0 160.0 108.0 258.0 360.0 225.0 360.0 146.7 140.8 167.6 167.6 275.8
## [13] 275.8 275.8 472.0 460.0 440.0  78.7  75.7  71.1 120.1 318.0 304.0 350.0
## [25] 400.0  79.0 120.3  95.1 351.0 145.0 301.0 121.0
\end{verbatim}

\emph{Não retorna. A coluna \texttt{mpg} é a primeira coluna do data frame. A coluna que esse código retornou foi a \texttt{disp}.}

\textbf{c.} \texttt{mtcars("mpg")}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mtcars}\NormalTok{(}\StringTok{"mpg"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in mtcars("mpg"): could not find function "mtcars"
\end{verbatim}

\emph{A sintaxe desse código não é válida pois \texttt{()} não são utilizados para fazer subsetting, mas sim para definir os argumentos de uma função (e \texttt{mtcars} não é uma função).}

\textbf{d.} \texttt{mtcars{[}\ ,\ "mpg"{]}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[ , }\StringTok{"mpg"}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4
## [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7
## [31] 15.0 21.4
\end{verbatim}

``Retorna!''

\textbf{e.} \texttt{mtcars.mpg}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars.mpg}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in eval(expr, envir, enclos): object 'mtcars.mpg' not found
\end{verbatim}

\emph{Essa sintaxe não é válida no R. Ele está procurando por um objeto chamado \texttt{mtcars.mpg}, que não existe.}

\textbf{f.} \texttt{mtcars{[}\ ,\ 1{]}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[ , }\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] 21.0 21.0 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 17.8 16.4 17.3 15.2 10.4
## [16] 10.4 14.7 32.4 30.4 33.9 21.5 15.5 15.2 13.3 19.2 27.3 26.0 30.4 15.8 19.7
## [31] 15.0 21.4
\end{verbatim}

\emph{Retorna!}

\textbf{g.} \texttt{mtcars{[}1,\ 1{]}}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars[}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{]}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 21
\end{verbatim}

\emph{Esse código retorna apenas o primeiro valor da coluna \texttt{mpg}.}

\begin{enumerate}
\def\labelenumi{\alph{enumi}.}
\setcounter{enumi}{7}
\tightlist
\item
  \texttt{mpg\$mtcars}
\end{enumerate}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mpg}\SpecialCharTok{$}\NormalTok{mtcars}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error in eval(expr, envir, enclos): object 'mpg' not found
\end{verbatim}

\emph{Não retorna. Essa sintaxe não é válida para selecionar colunas de um data frame. O correto seria \texttt{nome\_do\_data\_frame\$nome\_da\_coluna}.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Para que serve a função \texttt{str()}. Dê um exemplo do seu uso.

\emph{Serve para espiarmos a estrutura de um data frame, como número de linhas, colunas, classes das colunas e exemplo de valores em cada uma delas.}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    32 obs. of  11 variables:
##  $ mpg : num  21 21 22.8 21.4 18.7 18.1 14.3 24.4 22.8 19.2 ...
##  $ cyl : num  6 6 4 6 8 6 8 4 4 6 ...
##  $ disp: num  160 160 108 258 360 ...
##  $ hp  : num  110 110 93 110 175 105 245 62 95 123 ...
##  $ drat: num  3.9 3.9 3.85 3.08 3.15 2.76 3.21 3.69 3.92 3.92 ...
##  $ wt  : num  2.62 2.88 2.32 3.21 3.44 ...
##  $ qsec: num  16.5 17 18.6 19.4 17 ...
##  $ vs  : num  0 0 1 1 0 1 0 1 1 1 ...
##  $ am  : num  1 1 1 0 0 0 0 0 0 0 ...
##  $ gear: num  4 4 4 3 3 3 3 4 4 4 ...
##  $ carb: num  4 4 1 1 2 1 4 2 2 4 ...
\end{verbatim}

\textbf{3.} Para que serve a função \texttt{nanes()}. Dê um exemplo do seu uso.

\emph{Serve para observamos os nomes das colunas de um data frame. O valor retornado é um vetor de strings.}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##  [1] "mpg"  "cyl"  "disp" "hp"   "drat" "wt"   "qsec" "vs"   "am"   "gear"
## [11] "carb"
\end{verbatim}

\textbf{4.} Use o data frame \texttt{airquality} para responder às questões abaixo:

\textbf{a.} Quantas colunas \texttt{airquality} tem?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ncol}\NormalTok{(airquality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 6
\end{verbatim}

\textbf{b.} Quantas linhas \texttt{airquality} tem?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{nrow}\NormalTok{(airquality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 153
\end{verbatim}

\textbf{c.} O que a função \texttt{head()} retorna?

\emph{Retorna as 6 primeiras linhas do data frame.}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{head}\NormalTok{(airquality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Ozone Solar.R Wind Temp Month Day
## 1    41     190  7.4   67     5   1
## 2    36     118  8.0   72     5   2
## 3    12     149 12.6   74     5   3
## 4    18     313 11.5   62     5   4
## 5    NA      NA 14.3   56     5   5
## 6    28      NA 14.9   66     5   6
\end{verbatim}

\textbf{d.} Quais são os nomes das colunas?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{names}\NormalTok{(airquality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Ozone"   "Solar.R" "Wind"    "Temp"    "Month"   "Day"
\end{verbatim}

\textbf{e.} Qual é a classe da coluna \texttt{Ozone}?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str}\NormalTok{(airquality)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## 'data.frame':    153 obs. of  6 variables:
##  $ Ozone  : int  41 36 12 18 NA 28 23 19 8 NA ...
##  $ Solar.R: int  190 118 149 313 NA NA 299 99 19 194 ...
##  $ Wind   : num  7.4 8 12.6 11.5 14.3 14.9 8.6 13.8 20.1 8.6 ...
##  $ Temp   : int  67 72 74 62 56 66 65 59 61 69 ...
##  $ Month  : int  5 5 5 5 5 5 5 5 5 5 ...
##  $ Day    : int  1 2 3 4 5 6 7 8 9 10 ...
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Também podemos ver apenas a coluna Ozone}
\FunctionTok{class}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Ozone)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "integer"
\end{verbatim}

\textbf{5.} Desafio. Calculando desvio-padrão no R. Use o data frame \texttt{airquality} para responder às questões abaixo:

\textbf{a.} Tire a média da coluna Ozone e guarde em um objeto.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{media\_ozone }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Ozone, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{b.} Guarde em um objeto o vetor correspondente à coluna Ozone subtraída da sua própria média (calculada em no item a).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ozone\_centralizado }\OtherTok{\textless{}{-}}\NormalTok{ airquality}\SpecialCharTok{$}\NormalTok{Ozone }\SpecialCharTok{{-}}\NormalTok{ media\_ozone}
\end{Highlighting}
\end{Shaded}

\textbf{c.} Eleve o vetor calculado em (b) ao quadrado. Salve o resultado em um novo objeto.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{ozone\_centr\_quadrado }\OtherTok{\textless{}{-}}\NormalTok{ ozone\_centralizado }\SpecialCharTok{\^{}} \DecValTok{2}
\end{Highlighting}
\end{Shaded}

\textbf{d.} Tire a média do vetor calculado em (c) e salve o resultado em um objeto chamado \texttt{variancia}. Em seguida, calcule a raiz quadrada desse valor e salve em um objeto chamado \texttt{desvio\_padrao}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{variancia }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(ozone\_centr\_quadrado, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{desvio\_padrao }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(variancia)}
\end{Highlighting}
\end{Shaded}

\textbf{e.} Compare o valor de \texttt{desvio\_padrao} com \texttt{sd(airquality\$Ozone)} e pesquise por que os valores não são iguais. Dica: veja a documentação da função \texttt{sd()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{desvio\_padrao}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 32.84539
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sd}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Ozone, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 32.98788
\end{verbatim}

\emph{Os valores não são iguais, pois na nossa conta, ao calcularmos a média no item (d), dividimos a soma de quadrados por \texttt{n} (tamanho da amostra, no caso, 116), enquanto na função \texttt{sd()} a divisão é por \texttt{n\ -\ 1} (115). A divisão por \texttt{n\ -\ 1}, na Estatística, representa o estimador não viesado para a variância/desvio-padrão de uma quantidade. Na prática, ambas podem ser utilizadas como medidas de variabilidade, mas em contextos inferenciais o valor dividido por \texttt{n\ -\ 1} é preferível.}

\emph{Para chegarmos no mesmo resultado, poderíamos fazer:}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Número de valores sem NA}
\NormalTok{n }\OtherTok{\textless{}{-}} \FunctionTok{length}\NormalTok{(}\FunctionTok{na.omit}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Ozone))}

\NormalTok{variancia }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(ozone\_centr\_quadrado, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{/}\NormalTok{ (n }\SpecialCharTok{{-}} \DecValTok{1}\NormalTok{)}
\NormalTok{desvio\_padrao }\OtherTok{\textless{}{-}} \FunctionTok{sqrt}\NormalTok{(variancia)}
\NormalTok{desvio\_padrao}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 32.98788
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{6.} Use o \emph{data frame} \texttt{airquality} para responder às questões abaixo.

\textbf{a.} Conte quantos \texttt{NAs} tem na coluna \texttt{Solar.R}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{sum}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Solar.R))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 7
\end{verbatim}

\textbf{b.} Filtre a tabela \texttt{airquality}com apenas linhas em que \texttt{Solar.R} é \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab }\OtherTok{\textless{}{-}}\NormalTok{ airquality[}\FunctionTok{is.na}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Solar.R),]}

\CommentTok{\# Imprimindo apenas as primeiras linhas para facilitar a leitura}
\FunctionTok{head}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Ozone Solar.R Wind Temp Month Day
## 5     NA      NA 14.3   56     5   5
## 6     28      NA 14.9   66     5   6
## 11     7      NA  6.9   74     5  11
## 27    NA      NA  8.0   57     5  27
## 96    78      NA  6.9   86     8   4
## 97    35      NA  7.4   85     8   5
\end{verbatim}

\textbf{c.} Filtre a tabela \texttt{airquality} com apenas linhas em que \texttt{Solar.R} \textbf{não} é \texttt{NA}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab }\OtherTok{\textless{}{-}}\NormalTok{ airquality[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Solar.R),]}

\CommentTok{\# Imprimindo apenas as primeiras linhas para facilitar a leitura}
\FunctionTok{head}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##   Ozone Solar.R Wind Temp Month Day
## 1    41     190  7.4   67     5   1
## 2    36     118  8.0   72     5   2
## 3    12     149 12.6   74     5   3
## 4    18     313 11.5   62     5   4
## 7    23     299  8.6   65     5   7
## 8    19      99 13.8   59     5   8
\end{verbatim}

\textbf{d.} Filtre a tabela \texttt{airquality} com apenas linhas em que \texttt{Solar.R} \textbf{não} é \texttt{NA} e \texttt{Month} é igual a 5.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tab }\OtherTok{\textless{}{-}}\NormalTok{ airquality[}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(airquality}\SpecialCharTok{$}\NormalTok{Solar.R) }\SpecialCharTok{\&}\NormalTok{ airquality}\SpecialCharTok{$}\NormalTok{Month }\SpecialCharTok{\textgreater{}} \DecValTok{5}\NormalTok{,]}

\CommentTok{\# Imprimindo apenas as primeiras linhas para facilitar a leitura}
\FunctionTok{head}\NormalTok{(tab)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##    Ozone Solar.R Wind Temp Month Day
## 32    NA     286  8.6   78     6   1
## 33    NA     287  9.7   74     6   2
## 34    NA     242 16.1   67     6   3
## 35    NA     186  9.2   84     6   4
## 36    NA     220  8.6   85     6   5
## 37    NA     264 14.3   79     6   6
\end{verbatim}

\hypertarget{mais-sobre-funuxe7uxf5es}{%
\subsection*{Mais sobre funções}\label{mais-sobre-funuxe7uxf5es}}
\addcontentsline{toc}{subsection}{Mais sobre funções}

\textbf{1.} Qual dos códigos abaixo devolverá um erro se for avaliado?

\textbf{a.} \texttt{3\ *\ 5\ +\ 10}

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{3} \SpecialCharTok{*} \DecValTok{5} \SpecialCharTok{+} \DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 25
\end{verbatim}

\emph{Sem erro.}

\textbf{b.} \texttt{function\ \textless{}-\ 10}

\begin{Shaded}
\begin{Highlighting}[]
\ControlFlowTok{function} \OtherTok{\textless{}{-}} \DecValTok{10}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error: <text>:1:10: unexpected assignment
## 1: function <-
##              ^
\end{verbatim}

\emph{Retorna erro pois \texttt{function} é um nome reservado no R. Não podemos utilizá-lo para nomear outros objetos.}

\textbf{c.} \texttt{mean(1,\ 10)}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{mean}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1
\end{verbatim}

\emph{Não retorna erro, mas o 10 não é considerado na média. O código correto seria \texttt{mean(c(1,\ 10))}.}

\textbf{d.} \texttt{(soma\ \textless{}-\ sum(1,\ 1))}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{(soma }\OtherTok{\textless{}{-}} \FunctionTok{sum}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{1}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\emph{Não retorna erro. Cercar o código com parênteses força a saída a sempre ser apresentada no Console, além de ser gravada dentro do objeto.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Crie uma função que receba um número e retorne o quadrado deste número.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{quadrado }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
\NormalTok{  x }\SpecialCharTok{\^{}} \DecValTok{2}
\NormalTok{\}}

\FunctionTok{quadrado}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 4
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{quadrado}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 9
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{quadrado}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 0
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Crie uma função que receba 2 números e devolva a raiz quadrada da soma desses números.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{raiz\_da\_soma }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(a, b) \{}
  \FunctionTok{sqrt}\NormalTok{(a }\SpecialCharTok{+}\NormalTok{ b)}
\NormalTok{\}}

\FunctionTok{raiz\_da\_soma}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{raiz\_da\_soma}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{4}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2.236068
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Crie uma função que receba dois valores (numéricos) e devolva o maior deles.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{retornar\_maior }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
\NormalTok{  vetor }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(x, y)}
\NormalTok{  filtro }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(x }\SpecialCharTok{\textgreater{}}\NormalTok{ y, x }\SpecialCharTok{\textless{}=}\NormalTok{ y)}
\NormalTok{  vetor[filtro]}
\NormalTok{\}}

\FunctionTok{retornar\_maior}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{retornar\_maior}\NormalTok{(}\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

*Também poderíamos resolver usando a função \texttt{max()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{retornar\_maior }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x, y) \{}
  \FunctionTok{max}\NormalTok{(x, y)}
\NormalTok{\}}

\FunctionTok{retornar\_maior}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{20}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 20
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{retornar\_maior}\NormalTok{(}\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Use a função \texttt{runif()} para criar uma função que retorne um número aleatório inteiro entre 0 e 10 (0 e 10 inclusive). Caso você não conheça a função \texttt{runif()}, rode \texttt{help(runif)} para ler a sua documentação.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sortear\_numero }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{() \{}
\NormalTok{  numero }\OtherTok{\textless{}{-}} \FunctionTok{runif}\NormalTok{(}\DecValTok{1}\NormalTok{, }\AttributeTok{min =} \DecValTok{0}\NormalTok{, }\AttributeTok{max =} \DecValTok{10}\NormalTok{)}
  
\NormalTok{  numero\_inteiro }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(numero)}
  
  \FunctionTok{return}\NormalTok{(numero\_inteiro)}
\NormalTok{\}}

\FunctionTok{sortear\_numero}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 8
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{6.} Rode \texttt{help(sample)} para descobrir o que a função \texttt{sample()} faz. Em seguida:

\textbf{a.} Use a função \texttt{sample()} para escrever uma função que devolva uma linha aleatória de um \emph{data frame}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sortear\_linha }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data\_frame) \{}
\NormalTok{  num\_linhas }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(data\_frame)}
\NormalTok{  linha\_sorteada }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{num\_linhas, }\DecValTok{1}\NormalTok{)}
  
\NormalTok{  data\_frame[linha\_sorteada, ]}
\NormalTok{\}}

\FunctionTok{sortear\_linha}\NormalTok{(mtcars)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##               mpg cyl disp  hp drat   wt qsec vs am gear carb
## Ferrari Dino 19.7   6  145 175 3.62 2.77 15.5  0  1    5    6
\end{verbatim}

\textbf{b.} Generalize a função para retornar um número qualquer de linhas, escolhido pelo usuário.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{sortear\_linha }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(data\_frame, n) \{}
\NormalTok{  num\_linhas }\OtherTok{\textless{}{-}} \FunctionTok{nrow}\NormalTok{(data\_frame)}
\NormalTok{  linha\_sorteada }\OtherTok{\textless{}{-}} \FunctionTok{sample}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\NormalTok{num\_linhas, n)}
  
\NormalTok{  data\_frame[linha\_sorteada, ]}
\NormalTok{\}}

\FunctionTok{sortear\_linha}\NormalTok{(mtcars, }\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
##                      mpg cyl  disp  hp drat    wt  qsec vs am gear carb
## Merc 450SE          16.4   8 275.8 180 3.07 4.070 17.40  0  0    3    3
## Merc 230            22.8   4 140.8  95 3.92 3.150 22.90  1  0    4    2
## AMC Javelin         15.2   8 304.0 150 3.15 3.435 17.30  0  0    3    2
## Lincoln Continental 10.4   8 460.0 215 3.00 5.424 17.82  0  0    3    4
## Duster 360          14.3   8 360.0 245 3.21 3.570 15.84  0  0    3    4
## Toyota Corolla      33.9   4  71.1  65 4.22 1.835 19.90  1  1    4    1
## Hornet 4 Drive      21.4   6 258.0 110 3.08 3.215 19.44  1  0    3    1
## Dodge Challenger    15.5   8 318.0 150 2.76 3.520 16.87  0  0    3    2
## Lotus Europa        30.4   4  95.1 113 3.77 1.513 16.90  1  1    5    2
## Porsche 914-2       26.0   4 120.3  91 4.43 2.140 16.70  0  1    5    2
\end{verbatim}

\hypertarget{controle-de-fluxo-1}{%
\subsection*{Controle de fluxo}\label{controle-de-fluxo-1}}
\addcontentsline{toc}{subsection}{Controle de fluxo}

\textbf{1.} Por que o código abaixo retorna erro? Arrume o código para retornar o valor \texttt{TRUE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{4}
\ControlFlowTok{if}\NormalTok{(}\AttributeTok{x =} \DecValTok{4}\NormalTok{) \{}
  \ConstantTok{TRUE}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

**Porque a expressão dentro do \texttt{if} deve retornar um valor lógico (TRUE ou FALSE) e o código \texttt{x\ =\ 4} é uma atribuição (equivalente a \texttt{x\ \textless{}-\ 4}). O correto seria utilizar \texttt{==} em vez de \texttt{=}.*

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{4}
\ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{==} \DecValTok{4}\NormalTok{) \{}
  \ConstantTok{TRUE}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] TRUE
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Usando \texttt{if} e \texttt{else}, escreva um código que retorne a string \texttt{"número"} caso um valor \texttt{x} seja da classe \texttt{numeric} ou \texttt{integer}; a string \texttt{"palavra"} caso seja da classe \texttt{character}; e \texttt{NA} caso contrário.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \DecValTok{10}

\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"numeric"} \SpecialCharTok{|} \FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"integer"}\NormalTok{) \{}
  \StringTok{"número"}
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{class}\NormalTok{(x) }\SpecialCharTok{==} \StringTok{"character"}\NormalTok{) \{}
  \StringTok{"palavra"}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \ConstantTok{NA}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "número"
\end{verbatim}

\textbf{Uma solução mais simples seria utilizar as funções \texttt{is.numeric()} e \texttt{is.character()}.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{x }\OtherTok{\textless{}{-}} \StringTok{"qualquer texto"}

\ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.numeric}\NormalTok{(x)) \{}
  \StringTok{"número"}
\NormalTok{\} }\ControlFlowTok{else} \ControlFlowTok{if}\NormalTok{ (}\FunctionTok{is.character}\NormalTok{(x)) \{}
  \StringTok{"palavra"}
\NormalTok{\} }\ControlFlowTok{else}\NormalTok{ \{}
  \ConstantTok{NA}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "palavra"
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Usando apenas \texttt{for} e a função \texttt{length()}, construa uma função que calcule a média de um vetor numérico qualquer. Construa uma condição para a função retornar \texttt{NULL} caso o vetor não seja numérico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{minha\_media }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(vetor) \{}

\NormalTok{  soma }\OtherTok{\textless{}{-}} \DecValTok{0}
  
  \ControlFlowTok{for}\NormalTok{ (i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(vetor)) \{}
\NormalTok{    soma }\OtherTok{\textless{}{-}}\NormalTok{ soma }\SpecialCharTok{+}\NormalTok{ vetor[i]}
\NormalTok{  \}}
  
\NormalTok{  media }\OtherTok{\textless{}{-}}\NormalTok{ soma }\SpecialCharTok{/} \FunctionTok{length}\NormalTok{(vetor)  }
  
  \FunctionTok{return}\NormalTok{(media)}
  
\NormalTok{\}}

\FunctionTok{minha\_media}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 1.5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{minha\_media}\NormalTok{(}\DecValTok{0}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 5
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{minha\_media}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\DecValTok{2}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 2
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Utilize o vetor \texttt{a} para resolver as questões a seguir:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{a }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\DecValTok{10}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{5}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{4}\NormalTok{, }\DecValTok{8}\NormalTok{, }\DecValTok{9}\NormalTok{, }\SpecialCharTok{{-}}\DecValTok{10}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{a.} Utilize o \texttt{for} para imprimir as médias acumuladas do vetor \texttt{a}, isto é, primeiro vamos imprimir 10, depois a média entre 10 e 3, depois a média entre 10, 3 e 5 e assim por diante.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma }\OtherTok{\textless{}{-}} \DecValTok{0}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(a)) \{}
\NormalTok{  soma }\OtherTok{\textless{}{-}}\NormalTok{ soma }\SpecialCharTok{+}\NormalTok{ a[i]}
  
  \FunctionTok{print}\NormalTok{(soma }\SpecialCharTok{/}\NormalTok{ i)}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
## [1] 6.5
## [1] 6
## [1] 4.25
## [1] 4
## [1] 2.666667
## [1] 3.428571
## [1] 4.125
## [1] 2.555556
\end{verbatim}

\textbf{b.} Adapte o laço que você fez no item anterior para ignorar os valores negativos, isto é, em caso de valor negativo, o laço não deve calcular a média e não imprimir nada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{soma }\OtherTok{\textless{}{-}} \DecValTok{0}
\NormalTok{divisor }\OtherTok{\textless{}{-}} \DecValTok{0}

\ControlFlowTok{for}\NormalTok{(i }\ControlFlowTok{in} \DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(a)) \{}
  \ControlFlowTok{if}\NormalTok{ (a[i] }\SpecialCharTok{\textgreater{}=} \DecValTok{0}\NormalTok{) \{}
\NormalTok{    soma }\OtherTok{\textless{}{-}}\NormalTok{ soma }\SpecialCharTok{+}\NormalTok{ a[i]}
\NormalTok{    divisor }\OtherTok{\textless{}{-}}\NormalTok{ divisor }\SpecialCharTok{+} \DecValTok{1}
    \FunctionTok{print}\NormalTok{(soma }\SpecialCharTok{/}\NormalTok{ divisor)}
\NormalTok{  \}}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] 10
## [1] 6.5
## [1] 6
## [1] 5.25
## [1] 5.8
## [1] 6.333333
\end{verbatim}

\hypertarget{importauxe7uxe3o}{%
\section{Importação}\label{importauxe7uxe3o}}

\hypertarget{o-pacote-readr}{%
\subsection*{O pacote readr}\label{o-pacote-readr}}
\addcontentsline{toc}{subsection}{O pacote readr}

\textbf{1.} Qual a diferença entre as funções \texttt{read\_csv()} e \texttt{read\_csv2()}?

\emph{A função \texttt{read\_csv()\ lê\ arquivos\ CSV\ separados\ por\ vírgula\ (padrão\ norte-americano).\ A\ função}read\_csv2()` lê arquivos CSV separados por ponto-e-vírgula (padrão brasileiro, já que usamos a vírgula como seperador de decimais).}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Leia o arquivo \texttt{imdb.csv} utilizando a função \texttt{read\_delim()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(readr)}

\FunctionTok{read\_delim}\NormalTok{(}\StringTok{"imdb.csv"}\NormalTok{, }\AttributeTok{delim =} \StringTok{","}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Escreva a base mtcars em um arquivo \texttt{mtcars.csv} que não contenha o nome das colunas.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_csv}\NormalTok{(mtcars, }\StringTok{"mtcars.csv"}\NormalTok{, }\AttributeTok{col\_names =} \ConstantTok{FALSE}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Use a função \texttt{write\_rds()} para salvar em arquivos

\textbf{a)} Um número.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{numero }\OtherTok{\textless{}{-}} \DecValTok{29}
\FunctionTok{write\_rds}\NormalTok{(numero, }\StringTok{"numero.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{b)} Um vetor de strings.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{estados }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{"SP"}\NormalTok{, }\StringTok{"RN"}\NormalTok{, }\StringTok{"AC"}\NormalTok{, }\StringTok{"MG"}\NormalTok{)}
\FunctionTok{write\_rds}\NormalTok{(estados, }\StringTok{"estados.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{c)} Uma lista com valores númericos, textuais e lógicos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lista }\OtherTok{\textless{}{-}} \FunctionTok{list}\NormalTok{(}\AttributeTok{numero =} \DecValTok{1}\NormalTok{, }\AttributeTok{texto =} \FunctionTok{c}\NormalTok{(}\StringTok{"M"}\NormalTok{, }\StringTok{"F"}\NormalTok{, }\StringTok{"F"}\NormalTok{), }\AttributeTok{logico =} \ConstantTok{FALSE}\NormalTok{)}
\FunctionTok{write\_rds}\NormalTok{(lista, }\StringTok{"lista.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\textbf{d)} As 3 primeiras colunas da base \texttt{mtcars}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{write\_rds}\NormalTok{(mtcars[,}\DecValTok{1}\SpecialCharTok{:}\DecValTok{3}\NormalTok{], }\StringTok{"mtcars\_3\_colunas.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Utilize a função \texttt{read\_rds()} para importar de volta para o R os arquivos criados no exercício 4.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"numero.rds"}\NormalTok{)}
\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"estados.rds"}\NormalTok{)}
\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"lista.rds"}\NormalTok{)}
\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"mtcars\_3\_colunas.rds"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\hypertarget{pipe-1}{%
\section{Pipe}\label{pipe-1}}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{1.} Reescreva a expressão abaixo utilizando o \texttt{\%\textgreater{}\%}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{round}\NormalTok{(}\FunctionTok{mean}\NormalTok{(}\FunctionTok{sum}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{10}\NormalTok{)}\SpecialCharTok{/}\DecValTok{3}\NormalTok{), }\AttributeTok{digits =} \DecValTok{1}\NormalTok{)}

\DecValTok{1}\SpecialCharTok{:}\DecValTok{10} \SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  sum }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{divide\_by}\NormalTok{(}\DecValTok{3}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{round}\NormalTok{(}\AttributeTok{digits =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Reescreva o código abaixo utilizando o \texttt{\%\textgreater{}\%}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Setamos a semente que gera números aleatórios para deixar o resultado reprodutível}

\FunctionTok{set.seed}\NormalTok{(}\DecValTok{137}\NormalTok{)}

\NormalTok{x }\OtherTok{\textless{}{-}} \FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{)}
\NormalTok{x.pos }\OtherTok{\textless{}{-}}\NormalTok{ x[x}\SpecialCharTok{\textgreater{}}\DecValTok{0}\NormalTok{]}
\NormalTok{media }\OtherTok{\textless{}{-}} \FunctionTok{mean}\NormalTok{(x.pos)}
\NormalTok{saida }\OtherTok{\textless{}{-}} \FunctionTok{round}\NormalTok{(media, }\DecValTok{2}\NormalTok{)}
\NormalTok{saida}
\end{Highlighting}
\end{Shaded}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{set.seed}\NormalTok{(}\DecValTok{137}\NormalTok{)}

\FunctionTok{rnorm}\NormalTok{(}\DecValTok{100}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  magrittr}\SpecialCharTok{::}\FunctionTok{extract}\NormalTok{(. }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  mean }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{round}\NormalTok{(}\AttributeTok{digits =} \DecValTok{2}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Sem rodar, diga qual a saída do código abaixo. Consulte o help das funções caso precise.

\begin{Shaded}
\begin{Highlighting}[]
\DecValTok{2} \SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{add}\NormalTok{(}\DecValTok{2}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{, }\ConstantTok{NA}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mean}\NormalTok{(}\AttributeTok{na.rm =}\NormalTok{ T) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{equals}\NormalTok{(}\DecValTok{5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{itemize}
\tightlist
\item
  \emph{Primeiro, somamos 2 com 2, gerando o valor 4.}
\item
  \emph{Então colocamos esse valor em um vetor com os valores 6 e \texttt{NA}.}
\item
  \emph{Em seguida, tiramos a média desse vetor, desconsiderando o \texttt{NA}, obtendo o valor 5.}
\item
  \emph{Por fim, testemos se o valor é igual a 5, obtendo o valor \texttt{TRUE}.}
\end{itemize}

\hypertarget{o-pacote-dplyr}{%
\section{O pacote dplyr}\label{o-pacote-dplyr}}

\hypertarget{selecionando-colunas-1}{%
\subsection*{Selecionando colunas}\label{selecionando-colunas-1}}
\addcontentsline{toc}{subsection}{Selecionando colunas}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Teste aplicar a função \texttt{glimpse()} do pacote \texttt{\{dplyr\}} à base \texttt{imdb}. O que ela faz?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{glimpse}\NormalTok{(imdb)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Rows: 3,807
## Columns: 15
## $ titulo         <chr> "Avatar ", "Pirates of the Caribbean: At World's End ",~
## $ ano            <dbl> 2009, 2007, 2012, 2012, 2007, 2010, 2015, 2016, 2006, 2~
## $ diretor        <chr> "James Cameron", "Gore Verbinski", "Christopher Nolan",~
## $ duracao        <dbl> 178, 169, 164, 132, 156, 100, 141, 183, 169, 151, 150, ~
## $ cor            <chr> "Color", "Color", "Color", "Color", "Color", "Color", "~
## $ generos        <chr> "Action|Adventure|Fantasy|Sci-Fi", "Action|Adventure|Fa~
## $ pais           <chr> "USA", "USA", "USA", "USA", "USA", "USA", "USA", "USA",~
## $ classificacao  <chr> "A partir de 13 anos", "A partir de 13 anos", "A partir~
## $ orcamento      <dbl> 237000000, 300000000, 250000000, 263700000, 258000000, ~
## $ receita        <dbl> 760505847, 309404152, 448130642, 73058679, 336530303, 2~
## $ nota_imdb      <dbl> 7.9, 7.1, 8.5, 6.6, 6.2, 7.8, 7.5, 6.9, 6.1, 7.3, 6.5, ~
## $ likes_facebook <dbl> 33000, 0, 164000, 24000, 0, 29000, 118000, 197000, 0, 5~
## $ ator_1         <chr> "CCH Pounder", "Johnny Depp", "Tom Hardy", "Daryl Sabar~
## $ ator_2         <chr> "Joel David Moore", "Orlando Bloom", "Christian Bale", ~
## $ ator_3         <chr> "Wes Studi", "Jack Davenport", "Joseph Gordon-Levitt", ~
\end{verbatim}

\emph{A função \texttt{glimpse()} traz um resumo da base, contendo o número de linhas, colunas, o nome e tipo das colunas e as primeiras observações de cada coluna.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Crie uma tabela com apenas as colunas \texttt{titulo}, \texttt{diretor}, e \texttt{orcamento.} Salve em um objeto chamado \texttt{imdb\_simples}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_simples }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(imdb, titulo, diretor, orcamento)}
\NormalTok{imdb\_simples}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 3
##    titulo                                      diretor           orcamento
##    <chr>                                       <chr>                 <dbl>
##  1 Avatar                                      James Cameron     237000000
##  2 Pirates of the Caribbean: At World's End    Gore Verbinski    300000000
##  3 The Dark Knight Rises                       Christopher Nolan 250000000
##  4 John Carter                                 Andrew Stanton    263700000
##  5 Spider-Man 3                                Sam Raimi         258000000
##  6 Tangled                                     Nathan Greno      260000000
##  7 Avengers: Age of Ultron                     Joss Whedon       250000000
##  8 Batman v Superman: Dawn of Justice          Zack Snyder       250000000
##  9 Superman Returns                            Bryan Singer      209000000
## 10 Pirates of the Caribbean: Dead Man's Chest  Gore Verbinski    225000000
## # ... with 3,797 more rows
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Selecione apenas as colunas \texttt{ator\_1}, \texttt{ator\_2} e \texttt{ator\_3} usando o ajudante \texttt{contains()}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(imdb, }\FunctionTok{contains}\NormalTok{(}\StringTok{"ator"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 3
##    ator_1          ator_2            ator_3              
##    <chr>           <chr>             <chr>               
##  1 CCH Pounder     Joel David Moore  Wes Studi           
##  2 Johnny Depp     Orlando Bloom     Jack Davenport      
##  3 Tom Hardy       Christian Bale    Joseph Gordon-Levitt
##  4 Daryl Sabara    Samantha Morton   Polly Walker        
##  5 J.K. Simmons    James Franco      Kirsten Dunst       
##  6 Brad Garrett    Donna Murphy      M.C. Gainey         
##  7 Chris Hemsworth Robert Downey Jr. Scarlett Johansson  
##  8 Henry Cavill    Lauren Cohan      Alan D. Purwin      
##  9 Kevin Spacey    Marlon Brando     Frank Langella      
## 10 Johnny Depp     Orlando Bloom     Jack Davenport      
## # ... with 3,797 more rows
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Usando a função \texttt{select()} (e seus ajudantes), escreva códigos que retornem a base IMDB sem as colunas \texttt{ator\_1}, \texttt{ator\_2} e \texttt{ator\_3.} Escreva todas as soluções diferentes que você conseguir pensar.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{select}\NormalTok{(imdb, }\SpecialCharTok{{-}}\FunctionTok{starts\_with}\NormalTok{(}\StringTok{"ator"}\NormalTok{))}

\FunctionTok{select}\NormalTok{(imdb, }\SpecialCharTok{{-}}\NormalTok{ator\_1, }\SpecialCharTok{{-}}\NormalTok{ator\_2, }\SpecialCharTok{{-}}\NormalTok{ator\_3)}

\FunctionTok{select}\NormalTok{(imdb, }\SpecialCharTok{{-}}\NormalTok{(ator\_1}\SpecialCharTok{:}\NormalTok{ator\_3))}

\FunctionTok{select}\NormalTok{(imdb, titulo}\SpecialCharTok{:}\NormalTok{likes\_facebook)}

\FunctionTok{select}\NormalTok{(imdb, }\SpecialCharTok{{-}}\FunctionTok{contains}\NormalTok{(}\StringTok{"ator"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\hypertarget{ordenando-a-base-1}{%
\subsection*{Ordenando a base}\label{ordenando-a-base-1}}
\addcontentsline{toc}{subsection}{Ordenando a base}

\textbf{1.} Ordene os filmes em ordem crescente de \texttt{ano} e decrescente de \texttt{receita} e salve em um objeto chamado \texttt{filmes\_ordenados}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{filmes\_ordenados }\OtherTok{\textless{}{-}} \FunctionTok{arrange}\NormalTok{(imdb, ano, }\FunctionTok{desc}\NormalTok{(receita))}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Selecione apenas as colunas \texttt{titulo} e \texttt{orcamento} e então ordene de forma decrescente pelo \texttt{orcamento}.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Aninhando as funções}
\FunctionTok{arrange}\NormalTok{(}\FunctionTok{select}\NormalTok{(imdb, titulo, orcamento), }\FunctionTok{desc}\NormalTok{(orcamento))}

\CommentTok{\# Criando objeto intermediário}
\NormalTok{imdb\_aux }\OtherTok{\textless{}{-}} \FunctionTok{select}\NormalTok{(imdb, titulo, orcamento)}
\FunctionTok{arrange}\NormalTok{(imdb\_aux, }\FunctionTok{desc}\NormalTok{(orcamento))}

\CommentTok{\# Pipe s2}
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(orcamento))}
\end{Highlighting}
\end{Shaded}

\hypertarget{filtrando-linhas-1}{%
\subsection*{Filtrando linhas}\label{filtrando-linhas-1}}
\addcontentsline{toc}{subsection}{Filtrando linhas}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Crie um objeto chamado \texttt{filmes\_pb} apenas com filmes preto e branco.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Vendo categorias da variável cor}
\FunctionTok{unique}\NormalTok{(imdb}\SpecialCharTok{$}\NormalTok{cor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## [1] "Color"           "Black and White" NA
\end{verbatim}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Filtrando}
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{filter}\NormalTok{(cor }\SpecialCharTok{==} \StringTok{"Black and White"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 149 x 15
##    titulo     ano diretor  duracao cor    generos  pais  classificacao orcamento
##    <chr>    <dbl> <chr>      <dbl> <chr>  <chr>    <chr> <chr>             <dbl>
##  1 Pearl H~  2001 Michael~     184 Black~ Action|~ USA   A partir de ~ 140000000
##  2 The Avi~  2004 Martin ~     170 Black~ Biograp~ USA   A partir de ~ 110000000
##  3 Ali       2001 Michael~     165 Black~ Biograp~ USA   A partir de ~ 107000000
##  4 Eragon    2006 Stefen ~     104 Black~ Action|~ USA   Livre         100000000
##  5 Seabisc~  2003 Gary Ro~     140 Black~ Drama|H~ USA   A partir de ~  87000000
##  6 Bewitch~    NA <NA>          25 Black~ Comedy|~ USA   Outros               NA
##  7 Nine      2009 Rob Mar~     118 Black~ Drama|M~ USA   A partir de ~  80000000
##  8 The Lea~  2003 Stephen~     110 Black~ Action|~ USA   A partir de ~  78000000
##  9 War Hor~  2011 Steven ~     146 Black~ Drama|W~ USA   A partir de ~  66000000
## 10 Space C~  2000 Clint E~     130 Black~ Action|~ USA   A partir de ~  65000000
## # ... with 139 more rows, and 6 more variables: receita <dbl>, nota_imdb <dbl>,
## #   likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Crie um objeto chamado \texttt{curtos\_legais} com filmes de 90 minutos ou menos de duração e nota no imdb maior do que 8.5.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{curtos\_legais }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(duracao }\SpecialCharTok{\textless{}=} \DecValTok{90}\NormalTok{, nota\_imdb }\SpecialCharTok{\textgreater{}} \FloatTok{8.5}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Retorne tabelas (\texttt{tibbles}) apenas com:

\textbf{a.} filmes coloridos anteriores a 1950;

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(cor }\SpecialCharTok{==} \StringTok{"Color"}\NormalTok{, ano }\SpecialCharTok{\textless{}} \DecValTok{1950}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 14 x 15
##    titulo      ano diretor duracao cor   generos   pais  classificacao orcamento
##    <chr>     <dbl> <chr>     <dbl> <chr> <chr>     <chr> <chr>             <dbl>
##  1 Pinocchi~  1940 Norman~      88 Color Animatio~ USA   Outros          2600000
##  2 Duel in ~  1946 King V~     144 Color Drama|Ro~ USA   Outros          8000000
##  3 Tycoon     1947 Richar~      95 Color Adventur~ USA   Outros          3209000
##  4 State Fa~  1945 Walter~     100 Color Musical|~ USA   Outros               NA
##  5 Gone wit~  1939 Victor~     226 Color Drama|Hi~ USA   Outros          3977000
##  6 The Pira~  1948 Vincen~     102 Color Adventur~ USA   Outros          3700000
##  7 It's a W~  1946 Frank ~     118 Color Drama|Fa~ USA   Livre           3180000
##  8 Bathing ~  1944 George~     101 Color Comedy|M~ USA   Outros          2361000
##  9 Fantasia   1940 James ~     120 Color Animatio~ USA   Outros          2280000
## 10 She Wore~  1949 John F~     103 Color Western   USA   Outros          1600000
## 11 Spellbou~  1945 Alfred~      95 Color Film-Noi~ USA   Outros          1696377
## 12 Snow Whi~  1937 Willia~      83 Color Animatio~ USA   Outros          2000000
## 13 Casablan~  1942 Michae~      82 Color Drama|Ro~ USA   Livre            950000
## 14 Bambi      1942 James ~      70 Color Animatio~ USA   Outros               NA
## # ... with 6 more variables: receita <dbl>, nota_imdb <dbl>,
## #   likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\textbf{b.} filmes do ``Woody Allen'' ou do ``Wes Anderson'';

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{==} \StringTok{"Woody Allen"} \SpecialCharTok{|}\NormalTok{ diretor }\SpecialCharTok{==} \StringTok{"Wes Anderson"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 25 x 15
##    titulo      ano diretor duracao cor   generos   pais  classificacao orcamento
##    <chr>     <dbl> <chr>     <dbl> <chr> <chr>     <chr> <chr>             <dbl>
##  1 The Life~  2004 Wes An~     119 Color Adventur~ USA   A partir de ~  50000000
##  2 Fantasti~  2009 Wes An~      87 Color Adventur~ USA   Livre          40000000
##  3 The Gran~  2014 Wes An~      99 Color Adventur~ USA   A partir de ~  25000000
##  4 The Roya~  2001 Wes An~     110 Color Comedy|D~ USA   A partir de ~  21000000
##  5 The Curs~  2001 Woody ~     103 Color Comedy|C~ USA   A partir de ~  26000000
##  6 To Rome ~  2012 Woody ~     112 Color Comedy|R~ USA   A partir de ~  17000000
##  7 Bullets ~  1994 Woody ~      98 Color Comedy|C~ USA   A partir de ~  20000000
##  8 Deconstr~  1997 Woody ~      96 Color Comedy    USA   A partir de ~  20000000
##  9 Everyone~  1996 Woody ~     101 Color Comedy|M~ USA   A partir de ~  20000000
## 10 Blue Jas~  2013 Woody ~      98 Color Drama     USA   A partir de ~  18000000
## # ... with 15 more rows, and 6 more variables: receita <dbl>, nota_imdb <dbl>,
## #   likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\textbf{c.} filmes do ``Steven Spielberg'' ordenados de forma decrescente por ano, mostrando apenas as colunas \texttt{titulo} e \texttt{ano};

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{==} \StringTok{"Steven Spielberg"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(}\FunctionTok{desc}\NormalTok{(ano)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(titulo, ano)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 24 x 2
##    titulo                                                ano
##    <chr>                                               <dbl>
##  1 Bridge of Spies                                      2015
##  2 Lincoln                                              2012
##  3 The Adventures of Tintin                             2011
##  4 War Horse                                            2011
##  5 Indiana Jones and the Kingdom of the Crystal Skull   2008
##  6 War of the Worlds                                    2005
##  7 The Terminal                                         2004
##  8 Minority Report                                      2002
##  9 Catch Me If You Can                                  2002
## 10 A.I. Artificial Intelligence                         2001
## # ... with 14 more rows
\end{verbatim}

\textbf{d.} filmes que tenham ``Action'' \textbf{ou} ``Comedy'' entre os seus gêneros;

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}

\CommentTok{\# Solução 1}
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Action"}\NormalTok{) }\SpecialCharTok{|} \FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Comedy"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2,187 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <dbl> <chr>      <dbl> <chr> <chr>     <chr> <chr>             <dbl>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 2,177 more rows, and 6 more variables: receita <dbl>,
## #   nota_imdb <dbl>, likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>
\end{verbatim}

\textbf{e.} filmes que tenham ``Action'' \textbf{e} ``Comedy'' entre os seus gêneros e tenha \texttt{nota\_imdb} maior que 8;

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Action"}\NormalTok{), }\FunctionTok{str\_detect}\NormalTok{(generos, }\StringTok{"Comedy"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 203 x 15
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <dbl> <chr>      <dbl> <chr> <chr>     <chr> <chr>             <dbl>
##  1 Men in ~  2012 Barry S~     106 Color Action|A~ USA   A partir de ~ 225000000
##  2 Rush Ho~  2007 Brett R~      91 Color Action|C~ USA   A partir de ~ 140000000
##  3 Monster~  2009 Rob Let~      94 Color Action|A~ USA   Livre         175000000
##  4 Wild Wi~  1999 Barry S~     106 Color Action|C~ USA   A partir de ~ 170000000
##  5 Suicide~  2016 David A~     123 Color Action|A~ USA   A partir de ~ 175000000
##  6 Big Her~  2014 Don Hall     102 Color Action|A~ USA   Livre         165000000
##  7 Madagas~  2008 Eric Da~      89 Color Action|A~ USA   Livre         150000000
##  8 G-Force   2009 Hoyt Ye~      88 Color Action|A~ USA   Livre         150000000
##  9 Kung Fu~  2011 Jennife~      90 Color Action|A~ USA   Livre         150000000
## 10 Mars Ne~  2011 Simon W~      88 Color Action|A~ USA   Livre         150000000
## # ... with 193 more rows, and 6 more variables: receita <dbl>, nota_imdb <dbl>,
## #   likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\textbf{f.} filmes que não possuem informação tanto de receita quanto de orçamento (isto é, possuem \texttt{NA} em ambas as colunas).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\FunctionTok{is.na}\NormalTok{(orcamento), }\FunctionTok{is.na}\NormalTok{(receita))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 137 x 15
##    titulo    ano diretor  duracao cor    generos   pais  classificacao orcamento
##    <chr>   <dbl> <chr>      <dbl> <chr>  <chr>     <chr> <chr>             <dbl>
##  1 The A-~    NA <NA>          60 Color  Action|A~ USA   Outros               NA
##  2 Ben-Hu~  2016 Timur B~     141 Color  Adventur~ USA   A partir de ~        NA
##  3 Hannib~    NA <NA>          44 Color  Crime|Dr~ USA   Outros               NA
##  4 All Th~  1979 Bob Fos~     123 Color  Comedy|D~ USA   A partir de ~        NA
##  5 Darede~    NA <NA>          54 <NA>   Action|A~ USA   Outros               NA
##  6 Bewitc~    NA <NA>          25 Black~ Comedy|F~ USA   Outros               NA
##  7 Consta~    NA <NA>          43 Color  Drama|Fa~ USA   Outros               NA
##  8 Life       NA <NA>          45 Color  Crime|Dr~ USA   Outros               NA
##  9 Sleepy~    NA <NA>          45 Color  Adventur~ USA   Outros               NA
## 10 Last M~    NA <NA>          30 Color  Comedy    USA   Outros               NA
## # ... with 127 more rows, and 6 more variables: receita <dbl>, nota_imdb <dbl>,
## #   likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\hypertarget{modificando-e-criando-novas-colunas-1}{%
\subsection*{Modificando e criando novas colunas}\label{modificando-e-criando-novas-colunas-1}}
\addcontentsline{toc}{subsection}{Modificando e criando novas colunas}

\textbf{1.} Crie uma coluna chamada \texttt{prejuizo} (\texttt{orcamento\ -\ receita}) e salve a nova tabela em um objeto chamado \texttt{imdb\_prejuizo}. Em seguida, filtre apenas os filmes que deram prejuízo e ordene a tabela por ordem crescente de prejuízo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_prejuizo }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{prejuizo =}\NormalTok{ orcamento }\SpecialCharTok{{-}}\NormalTok{ receita)}

\NormalTok{imdb\_prejuizo }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(prejuizo }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{arrange}\NormalTok{(prejuizo)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,312 x 16
##    titulo     ano diretor   duracao cor   generos  pais  classificacao orcamento
##    <chr>    <dbl> <chr>       <dbl> <chr> <chr>    <chr> <chr>             <dbl>
##  1 The Hor~  2009 Michel O~      93 Color Documen~ USA   Outros           160000
##  2 Newlywe~  2011 Edward B~      95 Color Comedy|~ USA   Outros             9000
##  3 Shortbu~  2006 John Cam~     101 Color Comedy|~ USA   Outros          2000000
##  4 Slam      1998 Marc Lev~     100 Color Drama    USA   A partir de ~   1000000
##  5 Pink Na~  1971 James Bi~      65 Color Drama|F~ USA   Outros            27000
##  6 The FP    2011 Brandon ~      82 Color Comedy   USA   A partir de ~     60000
##  7 Assault~  2005 Jean-Fra~     109 Color Action|~ USA   A partir de ~  20000000
##  8 The Bus~  2002 Sherman ~     103 Color Drama|M~ USA   Outros           200000
##  9 Latter ~  2003 C. Jay C~     107 Color Comedy|~ USA   A partir de ~    850000
## 10 Happy C~  2014 Joe Swan~      82 Color Comedy|~ USA   A partir de ~     70000
## # ... with 1,302 more rows, and 7 more variables: receita <dbl>,
## #   nota_imdb <dbl>, likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>, prejuizo <dbl>
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Fazendo apenas uma chamada da função mutate(), crie as seguintes colunas novas na base \texttt{imdb}:

\textbf{a.} \texttt{lucro\ =\ receita\ -\ orcamento}

\textbf{b.} \texttt{lucro\_medio}

\textbf{c.} \texttt{lucro\_relativo\ =\ (lucro\ -\ lucro\_medio)/lucro\_medio}

\textbf{d.} \texttt{houve\_lucro\ =\ ifelse(lucro\ \textgreater{}\ 0,\ "sim",\ "não")}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento,}
    \AttributeTok{lucro\_medio =} \FunctionTok{mean}\NormalTok{(lucro, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{lucro\_relativo =}\NormalTok{ (lucro }\SpecialCharTok{{-}}\NormalTok{ lucro\_medio) }\SpecialCharTok{/}\NormalTok{ lucro\_medio,}
    \AttributeTok{houve\_lucro =} \FunctionTok{ifelse}\NormalTok{(lucro }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, }\StringTok{"sim"}\NormalTok{, }\StringTok{"não"}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 19
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <dbl> <chr>      <dbl> <chr> <chr>     <chr> <chr>             <dbl>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 10 more variables: receita <dbl>,
## #   nota_imdb <dbl>, likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>, lucro <dbl>, lucro_medio <dbl>, lucro_relativo <dbl>,
## #   houve_lucro <chr>
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Crie uma nova coluna que classifique o filme em \texttt{"recente"} (posterior a 2000) e \texttt{"antigo"} (de 2000 para trás).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{antigo\_ou\_recente =} \FunctionTok{ifelse}\NormalTok{(ano }\SpecialCharTok{\textgreater{}} \DecValTok{2000}\NormalTok{, }\StringTok{"recente"}\NormalTok{, }\StringTok{"antigo"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 16
##    titulo     ano diretor  duracao cor   generos   pais  classificacao orcamento
##    <chr>    <dbl> <chr>      <dbl> <chr> <chr>     <chr> <chr>             <dbl>
##  1 Avatar    2009 James C~     178 Color Action|A~ USA   A partir de ~ 237000000
##  2 Pirates~  2007 Gore Ve~     169 Color Action|A~ USA   A partir de ~ 300000000
##  3 The Dar~  2012 Christo~     164 Color Action|T~ USA   A partir de ~ 250000000
##  4 John Ca~  2012 Andrew ~     132 Color Action|A~ USA   A partir de ~ 263700000
##  5 Spider-~  2007 Sam Rai~     156 Color Action|A~ USA   A partir de ~ 258000000
##  6 Tangled   2010 Nathan ~     100 Color Adventur~ USA   Livre         260000000
##  7 Avenger~  2015 Joss Wh~     141 Color Action|A~ USA   A partir de ~ 250000000
##  8 Batman ~  2016 Zack Sn~     183 Color Action|A~ USA   A partir de ~ 250000000
##  9 Superma~  2006 Bryan S~     169 Color Action|A~ USA   A partir de ~ 209000000
## 10 Pirates~  2006 Gore Ve~     151 Color Action|A~ USA   A partir de ~ 225000000
## # ... with 3,797 more rows, and 7 more variables: receita <dbl>,
## #   nota_imdb <dbl>, likes_facebook <dbl>, ator_1 <chr>, ator_2 <chr>,
## #   ator_3 <chr>, antigo_ou_recente <chr>
\end{verbatim}

\hypertarget{summarisando-a-base-1}{%
\subsection*{Summarisando a base}\label{summarisando-a-base-1}}
\addcontentsline{toc}{subsection}{Summarisando a base}

Utilize a base \texttt{imdb} nos exercícios a seguir.

\textbf{1.} Calcule a duração média e mediana dos filmes
da base.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{duracao\_media =} \FunctionTok{mean}\NormalTok{(duracao, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{duracao\_mediana =} \FunctionTok{median}\NormalTok{(duracao, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 2
##   duracao_media duracao_mediana
##           <dbl>           <dbl>
## 1          106.             103
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Calcule o lucro médio dos filmes com duração
menor que 60 minutos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(duracao }\SpecialCharTok{\textless{}} \DecValTok{60}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{lucro\_medio =} \FunctionTok{mean}\NormalTok{(lucro, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1 x 1
##   lucro_medio
##         <dbl>
## 1     632454.
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Apresente na mesma tabela o lucro médio dos filmes com duracao menor que 60 minutos e o lucro médio dos filmes com duracao maior ou igual a 60 minutos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento,}
    \AttributeTok{duracao\_cat =} \FunctionTok{ifelse}\NormalTok{(duracao }\SpecialCharTok{\textless{}} \DecValTok{60}\NormalTok{, }\StringTok{"menor 60 min"}\NormalTok{, }\StringTok{"60 ou mais min"}\NormalTok{)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(lucro)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(duracao\_cat) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{lucro\_medio =} \FunctionTok{mean}\NormalTok{(lucro, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 2 x 2
##   duracao_cat    lucro_medio
##   <chr>                <dbl>
## 1 60 ou mais min   17274472.
## 2 menor 60 min       632454.
\end{verbatim}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Retorne tabelas (\texttt{tibbles}) apenas com:

\textbf{a.} a nota IMDB média dos filmes por tipo de classificacao;

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(classificacao) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 4 x 2
##   classificacao       nota_media
##   <chr>                    <dbl>
## 1 A partir de 13 anos       6.18
## 2 A partir de 18 anos       6.47
## 3 Livre                     6.26
## 4 Outros                    6.65
\end{verbatim}

\textbf{b.} a receita média e mediana dos filmes por ano;

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}
    \AttributeTok{receita\_media =} \FunctionTok{mean}\NormalTok{(receita, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{),}
    \AttributeTok{receita\_mediana =} \FunctionTok{median}\NormalTok{(receita, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 91 x 3
##      ano receita_media receita_mediana
##    <dbl>         <dbl>           <dbl>
##  1  1916           NaN              NA
##  2  1920       3000000         3000000
##  3  1925           NaN              NA
##  4  1929       2808000         2808000
##  5  1930           NaN              NA
##  6  1932           NaN              NA
##  7  1933       2300000         2300000
##  8  1934           NaN              NA
##  9  1935       3000000         3000000
## 10  1936        163245          163245
## # ... with 81 more rows
\end{verbatim}

\textbf{c.} apenas o nome dos diretores com mais de 10 filmes.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{num\_filmes =} \FunctionTok{n}\NormalTok{()) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(num\_filmes }\SpecialCharTok{\textgreater{}} \DecValTok{10}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(diretor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 22 x 1
##    diretor             
##    <chr>               
##  1 Barry Levinson      
##  2 Clint Eastwood      
##  3 Francis Ford Coppola
##  4 John Carpenter      
##  5 Kevin Smith         
##  6 Martin Scorsese     
##  7 Michael Bay         
##  8 Renny Harlin        
##  9 Ridley Scott        
## 10 Rob Cohen           
## # ... with 12 more rows
\end{verbatim}

\emph{Também podemos usar a função \texttt{count()}.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(diretor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(diretor, }\AttributeTok{name =} \StringTok{"num\_filmes"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(num\_filmes }\SpecialCharTok{\textgreater{}} \DecValTok{10}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(diretor)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 22 x 1
##    diretor             
##    <chr>               
##  1 Barry Levinson      
##  2 Clint Eastwood      
##  3 Francis Ford Coppola
##  4 John Carpenter      
##  5 Kevin Smith         
##  6 Martin Scorsese     
##  7 Michael Bay         
##  8 Renny Harlin        
##  9 Ridley Scott        
## 10 Rob Cohen           
## # ... with 12 more rows
\end{verbatim}

\hypertarget{juntando-duas-bases-1}{%
\subsection*{Juntando duas bases}\label{juntando-duas-bases-1}}
\addcontentsline{toc}{subsection}{Juntando duas bases}

\textbf{1.} Utilize a base \texttt{imdb} para resolver os itens a seguir.

\textbf{a.} Salve em um novo objeto uma tabela com a
nota média dos filmes de cada diretor. Essa tabela
deve conter duas colunas (\texttt{diretor} e \texttt{nota\_imdb\_media})
e cada linha deve ser um diretor diferente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{nota\_diretores }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_imdb\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb))}

\NormalTok{nota\_diretores}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 1,813 x 2
##    diretor          nota_imdb_media
##    <chr>                      <dbl>
##  1 A. Raven Cruz                1.9
##  2 Aaron Hann                   6  
##  3 Aaron Schneider              7.1
##  4 Aaron Seltzer                2.7
##  5 Abel Ferrara                 6.6
##  6 Adam Carolla                 6.1
##  7 Adam Goldberg                5.4
##  8 Adam Green                   5.7
##  9 Adam Jay Epstein             3.8
## 10 Adam Marcus                  4.3
## # ... with 1,803 more rows
\end{verbatim}

\textbf{b.} Use o \texttt{left\_join()} para trazer a coluna
\texttt{nota\_imdb\_media} da tabela do item anterior
para a tabela \texttt{imdb} original.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{left\_join}\NormalTok{(nota\_diretores, }\AttributeTok{by =} \StringTok{"diretor"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(nota\_imdb\_media, }\FunctionTok{everything}\NormalTok{())}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 3,807 x 16
##    nota_imdb_media titulo        ano diretor   duracao cor   generos       pais 
##              <dbl> <chr>       <dbl> <chr>       <dbl> <chr> <chr>         <chr>
##  1            7.88 Avatar       2009 James Ca~     178 Color Action|Adven~ USA  
##  2            6.99 Pirates of~  2007 Gore Ver~     169 Color Action|Adven~ USA  
##  3            8.43 The Dark K~  2012 Christop~     164 Color Action|Thril~ USA  
##  4            7.73 John Carte~  2012 Andrew S~     132 Color Action|Adven~ USA  
##  5            6.9  Spider-Man~  2007 Sam Raimi     156 Color Action|Adven~ USA  
##  6            7.8  Tangled      2010 Nathan G~     100 Color Adventure|An~ USA  
##  7            7.92 Avengers: ~  2015 Joss Whe~     141 Color Action|Adven~ USA  
##  8            7.18 Batman v S~  2016 Zack Sny~     183 Color Action|Adven~ USA  
##  9            7.26 Superman R~  2006 Bryan Si~     169 Color Action|Adven~ USA  
## 10            6.99 Pirates of~  2006 Gore Ver~     151 Color Action|Adven~ USA  
## # ... with 3,797 more rows, and 8 more variables: classificacao <chr>,
## #   orcamento <dbl>, receita <dbl>, nota_imdb <dbl>, likes_facebook <dbl>,
## #   ator_1 <chr>, ator_2 <chr>, ator_3 <chr>
\end{verbatim}

\hypertarget{o-pacote-stringr-1}{%
\section{O pacote stringr}\label{o-pacote-stringr-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(stringr)}
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(glue)}
\end{Highlighting}
\end{Shaded}

\textbf{1.} O CPF é um número de 11 dígitos, por exemplo: 54491651884. No entanto para facilitar a visualização costumamos mostrá-lo com separadores a cada 3 casas: 544.916.518-84. Crie uma função que transforma um número de 11 dígitos em uma string com as separações, como um CPF.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Sem regex}
\NormalTok{formata\_CPF }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(num) \{}
  
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{str\_count}\NormalTok{(num) }\SpecialCharTok{!=} \DecValTok{11}\NormalTok{) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"Número inválido!"}\NormalTok{)}
\NormalTok{  \}}
  
  \CommentTok{\# Concatemos cada parte do número, interpolando}
  \CommentTok{\# com os pontos e o traço.}
  
\NormalTok{  s }\OtherTok{\textless{}{-}} \FunctionTok{str\_c}\NormalTok{(}
    \FunctionTok{str\_sub}\NormalTok{(num, }\AttributeTok{start =} \DecValTok{1}\NormalTok{, }\AttributeTok{end =} \DecValTok{3}\NormalTok{),}
    \StringTok{"."}\NormalTok{,}
    \FunctionTok{str\_sub}\NormalTok{(num, }\AttributeTok{start =} \DecValTok{4}\NormalTok{, }\AttributeTok{end =} \DecValTok{6}\NormalTok{),}
    \StringTok{"."}\NormalTok{,}
    \FunctionTok{str\_sub}\NormalTok{(num, }\AttributeTok{start =} \DecValTok{7}\NormalTok{, }\AttributeTok{end =} \DecValTok{9}\NormalTok{),}
    \StringTok{"{-}"}\NormalTok{,}
    \FunctionTok{str\_sub}\NormalTok{(num, }\AttributeTok{start =} \DecValTok{10}\NormalTok{, }\AttributeTok{end =} \DecValTok{11}\NormalTok{)}
\NormalTok{  )}
  
\NormalTok{\}}
\CommentTok{\# Com regex}
\NormalTok{formata\_CPF }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(num) \{}
  
  \ControlFlowTok{if}\NormalTok{(}\FunctionTok{str\_count}\NormalTok{(num) }\SpecialCharTok{!=} \DecValTok{11}\NormalTok{) \{}
    \FunctionTok{stop}\NormalTok{(}\StringTok{"Número inválido!"}\NormalTok{)}
\NormalTok{  \}}
  
  \FunctionTok{str\_replace}\NormalTok{(}
    \AttributeTok{string =}\NormalTok{ num, }
    \AttributeTok{pattern =} \StringTok{"([0{-}9]\{3\})([0{-}9]\{3\})([0{-}9]\{3\})"}\NormalTok{, }
    \AttributeTok{replacement =} \StringTok{"}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{1.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{2.}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{3{-}"}
\NormalTok{  )}
\NormalTok{\}}
\end{Highlighting}
\end{Shaded}

A função \texttt{str\_replace()} faz o seguinte:

\begin{itemize}
\tightlist
\item
  O \texttt{pattern=} procurará um padrão de 9 números:

  \begin{itemize}
  \tightlist
  \item
    O primeiro \texttt{({[}0-9{]}\{3\})} pega os três primeiros números.
  \item
    O segundo \texttt{({[}0-9{]}\{3\})} pega os três próximos números (quarto ao sexto).
  \item
    O terceiro \texttt{({[}0-9{]}\{3\})} pega os três números seguintes (sétimo ao nono).
  \end{itemize}
\item
  O \texttt{replacement=} substituirá esses 9 números pela \emph{string} formada por:

  \begin{itemize}
  \tightlist
  \item
    \texttt{\textbackslash{}\textbackslash{}1}, a expressão dada pelo primeiro parêntese do \texttt{pattern=}, isto é, os três primeiros números.
  \item
    \texttt{.}, o primeiro ponto.
  \item
    \texttt{\textbackslash{}\textbackslash{}2}, a expressão dada pelo segundo parêntese do \texttt{pattern=}, isto é, os três próximos números (quarto ao sexto).
  \item
    \texttt{.}, o segundo ponto.
  \item
    \texttt{\textbackslash{}\textbackslash{}3}, a expressão dada pelo terceiro parêntese do \texttt{pattern=}, isto é, os três números seguintes (sétimo ao nono).
  \item
    \texttt{-}, o traço.
  \end{itemize}
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Transforme o vetor de \emph{strings} abaixo em \texttt{"01\ -\ Alto"\ "02\ -\ Médio"\ "03\ -\ Baixo"}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Alto\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Médio\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}Baixo\textquotesingle{}}\NormalTok{)}
\CommentTok{\# Usando str\_c()}
\FunctionTok{str\_c}\NormalTok{(}\StringTok{"0"}\NormalTok{, }\DecValTok{1}\SpecialCharTok{:}\FunctionTok{length}\NormalTok{(s), }\StringTok{" {-} "}\NormalTok{, s, }\AttributeTok{sep =} \StringTok{""}\NormalTok{)}
\DocumentationTok{\#\# [1] "01 {-} Alto"  "02 {-} Médio" "03 {-} Baixo"}

\CommentTok{\# Usando o pacote glue}
\FunctionTok{glue}\NormalTok{(}\StringTok{"0\{1:length(s)\} {-} \{s\}"}\NormalTok{)}
\DocumentationTok{\#\# 01 {-} Alto}
\DocumentationTok{\#\# 02 {-} Médio}
\DocumentationTok{\#\# 03 {-} Baixo}
\end{Highlighting}
\end{Shaded}

Para mais informações sobre o pacote \texttt{glue}, confira \href{http://curso-r.com/blog/2017/04/17/2017-04-08-glue/}{este post}.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Crie uma regex que capture múltiplas versões da palavra `casa'. Ela deve funcionar com as palavras `Casa', `CASA', `CaSa', `CAsa'. Teste-a usando a função \texttt{str\_detect()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}Casa\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CASA\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CaSa\textquotesingle{}}\NormalTok{, }\StringTok{\textquotesingle{}CAsa\textquotesingle{}}\NormalTok{)}
\FunctionTok{str\_detect}\NormalTok{(s, }\StringTok{"[CcAaSsAa]"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE TRUE TRUE TRUE}
\FunctionTok{str\_detect}\NormalTok{(s, }\StringTok{"[Cc][Aa][Ss][Aa]"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE TRUE TRUE TRUE}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Imagine que a seguinte \emph{string} é a parte final de uma URL.

\begin{itemize}
\tightlist
\item
  \texttt{/ac/rio-branco/xpto-xyz-1-0-1fds2396-5}
\end{itemize}

Transforme-a em ``AC - Rio Branco'' utilizando a função \texttt{str\_split()}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{url }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}\StringTok{\textquotesingle{}/ac/rio{-}branco/xpto{-}xyz{-}1{-}0{-}1fds2396{-}5\textquotesingle{}}\NormalTok{)}
\NormalTok{UF }\OtherTok{\textless{}{-}}\NormalTok{ url }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{str\_split}\NormalTok{(}\StringTok{"[/]"}\NormalTok{, }\AttributeTok{simplify =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  .[}\DecValTok{1}\NormalTok{,}\DecValTok{2}\NormalTok{] }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{str\_to\_upper}\NormalTok{()}
\NormalTok{cidade }\OtherTok{\textless{}{-}}\NormalTok{ url }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{str\_split}\NormalTok{(}\StringTok{"[/]"}\NormalTok{, }\AttributeTok{simplify =} \ConstantTok{TRUE}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  .[}\DecValTok{1}\NormalTok{,}\DecValTok{3}\NormalTok{] }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{str\_replace}\NormalTok{(}\StringTok{"{-}"}\NormalTok{, }\StringTok{" "}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{str\_to\_title}\NormalTok{()}
\FunctionTok{str\_c}\NormalTok{(UF, }\StringTok{" {-} "}\NormalTok{, cidade)}
\DocumentationTok{\#\# [1] "AC {-} Rio Branco"}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Crie uma função que retorna \texttt{TRUE} quando a string é um \href{https://pt.wikipedia.org/wiki/Pal\%C3\%ADndromo}{palíndromo} e \texttt{FALSO} caso não seja.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Solução 1: usando a função rev() para inverter uma string fragmentada}
\NormalTok{testa\_palindromo }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(s) \{}
  
\NormalTok{  s }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{str\_split}\NormalTok{(}\StringTok{""}\NormalTok{, }\AttributeTok{simplify =}\NormalTok{ T) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{    rev }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_c}\NormalTok{(}\AttributeTok{collapse =} \StringTok{""}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_detect}\NormalTok{(s)}
  
\NormalTok{\}}
\FunctionTok{testa\_palindromo}\NormalTok{(}\StringTok{"ana"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{testa\_palindromo}\NormalTok{(}\StringTok{"bananas"}\NormalTok{)}
\DocumentationTok{\#\# [1] FALSE}
\FunctionTok{testa\_palindromo}\NormalTok{(}\StringTok{"socorrammesubinoonibusemmarrocos"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}

\CommentTok{\# Solução 2: usando a função str\_reverse() do pacote stringi,}
\CommentTok{\# que já inverte a string diretamente.}
\NormalTok{testa\_palindromo }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(s) \{}
  
\NormalTok{  s }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{    stringi}\SpecialCharTok{::}\FunctionTok{stri\_reverse}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_detect}\NormalTok{(s)}
  
\NormalTok{\}}

\FunctionTok{testa\_palindromo}\NormalTok{(}\StringTok{"ana"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}
\FunctionTok{testa\_palindromo}\NormalTok{(}\StringTok{"bananas"}\NormalTok{)}
\DocumentationTok{\#\# [1] FALSE}
\FunctionTok{testa\_palindromo}\NormalTok{(}\StringTok{"socorrammesubinoonibusemmarrocos"}\NormalTok{)}
\DocumentationTok{\#\# [1] TRUE}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{6.} De acordo com as regras da língua portuguesa, antes de ``p'' ou ``b'' devemos usar a letra ``m''. Em outras palavras, com outras consoantes, usamos a letra ``N''. Suponha que você tem o seguinte texto com erros gramaticais:

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \StringTok{\textquotesingle{}Nós chamamos os bonbeiros quando começou o incêmdio.\textquotesingle{}}
\end{Highlighting}
\end{Shaded}

Crie uma função para corrigi-lo.

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Função que funciona para o exemplo}
\NormalTok{corrige\_mn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(s) \{}
  
\NormalTok{  s }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_replace}\NormalTok{(}\StringTok{"nb"}\NormalTok{, }\StringTok{"mb"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_replace}\NormalTok{(}\StringTok{"md"}\NormalTok{, }\StringTok{"nd"}\NormalTok{)}
  
\NormalTok{\}}
\FunctionTok{corrige\_mn}\NormalTok{(s)}
\DocumentationTok{\#\# [1] "Nós chamamos os bombeiros quando começou o incêndio."}

\CommentTok{\# Função que funciona no caso geral}
\NormalTok{corrige\_mn }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(s) \{}
  
\NormalTok{  s }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_replace\_all}\NormalTok{(}\StringTok{"m([\^{}aeioubp[[:space:]]+])"}\NormalTok{, }\StringTok{"n}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{1"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}  
    \FunctionTok{str\_replace\_all}\NormalTok{(}\StringTok{"n([pb])"}\NormalTok{, }\StringTok{"m}\SpecialCharTok{\textbackslash{}\textbackslash{}}\StringTok{1"}\NormalTok{)}
  
\NormalTok{\}}
\FunctionTok{corrige\_mn}\NormalTok{(s)}
\DocumentationTok{\#\# [1] "Nós chamamos os bombeiros quando começou o incêndio."}
\end{Highlighting}
\end{Shaded}

O padrão \texttt{{[}\^{}aeioubp{[}{[}:space:{]}{]}+{]}} significa ``tudo menos vogais, b, p ou espaços''. O \texttt{\textbackslash{}\textbackslash{}1} devolve o padrão encontrado pelo primeiro parêntese do argumento \texttt{patern=}.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{7.} Considere o seguinte texto

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \StringTok{"A função mais importante para leitura de dados no \textasciigrave{}lubridate\textasciigrave{} é a \textasciigrave{}ymd\textasciigrave{}. Essa função serve para ler qualquer data de uma \textasciigrave{}string\textasciigrave{} no formato \textasciigrave{}YYYY{-}MM{-}DD\textasciigrave{}. Essa função é útil pois funciona com qualquer separador entre os elementos da data e também porque temos uma função para cada formato (\textasciigrave{}ymd\textasciigrave{}, \textasciigrave{}mdy\textasciigrave{}, \textasciigrave{}dmy\textasciigrave{}, \textasciigrave{}dym\textasciigrave{}, \textasciigrave{}myd\textasciigrave{}, \textasciigrave{}ydm\textasciigrave{})."}
\end{Highlighting}
\end{Shaded}

Extraia todas as combinações da função \texttt{ymd}, sem repetições.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{str\_extract\_all}\NormalTok{(s, }\StringTok{"[ymd]\{3\}"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{unlist}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  unique}
\DocumentationTok{\#\# [1] "ymd" "mdy" "dmy" "dym" "myd" "ydm"}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{8.} Considere as frases abaixo

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{s }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{\textquotesingle{}O produto é bom.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é bom.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é muito bom.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto é muito bom\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é ruim.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é não ruim.\textquotesingle{}}\NormalTok{,}
  \StringTok{\textquotesingle{}O produto não é não bom.\textquotesingle{}}
\NormalTok{)}
\end{Highlighting}
\end{Shaded}

Crie uma regra para identificar se o texto refere-se a um feedback positivo ou negativo sobre o produto (considere não bom = ruim e não ruim = bom). Retorne um vetor lógico que vale \texttt{TRUE} se o feedback for positivo e \texttt{FALSE} caso contrário.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{feedback }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(s) \{}
  
\NormalTok{  s }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_replace}\NormalTok{(}\StringTok{"não bom"}\NormalTok{, }\StringTok{"ruim"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{str\_replace}\NormalTok{(}\StringTok{"não ruim"}\NormalTok{, }\StringTok{"bom"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_replace}\NormalTok{(}\StringTok{"muito "}\NormalTok{, }\StringTok{""}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{str\_detect}\NormalTok{(}\StringTok{"(.*) produto é bom|(.*) não é ruim"}\NormalTok{)}
  
\NormalTok{\}}
\FunctionTok{feedback}\NormalTok{(s)}
\DocumentationTok{\#\# [1]  TRUE FALSE FALSE  TRUE  TRUE FALSE  TRUE}
\end{Highlighting}
\end{Shaded}

\hypertarget{o-pacote-lubridate-1}{%
\section{O pacote lubridate}\label{o-pacote-lubridate-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(lubridate)}
\FunctionTok{library}\NormalTok{(ggplot2)}

\NormalTok{lakers }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{as\_tibble}\NormalTok{(lakers)}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Repare que a coluna \texttt{date} no data.frame é um vetor de inteiros. Transforme essa coluna em um vetor de valores com classe \texttt{date}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{date =} \FunctionTok{ymd}\NormalTok{(date))}
\DocumentationTok{\#\# \# A tibble: 34,624 x 13}
\DocumentationTok{\#\#    date       opponent game\_type time  period etype  team  player  result points}
\DocumentationTok{\#\#    \textless{}date\textgreater{}     \textless{}chr\textgreater{}    \textless{}chr\textgreater{}     \textless{}chr\textgreater{}  \textless{}int\textgreater{} \textless{}chr\textgreater{}  \textless{}chr\textgreater{} \textless{}chr\textgreater{}   \textless{}chr\textgreater{}   \textless{}int\textgreater{}}
\DocumentationTok{\#\#  1 2008{-}10{-}28 POR      home      12:00      1 jump \textasciitilde{} OFF   ""      ""          0}
\DocumentationTok{\#\#  2 2008{-}10{-}28 POR      home      11:39      1 shot   LAL   "Pau G\textasciitilde{} "miss\textasciitilde{}      0}
\DocumentationTok{\#\#  3 2008{-}10{-}28 POR      home      11:37      1 rebou\textasciitilde{} LAL   "Vladi\textasciitilde{} ""          0}
\DocumentationTok{\#\#  4 2008{-}10{-}28 POR      home      11:25      1 shot   LAL   "Derek\textasciitilde{} "miss\textasciitilde{}      0}
\DocumentationTok{\#\#  5 2008{-}10{-}28 POR      home      11:23      1 rebou\textasciitilde{} LAL   "Pau G\textasciitilde{} ""          0}
\DocumentationTok{\#\#  6 2008{-}10{-}28 POR      home      11:22      1 shot   LAL   "Pau G\textasciitilde{} "made"      2}
\DocumentationTok{\#\#  7 2008{-}10{-}28 POR      home      11:22      1 foul   POR   "Greg \textasciitilde{} ""          0}
\DocumentationTok{\#\#  8 2008{-}10{-}28 POR      home      11:22      1 free \textasciitilde{} LAL   "Pau G\textasciitilde{} "made"      1}
\DocumentationTok{\#\#  9 2008{-}10{-}28 POR      home      11:00      1 foul   LAL   "Vladi\textasciitilde{} ""          0}
\DocumentationTok{\#\# 10 2008{-}10{-}28 POR      home      10:53      1 shot   POR   "LaMar\textasciitilde{} "made"      2}
\DocumentationTok{\#\# \# ... with 34,614 more rows, and 3 more variables: type \textless{}chr\textgreater{}, x \textless{}int\textgreater{}, y \textless{}int\textgreater{}}
\end{Highlighting}
\end{Shaded}

Repare que \texttt{as\_date()} não funciona neste caso.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{date =} \FunctionTok{as\_date}\NormalTok{(date))}
\DocumentationTok{\#\# \# A tibble: 34,624 x 13}
\DocumentationTok{\#\#    date       opponent game\_type time  period etype  team  player  result points}
\DocumentationTok{\#\#    \textless{}date\textgreater{}     \textless{}chr\textgreater{}    \textless{}chr\textgreater{}     \textless{}chr\textgreater{}  \textless{}int\textgreater{} \textless{}chr\textgreater{}  \textless{}chr\textgreater{} \textless{}chr\textgreater{}   \textless{}chr\textgreater{}   \textless{}int\textgreater{}}
\DocumentationTok{\#\#  1 56949{-}12{-}27 POR      home      12:00      1 jump \textasciitilde{} OFF   ""      ""          0}
\DocumentationTok{\#\#  2 56949{-}12{-}27 POR      home      11:39      1 shot   LAL   "Pau G\textasciitilde{} "miss\textasciitilde{}      0}
\DocumentationTok{\#\#  3 56949{-}12{-}27 POR      home      11:37      1 rebou\textasciitilde{} LAL   "Vladi\textasciitilde{} ""          0}
\DocumentationTok{\#\#  4 56949{-}12{-}27 POR      home      11:25      1 shot   LAL   "Derek\textasciitilde{} "miss\textasciitilde{}      0}
\DocumentationTok{\#\#  5 56949{-}12{-}27 POR      home      11:23      1 rebou\textasciitilde{} LAL   "Pau G\textasciitilde{} ""          0}
\DocumentationTok{\#\#  6 56949{-}12{-}27 POR      home      11:22      1 shot   LAL   "Pau G\textasciitilde{} "made"      2}
\DocumentationTok{\#\#  7 56949{-}12{-}27 POR      home      11:22      1 foul   POR   "Greg \textasciitilde{} ""          0}
\DocumentationTok{\#\#  8 56949{-}12{-}27 POR      home      11:22      1 free \textasciitilde{} LAL   "Pau G\textasciitilde{} "made"      1}
\DocumentationTok{\#\#  9 56949{-}12{-}27 POR      home      11:00      1 foul   LAL   "Vladi\textasciitilde{} ""          0}
\DocumentationTok{\#\# 10 56949{-}12{-}27 POR      home      10:53      1 shot   POR   "LaMar\textasciitilde{} "made"      2}
\DocumentationTok{\#\# \# ... with 34,614 more rows, and 3 more variables: type \textless{}chr\textgreater{}, x \textless{}int\textgreater{}, y \textless{}int\textgreater{}}
\end{Highlighting}
\end{Shaded}

Para entender porque a função devolveu um dia do ano 56949, rode os códigos abaixo.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{as\_date}\NormalTok{(}\DecValTok{0}\NormalTok{)}
\DocumentationTok{\#\# [1] "1970{-}01{-}01"}
\FunctionTok{as\_date}\NormalTok{(}\SpecialCharTok{{-}}\DecValTok{3}\SpecialCharTok{:}\DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\# [1] "1969{-}12{-}29" "1969{-}12{-}30" "1969{-}12{-}31" "1970{-}01{-}01" "1970{-}01{-}02"}
\DocumentationTok{\#\# [6] "1970{-}01{-}03" "1970{-}01{-}04"}
\FunctionTok{as\_date}\NormalTok{(}\DecValTok{20081027}\SpecialCharTok{:}\DecValTok{20081029}\NormalTok{)}
\DocumentationTok{\#\# [1] "56949{-}12{-}26" "56949{-}12{-}27" "56949{-}12{-}28"}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Crie uma coluna que junte as informações de data e hora (colunas \texttt{date} e \texttt{time}) em objetos da classe \texttt{date}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{date\_time =} \FunctionTok{paste0}\NormalTok{(date, }\StringTok{" 00:"}\NormalTok{, time) }\SpecialCharTok{\%\textgreater{}\%}\NormalTok{ ymd\_hms) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(date\_time)}
\DocumentationTok{\#\# \# A tibble: 34,624 x 1}
\DocumentationTok{\#\#    date\_time          }
\DocumentationTok{\#\#    \textless{}dttm\textgreater{}             }
\DocumentationTok{\#\#  1 2008{-}10{-}28 00:12:00}
\DocumentationTok{\#\#  2 2008{-}10{-}28 00:11:39}
\DocumentationTok{\#\#  3 2008{-}10{-}28 00:11:37}
\DocumentationTok{\#\#  4 2008{-}10{-}28 00:11:25}
\DocumentationTok{\#\#  5 2008{-}10{-}28 00:11:23}
\DocumentationTok{\#\#  6 2008{-}10{-}28 00:11:22}
\DocumentationTok{\#\#  7 2008{-}10{-}28 00:11:22}
\DocumentationTok{\#\#  8 2008{-}10{-}28 00:11:22}
\DocumentationTok{\#\#  9 2008{-}10{-}28 00:11:00}
\DocumentationTok{\#\# 10 2008{-}10{-}28 00:10:53}
\DocumentationTok{\#\# \# ... with 34,614 more rows}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Crie as colunas \texttt{dia}, \texttt{mes} e \texttt{ano} com as respectivas informações sobre a data do jogo.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{date =} \FunctionTok{ymd}\NormalTok{(date),}
    \AttributeTok{dia =} \FunctionTok{day}\NormalTok{(date),}
    \AttributeTok{mes =} \FunctionTok{month}\NormalTok{(date),}
    \AttributeTok{ano =} \FunctionTok{year}\NormalTok{(date)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(date, dia, mes, ano)}
\DocumentationTok{\#\# \# A tibble: 34,624 x 4}
\DocumentationTok{\#\#    date         dia   mes   ano}
\DocumentationTok{\#\#    \textless{}date\textgreater{}     \textless{}int\textgreater{} \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\DocumentationTok{\#\#  1 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  2 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  3 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  4 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  5 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  6 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  7 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  8 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\#  9 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\# 10 2008{-}10{-}28    28    10  2008}
\DocumentationTok{\#\# \# ... with 34,614 more rows}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Em média, quanto tempo o Lakers demora para arremessar a primeira bola no primeiro período?

\textbf{Dicas}: arremessos são representados pela categoria \texttt{shot} da coluna \texttt{etype} e cada período tem 12 minutos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(etype }\SpecialCharTok{==} \StringTok{"shot"}\NormalTok{, period }\SpecialCharTok{==} \DecValTok{1}\NormalTok{, team }\SpecialCharTok{==} \StringTok{"LAL"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{time =} \FunctionTok{hms}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"00:"}\NormalTok{, time)),}
    \AttributeTok{cronometro =} \DecValTok{12}\SpecialCharTok{*}\DecValTok{60} \SpecialCharTok{{-}} \FunctionTok{minute}\NormalTok{(time)}\SpecialCharTok{*}\DecValTok{60} \SpecialCharTok{{-}} \FunctionTok{second}\NormalTok{(time)}
\NormalTok{  ) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(date) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(cronometro }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(cronometro)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(cronometro))}
\DocumentationTok{\#\# \# A tibble: 1 x 1}
\DocumentationTok{\#\#   media}
\DocumentationTok{\#\#   \textless{}dbl\textgreater{}}
\DocumentationTok{\#\# 1  29.6}
\end{Highlighting}
\end{Shaded}

O que foi feito:

\begin{itemize}
\item
  Primeiro filtramos a base para arremessos, \texttt{etype\ ==\ "shot"}, do primeiro período, \texttt{period\ ==}, que fossem do Lakers, \texttt{team\ ==\ "LAL"}.
\item
  Em seguida, mudamos a classe da coluna \texttt{time}, de \texttt{character} para \texttt{period}, e criamos a coluna \texttt{cronometro}, que contém o tempo passado (em segundos) até o instante do evento.
\item
  Então agrupamos a base pelo dia e a filtramos apenas para o primeiro evento de cada dia, isto é, o evento que tem o menor valor na coluna \texttt{cronometro}. Assim, a coluna \texttt{cronometro} da base resultante terá o tempo do primeiro arremesso de cada jogo.
\item
  Por fim, desagrupamos a base e calculamos a média da coluna \texttt{cronometro}.
\end{itemize}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Em média, quanto tempo demora para sair a primeira cesta de três pontos em cada um dos quatro períodos? Considere toda a base, e cestas de ambos os times.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(etype }\SpecialCharTok{==} \StringTok{"shot"}\NormalTok{, period }\SpecialCharTok{\%in\%} \DecValTok{1}\SpecialCharTok{:}\DecValTok{4}\NormalTok{, points }\SpecialCharTok{==} \StringTok{"3"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}\AttributeTok{time =} \FunctionTok{hms}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"00:"}\NormalTok{, time)),}
                \AttributeTok{cronometro =} \DecValTok{12}\SpecialCharTok{*}\DecValTok{60} \SpecialCharTok{{-}} \FunctionTok{minute}\NormalTok{(time)}\SpecialCharTok{*}\DecValTok{60} \SpecialCharTok{{-}} \FunctionTok{second}\NormalTok{(time)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(date, period) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{filter}\NormalTok{(cronometro }\SpecialCharTok{==} \FunctionTok{min}\NormalTok{(cronometro)) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%}
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{group\_by}\NormalTok{(period) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  dplyr}\SpecialCharTok{::}\FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(cronometro))}
\DocumentationTok{\#\# \# A tibble: 4 x 2}
\DocumentationTok{\#\#   period media}
\DocumentationTok{\#\#    \textless{}int\textgreater{} \textless{}dbl\textgreater{}}
\DocumentationTok{\#\# 1      1  202.}
\DocumentationTok{\#\# 2      2  219.}
\DocumentationTok{\#\# 3      3  203.}
\DocumentationTok{\#\# 4      4  192.}
\end{Highlighting}
\end{Shaded}

A resolução desse exercício é análoga ao anterior, só mudamos o filtro inicial e o agrupamento. Se você ficou com dúvidas, consulte o passo a passo na resolução do exercício 4.

Repare que não precisarímos filtrar por \texttt{etype\ ==\ "shot"}, já que o único evento que gera 3 pontos é a cesta de 3 pontos.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{6.} Construa boxplots do tempo entre pontos consecutivos para cada períodos. Considere toda a base de dados e apenas pontos do Lakers.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{lakers }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(points }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, team }\SpecialCharTok{==} \StringTok{"LAL"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
      \AttributeTok{time =} \FunctionTok{hms}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"00:"}\NormalTok{, time)),}
      \AttributeTok{tempo\_segundos =} \DecValTok{60} \SpecialCharTok{*} \FunctionTok{minute}\NormalTok{(time) }\SpecialCharTok{+} \FunctionTok{second}\NormalTok{(time),}
      \AttributeTok{dif =}\NormalTok{ tempo\_segundos }\SpecialCharTok{{-}} \FunctionTok{lead}\NormalTok{(tempo\_segundos),}
      \AttributeTok{period =} \FunctionTok{as.character}\NormalTok{(period)}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(dif }\SpecialCharTok{\textgreater{}=} \DecValTok{0}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ period, }\AttributeTok{y =}\NormalTok{ dif)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9844-respostas-lubridate_files/figure-latex/unnamed-chunk-10-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{7.} Qual foi o dia e mês do jogo que o Lakers demorou mais tempo para fazer uma cesta? Quanto tempo foi?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{cesta\_demorada }\OtherTok{\textless{}{-}}\NormalTok{ lakers }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(points }\SpecialCharTok{\textgreater{}} \DecValTok{0}\NormalTok{, team }\SpecialCharTok{==} \StringTok{"LAL"}\NormalTok{, period }\SpecialCharTok{==} \DecValTok{1}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{    dplyr}\SpecialCharTok{::}\FunctionTok{mutate}\NormalTok{(}
      \AttributeTok{time =} \FunctionTok{hms}\NormalTok{(}\FunctionTok{paste0}\NormalTok{(}\StringTok{"00:"}\NormalTok{, time)),}
      \AttributeTok{time =} \DecValTok{60} \SpecialCharTok{*} \FunctionTok{minute}\NormalTok{(time) }\SpecialCharTok{+} \FunctionTok{second}\NormalTok{(time),}
      \AttributeTok{date =} \FunctionTok{ymd}\NormalTok{(date),}
      \AttributeTok{dia =} \FunctionTok{day}\NormalTok{(date),}
      \AttributeTok{mes =} \FunctionTok{month}\NormalTok{(date),}
\NormalTok{    ) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(date) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(time }\SpecialCharTok{==} \FunctionTok{max}\NormalTok{(time)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ungroup}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{slice\_min}\NormalTok{(time)}

\NormalTok{cesta\_demorada }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{select}\NormalTok{(date, opponent, dia, mes)}
\DocumentationTok{\#\# \# A tibble: 1 x 4}
\DocumentationTok{\#\#   date       opponent   dia   mes}
\DocumentationTok{\#\#   \textless{}date\textgreater{}     \textless{}chr\textgreater{}    \textless{}int\textgreater{} \textless{}dbl\textgreater{}}
\DocumentationTok{\#\# 1 2009{-}04{-}12 MEM         12     4}

\NormalTok{tempo\_seg }\OtherTok{\textless{}{-}} \DecValTok{12}\SpecialCharTok{*}\DecValTok{60} \SpecialCharTok{{-}}\NormalTok{ cesta\_demorada}\SpecialCharTok{$}\NormalTok{time}
\FunctionTok{seconds\_to\_period}\NormalTok{(tempo\_seg)}
\DocumentationTok{\#\# [1] "2M 37S"}
\end{Highlighting}
\end{Shaded}

\hypertarget{o-pacote-forcats}{%
\section{O pacote forcats}\label{o-pacote-forcats}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(forcats)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Qual a diferença nos fatores criados com os códigos abaixo?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fator1 }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"z"}\NormalTok{, }\StringTok{"B"}\NormalTok{))}
\NormalTok{fator2 }\OtherTok{\textless{}{-}}\NormalTok{ forcats}\SpecialCharTok{::}\FunctionTok{as\_factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"c"}\NormalTok{, }\StringTok{"a"}\NormalTok{, }\StringTok{"z"}\NormalTok{, }\StringTok{"B"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

A função do R base \texttt{as.factor()} ordena os níveis do fator em ordem alfabética. A função \texttt{as\_factor()} do pacote \texttt{forcats} ordena os níveis do fator na ordem que eles aparecem no vetor.

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Ordene os níveis do fator \texttt{frutas} conforme a sua preferência, isto é, as que você mais gosta primeiro e as que você menos gosta por último.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{frutas }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"maçã"}\NormalTok{, }\StringTok{"banana"}\NormalTok{, }\StringTok{"mamão"}\NormalTok{, }\StringTok{"laranja"}\NormalTok{, }\StringTok{"melancia"}\NormalTok{))}
\NormalTok{frutas}
\DocumentationTok{\#\# [1] maçã     banana   mamão    laranja  melancia}
\DocumentationTok{\#\# Levels: banana laranja maçã mamão melancia}

\CommentTok{\# preferência do Willy}
\FunctionTok{lvls\_reorder}\NormalTok{(frutas, }\FunctionTok{c}\NormalTok{(}\DecValTok{4}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{))}
\DocumentationTok{\#\# [1] maçã     banana   mamão    laranja  melancia}
\DocumentationTok{\#\# Levels: mamão melancia banana maçã laranja}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Com base no vetor \texttt{series}, resolva os itens a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{series }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Game of Thrones"}\NormalTok{, }\StringTok{"How I Met your Mother"}\NormalTok{, }\StringTok{"Friends"}\NormalTok{, }\StringTok{"Lost"}\NormalTok{, }\StringTok{"The Office"}\NormalTok{, }\StringTok{"Breaking Bad"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{a.} Ordene os níveis do vetor \texttt{series} conforme a sua preferência, isto é, as que você mais gosta primeiro e as que você menos gosta por último.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{levels}\NormalTok{(series)}
\DocumentationTok{\#\# [1] "Breaking Bad"          "Friends"               "Game of Thrones"      }
\DocumentationTok{\#\# [4] "How I Met your Mother" "Lost"                  "The Office"}

\CommentTok{\# preferência do Willy}
\NormalTok{series }\OtherTok{\textless{}{-}} \FunctionTok{lvls\_reorder}\NormalTok{(series, }\FunctionTok{c}\NormalTok{(}\DecValTok{6}\NormalTok{, }\DecValTok{5}\NormalTok{, }\DecValTok{1}\NormalTok{, }\DecValTok{3}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{4}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{b.} Junte ao vetor \texttt{series} o vetor \texttt{novas\_series} a seguir, reordenando os níveis para manter a sua ordem de preferência.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{novas\_series }\OtherTok{\textless{}{-}} \FunctionTok{as.factor}\NormalTok{(}\FunctionTok{c}\NormalTok{(}\StringTok{"Stranger Things"}\NormalTok{, }\StringTok{"The Boys"}\NormalTok{, }\StringTok{"Queen\textquotesingle{}s Gambit"}\NormalTok{))}

\NormalTok{series }\OtherTok{\textless{}{-}}\NormalTok{ series }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{fct\_c}\NormalTok{(novas\_series) }

\FunctionTok{levels}\NormalTok{(series)}
\DocumentationTok{\#\# [1] "The Office"            "Lost"                  "Breaking Bad"         }
\DocumentationTok{\#\# [4] "Game of Thrones"       "Friends"               "How I Met your Mother"}
\DocumentationTok{\#\# [7] "Queen\textquotesingle{}s Gambit"        "Stranger Things"       "The Boys"}

\NormalTok{series }\OtherTok{\textless{}{-}} \FunctionTok{lvls\_reorder}\NormalTok{(series, }\FunctionTok{c}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{7}\NormalTok{, }\DecValTok{9}\NormalTok{, }\DecValTok{8}\NormalTok{))}
\FunctionTok{levels}\NormalTok{(series)}
\DocumentationTok{\#\# [1] "The Office"            "Lost"                  "Breaking Bad"         }
\DocumentationTok{\#\# [4] "Game of Thrones"       "Friends"               "How I Met your Mother"}
\DocumentationTok{\#\# [7] "Queen\textquotesingle{}s Gambit"        "The Boys"              "Stranger Things"}
\end{Highlighting}
\end{Shaded}

\textbf{c.} Renomeie o níveis do vetor criado no item (b) para os nomes em Português das séries. Mantenha o mesmo nome caso não haja tradução.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{series }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{fct\_recode}\NormalTok{(}
    \StringTok{"A Guerra dos Tronos"} \OtherTok{=} \StringTok{"Game of Thrones"}\NormalTok{,}
    \StringTok{"Como Eu Conheci Sua Mãe"} \OtherTok{=} \StringTok{"How I Met your Mother"}\NormalTok{,}
    \StringTok{"A Química do Mal"} \OtherTok{=} \StringTok{"Breaking Bad"}\NormalTok{,}
    \StringTok{"O Gambito da Rainha"} \OtherTok{=} \StringTok{"Queen\textquotesingle{}s Gambit"}
\NormalTok{  )}
\DocumentationTok{\#\# [1] A Guerra dos Tronos     Como Eu Conheci Sua Mãe Friends                }
\DocumentationTok{\#\# [4] Lost                    The Office              A Química do Mal       }
\DocumentationTok{\#\# [7] Stranger Things         The Boys                O Gambito da Rainha    }
\DocumentationTok{\#\# 9 Levels: The Office Lost A Química do Mal A Guerra dos Tronos ... Stranger Things}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Ordene as categorias do eixo y do gráfico abaixo para que os pontos no eixo x fique em ordem crescente.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tibble}\SpecialCharTok{::}\FunctionTok{rownames\_to\_column}\NormalTok{(}\StringTok{"modelo"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{modelo =} \FunctionTok{fct\_reorder}\NormalTok{(modelo, mpg)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ mpg, }\AttributeTok{y =}\NormalTok{ modelo)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9845-respostas-forcats_files/figure-latex/unnamed-chunk-9-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Utilize a base \texttt{dados::casas} para fazer um gráfico de barras mostrando as vizinhanças (coluna \texttt{vizinhanca}) com casas mais caras (segundo a coluna \texttt{venda\_valor}). O gráfico deve conter as 9 vizinhanças mais frequentes e as demais devem ser agrupadas em uma categoria chamada \texttt{Outras\ vizinhanças}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{dados}\SpecialCharTok{::}\NormalTok{casas }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{vizinhanca =} \FunctionTok{fct\_lump\_n}\NormalTok{(vizinhanca, }\DecValTok{9}\NormalTok{, }\AttributeTok{other\_level =} \StringTok{"Outras vizinhanças"}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(vizinhanca) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{venda\_valor =} \FunctionTok{mean}\NormalTok{(venda\_valor, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{vizinhanca =} \FunctionTok{fct\_reorder}\NormalTok{(vizinhanca, venda\_valor)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ venda\_valor, }\AttributeTok{y =}\NormalTok{ vizinhanca)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9845-respostas-forcats_files/figure-latex/unnamed-chunk-10-1} \end{center}

\hypertarget{o-pacote-ggplot2-1}{%
\section{O pacote ggplot2}\label{o-pacote-ggplot2-1}}

\textbf{1.} O que acontece quando rodamos o código \texttt{ggplot(data\ =\ mtcars)}?

\emph{A função \texttt{ggplot()} cria o nosso canvas, um quadro em branco onde vamos colocar todas as outras camadas do gráfico. Dentro do R, isso corresponde a uma lista com as informações necessárias para a criação do gráfico. Cada camada adicionada ao ggplot adiciona mais informações nessa lista. No exemplo acima, como passamos a base \texttt{mtcars} para a função \texttt{ggplot()}, a base mtcars é guardada dentro dessa lista, e será utilizada quando mapearmos variáveis ao gráfico.}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} O que tem de errado no código abaixo? Por que os pontos não ficaram azuis?

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mpg) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ displ, }\AttributeTok{y =}\NormalTok{ hwy, }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-2-1} \end{center}

\emph{Quando queremos definir o valor de um atributo estético, fazemos isso fora da função \texttt{aes()}. Usamos a função \texttt{aes()} apenas para mapear variáveis aos atributos estéticos do gráfico. O correto seria:}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{ggplot}\NormalTok{(}\AttributeTok{data =}\NormalTok{ mpg) }\SpecialCharTok{+} 
  \FunctionTok{geom\_point}\NormalTok{(}\AttributeTok{mapping =} \FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ displ, }\AttributeTok{y =}\NormalTok{ hwy), }\AttributeTok{color =} \StringTok{"blue"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-3-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Mapeie uma variável contínua para a cor, o tamanho e a forma de um gráfico de pontos. Como esses atributos estéticos se comportam diferente para variáveis categóricas vs contínuas?

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Cor (var continua)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ wt, }\AttributeTok{color =}\NormalTok{ carb))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-4-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Cor (var discreta)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{carb =} \FunctionTok{as.character}\NormalTok{(carb)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ wt, }\AttributeTok{color =}\NormalTok{ carb))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-4-2} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tamanho (var continua)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ wt, }\AttributeTok{size =}\NormalTok{ carb))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-5-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Tamanho (var discreta)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{carb =} \FunctionTok{as.character}\NormalTok{(carb)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ wt, }\AttributeTok{size =}\NormalTok{ carb))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Using size for a discrete variable is not advised.
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-5-2} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Forma (var continua)}
\CommentTok{\# Não pode ser utilizada com variável contínua}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ wt, }\AttributeTok{shape =}\NormalTok{ carb))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Error: A continuous variable can not be mapped to shape
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-6-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]
\CommentTok{\# Forma (var discreta)}
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{carb =} \FunctionTok{as.character}\NormalTok{(carb)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ wt, }\AttributeTok{shape =}\NormalTok{ carb))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-7-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Utilizando o \texttt{mtcars}, faça um gráfico de dispersão de \texttt{mpg} por \texttt{qsec}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ qsec))}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-8-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Utilizando o \texttt{mtcars}, o que acontece se você fizer um gráfico de dispersão de \texttt{vs} por \texttt{mpg}? Qual gráfico seria melhor para representar esses dados?

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ vs)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-9-1} \end{center}

\emph{Como os pontos ficam sobrepostos, um boxplot seria mais interessante nesse caso pois nos dá uma visão melhor da distribuição da variável \texttt{mpg} para cada categoria da variável \texttt{vs}.}

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{mtcars }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{vs =} \FunctionTok{as.character}\NormalTok{(vs)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ mpg, }\AttributeTok{x =}\NormalTok{ vs)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-10-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

Para resolver os exercícios a seguir, utilize a base \texttt{imdb}.

\textbf{6.} Crie um gráfico de dispersão da nota do imdb pelo orçamento.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{y =}\NormalTok{ nota\_imdb, }\AttributeTok{x =}\NormalTok{ orcamento)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 298 rows containing missing values (geom_point).
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-11-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{7.} Faça um gráfico de linhas do orçamento médio dos filmes ao longo dos anos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{orcamento\_medio =} \FunctionTok{mean}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ orcamento\_medio)) }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 row(s) containing missing values (geom_path).
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-12-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{8.} Transforme o gráfico do exercício anterior em um gráfico de barras.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{orcamento\_medio =} \FunctionTok{mean}\NormalTok{(orcamento, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ orcamento\_medio)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 rows containing missing values (position_stack).
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-13-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{9.} Descubra quais são os 5 atores que mais aparecem na coluna ator\_1 e faça um boxplot do lucro dos filmes desses atores.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{atores }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{count}\NormalTok{(ator\_1) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{top\_n}\NormalTok{(}\DecValTok{5}\NormalTok{, n) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(ator\_1)}

\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(ator\_1 }\SpecialCharTok{\%in\%}\NormalTok{ atores) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{lucro =}\NormalTok{ receita }\SpecialCharTok{{-}}\NormalTok{ orcamento) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ator\_1, }\AttributeTok{y =}\NormalTok{ lucro)) }\SpecialCharTok{+}
  \FunctionTok{geom\_boxplot}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 6 rows containing non-finite values (stat_boxplot).
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-14-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{10.} Com base no código abaixo, resolva os itens a seguir.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{diretores }\OtherTok{\textless{}{-}} \FunctionTok{c}\NormalTok{(}
  \StringTok{"Steven Spielberg"}\NormalTok{, }
  \StringTok{"Quentin Tarantino"}\NormalTok{, }
  \StringTok{"Christopher Nolan"}\NormalTok{,}
  \StringTok{"Martin Scorsese"}
\NormalTok{)}

\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{\%in\%}\NormalTok{ diretores) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano, diretor) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\FunctionTok{vars}\NormalTok{(diretor))}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'ano'. You can override using the `.groups` argument.
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-15-1} \end{center}

\textbf{a.} Analisando o gráfico gerado, descreva o que a função \texttt{facet\_wrap()} faz.

\emph{A função \texttt{facet\_wrap()} replica o gráfico especificado para cada categoria de uma coluna.}

\textbf{.b} Utilize os argumentos nrow e \texttt{ncol} da função \texttt{facet\_wrap()} para colocar os quatro gráficos em uma única coluna.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(diretor }\SpecialCharTok{\%in\%}\NormalTok{ diretores) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{group\_by}\NormalTok{(ano, diretor) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{summarise}\NormalTok{(}\AttributeTok{nota\_media =} \FunctionTok{mean}\NormalTok{(nota\_imdb, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{)) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ nota\_media)) }\SpecialCharTok{+}
  \FunctionTok{geom\_point}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{geom\_line}\NormalTok{() }\SpecialCharTok{+}
  \FunctionTok{facet\_wrap}\NormalTok{(}\FunctionTok{vars}\NormalTok{(diretor), }\AttributeTok{ncol =} \DecValTok{1}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## `summarise()` has grouped output by 'ano'. You can override using the `.groups` argument.
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-16-1} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{11.} Resovla os itens a seguir para fazer um gráfico de barras da frequência de filmes com nota maior que 8 ao longo dos anos.

\textbf{a.} Crie uma nova coluna na base IMDB indicando se a nota de um filme é maior que 8 ou não.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb\_notas\_8 }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{mutate}\NormalTok{(}\AttributeTok{nota\_maior\_que\_8 =} \FunctionTok{ifelse}\NormalTok{(nota\_imdb }\SpecialCharTok{\textgreater{}} \DecValTok{8}\NormalTok{, }\StringTok{"Nota maior que 8"}\NormalTok{, }\StringTok{"Nota menor que 8"}\NormalTok{))}
\end{Highlighting}
\end{Shaded}

\textbf{b.} b. Utilizando a coluna criada em (a) crie uma tabela com o número anual de filmes com nota maior 8.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabela }\OtherTok{\textless{}{-}}\NormalTok{ imdb\_notas\_8 }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{filter}\NormalTok{(nota\_maior\_que\_8 }\SpecialCharTok{==} \StringTok{"Nota maior que 8"}\NormalTok{) }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{count}\NormalTok{(ano)}

\NormalTok{tabela}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## # A tibble: 65 x 2
##      ano     n
##    <dbl> <int>
##  1  1925     1
##  2  1934     1
##  3  1936     1
##  4  1939     3
##  5  1940     1
##  6  1942     1
##  7  1946     2
##  8  1952     2
##  9  1954     1
## 10  1957     1
## # ... with 55 more rows
\end{verbatim}

\textbf{c.} Utilize a tabela criada em (b) para fazer um gráfico de barras do número de filmes com nota maior que 8 ao longo dos anos.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabela }\SpecialCharTok{\%\textgreater{}\%}
  \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ ano, }\AttributeTok{y =}\NormalTok{ n)) }\SpecialCharTok{+}
  \FunctionTok{geom\_col}\NormalTok{()}
\end{Highlighting}
\end{Shaded}

\begin{verbatim}
## Warning: Removed 1 rows containing missing values (position_stack).
\end{verbatim}

\begin{center}\includegraphics{985-respostas-ggplot2_files/figure-latex/unnamed-chunk-19-1} \end{center}

\hypertarget{programauxe7uxe3o-funcional-purrr}{%
\section{Programação funcional (purrr)}\label{programauxe7uxe3o-funcional-purrr}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(purrr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Utilize a função \texttt{map()} para calcular a média de cada coluna da base \texttt{mtcars}.

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{map}\NormalTok{(mtcars, mean)}
\DocumentationTok{\#\# $mpg}
\DocumentationTok{\#\# [1] 20.09062}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $cyl}
\DocumentationTok{\#\# [1] 6.1875}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $disp}
\DocumentationTok{\#\# [1] 230.7219}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $hp}
\DocumentationTok{\#\# [1] 146.6875}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $drat}
\DocumentationTok{\#\# [1] 3.596563}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $wt}
\DocumentationTok{\#\# [1] 3.21725}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $qsec}
\DocumentationTok{\#\# [1] 17.84875}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $vs}
\DocumentationTok{\#\# [1] 0.4375}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $am}
\DocumentationTok{\#\# [1] 0.40625}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $gear}
\DocumentationTok{\#\# [1] 3.6875}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# $carb}
\DocumentationTok{\#\# [1] 2.8125}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Use a função \texttt{map()} para testar se cada elemento do vetor \texttt{letters} é uma vogal ou não. Dica: você precisará criar uma função para testar se é uma letra é vogal. Faça o resultado ser (a) uma lista de \texttt{TRUE/FALSE} e (b) um vetor de \texttt{TRUE/FALSE}.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{testar\_vogal }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{(x }\SpecialCharTok{\%in\%} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"e"}\NormalTok{, }\StringTok{"i"}\NormalTok{, }\StringTok{"o"}\NormalTok{, }\StringTok{"u"}\NormalTok{)) \{}
    \FunctionTok{return}\NormalTok{(}\ConstantTok{TRUE}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{return}\NormalTok{(}\ConstantTok{FALSE}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}

\CommentTok{\# retornando uma lista}
\FunctionTok{map}\NormalTok{(letters, testar\_vogal)}
\DocumentationTok{\#\# [[1]]}
\DocumentationTok{\#\# [1] TRUE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[2]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[3]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[4]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[5]]}
\DocumentationTok{\#\# [1] TRUE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[6]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[7]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[8]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[9]]}
\DocumentationTok{\#\# [1] TRUE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[10]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[11]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[12]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[13]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[14]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[15]]}
\DocumentationTok{\#\# [1] TRUE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[16]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[17]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[18]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[19]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[20]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[21]]}
\DocumentationTok{\#\# [1] TRUE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[22]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[23]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[24]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[25]]}
\DocumentationTok{\#\# [1] FALSE}
\DocumentationTok{\#\# }
\DocumentationTok{\#\# [[26]]}
\DocumentationTok{\#\# [1] FALSE}

\CommentTok{\# retornando um vetor (2 soluções equivalentes)}
\FunctionTok{map}\NormalTok{(letters, testar\_vogal) }\SpecialCharTok{\%\textgreater{}\%} \FunctionTok{flatten\_lgl}\NormalTok{()}
\DocumentationTok{\#\#  [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE}
\DocumentationTok{\#\# [13] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE}
\DocumentationTok{\#\# [25] FALSE FALSE}
\FunctionTok{map\_lgl}\NormalTok{(letters, testar\_vogal)}
\DocumentationTok{\#\#  [1]  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE}
\DocumentationTok{\#\# [13] FALSE FALSE  TRUE FALSE FALSE FALSE FALSE FALSE  TRUE FALSE FALSE FALSE}
\DocumentationTok{\#\# [25] FALSE FALSE}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3} Faça uma função que divida um número por 2 se ele for par ou multiplique ele por 2 caso seja ímpar. Utilize uma função \texttt{map} para aplicar essa função ao vetor \texttt{1:100}. O resultado do código deve ser um vetor numérico.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{operacao }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(x) \{}
  \ControlFlowTok{if}\NormalTok{ (x }\SpecialCharTok{\%\%} \DecValTok{2} \SpecialCharTok{==} \DecValTok{0}\NormalTok{) \{}
    \FunctionTok{return}\NormalTok{(x }\SpecialCharTok{/} \DecValTok{2}\NormalTok{)}
\NormalTok{  \} }\ControlFlowTok{else}\NormalTok{ \{}
    \FunctionTok{return}\NormalTok{(x }\SpecialCharTok{*} \DecValTok{2}\NormalTok{)}
\NormalTok{  \}}
\NormalTok{\}}

\FunctionTok{operacao}\NormalTok{(}\DecValTok{2}\NormalTok{)}
\DocumentationTok{\#\# [1] 1}
\FunctionTok{operacao}\NormalTok{(}\DecValTok{3}\NormalTok{)}
\DocumentationTok{\#\# [1] 6}

\FunctionTok{map\_dbl}\NormalTok{(}\DecValTok{1}\SpecialCharTok{:}\DecValTok{100}\NormalTok{, operacao)}
\DocumentationTok{\#\#   [1]   2   1   6   2  10   3  14   4  18   5  22   6  26   7  30   8  34   9}
\DocumentationTok{\#\#  [19]  38  10  42  11  46  12  50  13  54  14  58  15  62  16  66  17  70  18}
\DocumentationTok{\#\#  [37]  74  19  78  20  82  21  86  22  90  23  94  24  98  25 102  26 106  27}
\DocumentationTok{\#\#  [55] 110  28 114  29 118  30 122  31 126  32 130  33 134  34 138  35 142  36}
\DocumentationTok{\#\#  [73] 146  37 150  38 154  39 158  40 162  41 166  42 170  43 174  44 178  45}
\DocumentationTok{\#\#  [91] 182  46 186  47 190  48 194  49 198  50}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Use a função \texttt{map()} para criar gráficos de dispersão da receita vs orçamento para os filmes da base \texttt{imdb}. Os filmes de cada ano deverão compor um gráfico diferente. Faça o resultado ser (a) uma lista de gráficos e (b) uma nova coluna na base \texttt{imdb} (utilizando a função \texttt{tidyr::nest()}).

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"imdb.rds"}\NormalTok{)}

\CommentTok{\# gerando uma lista de gráficos}

\NormalTok{fazer\_grafico }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, ano\_) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==}\NormalTok{ ano\_) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{()}
\NormalTok{\}}

\NormalTok{anos }\OtherTok{\textless{}{-}} \FunctionTok{unique}\NormalTok{(imdb}\SpecialCharTok{$}\NormalTok{ano)}

\NormalTok{graficos }\OtherTok{\textless{}{-}} \FunctionTok{map}\NormalTok{(anos, fazer\_grafico, }\AttributeTok{tab =}\NormalTok{ imdb)}

\CommentTok{\# gerando uma coluna na tabela imdb}
\NormalTok{fazer\_grafico2 }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ orcamento, }\AttributeTok{y =}\NormalTok{ receita)) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{()}
\NormalTok{\}}


\NormalTok{imdb\_com\_graficos }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{group\_by}\NormalTok{(ano) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{  tidyr}\SpecialCharTok{::}\FunctionTok{nest}\NormalTok{() }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{mutate}\NormalTok{(}
    \AttributeTok{grafico =} \FunctionTok{map}\NormalTok{(data, fazer\_grafico2)}
\NormalTok{  )}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{5.} Utilize a função \texttt{walk} para salvar cada ano da base \texttt{imdb} em um arquivo \texttt{.rds} diferente, isto é, o arquivo \texttt{imdb\_2001.rds}, por exemplo, deve conter apenas filmes do ano de 2001.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{imdb }\OtherTok{\textless{}{-}}\NormalTok{ readr}\SpecialCharTok{::}\FunctionTok{read\_rds}\NormalTok{(}\StringTok{"imdb.rds"}\NormalTok{)}

\NormalTok{salvar\_base }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, ano\_) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{filter}\NormalTok{(ano }\SpecialCharTok{==}\NormalTok{ ano\_) }\SpecialCharTok{\%\textgreater{}\%} 
\NormalTok{    readr}\SpecialCharTok{::}\FunctionTok{write\_rds}\NormalTok{(}\AttributeTok{file =} \FunctionTok{paste0}\NormalTok{(}\StringTok{"teste/imdb\_"}\NormalTok{, ano\_, }\StringTok{".rds"}\NormalTok{))}
\NormalTok{\}}

\NormalTok{anos }\OtherTok{\textless{}{-}}\NormalTok{ imdb }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(ano)) }\SpecialCharTok{\%\textgreater{}\%} 
  \FunctionTok{pull}\NormalTok{(ano)}

\FunctionTok{walk}\NormalTok{(anos, salvar\_base, }\AttributeTok{tab =}\NormalTok{ imdb)}
\end{Highlighting}
\end{Shaded}

\hypertarget{nse-1}{%
\section{NSE}\label{nse-1}}

\begin{Shaded}
\begin{Highlighting}[]
\FunctionTok{library}\NormalTok{(dplyr)}
\FunctionTok{library}\NormalTok{(ggplot2)}
\end{Highlighting}
\end{Shaded}

\textbf{1.} Escreva uma função que recebe uma \emph{tibble} e uma coluna qualquer e devolve uma \emph{tibble} sem as linhas contendo \texttt{NA} na coluna especificada.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{tabela\_qualquer }\OtherTok{\textless{}{-}}\NormalTok{ tibble}\SpecialCharTok{::}\FunctionTok{tibble}\NormalTok{(}
  \AttributeTok{x =} \FunctionTok{c}\NormalTok{(}\DecValTok{1}\NormalTok{, }\DecValTok{2}\NormalTok{, }\DecValTok{3}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\DecValTok{6}\NormalTok{),}
  \AttributeTok{y =} \FunctionTok{c}\NormalTok{(}\StringTok{"a"}\NormalTok{, }\StringTok{"b"}\NormalTok{, }\ConstantTok{NA}\NormalTok{, }\StringTok{"d"}\NormalTok{, }\StringTok{"e"}\NormalTok{)}
\NormalTok{)}

\NormalTok{filtrar\_na }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, coluna) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(\{\{coluna\}\}))}
\NormalTok{\}}

\FunctionTok{filtrar\_na}\NormalTok{(tabela\_qualquer, x)}
\DocumentationTok{\#\# \# A tibble: 4 x 2}
\DocumentationTok{\#\#       x y    }
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}chr\textgreater{}}
\DocumentationTok{\#\# 1     1 a    }
\DocumentationTok{\#\# 2     2 b    }
\DocumentationTok{\#\# 3     3 \textless{}NA\textgreater{} }
\DocumentationTok{\#\# 4     6 e}
\FunctionTok{filtrar\_na}\NormalTok{(tabela\_qualquer, y)}
\DocumentationTok{\#\# \# A tibble: 4 x 2}
\DocumentationTok{\#\#       x y    }
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}chr\textgreater{}}
\DocumentationTok{\#\# 1     1 a    }
\DocumentationTok{\#\# 2     2 b    }
\DocumentationTok{\#\# 3    NA d    }
\DocumentationTok{\#\# 4     6 e}


\CommentTok{\# string como argumento}
\NormalTok{filtrar\_na }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, coluna) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{filter}\NormalTok{(}\SpecialCharTok{!}\FunctionTok{is.na}\NormalTok{(.data[[coluna]]))}
\NormalTok{\}}

\FunctionTok{filtrar\_na}\NormalTok{(tabela\_qualquer, }\StringTok{"x"}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 4 x 2}
\DocumentationTok{\#\#       x y    }
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}chr\textgreater{}}
\DocumentationTok{\#\# 1     1 a    }
\DocumentationTok{\#\# 2     2 b    }
\DocumentationTok{\#\# 3     3 \textless{}NA\textgreater{} }
\DocumentationTok{\#\# 4     6 e}
\FunctionTok{filtrar\_na}\NormalTok{(tabela\_qualquer, }\StringTok{"y"}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 4 x 2}
\DocumentationTok{\#\#       x y    }
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}chr\textgreater{}}
\DocumentationTok{\#\# 1     1 a    }
\DocumentationTok{\#\# 2     2 b    }
\DocumentationTok{\#\# 3    NA d    }
\DocumentationTok{\#\# 4     6 e}
\end{Highlighting}
\end{Shaded}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{2.} Escreva uma função que recebe uma \emph{tibble} e uma coluna e faz um gráfico de barras da frequência dessa coluna.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{criar\_grafico }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, coluna) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{count}\NormalTok{(\{\{coluna\}\}) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ \{\{coluna\}\}, }\AttributeTok{y =}\NormalTok{ n)) }\SpecialCharTok{+}
    \FunctionTok{geom\_col}\NormalTok{()}
\NormalTok{\}}

\FunctionTok{criar\_grafico}\NormalTok{(mtcars, cyl)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9881-respostas-nse_files/figure-latex/unnamed-chunk-4-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]

\CommentTok{\# string como argumento}
\NormalTok{criar\_grafico }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, coluna) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{count}\NormalTok{(.data[[coluna]]) }\SpecialCharTok{\%\textgreater{}\%}
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .data[[coluna]], }\AttributeTok{y =}\NormalTok{ n)) }\SpecialCharTok{+}
    \FunctionTok{geom\_col}\NormalTok{()}
\NormalTok{\}}

\FunctionTok{criar\_grafico}\NormalTok{(mtcars, }\StringTok{"cyl"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9881-respostas-nse_files/figure-latex/unnamed-chunk-4-2} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{3.} Escreva uma função que recebe uma \emph{tibble} e o nome de duas colunas numéricas e faz um gráfico de dispersão dessas colunas.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{fazer\_grafico\_disp }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, col1, col2) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ \{\{col1\}\}, }\AttributeTok{y =}\NormalTok{ \{\{col2\}\})) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{()}
\NormalTok{\}}

\FunctionTok{fazer\_grafico\_disp}\NormalTok{(mtcars, mpg, wt)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9881-respostas-nse_files/figure-latex/unnamed-chunk-5-1} \end{center}

\begin{Shaded}
\begin{Highlighting}[]


\CommentTok{\# string como argumento}

\NormalTok{fazer\_grafico\_disp }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, col1, col2) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{ggplot}\NormalTok{(}\FunctionTok{aes}\NormalTok{(}\AttributeTok{x =}\NormalTok{ .data[[col1]], }\AttributeTok{y =}\NormalTok{ .data[[col2]])) }\SpecialCharTok{+}
    \FunctionTok{geom\_point}\NormalTok{()}
\NormalTok{\}}

\FunctionTok{fazer\_grafico\_disp}\NormalTok{(mtcars, }\StringTok{"mpg"}\NormalTok{, }\StringTok{"wt"}\NormalTok{)}
\end{Highlighting}
\end{Shaded}

\begin{center}\includegraphics{9881-respostas-nse_files/figure-latex/unnamed-chunk-5-2} \end{center}

\begin{center}\rule{0.5\linewidth}{0.5pt}\end{center}

\textbf{4.} Escreva uma função que recebe uma \emph{tibble}, o nome de uma coluna categótica e o nome de uma coluna numérica e devolva uma tabela com a média da coluna numérica para cada categoria da coluna categórica.

\begin{Shaded}
\begin{Highlighting}[]
\NormalTok{calcular\_media }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, col\_grupo, col\_num) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{group\_by}\NormalTok{(\{\{col\_grupo\}\}) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(\{\{col\_num\}\}, }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{\}}

\FunctionTok{calcular\_media}\NormalTok{(mtcars, cyl, mpg)}
\DocumentationTok{\#\# \# A tibble: 3 x 2}
\DocumentationTok{\#\#     cyl media}
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\DocumentationTok{\#\# 1     4  26.7}
\DocumentationTok{\#\# 2     6  19.7}
\DocumentationTok{\#\# 3     8  15.1}


\CommentTok{\# string como argumento}
\NormalTok{calcular\_media }\OtherTok{\textless{}{-}} \ControlFlowTok{function}\NormalTok{(tab, col\_grupo, col\_num) \{}
\NormalTok{  tab }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{group\_by}\NormalTok{(.data[[col\_grupo]]) }\SpecialCharTok{\%\textgreater{}\%} 
    \FunctionTok{summarise}\NormalTok{(}\AttributeTok{media =} \FunctionTok{mean}\NormalTok{(.data[[col\_num]], }\AttributeTok{na.rm =} \ConstantTok{TRUE}\NormalTok{))}
\NormalTok{\}}

\FunctionTok{calcular\_media}\NormalTok{(mtcars, }\StringTok{"cyl"}\NormalTok{, }\StringTok{"mpg"}\NormalTok{)}
\DocumentationTok{\#\# \# A tibble: 3 x 2}
\DocumentationTok{\#\#     cyl media}
\DocumentationTok{\#\#   \textless{}dbl\textgreater{} \textless{}dbl\textgreater{}}
\DocumentationTok{\#\# 1     4  26.7}
\DocumentationTok{\#\# 2     6  19.7}
\DocumentationTok{\#\# 3     8  15.1}
\end{Highlighting}
\end{Shaded}

\hypertarget{referuxeancias}{%
\chapter*{Referências}\label{referuxeancias}}
\addcontentsline{toc}{chapter}{Referências}

Abaixo, listamos todas as referências utilizadas na construção deste livro.

\hypertarget{allison-horst}{%
\subsection*{Allison Horst}\label{allison-horst}}
\addcontentsline{toc}{subsection}{Allison Horst}

As ilustrações contidas nesse livro são da Allison Horst.

\begin{itemize}
\item
  Acompanhe o trabalho dela: \url{https://github.com/allisonhorst}
\item
  Repositório com as ilustrações: \url{https://github.com/allisonhorst/stats-illustrations}
\item
  Siga a Allison no Twitter: \url{https://twitter.com/allison_horst}
\end{itemize}

\hypertarget{programauxe7uxe3o-em-r}{%
\subsection*{Programação em R}\label{programauxe7uxe3o-em-r}}
\addcontentsline{toc}{subsection}{Programação em R}

\begin{itemize}
\item
  \href{https://r4ds.had.co.nz/}{R for Data Sciente}, do Garrett Grolemund e Hadley Wickham
\item
  \href{https://adv-r.hadley.nz/}{Advanced R}, do Hadley Wickham
\item
  \href{http://r-pkgs.had.co.nz/intro.html}{R packages}, do Hadley Wickham
\end{itemize}

\end{document}
